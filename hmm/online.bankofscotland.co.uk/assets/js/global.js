var LBG=window.LBG||{};LBG.browserIdent={browserIdent:false,browserVersions:{ff2:"1.8",ff3:"1.9"},sniff:function(){if($.browser.mozilla){var currentBrowser=LBG.common.parseVersionString($.browser.version);var ff2=LBG.common.parseVersionString(this.browserVersions.ff2);var ff3=LBG.common.parseVersionString(this.browserVersions.ff3);if(currentBrowser.major===ff2.major&&currentBrowser.minor<=ff2.minor){this.browserIdent="ff2";}else{if(currentBrowser.major===ff3.major&&currentBrowser.minor>=ff3.minor&&currentBrowser.patch<=ff3.patch){this.browserIdent="ff3";}}}else{if($.browser.msie){this.browserIdent=($.browser.version>6)?"ie":"ie6";}else{if(navigator.platform.indexOf("iPad")!==-1){this.browserIdent="iPad";}else{if(navigator.platform.indexOf("iPhone")!==-1){this.browserIdent="iPhone";}}}}return this.browserIdent;}};LBG.numericInputSupport={init:function(){if(!$("body").hasClass("numericInput")){for(var els=document.getElementsByTagName("input"),i=els.length;i--;){if(els[i].type=="number"){els[i].type="text";}}}}};LBG.accordion={currentTriggerClass:".current",panePrefix:"accPane",paneCount:1,linkAddedClass:"linkPointer hasLink",partSelector:".part",selectedClass:"selected",triggerTitle:DI.lang.accordion.trigger,isChrome:/chrome/.test(navigator.userAgent.toLowerCase()),build:function(accordionSelector,triggerSelector){var $accordion=$(accordionSelector);if(!$accordion.length){return false;}var $trigger=$accordion.find(triggerSelector);if(!$trigger.length){return false;}var container=$(".secondary:eq(0)")[0];$trigger.addClass(LBG.accordion.linkAddedClass);if(LBG.accordion.isChrome===false&&$.browser.safari===true&&(navigator.appVersion.indexOf("3.")!==-1)){$trigger.wrapInner('<a href="#" />').find("a").keydown(function(e){if(e.keyCode===13||e.keyCode===32){$(this).parent().click();}});}LBG.accordion.tabIndexFocusFix($trigger);$accordion.accordion({header:triggerSelector,active:LBG.accordion.currentTriggerClass,collapsible:true,autoHeight:false,clearStyle:true,changestart:function(event,ui){if(ui.newHeader){ui.newHeader.parent(LBG.accordion.partSelector).toggleClass(LBG.accordion.selectedClass);}LBG.accordion.tabIndexFocusFix($trigger);},change:function(event,ui){if(jQuery.browser.msie&&jQuery.browser.version<8){LBG.common.explorerRedrawFix(container,true);}if(ui.oldHeader){ui.oldHeader.parent(LBG.accordion.partSelector).toggleClass(LBG.accordion.selectedClass);$trigger.attr("tabIndex","-1").attr("tabIndex","0");}LBG.accordion.tabIndexFocusFix($trigger);}});$trigger.attr("tabIndex","-1").attr("tabIndex","0");$trigger.each(function(){this.title=$(this).text()+": "+LBG.accordion.triggerTitle;});},addOpenClass:function(){$(".accordion .current").parent().addClass("selected");},tabIndexFocusFix:function($trigger){if($.browser.safari===true||LBG.accordion.isChrome===true&&$.browser.version<=533){$trigger.parents(".part").each(function(){var i=($(this).hasClass(".selected")===true)?0:-1;$(this).find("a, .qfaqTrigger").attr("tabIndex",i);});$trigger.find("a:first").attr("tabIndex",0).bind("blur",function(){var anchor=this;var timer=window.setTimeout(function(){$(anchor).css("overflow","hidden");window.clearTimeout(timer);},10);});}},init:function(){this.build("ul.quickFAQs","h3.qfaqTrigger");this.build("div.accordion",".trigger");this.build("div.accordionLight","h2.trigger");this.build("ul.showHideAccordion",".trigger");this.build("div.tillReceipt.expandable","h3.trigger");this.build(".testingAccord",".testingTrigger");}};LBG.quickTransfer=(function(){var TRANSFER_SELECTOR=".quickTransfer",CLOSED_TEXT=DI.lang.quickTransfer.triggerClosedText,OPEN_TEXT=DI.lang.quickTransfer.triggerOpenText,HEADING_TEXT=DI.lang.quickTransfer.defaultHeadingText,TRANSFER_ID=DI.lang.quickTransfer.triggerID,OPEN_CLASS="close";function _processQuickTransferModule(){var $transfer=$(this),$trigger=$('<p class="transferTrigger"><a href="#" id="'+TRANSFER_ID+'">'+CLOSED_TEXT+"</a></p>"),$parent=$transfer.parent(),$anchor=$trigger.find("a:eq(0)");$parent.before($trigger);$trigger.find("a:eq(0)").click(function(){$parent.slideToggle(400,function(){if($anchor.html()===CLOSED_TEXT){$anchor.html(OPEN_TEXT);}else{$anchor.html(CLOSED_TEXT);}$anchor.toggleClass(OPEN_CLASS);$parent.find(".success").removeClass("success").html(HEADING_TEXT);$(this).stop();});return false;});if(!$transfer.hasClass("open")){$parent.hide();}else{var triggerLink=$("p.transferTrigger").children("a");triggerLink.html(OPEN_TEXT);triggerLink.toggleClass(OPEN_CLASS);if($transfer.find(".success").length>0){LBG.common.effects.highlightElement(".transferSlideOuter");}}}return{init:function(){$(TRANSFER_SELECTOR).each(_processQuickTransferModule);}};})();LBG.iban={triggerSelector:".viewIban > a",statementWrapperSelector:".ibanPlaceholder",slideHTML:'<div class="ibanSlide"></div>',triggerOpenText:DI.lang.iban.triggerOpenText,triggerOpenClass:"open",loadMsg:'<span class="loading">&nbsp;</span>',loadErrorMsg:DI.lang.iban.loadErrorMsgStub,init:function(){$(this.triggerSelector).each(function(i,trigger){var statementItem=$(trigger).parents()[2],requested=false;trigger.wrapper=$(statementItem).find(LBG.iban.statementWrapperSelector)[0];trigger.slide=$(LBG.iban.slideHTML);$(trigger.wrapper).append(trigger.slide);trigger.slide.hide();trigger.slide.loaded=false;trigger.savedText=$(trigger).text();$(trigger).click(function(){if(trigger.slide.is(":animated")){return false;}if(!this.slide.loaded&&requested===false){requested=true;$(this).parent().append(LBG.iban.loadMsg);$.ajax({url:LBG.common.ajax.tagUrl(LBG.common.ajax.getAjaxURI(trigger)),success:function(response){trigger.slide.html(response);trigger.slide.loaded=true;$(trigger).parent().find("span").not("span.cxtHelp").remove();LBG.ajax.pageUpdated();if(typeof LBG.smartRewards!=="undefined"&&typeof LBG.smartRewards.statementCashbackOffers.init==="function"){LBG.smartRewards.statementCashbackOffers.init($(trigger.wrapper));}if(typeof dcsMultiTrack!="undefined"){dcsMultiTrack("WT.ac","pages/p27_00_account_statement/properties.p2700lnk507a,pages/p27_00_account_statement/properties.p2700lnk510a,Show IBAN / BIC,Hide IBAN/BIC");}trigger.slide.slideToggle(500,function(){$(trigger).toggleClass(LBG.iban.triggerOpenClass);if($(trigger).text()===trigger.savedText){$(trigger).text(LBG.iban.triggerOpenText);$(trigger.slide).find("li.close a").text(LBG.iban.triggerOpenText);}else{$(trigger).text(trigger.savedText);}$(this).stop();return false;});$(trigger.slide).find("li.close a").click(function(){trigger.slide.loaded=false;trigger.slide.slideToggle(500,function(){$(trigger).toggleClass(LBG.iban.triggerOpenClass);if($(trigger).text()===trigger.savedText){$(trigger).text(LBG.iban.triggerOpenText);}else{$(trigger).text(trigger.savedText);}$(this).stop();});return false;});},error:function(){$.ajax({url:LBG.iban.loadErrorMsg,dataType:"html",success:function(data){trigger.slide.html(data);}});$(trigger).parent().find("span").remove();trigger.slide.slideToggle(500,function(){$(trigger).toggleClass(LBG.iban.triggerOpenClass);if($(trigger).text()===trigger.savedText){$(trigger).text(LBG.iban.triggerOpenText);}else{$(trigger).text(trigger.savedText);}$(this).stop();return false;});}});}else{trigger.slide.slideToggle(500,function(){trigger.slide.loaded=false;$(trigger).toggleClass(LBG.iban.triggerOpenClass);if($(trigger).text()===trigger.savedText){$(trigger).text(LBG.iban.triggerOpenText);}else{$(trigger).text(trigger.savedText);}$(this).stop();return false;});}return false;});});}};LBG.miniStatement={triggerSelector:".viewMiniStatement a",statementWrapperSelector:".miniStatementPlaceholder",slideHTML:'<div class="miniStatementSlide"></div>',triggerOpenText:DI.lang.miniStatement.triggerOpenText,triggerOpenClass:"open",loadMsg:'<span class="loading">&nbsp;</span>',loadErrorMsg:DI.lang.miniStatement.loadErrorMsgStub,init:function(){$(this.triggerSelector).each(function(i,trigger){var statementItem=$(trigger).parents()[2],requested=false;
trigger.wrapper=$(statementItem).find(LBG.miniStatement.statementWrapperSelector)[0];trigger.slide=$(LBG.miniStatement.slideHTML);$(trigger.wrapper).append(trigger.slide);trigger.slide.hide();trigger.slide.loaded=false;trigger.savedText=$(trigger).text();$(trigger).click(function(){if(trigger.slide.is(":animated")){return false;}if(!this.slide.loaded&&requested===false){requested=true;$(this).parent().append(LBG.miniStatement.loadMsg);$.ajax({url:LBG.common.ajax.tagUrl(LBG.common.ajax.getAjaxURI(trigger)),success:function(response){trigger.slide.html(response);trigger.slide.loaded=true;$(trigger).parent().find("span").remove();LBG.ajax.pageUpdated();if(typeof LBG.smartRewards!=="undefined"&&typeof LBG.smartRewards.statementCashbackOffers.init==="function"){LBG.smartRewards.statementCashbackOffers.init($(trigger.wrapper));}trigger.slide.slideToggle(500,function(){$(trigger).toggleClass(LBG.miniStatement.triggerOpenClass);if($(trigger).text()===trigger.savedText){$(trigger).text(LBG.miniStatement.triggerOpenText);$(trigger.slide).find("li.close a").text(LBG.miniStatement.triggerOpenText);}else{$(trigger).text(trigger.savedText);}$(this).stop();return false;});$(trigger.slide).find("li.close a").click(function(){trigger.slide.loaded=false;trigger.slide.slideToggle(500,function(){$(trigger).toggleClass(LBG.miniStatement.triggerOpenClass);if($(trigger).text()===trigger.savedText){$(trigger).text(LBG.miniStatement.triggerOpenText);}else{$(trigger).text(trigger.savedText);}$(this).stop();});return false;});},error:function(){$.ajax({url:LBG.miniStatement.loadErrorMsg,dataType:"html",success:function(data){trigger.slide.html(data);}});$(trigger).parent().find("span").remove();trigger.slide.slideToggle(500,function(){$(trigger).toggleClass(LBG.miniStatement.triggerOpenClass);if($(trigger).text()===trigger.savedText){$(trigger).text(LBG.miniStatement.triggerOpenText);}else{$(trigger).text(trigger.savedText);}$(this).stop();return false;});}});}else{trigger.slide.slideToggle(500,function(){trigger.slide.loaded=false;$(trigger).toggleClass(LBG.miniStatement.triggerOpenClass);if($(trigger).text()===trigger.savedText){$(trigger).text(LBG.miniStatement.triggerOpenText);}else{$(trigger).text(trigger.savedText);}$(this).stop();return false;});}return false;});});}};LBG.scottishWidows={triggerSelector:".viewScottishWidowsAccounts a",listWrapperSelector:".scottishWidowsAccountsPlaceholder",slideHTML:'<div class="scottishWidowsAccountsSlide"></div>',triggerOpenClass:"open",loadMsg:'<span class="loading">&nbsp;</span>',loadErrorMsg:'<p class="asyncError">'+DI.lang.scottishWidows.loadErrorMsgText+"</p>",init:function(){$(this.triggerSelector).each(function(i,trigger){var accountListItem=$(trigger).parents()[2],requested=false;trigger.wrapper=$(accountListItem).find(LBG.scottishWidows.listWrapperSelector)[0];trigger.slide=$(LBG.scottishWidows.slideHTML);$(trigger.wrapper).append(trigger.slide);trigger.slide.hide();trigger.slide.loaded=false;$(trigger).click(function(){if(!this.slide.loaded&&requested===false){requested=true;$(this).parent().append(LBG.scottishWidows.loadMsg);$.ajax({url:LBG.common.ajax.tagUrl(LBG.common.ajax.getAjaxURI(trigger)),success:function(response){trigger.slide.html(response);trigger.slide.loaded=true;$(trigger).parent().find("span").remove();LBG.ajax.pageUpdated();trigger.slide.slideToggle(500,function(){$(trigger).toggleClass(LBG.scottishWidows.triggerOpenClass);$(this).stop();return false;});},error:function(){trigger.slide.html(LBG.scottishWidows.loadErrorMsg);trigger.slide.loaded=true;$(trigger).parent().find("span").remove();trigger.slide.slideToggle(500,function(){$(trigger).toggleClass(LBG.scottishWidows.triggerOpenClass);$(this).stop();return false;});}});}else{if(!trigger.slide.is(":animated")){trigger.slide.slideToggle(500,function(){trigger.slide.loaded=false;$(trigger).toggleClass(LBG.scottishWidows.triggerOpenClass);$(this).stop();return false;});}}return false;});});}};LBG.showHide={toggleSelector:".showHide",toggleSelectorBind:".showHideBind",triggerSelector:".trigger",triggerContent:'<span class="toggle"></span>',paneSelector:"div.pane",tempIDPrefix:"show",closedClass:"closed",showSingle:false,triggerTitle:DI.lang.showHide.trigger,formFixClass:"safariFormFix",hasNestedClass:"hasNested",updateTriggerTitle:function($trigger){$trigger.each(function(){this.title=$.trim($(this).text())+": "+$.trim(LBG.showHide.triggerTitle);});},init:function(){$(this.toggleSelector).find(this.triggerSelector).each(function(i,trigger){var thePane=$(trigger).siblings(LBG.showHide.paneSelector)[0]||null;var $pane=$(thePane);var meta=$(trigger).parents(LBG.showHide.toggleSelector).metadata();var allowMultipleAjaxRequests=meta&&meta.allowMultipleAjaxRequests?true:false;var triggerID="";if(meta&&meta.target){thePane=$(meta.target)[0];}if(!thePane){return;}var tmpID=LBG.showHide.tempIDPrefix+i;if(thePane.id){tmpID=thePane.id;}else{thePane.id=tmpID;}$(trigger).append(LBG.showHide.triggerContent).data("thePaneId",thePane.id);if($(trigger)[0].tagName.toLowerCase()!=="a"&&!meta.triggerNoLink){$(trigger).wrapInner('<a href="#'+tmpID+'" class="triggerChild"></a>');if(trigger.id){$("a:first",trigger).attr("id",trigger.id);$(trigger).removeAttr("id");}}else{$(trigger).wrapInner('<span class="triggerChild"></span>');}if($(trigger).closest(LBG.showHide.toggleSelector).hasClass("resets")){trigger.resets=thePane.innerHTML;}if(($(trigger).parent().next().hasClass("clearer"))===false&&document.body.style.maxHeight!==undefined){$(trigger).parent().after('<div class="clearer"></div>');}if($(trigger).parents(LBG.showHide.toggleSelector).hasClass(LBG.showHide.closedClass)){$(thePane).hide();}if(trigger.tagName.toLowerCase()==="a"){$(trigger).click(function(event){event.preventDefault();});}$(".triggerChild",trigger).each(function(){$(this).click(function(){if(LBG.showHide.showSingle){var closeTrigger=$(LBG.showHide.paneSelector+":visible").parent().find(LBG.showHide.triggerSelector);if(closeTrigger.length>0&&closeTrigger.find(".triggerChild").get(0).hash!==this.hash){LBG.showHide.toggleDisplay(closeTrigger);}}if($(trigger).parent().hasClass(LBG.showHide.toggleSelectorBind)){var $collection=$(LBG.showHide.toggleSelectorBind).find(LBG.showHide.triggerSelector);$collection.each(function(){LBG.showHide.toggleDisplay($(this)[0]);});}else{LBG.showHide.toggleDisplay($(trigger)[0]);}if(trigger.actionFlag&&!LBG.common.isEmpty($(trigger).metadata().async)){if(!$pane.hasClass("show-hide-async-loaded")){$pane.addClass("async-loading").html('<div class="async-loading-message">loading...</div>');$.ajax({url:$(trigger).metadata().async.url,cache:false,dataType:"html",success:function(data){$pane.html(data);$pane.removeClass("async-loading");if(!allowMultipleAjaxRequests){$pane.addClass("show-hide-async-loaded");}}});}}return false;});if(this.tagName.toLowerCase()!=="a"){$(this).attr("tabIndex",0).keydown(function(e){if(e.keyCode===32||e.keyCode===13){$(this).click();return false;}});if($.browser.msie&&$.browser.version<7){$(this).hover(function(){$(this).addClass("hover");},function(){$(this).removeClass("hover");});}}});LBG.showHide.updateTriggerTitle($(this).find(".triggerChild"));});if($(this.toggleSelector+":first").parent().hasClass("show_single")){this.showSingle=true;}$(".showHide .part.closed .pane").css("display","none");},toggleDisplay:function(trigger){var $closeAppliedTo=$(trigger).parent();var $thePane=$(trigger).siblings(LBG.showHide.paneSelector);if(!$thePane.length){$thePane=$("#"+$(trigger).data("thePaneId"));
}if(!trigger.busyFlag){trigger.busyFlag=true;if(jQuery.browser.safari){$(trigger).parents("form").toggleClass(LBG.showHide.formFixClass);}if($closeAppliedTo.hasClass(LBG.showHide.closedClass)){$closeAppliedTo.toggleClass(LBG.showHide.closedClass);trigger.actionFlag=true;}$thePane.slideToggle("slow",function(){var meta=$(trigger).metadata().label;if(trigger.actionFlag){trigger.actionFlag=false;if(typeof(LBG.ommDetect)!=="undefined"){LBG.ommDetect.revealLoader(trigger);}if(meta){$(trigger).find(".triggerChild")[0].firstChild.nodeValue=meta.open;}}else{$closeAppliedTo.toggleClass(LBG.showHide.closedClass);trigger.actionFlag=true;if(trigger.resets){$(this).html(trigger.resets);LBG.Forms.Validation.init(this);}if(meta){$(trigger).find(".triggerChild")[0].firstChild.nodeValue=meta.closed;}}LBG.showHide.updateTriggerTitle($(trigger).find(".triggerChild"));trigger.busyFlag=false;});}}};LBG.tableSorter={tableSelector:"table.sortable",zeroPaddingSize:30,init:function(){var months={"JAN":"01","FEB":"02","MAR":"03","APR":"04","MAY":"05","JUN":"06","JUL":"07","AUG":"08","SEP":"09","OCT":"10","NOV":"11","DEC":"12"};$.tablesorter.addParser({id:"LBGShortDate",is:function(s){return(/(\d{2}) ([A-Za-z]{3}) (\d{2})/.test(s));},format:function(s,table){var c=table.config,y;var dateParts=s.match(/(\d{2}) ([A-Za-z]{3}) (\d{2})/);if(dateParts&&dateParts.length===4){y=(parseFloat(dateParts[3])<2000)?parseFloat(dateParts[3])+2000:parseFloat(dateParts[3]);return $.tablesorter.formatFloat(new Date(y,months[dateParts[2].toUpperCase()],dateParts[1]).getTime());}},type:"numeric"});$.tablesorter.addParser({id:"LBGDateDDMMMYY",is:function(s){return false;},format:function(s){s=$.trim(s);var regEx="^[\\d]{2}[/|\\s]{1}[A-Za-z]{3}[/|\\s]{1}[\\d]{2}";var date=s.match(regEx);if(date!==null){date=date[0];date=date.replace(/\s/g,"/");date=date.split("/");date[1]=months[date[1].toUpperCase()];return date.reverse().join("");}else{return"999999";}},type:"numeric"});$.tablesorter.addParser({id:"LBGAlphaNumeric",is:function(s){return false;},format:function(s){var numCheck=new RegExp("^[\d{1}]");var stripHTML=new RegExp("<(?:.|s)*?>","g");s=$.trim(s.replace(stripHTML,"").toLowerCase());return(numCheck.test(s)===false)?"0"+s:LBG.common.zeroPadding(s,LBG.tableSorter.zeroPaddingSize);},type:"text"});$(LBG.tableSorter.tableSelector).tablesorter({dateFormat:"uk"});$(LBG.tableSorter.tableSelector).find(".header").makeTabbable(0);if(jQuery.browser.safari&&(navigator.appVersion.indexOf("3.")!==-1)){$(LBG.tableSorter.tableSelector).find(".header").each(function(){$(this).wrapInner('<a href="#" class="sortingTrigger"></a>');});}}};LBG.textAlerts={registerSelector:".registerTextAlerts",textAlertsTableSelector:".textAlerts",tableWithInputsSelector:".textAlertInputs",validationClass:"validate:(required)",formFieldClass:".formField",init:function(){$(LBG.textAlerts.textAlertsTableSelector+" input:checkbox").each(function(){var hasSiblingInputs;if($.browser.msie===true&&$.browser.version<8){var $checkbox=$(this),$oldLabel=$checkbox.prev("label.postit"),$newLabel=$oldLabel.clone().removeClass("postit"),$formField=$checkbox.parents(LBG.textAlerts.formFieldClass),$spanLabel=$("<span />");$formField.addClass("checkbox");$spanLabel.addClass("postit").html($newLabel.html());$spanLabel.insertBefore($checkbox);$oldLabel.remove();$newLabel.html("");$spanLabel.add($checkbox).wrapAll($newLabel);}hasSiblingInputs=$(this).parents(LBG.textAlerts.tableWithInputsSelector).length;if(hasSiblingInputs>0){if(!this.checked){LBG.textAlerts.updateRowInputs(this,this.checked);}}$(this).click(function(){if(hasSiblingInputs){LBG.textAlerts.updateRowInputs(this,this.checked);}if($(this).parents(LBG.textAlerts.registerSelector).length>0){LBG.textAlerts.updateSiblingCheckboxes(this);}});});},updateRowInputs:function(input,checked){var that=this;this.$inputAdjacentCells=$(input).parents("tr").find("div.formField");this.validationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject(this.$inputAdjacentCells);if(checked){this.$inputAdjacentCells.find(':input[type!="checkbox"]').attr("disabled","").removeClass("isDisabled");this.validationHandler.isValid=false;this.validationHandler.findChildren($(input).parents("tr"));}else{this.validationHandler.hideError();$(input).parents("td").siblings("td").each(function(){that.validationHandler.removeChildren($(this));});this.$inputAdjacentCells.find(':input[type!="checkbox"]').val("-");this.$inputAdjacentCells.find(':input[type="text"]').val("");this.$inputAdjacentCells.find(':input[type!="checkbox"]').attr("disabled","disabled").addClass("isDisabled");}LBG.ajax.pageUpdated();},updateSiblingCheckboxes:function(input){var $siblingCheckboxes=$(input).parents(LBG.textAlerts.textAlertsTableSelector).find("input:checkbox");var checkedElements=0;var i,len,disableCheckboxes=false;if($siblingCheckboxes.length>5){for(i=0,len=$siblingCheckboxes.length;i<len;i++){if($siblingCheckboxes[i].checked){checkedElements++;}}if(checkedElements===5){disableCheckboxes=true;}for(i=0;i<len;i++){if(!$siblingCheckboxes[i].checked){$siblingCheckboxes[i].disabled=disableCheckboxes;}}}LBG.ajax.pageUpdated();}};LBG.autoTotal={init:function(){if($("div.total").parent("form.balanceTransfer").length){$("fieldset.balanceTransfer").each(function(){var $amounts=$("input.amount");$("input.calculate").remove();$("span.totalAmount").autoTotal($amounts);});}else{if($("fieldset.balanceTransfer").length){$("fieldset.balanceTransfer").each(function(){$("input.calculate",this).remove();if($(".total",this).length){var $amounts=$("input.amount",this);$("span.totalAmount",this).autoTotal($amounts);}});}}var modifiers=DI.lang.autoTotalModifiers.bulkPaymentCalculator;$("div.bulkPaymentCalculator").each(function(){var $amounts=$("input.amount",this);$("input.calculate",this).remove();$(".subtotal span.value",this).autoTotal($amounts);$(".contingency span.value",this).autoTotal($amounts,modifiers.contingency);$(".grandTotal span.value",this).autoTotal($amounts,modifiers.grandTotal);});LBG.autoTotal.batchLimit();$(".loanRequirements").each(function(){var $amounts=$(".amount",this);$("input.calculate",this).remove();$(".totalAmount",this).autoTotal($amounts);});},batchLimit:function(){var limit,$amounts,total;$("form.amendBulkPayments").each(function(){$amounts=$("input.amount",this);$("input.calculate",this).remove();$("span.batchTotal, th.totalLimit",this).autoTotal($amounts);$("span.remainingLimit, th.remainingLimit",this).autoTotal($amounts,function(x){if(limit===undefined){limit=0;}total=(limit||0)-x;return Math.round(total*100)/100;});});$("select.payDate").change(function(){if(this.value==="-"){$(".batchAmount p.off").show();$(".batchAmount p.on").hide();}else{$(".batchAmount p.off").hide();$(".batchAmount p.on").show();}limit=$(":selected",this).metadata().limit;if(limit===undefined){limit=0;}if($amounts.length>0){$amounts.blur();}else{$("span.batchTotal, th.totalLimit").text(LBG.common.formatCurrencyString(0));$("span.remainingLimit, th.remainingLimit").text(LBG.common.formatCurrencyString(limit));}}).change();}};LBG.datePicker={constants:{datePickerSelector:"input.datePicker",parentSelector:"div.inputGroup",parentFormFieldSelector:"div.formField",daySelector:"select.slctDay",monthSelector:"select.slctMonth",yearSelector:"select.slctYear",calendarIconSelector:"img.ui-datepicker-trigger"},tools:{convertDetailsToDate:function(details){details=details.split("-");var yyyy=details[0];var mm=details[1];var dd=details[2];return new Date(yyyy,mm-1,dd);
},checkLinkedInputDays:function(hiddenDatePickerTextInput){var daysInMonth=32-new Date(hiddenDatePickerTextInput.parentWrapperElement.find(LBG.datePicker.constants.yearSelector).val(),hiddenDatePickerTextInput.parentWrapperElement.find(LBG.datePicker.constants.monthSelector).val()-1,32).getDate();if(hiddenDatePickerTextInput.parentWrapperElement.find(LBG.datePicker.constants.daySelector).val()>daysInMonth){hiddenDatePickerTextInput.parentWrapperElement.find(LBG.datePicker.constants.daySelector).val(daysInMonth);}},transferDateRangeRestrictionRulesToDatepicker:function(validationRoutineDetails,defaultOptions){if(validationRoutineDetails.minDate!==undefined){defaultOptions.minDate=LBG.datePicker.tools.convertDetailsToDate(validationRoutineDetails.minDate);}if(validationRoutineDetails.maxDate!==undefined){defaultOptions.maxDate=LBG.datePicker.tools.convertDetailsToDate(validationRoutineDetails.maxDate);}return defaultOptions;},findOtherDatePickerInRangePair:function(datePicker){var $formField=$(datePicker).parents(".formField"),datePickerType=datePicker.typeOfDatePicker,datePickerPairName=datePicker.datePickerGroupName,otherDatePickers,otherDatePickerInRangePair;if(datePickerType==="to"){otherDatePickers=$formField.find("input.datePicker.from");}else{if(datePickerType==="from"){otherDatePickers=$formField.find("input.datePicker.to");}}for(var i=0,len=otherDatePickers.length;i<len;i++){if(otherDatePickers[i].datePickerGroupName!==datePickerPairName){otherDatePickerInRangePair=otherDatePickers[i];break;}}return otherDatePickerInRangePair;}},defaultOptions:{showButtonPanel:true,closeText:" ",buttonText:DI.lang.datePicker.buttonText,buttonImage:DI.lang.datePicker.buttonImage,dayNamesLong:DI.lang.datePicker.dayNamesLong,dayNamesMin:DI.lang.datePicker.dayNamesMin,monthNames:DI.lang.datePicker.monthNames,dateFormat:"dd/mm/yyyy",minDate:null,maxDate:null,beforeShowDay:function(date){var isValidDateToSelect=true;var dayOfMonth=date.getDate();var monthOfYear=date.getMonth();var year=date.getFullYear();var daysOfWeekNames=["sun","mon","tue","wed","thu","fri","sat"];var dayOfWeekEntered=daysOfWeekNames[date.getDay()];var monthsOfYearNames=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"];var monthOfYearEnteredName=monthsOfYearNames[monthOfYear],j,len;var validationRoutineDetails=this.validationRoutines.validateDateRestriction;if(validationRoutineDetails!==undefined){if(validationRoutineDetails.invalidDays!==undefined){if(typeof validationRoutineDetails.invalidDays==="string"){validationRoutineDetails.invalidDays=[validationRoutineDetails.invalidDays];}for(j=0,len=validationRoutineDetails.invalidDays.length;j<len;j++){var validationRoutineDetailsSplit=validationRoutineDetails.invalidDays[j].split("-");if(year===parseInt(validationRoutineDetailsSplit[0],10)&&monthOfYear===parseInt(validationRoutineDetailsSplit[1]-1,10)&&dayOfMonth===parseInt(validationRoutineDetailsSplit[2],10)){isValidDateToSelect=false;}}}if(validationRoutineDetails.invalidDaysOfWeek!==undefined){if(typeof validationRoutineDetails.invalidDaysOfWeek==="string"){validationRoutineDetails.invalidDaysOfWeek=[validationRoutineDetails.invalidDaysOfWeek];}for(j=0,len=validationRoutineDetails.invalidDaysOfWeek.length;j<len;j++){if(dayOfWeekEntered===validationRoutineDetails.invalidDaysOfWeek[j]){isValidDateToSelect=false;}}}if(validationRoutineDetails.invalidMonths!==undefined){if(typeof validationRoutineDetails.invalidMonths==="string"){validationRoutineDetails.invalidMonths=[validationRoutineDetails.invalidMonths];}for(j=0,len=validationRoutineDetails.invalidMonths.length;j<len;j++){if(monthOfYearEnteredName===validationRoutineDetails.invalidMonths[j]){isValidDateToSelect=false;}}}}return[isValidDateToSelect,""];},showOn:"both",hideIfNoPrevNext:true,buttonImageOnly:true,changeMonth:false,changeYear:false,beforeShow:function(){if(LBG.Forms.Validation.Routines.validDate(this.parentWrapperElement)){var year=parseInt(this.parentWrapperElement.find(LBG.datePicker.constants.yearSelector).val(),10),month=parseInt(this.parentWrapperElement.find(LBG.datePicker.constants.monthSelector).val(),10)-1,day=parseInt(this.parentWrapperElement.find(LBG.datePicker.constants.daySelector).val(),10);this.$hiddenDatePickerTextInput.val(day+"/"+(month+1)+"/"+year);return{defaultDate:new Date(year,month,day)};}else{return{defaultDate:null};}},onClose:function(){$(this).next().focus();},onSelect:function(date){this.parentWrapperElement.find(LBG.datePicker.constants.daySelector).val(date.slice(0,2));this.parentWrapperElement.find(LBG.datePicker.constants.monthSelector).val(date.slice(3,5));this.parentWrapperElement.find(LBG.datePicker.constants.yearSelector).val(date.slice(6,10));if(this.parentWrapperElement.parents(".radioGroup").length>0){this.parentWrapperElement.prevAll("input:radio").get(0).checked=true;}this.parentWrapperElement.find(LBG.datePicker.constants.datePickerSelector).blur();if(this.typeOfDatePicker==="single"){this.parentWrapperElement.find(LBG.datePicker.constants.daySelector).focus();this.parentWrapperElement.find(LBG.datePicker.constants.daySelector).blur();}else{if(this.typeOfDatePicker==="to"||this.typeOfDatePicker==="from"){var otherDatePickerInRangePair=LBG.datePicker.tools.findOtherDatePickerInRangePair(this);if(typeof otherDatePickerInRangePair!=="undefined"){if(otherDatePickerInRangePair.parentWrapperElement.find(LBG.datePicker.constants.daySelector).val()!==""&&this.parentWrapperElement.find(LBG.datePicker.constants.daySelector).val()!==""){this.parentWrapperElement.find(LBG.datePicker.constants.daySelector).focus();this.parentWrapperElement.find(LBG.datePicker.constants.daySelector).blur();this.parentWrapperElement.find(LBG.datePicker.constants.monthSelector).focus();this.parentWrapperElement.find(LBG.datePicker.constants.monthSelector).blur();this.parentWrapperElement.find(LBG.datePicker.constants.yearSelector).focus();this.parentWrapperElement.find(LBG.datePicker.constants.yearSelector).blur();}}if(this.maxRangeInMonths!==undefined){if(typeof otherDatePickerInRangePair!=="undefined"){otherDatePickerInRangePair.$hiddenDatePickerTextInput.datepicker("destroy");}var defaultOptions=LBG.datePicker.defaultOptions;if(this.typeOfDatePicker==="to"){var toDate=this.$hiddenDatePickerTextInput.datepicker("getDate");var newFromDate=new Date(toDate);newFromDate.setMonth(parseInt(newFromDate.getMonth(),10)-parseInt(this.maxRangeInMonths,10));if(this.originalMinDate!==null&&newFromDate<this.originalMinDate){newFromDate=this.originalMinDate;}defaultOptions.minDate=newFromDate;defaultOptions.maxDate=toDate;}else{if(this.typeOfDatePicker==="from"){var fromDate=this.$hiddenDatePickerTextInput.datepicker("getDate");var newToDate=new Date(fromDate);newToDate.setMonth(parseInt(newToDate.getMonth(),10)+parseInt(this.maxRangeInMonths,10));if(this.originalMaxDate!==null&&newToDate>this.originalMaxDate){newToDate=this.originalMaxDate;}defaultOptions.minDate=fromDate;defaultOptions.maxDate=newToDate;}}if(typeof otherDatePickerInRangePair!=="undefined"){otherDatePickerInRangePair.$hiddenDatePickerTextInput.datepicker(defaultOptions);}}if($(otherDatePickerInRangePair).next("a").find(LBG.datePicker.constants.calendarIconSelector).length===0){$(otherDatePickerInRangePair).siblings("a").remove();LBG.datePicker.selectableCalendarIcon(otherDatePickerInRangePair);}}}}},init:function(){$(LBG.datePicker.constants.datePickerSelector).each(function(){var that=this;if($.browser.msie&&$.browser.version<7){this.parentFormField=$(this).parents(LBG.datePicker.constants.parentFormFieldSelector+":first");
}else{LBG.datePicker.createDatePicker.call(this,this,LBG.datePicker.defaultOptions);var preWrapWidth=$(this).parent().width();LBG.datePicker.selectableCalendarIcon(this);if($.browser.safari){$(this).parent().width(preWrapWidth+20);}}$(this).parents(LBG.datePicker.constants.parentSelector).find(".date select").change(function(){LBG.datePicker.updateRangeDatePickers.call(that);});$(this).attr("tabIndex",-1);});},selectableCalendarIcon:function(input){$(input).siblings(LBG.datePicker.constants.calendarIconSelector).wrap("<a href='#'></a>").parent().css({"float":"left","display":"block","overflow":"hidden"}).click(function(e){e.preventDefault();$(this).find(LBG.datePicker.constants.calendarIconSelector).click();});},createDatePicker:function(hiddenDatePickerTextInput,defaultOptions){var that=this;this.$hiddenDatePickerTextInput=$(hiddenDatePickerTextInput);this.parentFormField=this.$hiddenDatePickerTextInput.parents(LBG.datePicker.constants.parentFormFieldSelector+":first");this.parentWrapperElement=this.$hiddenDatePickerTextInput.parents(LBG.datePicker.constants.parentSelector+":first");this.typeOfDatePicker="single";if(this.$hiddenDatePickerTextInput.hasClass("to")){this.typeOfDatePicker="to";}else{if(this.$hiddenDatePickerTextInput.hasClass("from")){this.typeOfDatePicker="from";}}this.datePickerGroupName=LBG.Forms.Validation.Tools.convertClassDetailsToData(this,"datePickerGroupName:")[0];this.validationRoutines=LBG.Forms.Validation.Tools.convertClassDetailsToData(this.parentFormField.get(0),"validate:");var formFieldGroupValidationRoutines=LBG.Forms.Validation.Tools.convertClassDetailsToData(this.parentFormField.get(0),"formFieldGroup:");for(var i=0,len=formFieldGroupValidationRoutines.length;i<len;i++){this.validationRoutines.push(formFieldGroupValidationRoutines[i]);this.validationRoutines[formFieldGroupValidationRoutines[i]]=formFieldGroupValidationRoutines[formFieldGroupValidationRoutines[i]];}this.originalMaxDate=null;this.originalMinDate=null;this.validateDateRestriction=false;for(i=0,len=this.validationRoutines.length;i<len;i++){var validationRoutineName=this.validationRoutines[i];var validationRoutineDetails=this.validationRoutines[validationRoutineName];if(validationRoutineName==="validateDateTimeRange"||validationRoutineName==="specificDateWithRadio"||validationRoutineName==="validateDateRangeIsInRange"||validationRoutineName==="validateDatesAreInRange"){defaultOptions.minDate=null;defaultOptions.maxDate=null;defaultOptions=LBG.datePicker.tools.transferDateRangeRestrictionRulesToDatepicker(validationRoutineDetails,defaultOptions);this.originalMinDate=defaultOptions.minDate;this.originalMaxDate=defaultOptions.maxDate;}if(validationRoutineName==="validateDateRange"||validationRoutineName==="validateDatesRelativeRange"){this.maxRangeInMonths=validationRoutineDetails.maxRangeInMonths;}if(validationRoutineName==="validateDateRestriction"){this.validateDateRestriction=true;}}this.$hiddenDatePickerTextInput.datepicker(defaultOptions);$(this.parentWrapperElement.find(LBG.datePicker.constants.monthSelector)).bind("change",function(){LBG.datePicker.tools.checkLinkedInputDays(that);});$(this.parentWrapperElement.find(LBG.datePicker.constants.yearSelector)).bind("change",function(){LBG.datePicker.tools.checkLinkedInputDays(that);});},updateRangeDatePickers:function(){if(this.parentFormField.parents(".radioGroup").length>0){this.parentFormField.find("input:radio").get(0).checked=true;}if($.browser.msie&&$.browser.version<7){return;}if(LBG.Forms.Validation.Routines.validDate(this.parentWrapperElement)){var year=parseInt(this.parentWrapperElement.find(LBG.datePicker.constants.yearSelector).val(),10),month=parseInt(this.parentWrapperElement.find(LBG.datePicker.constants.monthSelector).val(),10)-1,day=parseInt(this.parentWrapperElement.find(LBG.datePicker.constants.daySelector).val(),10);this.$hiddenDatePickerTextInput.val(day+"/"+(month+1)+"/"+year);if(this.typeOfDatePicker==="to"||this.typeOfDatePicker==="from"){var otherDatePickerInRangePair=LBG.datePicker.tools.findOtherDatePickerInRangePair(this);if(otherDatePickerInRangePair.parentWrapperElement.find(LBG.datePicker.constants.daySelector).val()!==""&&this.parentWrapperElement.find(LBG.datePicker.constants.daySelector).val()!==""){this.parentWrapperElement.find(LBG.datePicker.constants.daySelector).focus();this.parentWrapperElement.find(LBG.datePicker.constants.daySelector).blur();}if(this.maxRangeInMonths!==undefined){otherDatePickerInRangePair.$hiddenDatePickerTextInput.datepicker("destroy");var defaultOptions=LBG.datePicker.defaultOptions;if(this.typeOfDatePicker==="to"){var toDate=new Date();toDate.setFullYear(year,month,day);var newFromDate=new Date(toDate);newFromDate.setMonth(parseInt(newFromDate.getMonth(),10)-parseInt(this.maxRangeInMonths,10));if(this.originalMinDate!==null&&newFromDate<this.originalMinDate){newFromDate=this.originalMinDate;}defaultOptions.minDate=newFromDate;defaultOptions.maxDate=toDate;}else{if(this.typeOfDatePicker==="from"){var fromDate=new Date();fromDate.setFullYear(year,month,day);var newToDate=new Date(fromDate);newToDate.setMonth(parseInt(newToDate.getMonth(),10)+parseInt(this.maxRangeInMonths,10));if(this.originalMaxDate!==null&&newToDate>this.originalMaxDate){newToDate=this.originalMaxDate;}defaultOptions.minDate=fromDate;defaultOptions.maxDate=newToDate;}}otherDatePickerInRangePair.$hiddenDatePickerTextInput.datepicker(defaultOptions);}}}}};LBG.help={triggerSelector:".cxtHelp",wrapperSelector:".refPoint",contextualHTML:'<div class="refPoint"><div class="contextual"></div></div>',pointerHTML:'<div class="pointer"></div>',closeHTML:'<p class="close"><a href="#" title="'+DI.lang.help.closeHTMLTitle+'">'+DI.lang.help.closeHTMLTitle+"</a></p>",activeClass:"active",helpWidth:320,helpContentHeight:200,contentInnerHTML:'<div class="contentInner" />',contentInnerSelector:".contentInner",init:function(){function showHelp(){var helpLink=this,$ff3=$("div.primary.ff3");if(LBG.common.urlGetAnchor(helpLink)){if($(helpLink).hasClass(LBG.help.activeClass)){LBG.help.closeHelp();}else{LBG.help.closeHelp();var viewPortWidth=self.innerWidth||(document.documentElement&&document.documentElement.clientWidth)||document.body.clientWidth;var hasArea=viewPortWidth-LBG.common.getAbsoluteLeft(helpLink);var contextualHTML=$(LBG.help.contextualHTML);if(((hasArea<LBG.help.helpWidth)&&(LBG.common.getAbsoluteLeft(helpLink)>=LBG.help.helpWidth))||($(helpLink).parents(".secondary").length>0)){contextualHTML.find(".contextual").addClass("left");}if($ff3.length>0){var secondaryWidth=$(".secondary").width(),ff3left=LBG.common.getAbsoluteLeft($ff3[0]),minusArea=(secondaryWidth+ff3left);hasArea=(viewPortWidth-minusArea)-LBG.common.getAbsoluteLeft(helpLink);if(((hasArea<LBG.help.helpWidth)&&(LBG.common.getAbsoluteLeft(helpLink)>=LBG.help.helpWidth))||($(helpLink).parents(".secondary").length>0)){contextualHTML.find(".contextual").addClass("left");}}var helpContentID=LBG.common.escapeSpecialCharsInId(LBG.common.urlGetAnchor(helpLink));var helpContent=$(helpContentID).clone(true);helpContent.id="";helpContent.appendTo($(helpLink).parent()[0]);helpContent.wrap(contextualHTML);helpContent.wrapInner(LBG.help.contentInnerHTML).find("h3").remove().clone().insertBefore(helpContent.find(LBG.help.contentInnerSelector));helpContent.find(LBG.help.contentInnerSelector).attr("tabIndex",0);if(helpContent.find(LBG.help.contentInnerSelector).height()>LBG.help.helpContentHeight){helpContent.find(LBG.help.contentInnerSelector).height(LBG.help.helpContentHeight);
helpContent.find(LBG.help.contentInnerSelector).css("margin","20px 0 0 0");}if(helpContent.get(0).clientHeight>LBG.common.getAbsoluteTop(helpLink)){helpContent.closest(".refPoint").addClass("bottom");}if(!$(this).hasClass(".onHover")){var closeHelpLink=$(LBG.help.closeHTML);closeHelpLink.find("a").click(function(){LBG.help.closeHelp();return false;});helpContent.after(closeHelpLink);}helpContent.after(LBG.help.pointerHTML);helpContent.attr("tabindex",-1);helpContent.focus();if($.browser.msie&&$.browser.version<7){helpContent.parent().bgiframe();}$(helpLink).addClass(LBG.help.activeClass);if($.browser.msie&&$.browser.version<7){$(LBG.help.triggerSelector).not($(this).parent()).css("position","static");}LBG.iOS.scrollGestureMessage(helpContent.find(".contentInner")[0]);if($.browser.msie&&$.browser.version<8&&!$("#olMask:visible").length){setTimeout(function(){LBG.ieZindexFix.apply(true,helpContent);},0);}if($(helpLink).parents(".secondary").length>0){$(helpLink).parents(".secondary").css("z-index","11");}}}return false;}$(LBG.help.triggerSelector+" a.cxtTrigger:not(.onHover)").live("click",showHelp);$(LBG.help.triggerSelector+" a.cxtTrigger.onHover").bind("mouseover",showHelp);$(LBG.help.triggerSelector+" a.cxtTrigger.onHover").bind("mouseleave",LBG.help.closeHelp);},closeHelp:function(){$(LBG.help.triggerSelector+" ."+LBG.help.activeClass).removeClass(LBG.help.activeClass).focus();$(LBG.help.wrapperSelector).remove();if($.browser.msie&&$.browser.version<8&&$("div.rewardOfferBlock").length>0){setTimeout(function(){LBG.ieZindexFix.apply(true);},0);}if($.browser.msie&&$.browser.version<7){$(LBG.help.triggerSelector).css("position","relative");}}};LBG.overlay={pageSelector:"#wrapper",outerSelector:"body",triggerSelector:".overlay, .overlayContainer a",loadedCloseSelector:".closeOverlay",loadedCancelSelector:".cancelOverlay",datePickerSelector:"input.datePicker",overlayCloseButton:"#overlay p.close a",overlayCancelButton:"#overlay li.cancel a",maskID:"olMask",overlayWrapperID:"overlayWrapper",overlayLoadedClass:"loaded",overlayID:"overlay",overlayClass:"content",overlayInnerID:"overlayInner",overlayContID:"overlayCont",closeClass:"close",overlayFlagClass:"overlayOpen",spinnerHTML:'<div class="spinner"></div>',closeTriggerTitleCopy:DI.lang.overlay.closeTriggerTitle,openTriggerTitleCopy:DI.lang.overlay.openTriggerTitle,closeLinkCopy:DI.lang.overlay.closeLink,loadErrorCopy:DI.lang.overlay.loadError,fromDomElement:false,$previousParent:null,$storedOverlayInners:null,$modifiedStoredInners:null,hasLaunchOverlay:false,init:function(){$(LBG.overlay.triggerSelector).bind("click",function(e){e.preventDefault();var metadata=$(this).metadata();var $domElement=metadata.domElement?$(metadata.domElement).eq(0):undefined;if($domElement){LBG.overlay.fromDomElement=true;LBG.overlay.open($domElement,this,true);}else{LBG.overlay.open(LBG.common.ajax.tagUrl(LBG.common.ajax.getAjaxURI(this)),this,true);}return false;}).each(function(){var $trigger=$(this).find("img").length?$(this).find("img:first"):$(this);var tagName=$trigger[0].tagName.toLowerCase();var message=LBG.overlay.openTriggerTitleCopy;if(tagName==="img"){if($trigger.attr("alt")){message=$trigger.attr("alt")+": "+message;}$trigger.attr({alt:message,title:message});}else{if($trigger.attr("title")){message=$trigger.attr("title")+": "+message;}else{if(tagName==="a"){message=$trigger.text()+": "+message;}}$trigger.attr("title",message);}if(!LBG.overlay.hasLaunchOverlay){LBG.overlay.hasLaunchOverlay=true;var meta=$trigger.metadata();if(meta.launchOverlay){$trigger.click();}}});if(!LBG.overlay.hasLaunchOverlay&&typeof LBG.launchOverlayData!=="undefined"&&typeof LBG.launchOverlayData.ajaxURL!=="undefined"){LBG.overlay.hasLaunchOverlay=true;LBG.overlay.open(LBG.launchOverlayData.ajaxURL,null,typeof LBG.launchOverlayData.canClose==="boolean"?LBG.launchOverlayData.canClose:true);}var kill_primary_overlay=$(".altOverlayContainer.firstTimeSRContainer").length;var i_can_see_the_alt_overlay=$(".altOverlayContainer.firstTimeSRContainer").is(":visible");if((kill_primary_overlay>0)&&(i_can_see_the_alt_overlay)){$("#olMask").hide();$("#overlayWrapper").hide();}},open:function(path,trigger,canClose,timeout){if(!path){return false;}LBG.overlay.close();$(LBG.overlay.datePickerSelector).datepicker("hide");var $outerSelector=$(LBG.overlay.outerSelector);$outerSelector.addClass(LBG.overlay.overlayFlagClass);$("#showMeMask").removeClass("show");$("#showMeOrientation").css("display","none");LBG.showMeOrientation.removeCookie(LBG.showMeOrientation.journeyCookieName);var meta=$(trigger).metadata();var $mask=$("<div />").attr("id",LBG.overlay.maskID).appendTo($outerSelector);var $overlayWrapper=$("<div />").attr("id",LBG.overlay.overlayWrapperID).appendTo($outerSelector);var $overlay=$("<div />").attr("id",LBG.overlay.overlayID).attr("class",LBG.overlay.overlayClass).attr("tabindex",-1).appendTo($overlayWrapper);var $overlayInner=$("<div />").attr("id",LBG.overlay.overlayInnerID).appendTo($overlay);var $overlayCont=$("<div />").attr("id",LBG.overlay.overlayContID).html(LBG.overlay.spinnerHTML).appendTo($overlayInner);if(meta.overlayWidth){$overlay.width(parseInt(meta.overlayWidth,10));}if(trigger){$overlay[0].storedTrigger=trigger;}if(canClose===true){$mask.click(function(){LBG.overlay.close();return false;});$('<a href="#" />').html(LBG.overlay.closeLinkCopy).attr("title",LBG.overlay.closeLinkCopy+LBG.overlay.closeTriggerTitleCopy).click(function(){LBG.overlay.close();return false;}).appendTo($("<p />").attr("class",LBG.overlay.closeClass).prependTo($overlay));}LBG.overlay.adjustMaskDimensions(true);LBG.overlay.position();if(typeof path==="string"){$.ajax({url:path,success:function(response){LBG.overlay.config({content:response,callback:true,timeout:timeout});},error:function(){LBG.overlay.config({content:"<p><strong>"+LBG.overlay.loadErrorCopy+"</strong></p>",callback:false,timeout:timeout});}});}else{if(typeof path==="object"){try{LBG.overlay.config({content:path,callback:true,timeout:false});}catch(err){LBG.overlay.config({content:"<p><strong>"+LBG.overlay.loadErrorCopy+"</strong></p>",callback:true,timeout:false});}}}},config:function(opts){var $overlay=$("#"+LBG.overlay.overlayID);var $overlayCont=$overlay.find("#"+LBG.overlay.overlayContID);if(opts.content&&LBG.overlay.fromDomElement){if(!$("#tempOverlayParent").length){$(opts.content).wrap('<div id="tempOverlayParent" />');LBG.overlay.$previousParent=$(opts.content).parent();}LBG.overlay.$storedOverlayInners=opts.content;LBG.overlay.$modifiedStoredInners=$(opts.content).clone().removeClass("hideJS");$(opts.content).remove();$overlayCont.html(LBG.overlay.$modifiedStoredInners);LBG.overlay.position();}else{if(opts.content){$overlayCont.html(opts.content);LBG.overlay.position();}}if($overlayCont.find("form").length>0){LBG.Forms.Validation.init($overlayCont[0]);$(LBG.overlay.loadedCloseSelector).attr("onKeyPress","event.stopPropagation();");$(document).bind("keydown",function(event){if($(event.target).hasClass(LBG.overlay.loadedCloseSelector)&&event.which===13){event.preventDefault();LBG.overlay.close();return false;}});if($(".submitAction").attr("disabled")){$(".submitAction").attr("disabled","");}if($overlay[0].storedTrigger&&$overlay[0].storedTrigger.tagName.toLowerCase()!=="a"){$($overlay[0].storedTrigger).parents("form").find(':input:not([type="image"])').each(function(){$overlayCont.find("form").prepend($("<input />").val(this.value).attr({type:"hidden",name:this.name,id:this.id}));});}}if($overlayCont.find(".js-tabs").length>0){LBG.tabs.init();
}$overlay.find(LBG.overlay.loadedCloseSelector).click(function(){LBG.overlay.close();return false;});LBG.ajax.pageUpdated($overlay,opts.timeout);if(opts.callback){LBG.overlay.callback();}},position:function(){if($(LBG.common.escapeSpecialCharsInId(LBG.overlay.overlayID))){var overlay=$(LBG.common.escapeSpecialCharsInId(LBG.overlay.overlayID));var overlayWrapper=$(LBG.common.escapeSpecialCharsInId(LBG.overlay.overlayWrapperID));var pageWrapper=$(LBG.overlay.pageSelector);var windowH=$(window).height();var overlayH=overlay.outerHeight();var pageH=pageWrapper.outerHeight();overlayWrapper.addClass(LBG.overlay.overlayLoadedClass);overlay.css("margin-top",0);var scrollPosition=$(window).scrollTop();if(overlayH>=pageH){pageWrapper.css("min-height",overlayH+20);overlay.css("top",10+"px");}else{if((overlayH/2+scrollPosition)<pageH){var horiz=scrollPosition+windowH/2;var top=overlayH/2;if(horiz>top){overlay.css("top",horiz+"px");overlay.css("margin-top","-"+top+"px");}else{pageWrapper.css("min-height",overlayH+20);overlay.css("top",10+"px");}}else{pageWrapper.css("min-height",overlayH+20);overlay.css("top",10+"px");}}overlay.css("margin-left","-"+overlay.outerWidth()/2+"px");}},adjustMaskDimensions:function(setOnResize){if($.browser.msie&&$.browser.version<7||LBG.browserIdent.browserIdent==="iPad"||LBG.browserIdent.browserIdent==="iPhone"){var mask=$(LBG.common.escapeSpecialCharsInId(LBG.overlay.maskID));var pageWrapper=$(LBG.overlay.pageSelector);mask.width(pageWrapper.outerWidth(true));mask.height(pageWrapper.outerHeight(true));if(setOnResize&&setOnResize===true){$(window).resize(function(){LBG.overlay.adjustMaskDimensions();});}}},close:function(){if(document.getElementById(LBG.overlay.overlayID)){var overlay=$(LBG.common.escapeSpecialCharsInId(LBG.overlay.overlayID));var storedTrigger=false;if(overlay[0].storedTrigger){storedTrigger=overlay[0].storedTrigger;}$(LBG.common.escapeSpecialCharsInId(LBG.overlay.maskID)).remove();$(LBG.common.escapeSpecialCharsInId(LBG.overlay.overlayWrapperID)).remove();$(LBG.overlay.pageSelector).css("min-height","100%");if(storedTrigger){LBG.ajax.pageUpdated(overlay[0].storedTrigger,false);}else{LBG.ajax.pageUpdated(null,false);}if(LBG.overlay.fromDomElement){LBG.overlay.$previousParent.html(LBG.overlay.$storedOverlayInners);LBG.overlay.fromDomElement=false;}$("body").removeClass(LBG.overlay.overlayFlagClass);}},callback:function(){LBG.Forms.DatePickerConverter.init();LBG.datePicker.init();LBG.employmentShowHide.init();LBG.selectAccount.init();LBG.beneficiariesChooser.init();LBG.contentScrollerTabIndex();var $overlayCont=$("#"+LBG.overlay.overlayContID);if($("#omm").length){if(LBG.ommSelectImageOverlay&&typeof LBG.ommSelectImageOverlay.init==="function"){LBG.ommSelectImageOverlay.init();}if(LBG.ommDetect&&typeof LBG.ommDetect.init==="function"){LBG.ommDetect.init($("#overlayWrapper"));}if(LBG.arrangementsDateDropdown&&typeof LBG.arrangementsDateDropdown.init==="function"){if($overlayCont.find(".viewFilterOverlay").length){LBG.arrangementsDateDropdown.init();}}}$overlayCont.find("form:eq(0)").bind("submit",function(e){e.preventDefault();this.submit();});$(".exportStatement:eq(0)").parent().unbind("submit").bind("submit",function(e){e.preventDefault();setTimeout(function(){LBG.overlay.close();},DI.exportStatement.closeOverlayInterval);this.submit();});if($(LBG.overlay.overlayCancelButton).length){$(LBG.overlay.overlayCancelButton).bind("click",function(){LBG.overlay.close();});}$(document).one("keypress",function(e){if(e.keyCode===27){LBG.overlay.close();}});$overlayCont.find(LBG.overlay.loadedCloseSelector).each(function(){this.title=(this.alt||this.title||$(this).text())+LBG.overlay.closeTriggerTitleCopy;});$(LBG.overlay.overlayCloseButton).focus();LBG.iOS.scrollGestureMessage($overlayCont.find(".legals")[0]);}};LBG.session={isUnauthenticated:false,sessionActive:false,logoutClass:"logoutWarning",msgClass:"logoutMsg",actionsClass:"actions",loggedOutOverlayClass:"dark",alternateLinkData:{},allow:function(isUnauthenticated,alternateLinkData){if(isUnauthenticated){this.isUnauthenticated=true;}this.sessionActive=true;this.alternateLinkData=alternateLinkData;this.init();},preloadImg:function(src){var img=new Image();img.src=src;return img;},init:function(){LBG.session.duration=LBG.session.isUnauthenticated?DI.sessionUnauthenticated.duration:DI.session.duration;LBG.session.gracePeriod=LBG.session.isUnauthenticated?DI.sessionUnauthenticated.gracePeriod:DI.session.gracePeriod;LBG.session.URLRedirect=LBG.session.isUnauthenticated?DI.sessionUnauthenticated.URLRedirect:DI.session.URLRedirect;LBG.session.URLRedirect_Marker=LBG.session.isUnauthenticated?DI.sessionUnauthenticated.URLRedirect_Marker:DI.session.URLRedirect_Marker;LBG.session.hideLogoutButton=DI.session.hideLogoutButton||false;LBG.session.hideLogonButton=DI.session.hideLogonButton||false;if(LBG.session.isUnauthenticated){LBG.session.warnTitle=DI.lang.sessionUnauthenticated.warningTitle;LBG.session.warnMsg=DI.lang.sessionUnauthenticated.warningMsg;LBG.session.warnSecondaryBtnSrc=DI.lang.sessionUnauthenticated.resetButton;LBG.session.warnSecondaryBtnAlt=DI.lang.sessionUnauthenticated.resetAlt;LBG.session.warnPrimaryBtnSrc=DI.lang.sessionUnauthenticated.continueButton;LBG.session.warnPrimaryBtnAlt=DI.lang.sessionUnauthenticated.continueAlt;LBG.session.warnPrimaryBtnLink=DI.lang.sessionUnauthenticated.continueLink;LBG.session.exitTitle=DI.lang.sessionUnauthenticated.timedOutTitle;LBG.session.exitMsg=DI.lang.sessionUnauthenticated.timedOutMsg;LBG.session.exitPrimaryBtnSrc=DI.lang.sessionUnauthenticated.startAgainButton;LBG.session.exitPrimaryBtnAlt=DI.lang.sessionUnauthenticated.startAgainAlt;LBG.session.warnSecondaryBtnLink=typeof LBG.session.alternateLinkData.resetLink!=="undefined"?LBG.session.alternateLinkData.resetLink:DI.lang.sessionUnauthenticated.resetLink;LBG.session.exitPrimaryBtnLink=typeof LBG.session.alternateLinkData.startAgainLink!=="undefined"?LBG.session.alternateLinkData.startAgainLink:DI.lang.sessionUnauthenticated.startAgainLink;}else{LBG.session.warnTitle=DI.lang.session.warningTitle;LBG.session.warnMsg=DI.lang.session.warningMsg;LBG.session.warnSecondaryBtnSrc=DI.lang.session.logoutButton;LBG.session.warnSecondaryBtnAlt=DI.lang.session.logoutAlt;LBG.session.warnSecondaryBtnLink=DI.lang.session.logoutLink;LBG.session.warnPrimaryBtnSrc=DI.lang.session.continueButton;LBG.session.warnPrimaryBtnAlt=DI.lang.session.continueAlt;LBG.session.warnPrimaryBtnLink=DI.lang.session.continueLink;LBG.session.exitTitle=DI.lang.session.loggedOutTitle;LBG.session.exitMsg=DI.lang.session.loggedOutMsgText;LBG.session.exitPrimaryBtnSrc=DI.lang.session.loggedOutButton;LBG.session.exitPrimaryBtnAlt=DI.lang.session.loggedOutAlt;LBG.session.exitPrimaryBtnLink=DI.lang.session.loggedOutLink;}LBG.session.warnMsg=LBG.common.formatPlaceholder.call(LBG.session.warnMsg,Math.floor(LBG.session.duration/60000));LBG.session.exitMsg=LBG.common.formatPlaceholder.call(LBG.session.exitMsg,Math.ceil((LBG.session.duration+LBG.session.gracePeriod)/60000));if(LBG.session.sessionActive){LBG.sessionTerminate.init();LBG.session.warnSecondaryBtnImg=LBG.session.preloadImg(LBG.session.warnSecondaryBtnSrc);LBG.session.warnPrimaryBtnImg=LBG.session.preloadImg(LBG.session.warnPrimaryBtnSrc);LBG.session.exitPrimaryBtnImg=LBG.session.preloadImg(LBG.session.exitPrimaryBtnSrc);window.clearTimeout(LBG.session.timeOut);LBG.session.timeOut=window.setTimeout(function(){if($("#inTNGA").length==0){LBG.overlay.open(LBG.session.buildMsg(),null,false,false);
}$(".logoutWarning img").removeAttr("width").removeAttr("height");window.clearTimeout(LBG.session.timeOut);try{window.focus();}catch(e){}LBG.session.timeOut=window.setTimeout(function(){var currentURL=document.URL;var newURL=currentURL.split(LBG.session.URLRedirect_Marker);var autoLogOff=$("#autoLogOff").val();if(autoLogOff!==undefined){autoLogOff=autoLogOff.toLowerCase();}else{LBG.sessionTerminate.isEnabled=true;LBG.session.loggedOutMsg();LBG.sessionTerminate.sendTerminate();window.clearTimeout(LBG.session.timeOut);}if(autoLogOff=="autologoff"){window.location.href=newURL[0]+LBG.session.URLRedirect;}else{LBG.sessionTerminate.isEnabled=true;LBG.session.loggedOutMsg();LBG.sessionTerminate.sendTerminate();window.clearTimeout(LBG.session.timeOut);}},LBG.session.gracePeriod);},LBG.session.duration);}},buildMsg:function(){var $wrapper=$("<div></div>").attr("class",LBG.session.logoutClass);var $title=$("<h2>"+LBG.session.warnTitle+"</h2>");var $message=$("<div></div>").attr("class",LBG.session.msgClass).append($("<p><strong>"+LBG.session.warnMsg+"</strong></p>"));var $actions=$("<ul></ul>").attr("class",LBG.session.actionsClass);if(!LBG.session.hideLogoutButton){var $secondary=$("<li></li>").appendTo($actions);var $secondaryLink=$("<a></a>").attr("href",LBG.session.warnSecondaryBtnLink).appendTo($secondary);var $secondaryImg=$(LBG.session.warnSecondaryBtnImg).attr("alt",LBG.session.warnSecondaryBtnAlt).appendTo($secondaryLink);}var $primary=$("<li></li>").addClass("primaryAction").appendTo($actions);var $primaryLink=$("<a></a>").attr("href",LBG.session.warnPrimaryBtnLink).appendTo($primary);var $primaryImg=$(LBG.session.warnPrimaryBtnImg).attr("alt",LBG.session.warnPrimaryBtnAlt).appendTo($primaryLink);$primaryLink.click(function(){LBG.session.ping(LBG.session.warnPrimaryBtnLink);return false;});$wrapper.append($title,$message,$actions);return $wrapper;},loggedOutMsg:function(){var $wrapper=$("."+LBG.session.logoutClass);var $actions=$wrapper.find("."+LBG.session.actionsClass);$actions.empty();$wrapper.find("h2").html(LBG.session.exitTitle);$wrapper.find("."+LBG.session.msgClass+" strong").html(LBG.session.exitMsg);if(!LBG.session.hideLogonButton){var $primary=$("<li></li>").addClass("primaryAction").appendTo($actions);var $primaryLink=$("<a></a>").attr("href",LBG.session.exitPrimaryBtnLink).appendTo($primary);var $primaryImg=$(LBG.session.exitPrimaryBtnImg).attr("alt",LBG.session.exitPrimaryBtnAlt).removeAttr("width").removeAttr("height").appendTo($primaryLink);}else{$actions.css("display","none");}LBG.ajax.pageUpdated($(LBG.common.escapeSpecialCharsInId(LBG.overlay.overlayID)),false);$(LBG.common.escapeSpecialCharsInId(LBG.overlay.maskID)).addClass(LBG.session.loggedOutOverlayClass);},ping:function(path){if(!path){return false;}$.ajax({url:path,dataType:"json",success:function(response){if(response.isActive===true){LBG.overlay.close();LBG.session.init();}else{LBG.session.loggedOutMsg();window.clearTimeout(LBG.session.timeOut);}},error:function(){LBG.session.loggedOutMsg();window.clearTimeout(LBG.session.timeOut);}});}};LBG.sessionNotLoggedIn={sessionActive:false,duration:DI.sessionNotLoggedIn.duration,logoutClass:"logoutWarning",msgClass:"logoutMsg",actionsClass:"actions",loggedOutOverlayClass:"dark",loggedOutTitle:DI.lang.sessionNotLoggedIn.loggedOutTitle,loggedOutMsgText:LBG.common.formatPlaceholder.call(DI.lang.sessionNotLoggedIn.loggedOutMsgText,Math.floor(DI.sessionNotLoggedIn.duration/60000)),loggedOutButtonSrc:DI.lang.sessionNotLoggedIn.loggedOutButton,loggedOutButtonAlt:DI.lang.sessionNotLoggedIn.loggedOutAlt,loggedOutLinkPath:DI.lang.sessionNotLoggedIn.loggedOutLink,allow:function(){this.sessionActive=true;this.init();},preloadImg:function(src){var img=new Image();img.src=src;return img;},init:function(){if(LBG.sessionNotLoggedIn.sessionActive){LBG.sessionNotLoggedIn.loggedOutImg=LBG.sessionNotLoggedIn.preloadImg(LBG.sessionNotLoggedIn.loggedOutButtonSrc);window.clearTimeout(LBG.sessionNotLoggedIn.timeOut);LBG.sessionNotLoggedIn.timeOut=window.setTimeout(function(){LBG.overlay.open(LBG.sessionNotLoggedIn.buildMsg(),null,false,false);$(".logoutWarning img").removeAttr("width").removeAttr("height");window.clearTimeout(LBG.sessionNotLoggedIn.timeOut);try{window.focus();}catch(e){}},LBG.sessionNotLoggedIn.duration);}},buildMsg:function(){var logoutSession=$("<div></div>").attr("class",LBG.sessionNotLoggedIn.logoutClass);$("<h2>"+LBG.sessionNotLoggedIn.loggedOutTitle+"</h2>").appendTo(logoutSession);var msg=$("<div></div>").attr("class",LBG.sessionNotLoggedIn.msgClass);$("<p><strong>"+LBG.sessionNotLoggedIn.loggedOutMsgText+"</strong></p>").appendTo(msg);msg.appendTo(logoutSession);var actions=$("<ul></ul>").attr("class",LBG.sessionNotLoggedIn.actionsClass);var logoutImg=$(LBG.sessionNotLoggedIn.loggedOutImg).attr("alt",LBG.sessionNotLoggedIn.loggedOutButtonAlt);var logoutLink=$("<a></a>").attr("href",LBG.sessionNotLoggedIn.loggedOutLinkPath).append(logoutImg);$("<li></li>").append(logoutLink).appendTo(actions);actions.appendTo(logoutSession);return logoutSession;}};LBG.miniSession={sessionActive:false,duration:DI.session.miniDuration,logoutClass:"logoutWarning",msgClass:"logoutMsg",actionsClass:"actions",loggedOutOverlayClass:"dark",loginButtonSrc:DI.lang.session.loginButton,loginButtonAlt:DI.lang.session.loginAlt,loginLinkPath:DI.lang.session.loginLink,loggedOutTitle:DI.lang.session.loggedOutTitle,loggedOutMsgText:LBG.common.formatPlaceholder.call(DI.lang.session.loggedOutMsgText,Math.ceil((DI.session.miniDuration)/60000)),allow:function(){this.sessionActive=true;this.init();},preloadImg:function(src){var img=new Image();img.src=src;return img;},init:function(){if(LBG.miniSession.sessionActive){LBG.sessionTerminate.init();LBG.miniSession.loginImg=LBG.sessionNotLoggedIn.preloadImg(LBG.miniSession.loginButtonSrc);window.clearTimeout(LBG.miniSession.timeOut);LBG.miniSession.timeOut=window.setTimeout(function(){LBG.overlay.open(LBG.miniSession.buildMsg(),null,false,false);LBG.miniSession.loggedOutMsg();window.clearTimeout(LBG.miniSession.timeOut);try{window.focus();}catch(e){}},LBG.miniSession.duration);}},buildMsg:function(){var logout=$("<div></div>").attr("class",LBG.miniSession.logoutClass);$("<h2>"+LBG.miniSession.loggedOutTitle+"</h2>").appendTo(logout);var msg=$("<div></div>").attr("class",LBG.miniSession.msgClass);$("<p><strong>"+LBG.miniSession.loggedOutMsgText+"</strong></p>").appendTo(msg);msg.appendTo(logout);var actions=$("<ul></ul>").attr("class",LBG.miniSession.actionsClass);var loginImg=$(LBG.miniSession.loginImg).attr("alt",LBG.miniSession.loginButtonAlt);var loginLink=$("<a></a>").attr("href",LBG.miniSession.loginLinkPath).append(loginImg);$("<li></li>").addClass("primaryAction").append(loginLink).appendTo(actions);actions.appendTo(logout);return logout;},loggedOutMsg:function(){LBG.ajax.pageUpdated($(LBG.common.escapeSpecialCharsInId(LBG.overlay.overlayID)),false);$(LBG.common.escapeSpecialCharsInId(LBG.overlay.maskID)).addClass(LBG.miniSession.loggedOutOverlayClass);}};LBG.sessionTerminate={terminateUrl:DI.sessionTerminate.url,dataSelector:"input:hidden.sessionTerminate",isEnabled:false,isReload:false,allowSend:false,sendTerminate:function(){if(LBG.sessionTerminate.isEnabled===true){LBG.sessionTerminate.isEnabled=false;$.ajax({type:"GET",async:false,url:LBG.sessionTerminate.terminateUrl,data:$(LBG.sessionTerminate.dataSelector).serialize()});}},init:function(){var nav=navigator.appVersion.toLowerCase();var os={win:(nav.indexOf("win")!==-1)?true:false,mac:(nav.indexOf("mac")!==-1)?true:false};
var $data=$(LBG.sessionTerminate.dataSelector);if($data.length>0&&$data.val()!==""){LBG.sessionTerminate.isEnabled=true;$(document).bind("keydown",function(event){var SHIFT=event.shiftKey,CTRL=event.ctrlKey,ALT=event.altKey,KEY=(event.keyCode?event.keyCode:event.which);if(event.clientY<0){var F5=!CTRL&&!SHIFT&&KEY===116,CTRLR=CTRL&&!SHIFT&&KEY===82,CTRLF5=CTRL&&!SHIFT&&KEY===116,SHIFTF5=!CTRL&&SHIFT&&KEY===116,CTRLSHIFTR=CTRL&&SHIFT&&KEY===82;LBG.sessionTerminate.isReload=(F5||CTRLR||CTRLF5||SHIFTF5||CTRLSHIFTR);}var allowMozilla=$.browser.mozilla&&$.browser.version>="1.9.1",allowIE=$.browser.msie&&$.browser.version>="7";var ALTF4=os.win&&ALT&&KEY===115,CTRLW=CTRL&&!SHIFT&&KEY===87,CTRLF4=($.browser.safari||allowIE||allowMozilla)&&!SHIFT&&CTRL&&!ALT&&KEY===115,CTRLSHIFTW=!$.browser.msie&&CTRL&&SHIFT&&KEY===87;LBG.sessionTerminate.allowSend=(ALTF4||CTRLW||CTRLF4||CTRLSHIFTW);});$(window).bind("beforeunload",function(event){var x=0;var y=0;if(event.pageX||event.pageY){x=event.pageX;y=event.pageY;}else{if(event.clientX||event.clientY){x=event.clientX;y=event.clientY;}}var cursorAtCloseButton=(y<0)?x>$(document).width()-60&&y<0:false;if(LBG.sessionTerminate.allowSend===true||(y<0&&LBG.sessionTerminate.isReload===false&&cursorAtCloseButton===true)){LBG.sessionTerminate.sendTerminate();}});}}};LBG.ajax={pageUpdated:function(focusEL,timeout){LBG.common.ajax.updateBuffer();if(focusEL){if($.isArray(focusEL)||(focusEL.length>0)){focusEL[0].focus();}else{focusEL.focus();}}if(timeout!==false){LBG.session.init();}}};LBG.submitOnChange=(function(){var submitSelector="select.submitOnChange";var hiddenInputSelector="input[type=image], input[type=submit]";function handleChange(){$(this).parents("form:first").find(hiddenInputSelector).eq(0).click(function(e){LBG.Forms.Validation._submitManagement(e);}).click();}function setup(){$(this).change(handleChange);$(this).parents("form:first").find(hiddenInputSelector).eq(0).hide();}return{init:function(){$(submitSelector).each(setup);}};}());LBG.compareSelection=(function(){var PANEL="ul.comparisonSelectList",CHECKBOXES=".addToCompare input:checkbox",BUTTONS=".comparisonSelectAction input",DISABLED_SUFFIX="_disabled",MIN=2,MAX=3;return{init:function(){var $panel=$(PANEL);if(!$panel.length){return;}var $buttons=$(BUTTONS),$checkboxes=$(CHECKBOXES);$buttons.each(function(){this.state_hi=this.src;this.state_lo=this.src.replace(/(?=\.[^.]+$)/,DISABLED_SUFFIX);});var handleChangeEvent=function(){var count=$checkboxes.filter(":checked").length;if(count<MIN){$buttons.each(function(){this.disabled=true;this.src=this.state_lo;});}else{if(count>=MAX){$checkboxes.not(":checked").each(function(){this.disabled=true;});}else{$buttons.each(function(){this.disabled=false;this.src=this.state_hi;});$checkboxes.each(function(){this.disabled=false;});}}};$panel.bind("click",handleChangeEvent);handleChangeEvent();}};})();LBG.ajaxLink={ajaxLinkSel:".ajaxLink",placeHolderSel:".ajaxPlaceholder",maximumTraverse:7,init:function(){var $el=$(LBG.ajaxLink.ajaxLinkSel);$el.bind("click",LBG.ajaxLink.onClick);},onClick:function(e){e.preventDefault();var o,k;var $el=$(this);$el[0].callback=$el[0].callback||function(){};function loader(k,$link){var url=($link.metadata().async)?$link.metadata().async.url:$link.attr("href");$(k).load(url,function(e){LBG.Forms.Validation.init($(k));$link[0].callback($(this),e);$(k).find(".btnCancel").click(function(e){e.preventDefault();$(k).html("");});});}for(o=0;o<LBG.ajaxLink.maximumTraverse;o++){k=LBG.ajaxLink.travCheck($el);if(k.length){loader(k,$(this));break;}else{$el=$el.parent();}}},travCheck:function($el){return $el.find(LBG.ajaxLink.placeHolderSel).eq(0);}};LBG.addressFinder={handlers:[],addressDataStub:DI.lang.addressFinder.addressPickerStubData,isNumeric:function(value){return LBG.Forms.Validation.Routines.simpleRegexTest(LBG.Forms.Validation.Expressions.numeric,value);},finder:function(wrapper,uniqueID){this.uniqueID=uniqueID;this.$wrapper=$(wrapper);this.$header=$(wrapper).find(".addressHeader");this.formValidationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject(this.$wrapper);this.isPreviousAddress=this.$wrapper.hasClass("previousAddress");this.panels=[];this.panels.push(this.$panelSelectedAddress=this.$wrapper.find("div.selectedAddress"));this.panels.push(this.$panelFindAddress=this.$wrapper.find("div.findAddress"));this.panels.push(this.$panelyearsAtCurrent=this.$wrapper.find("div.timeYearsMonths"));this.panels.push(this.$panelSelectAddress=this.$wrapper.find("div.selectAddress"));this.panels.push(this.$panelManualAddress=this.$wrapper.find("div.manualAddress"));this.panels.push(this.$panelBFPOAddress=this.$wrapper.find("div.BFPOAddress"));if(this.isPreviousAddress){this.$currentTimeAtAddress=this.$wrapper.prev("div.timeYearsMonths");this.panels.push(this.$previousTimeAtAddress=this.$wrapper.find("div.timeYearsMonths"));}this.postcode="";this.addressData={};this.btnFindAddressSrcEnabled=this.$panelFindAddress.find("input:image")[0].src;this.btnFindAddressSrcDisabled=this.$panelFindAddress.find("input:image")[0].className.split("disabledSrc:")[1];this.$wrapper.parents("form").find(".hideJS").find("input, select").attr("tabIndex",-1);this.setup();},init:function(){$("fieldset.addressFinder").each(function(i){LBG.addressFinder.handlers.push(new LBG.addressFinder.finder(this,i));});}};LBG.addressFinder.finder.prototype={getValidationName:function($formField){return LBG.Forms.Validation.Tools.convertClassDetailsToData($formField[0],"validationName:")[0];},getValidationHandler:function($formField){return this.formValidationHandler.getChild(this.getValidationName($formField));},hideErrors:function($panel){var self=this;var $errorFormFields=$panel.is("div.formField.error")?$panel:$panel.find("div.formField.error");var validationHandler;$errorFormFields.each(function(){validationHandler=self.getValidationHandler($(this));validationHandler.isShowingError=true;if($.browser.msie&&$.browser.version<7){window.setTimeout(function(){validationHandler.hideError();},30);}else{validationHandler.hideError();}});},showPanel:function($panel){var self=this;var arrayRemove=function(arr,$panel){return $.grep(arr,function(value){return value!==$panel;});};var show=function($element){$element.removeClass("hideAddressPanel");if($.browser.msie&&$.browser.version<7){$element.css("display","none").css("display","block");}};var hide=function($element){$element.addClass("hideAddressPanel");if($.browser.msie&&$.browser.version<7){$element.css("display","block").css("display","none");}};for(var i=0;i<this.panels.length;i++){if(this.panels[i]===$panel||(this.panels[i]===this.$previousTimeAtAddress&&this.isPreviousAddress)){show(this.panels[i]);}else{hide(this.panels[i]);}this.hideErrors(this.panels[i]);}if($panel===this.$panelFindAddress){this.resetFields();}if(this.$panelManualAddress.is(":visible")){this.$wrapper.find("p.useAddressFinder").removeClass("hideAddressPanel");}else{this.$wrapper.find("p.useAddressFinder").addClass("hideAddressPanel");}if(this.$panelBFPOAddress.is(":not(.hideAddressPanel)")){this.resetFields();show(this.$panelFindAddress);this.$panelFindAddress.find("input:image:first").attr("src",this.btnFindAddressSrcDisabled);this.$panelFindAddress.addClass("isDisabled").find(":input").attr("disabled","disabled");this.$header.addClass("isDisabled");}else{this.$panelFindAddress.removeClass("isDisabled").find(":input").removeAttr("disabled");this.$panelFindAddress.find("input:image:first").attr("src",this.btnFindAddressSrcEnabled);
this.$header.removeClass("isDisabled");}if($panel===this.$panelFindAddress||$panel===this.$panelManualAddress||$panel===this.$panelBFPOAddress){$panel.find("input:text:first").focus();}},resetFields:function(){this.postcode="";this.addressData={};for(var i=0;i<this.panels.length;i++){this.panels[i].find("input:text").val("");}this.$panelSelectAddress.find("select").empty();},updateAddressList:function($panel){var self=this;var text="";var data={};var $postcodeFinder=$panel.find("div.postcodeFinder");var postcodeVal=$postcodeFinder.find("input:text").val();var $addressList=this.$panelSelectAddress.find("div.addressList select");var validationHandler=this.getValidationHandler($postcodeFinder);validationHandler.validate();if(!validationHandler.isValid||postcodeVal===this.postcode){if($.trim(postcodeVal)===""){validationHandler.showError("required");}return false;}this.postcode=postcodeVal;this.addressData={};$addressList.empty();validationHandler=this.getValidationHandler(this.$panelSelectAddress.find("div.addressList"));validationHandler.hideError();function onFail(){$postcodeFinder.find("span.error").remove();$postcodeFinder.addClass("error").append($("<span />").addClass("error").html(Messages.noAddressesFound));var postcodeInput=$(".formField.wtError input:text");if($(".formField.wtError.postCodeFindAddress").hasClass(".error")){LBG.track({"WT.ti":postcodeInput.attr("id"),"DCSext.CurrentPostcode":postcodeInput.attr("value"),"DCSext.CurrentPostcodeValid":"noaddress"});}if(self.$panelFindAddress.is(":visible")){self.$panelFindAddress.find(".cantFindAddress").removeClass("hideAddressPanel");}}$.ajax({url:LBG.addressFinder.addressDataStub,cache:false,dataType:"json",type:"GET",data:{"addressFinderUniqueID":self.uniqueID,"postalCode":self.postcode},error:function(data){onFail();},success:function(data){self.addressData=data;var testResponse=(typeof(self.addressData.addresses)!=="undefined")?self.addressData.addresses.length===0:true;if(testResponse){onFail();}else{var labelOption=0;var label=$addressList.prev("label");if($addressList[0].size<=1){$addressList[0].options[0]=new Option(label.text(),"-");labelOption=1;label.addClass("postit");}var existingOptions=$addressList[0].options.length;for(var i=0,len=self.addressData.addresses.length;i<len;i++){text="";data=self.addressData.addresses[i];if(!LBG.common.isNull(data.numberOrName)){text+=data.numberOrName;}if(!LBG.common.isNull(data.streetName)){text+=(text!=="")?" "+data.streetName:data.streetName;}if(!LBG.common.isNull(data.district)){text+=(text!=="")?", "+data.district:data.district;}if(!LBG.common.isNull(data.townOrCity)){text+=(text!=="")?", "+data.townOrCity:data.townOrCity;}if(!LBG.common.isNull(data.county)){text+=(text!=="")?", "+data.county:data.county;}$addressList[0].options[i+labelOption]=new Option(text,i);}self.$panelSelectAddress.find("div.postcodeFinder input:text").val(self.postcode);self.showPanel(self.$panelSelectAddress);self.$panelSelectAddress.find("a:first").focus();self.$panelSelectAddress.find("select:not(.single)").focus();}}});},updateSelectedAddress:function(){var self=this;var data={};var html="";var $postcodeFinder=this.$panelSelectAddress.find("div.postcodeFinder");var $addressList=this.$panelSelectAddress.find("div.addressList");var $addressParagraph=this.$panelSelectedAddress.find("div.adr");var $btnChangeAddress=this.$panelSelectedAddress.find("ul.linkList a.changeAddress");var validationHandlerAddressList=this.getValidationHandler($addressList);var validationHandlerPostcode=this.getValidationHandler($postcodeFinder);validationHandlerAddressList.validate();validationHandlerPostcode.validate();if(!validationHandlerPostcode.isValid){$postcodeFinder.find("input:text").val(this.postcode);validationHandlerPostcode.hideError();}if(!validationHandlerAddressList.isValid){return false;}data=self.addressData.addresses[$addressList.find("select").val()];if(!LBG.common.isNull(data.numberOrName)||!LBG.common.isNull(data.streetName)){html+='<span class="street-address">';html+=!LBG.common.isNull(data.numberOrName)?data.numberOrName:"";html+=!LBG.common.isNull(data.streetName)&&!LBG.common.isNull(data.numberOrName)?" ":"";html+=!LBG.common.isNull(data.streetName)?data.streetName:"";html+="</span>";}html+=!LBG.common.isNull(data.district)?'<span class="district">'+data.district+"</span>":"";html+=!LBG.common.isNull(data.townOrCity)?'<span class="town">'+data.townOrCity+"</span>":"";html+=!LBG.common.isNull(data.county)?'<span class="county">'+data.county+"</span>":"";html+=!LBG.common.isNull(data.postcode)?'<span class="postcode">'+data.postcode+"</span>":"";$addressParagraph.html(html);this.showPanel(this.$panelSelectedAddress);$btnChangeAddress.focus();},getTimeAtAddress:function($target){var $inputs=this.$currentTimeAtAddress.find(".field");var years=$inputs.eq(0).val();var months=$inputs.eq(1).val();if($target===$inputs.eq(0)&&$target.val()===""||months===""){months=0;}if(parseInt(months,10)===12){return false;}if(LBG.addressFinder.isNumeric(years)&&LBG.addressFinder.isNumeric(months)){years=parseInt(years,10)+parseInt(months/12,10);if(years<3){if(this.$wrapper.is(":hidden")){this.showPanel(this.$panelFindAddress);this.$wrapper.removeClass("hideAddressPanel").show();}}else{this.resetFields();this.$wrapper.hide();}}},removeTextBFPO:function($element){if($element.text().indexOf("BFPO")!==-1){$element.text($element.text().replace("BFPO ",""));}},setup:function(){var self=this;if(this.$panelBFPOAddress.is(":hidden")){this.$panelFindAddress.removeClass("isDisabled").find(":input").removeAttr("disabled");this.$header.removeClass("isDisabled");}self.$wrapper.nextAll(".hideUntilAddress:first").hide();var handlerSelectedAddress=function(event){event.preventDefault();if($(this).hasClass("BFPOAddress")){self.showPanel(self.$panelBFPOAddress);}else{self.showPanel(self.$panelFindAddress);self.removeTextBFPO(self.$wrapper.find("div.selectedAddress a.changeAddress"));self.removeTextBFPO(self.$wrapper.find("div.addressHeader h3"));}};var handlerFindAddress=function(event){if(event.type==="click"||(event.type==="keypress"&&event.keyCode===13)){self.updateAddressList(self.$panelFindAddress);}};var handlerChangeAddress=function(event){if(event.type==="click"||(event.type==="keypress"&&event.keyCode===13)){self.updateAddressList(self.$panelSelectAddress);}};var handlerSingleSelectAddress=function(event){if($(this).val()!=="-"){self.$wrapper.nextAll(".hideUntilAddress:first").show();}else{self.$wrapper.nextAll(".hideUntilAddress:first").hide();}};var handlerSelectAddress=function(event){if(event.type==="click"||event.type==="dblclick"||(event.type==="keypress"&&event.keyCode===13)){self.updateSelectedAddress();return false;}};var handlerCantFindAddress=function(event){if($(this).attr("href")){event.preventDefault();}if(event.type==="click"||(event.type==="keypress"&&event.keyCode===13)){self.showPanel(self.$panelManualAddress);}};var handlerUseAddressFinder=function(event){event.preventDefault();self.showPanel(self.$panelFindAddress);self.removeTextBFPO(self.$wrapper.find("div.selectedAddress a.changeAddress"));self.removeTextBFPO(self.$wrapper.find("div.addressHeader h3"));self.$wrapper.nextAll(".hideUntilAddress:first").hide();};var handlerBFPOAddress=function(event){event.preventDefault();self.showPanel(self.$panelBFPOAddress);};this.$panelSelectedAddress.find("a.changeAddress").click(handlerSelectedAddress);this.$panelFindAddress.find("div.postcodeFinder input:text").keypress(handlerFindAddress);this.$panelFindAddress.find("div.postcodeFinder input:image").keypress(handlerFindAddress).click(handlerFindAddress);
this.$panelFindAddress.find(".cantFindAddress input:image").keypress(handlerCantFindAddress).click(handlerCantFindAddress);this.$panelSelectAddress.find("div.postcodeFinder input:text").keypress(handlerChangeAddress);this.$panelSelectAddress.find("div.postcodeFinder input:image").keypress(handlerChangeAddress).click(handlerChangeAddress);this.$panelSelectAddress.find("div.addressList select").keypress(handlerSelectAddress).dblclick(handlerSelectAddress);this.$panelSelectAddress.find("div.addressList select.single").change(handlerSingleSelectAddress);this.$panelSelectAddress.find("div.addressList input:image").keypress(handlerSelectAddress).click(handlerSelectAddress);this.$panelSelectAddress.find(".cantFindAddress input:image").keypress(handlerCantFindAddress).click(handlerCantFindAddress);this.$panelSelectAddress.find(".cantFindAddress a:not(.cxtTrigger)").keypress(handlerCantFindAddress).click(handlerCantFindAddress);this.$wrapper.find("p.useAddressFinder a").click(handlerUseAddressFinder);this.$panelManualAddress.find("input:text").keypress(function(e){if(e.keyCode===13){$(this).parents("form").find(".submitAction").click();}});this.$wrapper.find("div.applyBFPO:not(div.BFPOAddress div.applyBFPO) a:not(.cxtTrigger)").click(handlerBFPOAddress);this.$wrapper.find("div.BFPOAddress div.applyBFPO a:not(.cxtTrigger)").click(handlerUseAddressFinder);if(this.isPreviousAddress){this.$currentTimeAtAddress.find("input:text").blur(function(){self.getTimeAtAddress($(this));});this.$currentTimeAtAddress.find("select").change(function(){self.getTimeAtAddress($(this));});}}};LBG.ajaxPoweredAddressFinder={init:function(){var $elementsForAjaxResponseInjection=$("div.ajaxPoweredAddressFinder");if($elementsForAjaxResponseInjection.length===0){return false;}var ajaxPoweredAddressFinders=[];var $manualAddressFieldset=$("fieldset.enterAddressManually");var validationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject($manualAddressFieldset);for(var i=0,len=$elementsForAjaxResponseInjection.length;i<len;i++){ajaxPoweredAddressFinders.push(new LBG.ajaxPoweredAddressFinder.ajaxPoweredAddressFinder($($elementsForAjaxResponseInjection[i]),i));}var formID=$elementsForAjaxResponseInjection.parents("form").attr("id"),$yearsAtCurrentAddress=$(LBG.common.escapeSpecialCharsInId(formID+":txtYearsAtCurrentAddress")),$monthsAtCurrentAddress=$(LBG.common.escapeSpecialCharsInId(formID+":txtMonthsAtCurrentAddress"));if($(".personalDetails").length>0){ajaxPoweredAddressFinders[0].isPersonalDetailsPostcodeFinder=true;}if($yearsAtCurrentAddress.get(0)!==undefined&&$monthsAtCurrentAddress.get(0)!==undefined){var $parentFormField=$yearsAtCurrentAddress.parents("div.formField");var years,months;var focusAndBlurEventCapturing=function(e){var evt=e||window.event;var tgt=evt.target||evt.srcElement;if(tgt===$yearsAtCurrentAddress.get(0)||tgt===$monthsAtCurrentAddress.get(0)){years=$yearsAtCurrentAddress.val();months=$monthsAtCurrentAddress.val();if(tgt===$monthsAtCurrentAddress.get(0)&&tgt.value===""||months===""){months=0;}if(LBG.Forms.Validation.Routines.simpleRegexTest(LBG.Forms.Validation.Expressions.numeric,years)&&LBG.Forms.Validation.Routines.simpleRegexTest(LBG.Forms.Validation.Expressions.numeric,months)){if(parseInt(years,10)<3&&parseInt(months,10)<12&&jQuery($elementsForAjaxResponseInjection[0]).html().length===0&&$manualAddressFieldset.get(0).style.display!=="block"){$.ajax({url:ajaxPoweredAddressFinders[0].isPersonalDetailsPostcodeFinder?DI.lang.personalDetailsAddressFinder.postCodeFinderStub:DI.lang.addressFinder.postCodeFinderStub,dataType:"html",success:function(data){ajaxPoweredAddressFinders[0].injectNewFormFields(data);ajaxPoweredAddressFinders[0].processPostcodeFinder();}});}else{if(parseInt(years,10)>=3&&parseInt(months,10)<12&&$($elementsForAjaxResponseInjection[0]).html().length>0){ajaxPoweredAddressFinders[0].injectNewFormFields(null);$manualAddressFieldset.hide();LBG.ajax.pageUpdated();}else{if(parseInt(years,10)>=3&&$($elementsForAjaxResponseInjection[0]).html().length===0){$manualAddressFieldset.hide();LBG.ajax.pageUpdated();}}}}}};if($.browser.msie){$parentFormField.get(0).onfocusout=focusAndBlurEventCapturing;}else{$parentFormField.get(0).addEventListener("blur",focusAndBlurEventCapturing,true);}}else{for(i=0,len=ajaxPoweredAddressFinders.length;i<len;i++){ajaxPoweredAddressFinders[i].processPostcodeFinder();}}$manualAddressFieldset.hide();validationHandler.removeChildren($manualAddressFieldset);}};LBG.ajaxPoweredAddressFinder.ajaxPoweredAddressFinder=function($elementForAjaxResponseInjection,addressFinderUniqueID){var that=this;this.$elementForAjaxResponseInjection=$elementForAjaxResponseInjection;this.addressFinderUniqueID=addressFinderUniqueID;this.isPersonalDetailsPostcodeFinder=false;this.$enterAddressManuallyFieldset=$("fieldset.enterAddressManually");this.parentValidationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject(this.$elementForAjaxResponseInjection);};LBG.ajaxPoweredAddressFinder.ajaxPoweredAddressFinder.prototype={injectNewFormFields:function(htmlStubToInject){this.parentValidationHandler.removeChildren(this.$elementForAjaxResponseInjection);if(htmlStubToInject===null){this.$elementForAjaxResponseInjection.empty();}else{this.$elementForAjaxResponseInjection.html(htmlStubToInject);if($.browser.msie&&$.browser.version>=8){$("input:visible,select:visible,textarea:visible",this.$elementForAjaxResponseInjection).eq(0).focus();}}this.parentValidationHandler.isValid=false;LBG.common.explorerRedrawFix();LBG.ajax.pageUpdated();LBG.Forms.Validation.Tools.setMultipleFieldValidation(this.$elementForAjaxResponseInjection);this.parentValidationHandler.findChildren(this.$elementForAjaxResponseInjection);},processPostcodeFinder:function(){var that=this,$enterAddressManuallyLink=this.$elementForAjaxResponseInjection.find("a"),postCodeFinderFormfieldElement=this.$elementForAjaxResponseInjection.find("div.formField")[0],postCodeFinderFormfieldName;if(!postCodeFinderFormfieldElement){return;}postCodeFinderFormfieldName=LBG.Forms.Validation.Tools.convertClassDetailsToData(postCodeFinderFormfieldElement,"validationName:")[0];function loadManualAddressForm(event){event.preventDefault();that.parentValidationHandler.remove(postCodeFinderFormfieldName);that.$elementForAjaxResponseInjection.empty();that.$enterAddressManuallyFieldset.show();that.$enterAddressManuallyFieldset.find("input:text").each(function(){this.ready=false;});that.parentValidationHandler.findChildren(that.$enterAddressManuallyFieldset);that.processManualAddressForm(that.$enterAddressManuallyFieldset);LBG.ajax.pageUpdated();}$enterAddressManuallyLink.bind("click",loadManualAddressForm);var $findAddressInput=this.$elementForAjaxResponseInjection.find("input:image");if(postCodeFinderFormfieldElement!==undefined){var loadAddressSelector=function(event){var addressData;if(that.parentValidationHandler.getChild(postCodeFinderFormfieldName).isValid===true){var integrateAddressData=function(addressData){var option,data,text;for(var i=0,len=addressData.addresses.length;i<len;i++){text="";data=addressData.addresses[i];option=document.createElement("option");option.setAttribute("value",i);if(!LBG.common.isNull(data.numberOrName)){text+=data.numberOrName;}if(!LBG.common.isNull(data.streetName)){text+=(text!=="")?" "+data.streetName:data.streetName;}if(!LBG.common.isNull(data.district)){text+=(text!=="")?", "+data.district:data.district;}if(!LBG.common.isNull(data.townOrCity)){text+=(text!=="")?", "+data.townOrCity:data.townOrCity;
}if(!LBG.common.isNull(data.county)){text+=(text!=="")?", "+data.county:data.county;}option.innerHTML=text;jQuery(that.$elementForAjaxResponseInjection.find("select")[0]).append(option);}};var insertAddressSelector=function(addressData){if(addressData.addresses.length===0){var error=document.createElement("span");error.className="error";error.innerHTML=Messages.noAddressesFound;var oldError=$(postCodeFinderFormfieldElement).find(".error");if(oldError.length>0){oldError.remove();}$(postCodeFinderFormfieldElement).append(error);$(postCodeFinderFormfieldElement).addClass("error");}else{var stubUrl=that.isPersonalDetailsPostcodeFinder?DI.lang.personalDetailsAddressFinder.addressPickerStub:DI.lang.addressFinder.addressPickerStub;$.get(stubUrl,{"addressFinderUniqueID":that.addressFinderUniqueID},function(data){that.injectNewFormFields(data);integrateAddressData(addressData);that.processAddressSelector(addressData);},"html");}};$.get(DI.lang.addressFinder.addressPickerStubData+"?postalCode="+$(postCodeFinderFormfieldElement).find("input:text").val(),{"addressFinderUniqueID":that.addressFinderUniqueID},function named(data){addressData=data;insertAddressSelector(data);},"json");}};$findAddressInput.bind("click",loadAddressSelector);var keyPressEventDelegation=function(event){if(event.keyCode===13){loadAddressSelector(event);}};$findAddressInput.bind("keypress",keyPressEventDelegation);}},processManualAddressForm:function($fieldset){var that=this,$enterAddressManuallyLink=$("div.previousAddress").find("a.linkBullet");function handleChangePostcode(event){event.preventDefault();$.ajax({url:that.isPersonalDetailsPostcodeFinder?DI.lang.personalDetailsAddressFinder.postCodeFinderStub:DI.lang.addressFinder.postCodeFinderStub,data:{"addressFinderUniqueID":that.addressFinderUniqueID},dataType:"html",type:"GET",success:function(data){that.parentValidationHandler.removeChildren($fieldset);$fieldset.find("input:text").each(function(){this.value="";});$fieldset.hide();that.injectNewFormFields(data);that.processPostcodeFinder();}});}$enterAddressManuallyLink.bind("click",handleChangePostcode);},processAddressSelector:function(addressData){var that=this,$changePostcodeLinks=this.$elementForAjaxResponseInjection.find("a"),$useAddressInput=this.$elementForAjaxResponseInjection.find("input:image");var handleChangePostcode=function(){$("div.ajaxPoweredAddressFinder .timeYearsMonths:eq(0) input").val("");$(".enterAddressManually:eq(0)").append($(".ajaxPoweredAddressFinder .timeYearsMonths:eq(0)"));$.ajax({url:that.isPersonalDetailsPostcodeFinder?DI.lang.personalDetailsAddressFinder.postCodeFinderStub:DI.lang.addressFinder.postCodeFinderStub,data:{"addressFinderUniqueID":that.addressFinderUniqueID},dataType:"html",type:"GET",success:function(data){that.injectNewFormFields(data);that.processPostcodeFinder();}});};var loadManualAddressForm=function(){$.ajax({url:that.isPersonalDetailsPostcodeFinder?DI.lang.personalDetailsAddressFinder.enterAddressManuallyStub:DI.lang.addressFinder.enterAddressManuallyStub,data:{"addressFinderUniqueID":that.addressFinderUniqueID},dataType:"html",type:"GET",success:function(data){that.injectNewFormFields(data);that.processManualAddressForm(that.$enterAddressManuallyFieldset);}});};var handleUseAddress=function(){var selectedAddressValue=jQuery(that.$elementForAjaxResponseInjection.find("select")[0]).val();var injectAddressData=function(){var addressParagraph=jQuery(that.$elementForAjaxResponseInjection.find("div.adr"));var data=addressData.addresses[selectedAddressValue];var html="";if(!LBG.common.isNull(data.numberOrName)||!LBG.common.isNull(data.streetName)){html+='<span class="street-address">';html+=!LBG.common.isNull(data.numberOrName)?data.numberOrName:"";html+=!LBG.common.isNull(data.streetName)&&!LBG.common.isNull(data.numberOrName)?" "+data.streetName:data.streetName;html+="</span>";}html+=!LBG.common.isNull(data.district)?'<span class="district">'+data.district+"</span>":"";html+=!LBG.common.isNull(data.townOrCity)?'<span class="town">'+data.townOrCity+"</span>":"";html+=!LBG.common.isNull(data.county)?'<span class="county">'+data.county+"</span>":"";html+=!LBG.common.isNull(data.postcode)?'<span class="postcode">'+data.postcode+"</span>":"";addressParagraph.html(html);};$.ajax({url:that.isPersonalDetailsPostcodeFinder?DI.lang.personalDetailsAddressFinder.addressPickerCompletedStub:DI.lang.addressFinder.addressPickerCompletedStub,data:{"addressFinderUniqueID":+that.addressFinderUniqueID,"selectedAddressValue":selectedAddressValue},dataType:"html",type:"GET",success:function(data){that.injectNewFormFields(data);injectAddressData();$(that.$elementForAjaxResponseInjection.find("a")[0]).bind("click",handleChangePostcode);that.$elementForAjaxResponseInjection.append($(".enterAddressManually .timeYearsMonths:eq(0)"));that.parentValidationHandler.findChildren(that.$elementForAjaxResponseInjection);LBG.Forms.Validation.Tools.setMultipleFieldValidation(that.$elementForAjaxResponseInjection);}});};var clickHandler=function(event){event.preventDefault();if(event.target===$useAddressInput.get(0)){var selectAddressFormfieldElement=that.$elementForAjaxResponseInjection.find("div.formField")[0];var selectAddressFormfieldName=LBG.Forms.Validation.Tools.convertClassDetailsToData(selectAddressFormfieldElement,"validationName:")[0];if(that.parentValidationHandler.getChild(selectAddressFormfieldName).isValid===true){handleUseAddress();}}else{if(event.target===$changePostcodeLinks[0]||event.target===$($changePostcodeLinks[0]).children("img")[0]){handleChangePostcode();}else{if(event.target===$changePostcodeLinks[1]||event.target===$($changePostcodeLinks[1]).children("img")[0]){loadManualAddressForm();}}}};this.$elementForAjaxResponseInjection.bind("click",clickHandler);var keyPressEventDelegation=function(event){if(event.keyCode===13){clickHandler(event);}};$useAddressInput.bind("keypress",keyPressEventDelegation);}};LBG.selectHybrid={componentSelector:"div.selectHybrid",detailsSelector:".furtherDetails",balanceSelector:".accountBalance",fundsSelector:".availableFunds",businessSelector:".businessName",helpSelector:".cxtHelp",detailsHTML:'<div class="furtherDetails"><p><span class="accountBalance"></span><span class="availableFunds"></span></p><p class="businessName"></p></div>',cxtHelpHTML:'<span class="cxtHelp"><a class="cxtTrigger">[?]</a></span>',setFocusOnTab:false,hasCurrYearFundedISA:false,init:function(){var $selectHybridComponents=$(LBG.selectHybrid.componentSelector);if($selectHybridComponents.length===0){return false;}else{var selectHybrids=[];$.each($selectHybridComponents,function(i){selectHybrids[i]=$(this);selectHybrids[i].uniqueID=this.id||null;if(selectHybrids[i].uniqueID!==null){selectHybrids[i].accountData=LBG[this.id].accountData;var $selectInput=selectHybrids[i].find("select");$selectInput.change(function(){LBG.selectHybrid.updateAccountData(selectHybrids[i]);});if($.browser.safari===true||$.browser.mozilla===true){$selectInput.keydown(function(event){LBG.selectHybrid.setFocusOnTab=event.shiftKey===false&&event.keyCode===9;});}var $elm=($selectInput.next().hasClass("submitAction")===true)?$selectInput.next():$selectInput;$elm.after(LBG.selectHybrid.detailsHTML);LBG.selectHybrid.updateAccountData(selectHybrids[i]);}});}},hideError:function($selectHybrid,$field){var $formFields=($field.hasClass("formField"))?$field:$field.find("div.formField");var validationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject($selectHybrid.find("input, select").eq(0));
$formFields.each(function(){var data=LBG.Forms.Validation.Tools.convertClassDetailsToData(this,"validationName:");var field=validationHandler.getChild(data[0]);if(field.hideError){field.hideError();}});},updateAccountData:function($selectHybrid){var selectInput=$selectHybrid.find("select").get(0),selectedAccountValue,newBalance,newAvailableFunds,newBusinessName;if(selectInput.selectedIndex!==-1&&selectInput.options[selectInput.selectedIndex]){selectedAccountValue=selectInput.options[selectInput.selectedIndex].value;}var $nextFocusable=$selectHybrid.next(".formField").find("input, select, a").eq(0);if(selectedAccountValue!==undefined&&$selectHybrid.accountData!==undefined&&$selectHybrid.accountData[selectedAccountValue]!==undefined){newBalance=$selectHybrid.accountData[selectedAccountValue].accountBalance;newAvailableFunds=$selectHybrid.accountData[selectedAccountValue].availableFunds;newBusinessName=$selectHybrid.accountData[selectedAccountValue].businessName;if(newBalance!==""&&newBalance!==undefined){$selectHybrid.find(LBG.selectHybrid.detailsSelector).find(LBG.selectHybrid.balanceSelector).html(newBalance);}else{$selectHybrid.find(LBG.selectHybrid.detailsSelector).find(LBG.selectHybrid.balanceSelector).empty();}if(newAvailableFunds!==""&&newAvailableFunds!==undefined){$selectHybrid.find(LBG.selectHybrid.detailsSelector).find(LBG.selectHybrid.fundsSelector).html(newAvailableFunds);}else{$selectHybrid.find(LBG.selectHybrid.detailsSelector).find(LBG.selectHybrid.fundsSelector).empty();}if(newBusinessName!==""&&newBusinessName!==undefined){$selectHybrid.find(LBG.selectHybrid.detailsSelector).find(LBG.selectHybrid.businessSelector).html(newBusinessName);}else{$selectHybrid.find(LBG.selectHybrid.detailsSelector).find(LBG.selectHybrid.businessSelector).empty();}$selectHybrid.find(LBG.selectHybrid.detailsSelector).find(LBG.selectHybrid.helpSelector).remove();if($selectHybrid.accountData[selectedAccountValue].cxtHelpText!==""&&$selectHybrid.accountData[selectedAccountValue].cxtHelpText!==undefined){$selectHybrid.find(LBG.selectHybrid.detailsSelector).find(LBG.selectHybrid.fundsSelector).after(LBG.selectHybrid.buildContextualHelp($selectHybrid,selectedAccountValue));}$selectHybrid.find(LBG.selectHybrid.detailsSelector).show();LBG.selectHybrid.hideError($selectHybrid,$selectHybrid.find(".formField"));if(($.browser.safari===true||$.browser.mozilla===true)&&LBG.selectHybrid.setFocusOnTab===true){var $focus=$selectHybrid.find(LBG.selectHybrid.detailsSelector).find(LBG.selectHybrid.helpSelector).find("a.cxtTrigger");if($focus.length>0){var $next=$focus.parents(".selectHybrid").next(".formField");setTimeout(function(){$focus.focus();LBG.selectHybrid.hideError($selectHybrid,$next);},5);}else{$nextFocusable.focus();}}}else{LBG.selectHybrid.clearDetails($selectHybrid);$selectHybrid.find(LBG.selectHybrid.detailsSelector).hide();if(($.browser.safari===true||$.browser.mozilla===true)&&LBG.selectHybrid.setFocusOnTab===true){$nextFocusable.focus();}}},adjustDetailsWidth:function($selectHybrid){$selectHybrid.find(LBG.selectHybrid.detailsSelector).width(0).width($selectHybrid.find(".formFieldInner").width());},buildContextualHelp:function($selectHybrid,selectedAccountValue){var $cxtHelpHTML=$(LBG.selectHybrid.cxtHelpHTML);var $anchorLink=$cxtHelpHTML.find("a");var anchorURL="#cxtHelp_"+$selectHybrid.uniqueID;$anchorLink.attr("title",$selectHybrid.accountData[selectedAccountValue].cxtHelpText);$cxtHelpHTML.find("a").attr("href",anchorURL);return $cxtHelpHTML.get(0);},clearDetails:function($selectHybrid){$selectHybrid.find(LBG.selectHybrid.detailsSelector).find(LBG.selectHybrid.balanceSelector).empty();$selectHybrid.find(LBG.selectHybrid.detailsSelector).find(LBG.selectHybrid.fundsSelector).empty();$selectHybrid.find(LBG.selectHybrid.detailsSelector).find(LBG.selectHybrid.helpSelector).remove();}};LBG.ISASelectRef=(function(initSelector,textSelector,dropDownSelector){var setup=function($formField){if(!LBG.selectHybrid.hasCurrYearFundedISA){$("option",dropDownSelector).each(function(i){var tmpOpt=$("option:nth-child("+(i+1)+")",$(".slctAccountFrom"));var metaRef=tmpOpt.metadata().reference;if(metaRef=="ISA_Current"){LBG.selectHybrid.hasCurrYearFundedISA=true;return false;}});}$(dropDownSelector,$formField).change(function(){var $option=$("option:selected",this),metadata=$option.metadata();var validationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject($option);$(".ISAInfoMessage").hide();validationHandler.hideError();var selectInput=this;var selectedAccountRef=metadata.reference;var $fromOption=$("option:selected",$(".slctAccountFrom"));var fromRef=$fromOption.metadata().reference;var $toOption=$("option:selected",$(".slctAccountTo"));var toRef=$toOption.metadata().reference;$("input."+validationHandler.submitInputSelector).attr("disabled",false);$("input."+validationHandler.submitInputSelector).css({"filter":"","opacity":""});if(selectInput.className.indexOf("slctAccountFrom")>0){var fromSelVal=$(".slctAccountFrom").val();$(".slctAccountFrom").html(LBG.manageTransfers.initialFromAccounts);$(".slctAccountFrom>option[value="+fromSelVal+"]").attr("selected",true);$(".slctAccountTo>option:eq(0)").attr("selected",true);$(".slctAccountTo").siblings(".furtherDetails").hide();$("input."+validationHandler.submitInputSelector).attr("disabled",false);$("input."+validationHandler.submitInputSelector).css({"filter":"","opacity":""});}else{if(selectedAccountRef=="ISA_Previous"&&LBG.selectHybrid.hasCurrYearFundedISA){if(!validationHandler.validationRoutines.customMessage){validationHandler.validationRoutines.push("customMessage");validationHandler.validationRoutines.customMessage={msg:"msg256"};}if(typeof dcsMultiTrack!="undefined"){dcsMultiTrack("WT.tx_e","E");}validationHandler.showError();$("input."+validationHandler.submitInputSelector).attr("disabled","disabled");$("input."+validationHandler.submitInputSelector).css({"filter":"alpha(opacity=40)","opacity":"0.4"});validationHandler.validationRoutines.customMessage=undefined;}else{if(fromRef=="ISA_Previous"&&toRef=="ISA_Previous"&&!LBG.selectHybrid.hasCurrYearFundedISA){$(".ISAInfoMessage").show();if(typeof dcsMultiTrack!="undefined"){dcsMultiTrack("WT.tx_e","W3");}}else{if(fromRef=="ISA_Previous"&&toRef=="ISA_Current"&&LBG.selectHybrid.hasCurrYearFundedISA){$(".ISAInfoMessage").show();if(typeof dcsMultiTrack!="undefined"){dcsMultiTrack("WT.tx_e","W3");}}else{if((typeof toRef!="undefined")&&($(".formSubmitError").length==0)&&$(".ISAInfoMessage:hidden")){if(typeof dcsMultiTrack!="undefined"){dcsMultiTrack("WT.tx_e","T");}}}}}}});};return{init:function(){$(initSelector).each(function(){setup($(this));$(dropDownSelector,this).trigger("change");});}};});LBG.isaOvelay1Ref=(function(){return LBG.ISASelectRef(".formField.isaOvelay1Ref","","select.fromAccount");})();LBG.isaOvelay2Ref=(function(){return LBG.ISASelectRef(".formField.isaOvelay2Ref","","select.toAccount");})();LBG.employmentShowHide={employmentSelector:".employmentStatus",infoSelector:"div.employmentInfo",employmentStatusSelector:"select.slctEmploymentStatus",occupationTypeSelector:"select.slctOccupationType",occupationSelector:"select.slctOccupation",validIdentifier:DI.lang.employmentShowHide.validIdentifier,isEligible:true,data:null,init:function(){var $infoElements=$(LBG.employmentShowHide.infoSelector),$employmentWrapper=$(LBG.employmentShowHide.employmentSelector),$employmentStatus=[],$occupationType=[],$occupation=[],$occupationOptions=[];if($infoElements.length>0){$infoElements.each(function(){var that=this;
that.validationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject($(that));var employmentShowHideHelper=function(emplSelect,that){if(LBG.employmentShowHide.isEligible){LBG.employmentShowHide.updateInfoVisibility(emplSelect,that);}else{$(that).hide();}};var $employSelect=$(that).parents("fieldset").find(LBG.employmentShowHide.employmentSelector).find(":input");$employSelect.change(function(){if(LBG.employmentShowHide.isEligible){LBG.employmentShowHide.updateInfoVisibility(this,that);}});$employSelect.keyup(function(e){if((e.keyCode===38)||(e.keyCode===40)){if(LBG.employmentShowHide.isEligible){LBG.employmentShowHide.updateInfoVisibility(this,that);}}});LBG.employmentShowHide.data=$(that).parents("form:eq(0)").metadata();if(("age" in LBG.employmentShowHide.data)&&("maxlimit" in LBG.employmentShowHide.data)){LBG.employmentShowHide.isEligible=LBG.employmentShowHide.testEligiblity($(that).closest("form").find("input:eq(1)"));$(that).closest("form").find("input:eq(1)").change(function(){LBG.employmentShowHide.isEligible=LBG.employmentShowHide.testEligiblity($(this));employmentShowHideHelper($employSelect[0],that);});}employmentShowHideHelper($employSelect[0],that);});}if($employmentWrapper.length){$employmentStatus=$employmentWrapper.find(LBG.employmentShowHide.employmentStatusSelector);$occupationType=$employmentWrapper.parent().find(LBG.employmentShowHide.occupationTypeSelector);$occupation=$employmentWrapper.parent().find(LBG.employmentShowHide.occupationSelector);var employmentStatusIndex=$employmentStatus.attr("selectedIndex");var occupationSelectedVal="";if($occupationType.length){var tabDirection="";var getTabDirection=function(e){if(e.keyCode!==9){tabDirection="";}else{tabDirection=(e.shiftKey)?"prev":"next";}};$occupationOptions=$occupation.find("option");occupationSelectedVal=$occupationOptions.filter(":selected").val();$occupationType.keyup(function(e){if((e.keyCode===38)||(e.keyCode===40)){if(LBG.employmentShowHide.isEligible){$occupationType.change();}}});var handlerEmploymentStatus=function(e){if(e.type==="change"&&$(this).attr("selectedIndex")!==employmentStatusIndex){occupationSelectedVal="";}if(e.type==="blur"&&tabDirection==="next"){var timer=window.setTimeout(function(){$occupationType.focus();tabDirection="";window.clearTimeout(timer);},1);}};var handlerOccupationType=function(e){var selectedClass="relation-"+this.value;var curIndex=0;if(e.type==="change"){if(this.value!=="-"){$occupation.empty();$occupation[0].options[curIndex]=new Option($occupationOptions[0].text,$occupationOptions[0].value,true);$occupationOptions.each(function(i){if($(this).hasClass(selectedClass)){curIndex=$occupation[0].options.length;$occupation[0].options[curIndex]=new Option(this.text,this.value,this.value===occupationSelectedVal);if(this.value===occupationSelectedVal){$occupation.attr("selectedIndex",curIndex);}}});}else{$occupation.attr("selectedIndex",0);}}if(e.type==="blur"&&tabDirection!==""){var timer=window.setTimeout(function(){if(tabDirection==="next"){$occupation.focus();}else{$employmentStatus.focus();}tabDirection="";window.clearTimeout(timer);},1);}};$employmentStatus.blur(handlerEmploymentStatus).change(handlerEmploymentStatus).keydown(getTabDirection);if($occupation.length){$occupationType.blur(handlerOccupationType).change(handlerOccupationType).keydown(getTabDirection);}}}},testEligiblity:function(input){return((this.data.age+parseInt($(input).val(),10))/12)<this.data.maxlimit;},updateInfoVisibility:function(input,info){var showInfo=input.value.match(LBG.employmentShowHide.validIdentifier);var lpiCheckbox=$(info).find("input:checkbox").get(0);var meta=$(input).find(":selected").metadata();if(showInfo&&meta.enable===true){$(info).show();if(lpiCheckbox!==undefined){lpiCheckbox.disabled=false;}if(info.validationHandler){info.validationHandler.findChildren($(info));}}else{$(info).hide();if(lpiCheckbox!==undefined){lpiCheckbox.checked=false;lpiCheckbox.disabled=true;}if(info.validationHandler){info.validationHandler.removeChildren($(info));}}LBG.common.explorerRedrawFix();}};LBG.manageTransfers={fromAccountSelector:"select.fromAccount",toAccountSelector:"select.toAccount",detailsSelector:".furtherDetails",hybridSelector:".selectHybrid",fromText:DI.lang.manageTransfers.fromText,toText:DI.lang.manageTransfers.toText,initTo:true,init:function(){this.$fromInput=$(LBG.manageTransfers.fromAccountSelector);if(!this.$fromInput.length){return;}this.$toInput=$(LBG.manageTransfers.toAccountSelector);if(!this.$toInput.length){return;}this.$parentSelectHybrid=$(LBG.manageTransfers.toAccountSelector).parents(LBG.manageTransfers.hybridSelector);this.initialToAccounts=$(LBG.manageTransfers.toAccountSelector).html();this.initialFromAccounts=$(LBG.manageTransfers.fromAccountSelector).html();this.$fromInput.change(function(){LBG.manageTransfers.updateToAccount(this);}).change();this.$toInput.change(function(){LBG.manageTransfers.updateFromAccount(this);}).change();},updateToAccount:function(fromAccountInput){if(fromAccountInput.selectedIndex<0){fromAccountInput.selectedIndex=0;}var selectedAccountValue=fromAccountInput.options[fromAccountInput.selectedIndex].value;var selectedAccountIndexValue=(this.$toInput.get(0).selectedIndex>=0)?this.$toInput.get(0).options[this.$toInput.get(0).selectedIndex].value:null;if(LBG.manageTransfers.initTo===false){this.$toInput.html(this.initialToAccounts);}var toCount=0;var removedIndex;var sIndex;this.$toInput.find("option").each(function(){if(this.value===selectedAccountValue&&this.value!=="-"&&this.value!==null){$(this).remove();removedIndex=toCount;}toCount++;});toCount=0;this.$toInput.find("option").each(function(){if(this.value===selectedAccountIndexValue){sIndex=toCount;}toCount++;});this.$toInput.get(0).selectedIndex=sIndex;if(LBG.manageTransfers.initTo===false&&this.$toInput.get(0).selectedIndex===0){this.$parentSelectHybrid.find(LBG.manageTransfers.detailsSelector).hide();}LBG.manageTransfers.initTo=false;},updateFromAccount:function(toAccountInput){if(toAccountInput.selectedIndex<0){toAccountInput.selectedIndex=0;}var selectedAccountValue=toAccountInput.options[toAccountInput.selectedIndex].value;var selectedAccountIndexValue=this.$fromInput.get(0).options[this.$fromInput.get(0).selectedIndex].value;if(LBG.manageTransfers.initTo===false){this.$fromInput.html(this.initialFromAccounts);}var fromCount=0;var removedIndex;var sIndex;this.$fromInput.find("option").each(function(){if(this.value===selectedAccountValue&&this.value!=="-"){$(this).remove();removedIndex=fromCount;}fromCount++;});fromCount=0;this.$fromInput.find("option").each(function(){if(this.value===selectedAccountIndexValue){sIndex=fromCount;}fromCount++;});this.$fromInput.get(0).selectedIndex=sIndex;if(LBG.manageTransfers.initTo===false&&this.$fromInput.get(0).selectedIndex===0){this.$parentSelectHybrid.find(LBG.manageTransfers.detailsSelector).hide();}LBG.manageTransfers.initTo=false;}};LBG.linkedRadioAndTextFields=(function(){var WRAPPER=".linkedRadioAndTextFields",RADIO_BUTTONS=".linkedRadio",FORM_FIELDS=".linkedTextField",TEXT_ENABLED="enabledTextField",SELECTED_VALUE=DI.lang.validation.yesRegexValue,clickTrigger=false;function updateTextInput(input){var $linkedTextField=$(input).parents(WRAPPER).find(FORM_FIELDS),$formFieldElement=$linkedTextField.parents(".formField"),validationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject($formFieldElement),validationName=LBG.Forms.Validation.Tools.convertClassDetailsToData($formFieldElement.get(0),"validationName:")[0],validationElement;
if($linkedTextField.hasClass(TEXT_ENABLED)===false&&!$linkedTextField.data("skip")){$linkedTextField.attr("disabled","disabled");$linkedTextField.addClass("isDisabled");}for(var i=0,len=validationHandler.children.length;i<len;i++){if(validationHandler.children[i].name===validationName){validationElement=validationHandler.children[i];}}if(input.checked){if(SELECTED_VALUE.test(input.value)&&$linkedTextField.hasClass(TEXT_ENABLED)===false){$linkedTextField.attr("disabled","");$linkedTextField.removeClass("isDisabled");$linkedTextField.data("skip",true);}else{if(clickTrigger===true&&$linkedTextField.hasClass(TEXT_ENABLED)===false){$linkedTextField.val("");}validationElement.hideError();validationElement.isValid=false;if($linkedTextField.hasClass(TEXT_ENABLED)===false){$linkedTextField.attr("disabled","disabled");$linkedTextField.addClass("isDisabled");}}}LBG.ajax.pageUpdated();}function setup(){updateTextInput(this);$(this).click(function(){clickTrigger=true;updateTextInput(this);});}return{init:function(){$(WRAPPER).find(RADIO_BUTTONS).each(setup);}};}());LBG.linkedSelectAndTextFields={wrapperSelector:".linkedSelectAndTextFields",selectSelector:".linkedSelect",textSelector:".linkedTextField",otherValue:DI.lang.validation.otherValue,init:function(){$(LBG.linkedSelectAndTextFields.wrapperSelector).find(LBG.linkedSelectAndTextFields.selectSelector).each(function(){LBG.linkedSelectAndTextFields.updateTextInput(this);$(this).change(function(){LBG.linkedSelectAndTextFields.updateTextInput(this);});});},updateTextInput:function(input){this.$linkedTextField=$(input).parents(LBG.linkedSelectAndTextFields.wrapperSelector).find(LBG.linkedSelectAndTextFields.textSelector);this.$formFieldElement=this.$linkedTextField.parents(".formField");this.validationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject(this.$formFieldElement);this.validationName=LBG.Forms.Validation.Tools.convertClassDetailsToData(this.$formFieldElement.get(0),"validationName:")[0];var value=input.options[input.selectedIndex].value;for(var i=0,len=this.validationHandler.children.length;i<len;i++){if(this.validationHandler.children[i].name===this.validationName){this.validationElement=this.validationHandler.children[i];}}if(value===LBG.linkedSelectAndTextFields.otherValue){this.$formFieldElement.show();$("input:visible",this.$formFieldElement).eq(0).focus();LBG.common.explorerRedrawFix();}else{this.$linkedTextField.val("");this.validationElement.hideError();this.validationElement.isValid=false;this.$formFieldElement.hide();LBG.common.explorerRedrawFix();}LBG.ajax.pageUpdated();}};LBG.linkedCheckBoxAndTextFields={wrapperSelector:".linkedCheckBoxAndTextFields",checkboxSelector:".linkedCheckBox",textSelector:".linkedTextField",checkedValue:DI.lang.validation.checkedValue,init:function(){$(LBG.linkedCheckBoxAndTextFields.wrapperSelector).find(LBG.linkedCheckBoxAndTextFields.checkboxSelector).each(function(){LBG.linkedCheckBoxAndTextFields.updateTextInput(this);$(this).click(function(){LBG.linkedCheckBoxAndTextFields.updateTextInput(this);});});},updateTextInput:function(input){this.$linkedTextField=$(input).parents(LBG.linkedCheckBoxAndTextFields.wrapperSelector).find(LBG.linkedCheckBoxAndTextFields.textSelector);this.$formFieldElement=this.$linkedTextField.parents(".formField");this.validationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject(this.$formFieldElement);this.validationName=LBG.Forms.Validation.Tools.convertClassDetailsToData(this.$formFieldElement.get(0),"validationName:")[0];for(var i=0,len=this.validationHandler.children.length;i<len;i++){if(this.validationHandler.children[i].name===this.validationName){this.validationElement=this.validationHandler.children[i];}}if(input.checked===LBG.linkedCheckBoxAndTextFields.checkedValue){this.$linkedTextField.attr("disabled","");this.$linkedTextField.removeClass("isDisabled");}else{this.$linkedTextField.val("");this.validationElement.isShowingError=this.$formFieldElement.hasClass("error");this.validationElement.hideError();this.validationElement.isValid=false;this.$linkedTextField.attr("disabled","disabled");this.$linkedTextField.addClass("isDisabled");}LBG.ajax.pageUpdated();}};LBG.linkedTextFieldAndCheckBox={wrapperSelector:".linkedTextFieldAndCheckBox",checkboxSelector:".linkedCheckBox",textSelector:".linkedTextField",setFocusOnTab:false,init:function(){$(LBG.linkedTextFieldAndCheckBox.checkboxSelector,$(LBG.linkedTextFieldAndCheckBox.wrapperSelector)).attr("disabled","disabled");$(LBG.linkedTextFieldAndCheckBox.wrapperSelector).find(LBG.linkedTextFieldAndCheckBox.textSelector).each(function(){$(this).change(function(){LBG.linkedTextFieldAndCheckBox.updateTextInput(this);}).keydown(function(event){LBG.linkedTextFieldAndCheckBox.setFocusOnTab=event.shiftKey===false&&event.keyCode===9;});});},updateTextInput:function(input){this.$linkedCheckBox=$(input).parents(LBG.linkedTextFieldAndCheckBox.wrapperSelector).find(LBG.linkedTextFieldAndCheckBox.checkboxSelector);this.$linkedTextField=$(input).parents(LBG.linkedTextFieldAndCheckBox.wrapperSelector).find(LBG.linkedTextFieldAndCheckBox.textSelector);this.$formFieldElement=this.$linkedCheckBox.parents(".formField");this.validationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject(this.$formFieldElement);if(this.$linkedTextField.val()!==""){this.$linkedCheckBox.attr("disabled","");if(LBG.linkedTextFieldAndCheckBox.setFocusOnTab===true){var $linkedInput=this.$linkedCheckBox;setTimeout(function(){$linkedInput.focus();},5);}}else{this.$linkedTextField.val("");this.$linkedCheckBox.attr("checked","");this.$linkedCheckBox.attr("disabled","disabled");}LBG.ajax.pageUpdated();}};LBG.autoFillDecimals={amountFormFieldSelector:".amountField",addDecimals:function($formField){var $inputElements=$formField.find("input:text");var inputsToUpdate=[],i,len;if($inputElements.length>1){if($formField.parents(".radioGroup").length>0){for(i=0,len=$inputElements.length;i<len;i++){inputsToUpdate.push($inputElements[i]);}}}else{inputsToUpdate.push($inputElements[0]);}for(i=0,len=inputsToUpdate.length;i<len;i++){if(inputsToUpdate[i].value.length>0){LBG.autoFillDecimals.updateAmountWithDecimalPlaces(inputsToUpdate[i]);}}},updateAmountWithDecimalPlaces:function(input){var isNegative=parseInt(input.value,10)<0||input.value.indexOf("-")!==-1;if(!LBG.Forms.Validation.Routines.simpleRegexTest(LBG.Forms.Validation.Expressions.currencyCharacters,input.value)){return false;}if(isNegative){input.value=input.value.replace(/-/g,"");}input.value=input.value.replace(/^0+/,"");if(input.value<1){input.value="0"+input.value;}if(input.value.indexOf(".")<0){if(LBG.Forms.Validation.Routines.simpleRegexTest(LBG.Forms.Validation.Expressions.numeric,parseInt(input.value.replace(/,/g,""),10))){input.value+=".00";}}else{var splitDecimal=input.value.split("."),decimalPlaces="";for(var i=1;i<splitDecimal.length;i++){if(splitDecimal[i]!==""){decimalPlaces=splitDecimal[i];}}if(decimalPlaces.length<2){input.value+="0";this.updateAmountWithDecimalPlaces(input);}}if(isNegative){input.value="-"+input.value;}}};LBG.converter=(function(){var setup_run=false,$con;function updateInputs(){if(setup_run){$con.find("input[type=text]").val("");}var meta=$(this).find(":selected").metadata();$("input.dynCurrencyValueDomestic")[0].rate=meta.rate;$("input.dynCurrencyValueForeign")[0].rate=1/meta.rate||undefined;var $copy=$("div.dynconSelectionCopy");if(this.value==="-"){$copy.hide();}else{$copy.show();$copy.find("p.dynconSelectionCopyCurrency").text(meta.abbr+": "+meta.name);
$copy.find("span").text(meta.rate+" "+meta.abbr);$copy.find("p.dynconSelectionCopyInfo").text(meta.info||"");$("label.dynconValueForeignLabel").text(meta.name);}}function updateDropdown(){var $this=$(this);if(setup_run){LBG.Forms.Validation.Tools.getValidationHandlerObject($this).hideError();}$("div.country_cash, div.country_cheque").hide();var dropdown=$($this.metadata().target).show().find("select");updateInputs.call(dropdown[0]);}function convert(){if(!this.rate){return;}$($(this).metadata().target).val((LBG.converter.tidyCurrency(this.value)*this.rate).toFixed(2));}function reverse(str){return str.split("").reverse().join("");}return{tidyCurrency:function(strIn){var val=strIn,reRplc=new RegExp("[-+,\\u00A3]","g");val=val.replace("&pound;","");val=val.replace(reRplc,"");return val;},formatCurrency:function(value){var val=value,spl=[],len=0,dol=0,cen=0;val=val.replace(/,/g,"");spl=val.split(".");len=spl.length;if(len>2){val=spl.slice(0,len-1);val=val.join("")+"."+spl[len-1];spl=val.split(".");}dol=reverse(spl[0]);cen=spl[1]?"."+spl[1]:"";spl=[];for(var i=0;i<dol.length;i+=3){spl.push(dol.substr(i,3));}dol=reverse(spl.join());return dol+cen;},init:function(){$con=$("div.dynamicConverter");if(!$con.length){return;}$("div.staticConverter").hide();$con.show();$con.find("input[type=text]").keyup(convert).keydown(function(){$con.find("input.dynconValueFlag").val(this.id);});$con.find("select").change(updateInputs);$con.find("input[type=radio]").click(updateDropdown).filter(":checked").click();setup_run=true;}};})();LBG.enhanceOverdraftDetails=(function(){var MODULE_SELECTOR="fieldset.overdraftDetails",OPTION_VALUES={termValue:"ongoing_term",overdraftPurposeValue:"ongoing_od_purpose",overdraftRepayValue:"ongoing_od_repay"},selectElementHash={},validationHandler;function _getSelectElements(){$.each(OPTION_VALUES,function(key,value){selectElementHash[key]=$('option[value="'+value+'"]').closest("select")[0];});return selectElementHash;}function _onChangeHandler(key,value){if(OPTION_VALUES[key]===value){if(validationHandler!==undefined){$.each(validationHandler.children,function(){this.hideError();});}$.each(selectElementHash,function(_key){if(this.value!==value){this.value=OPTION_VALUES[_key];}});}}return{init:function overdraftDetailController(){var overdraftFormEl=$(MODULE_SELECTOR)[0]||null;if(overdraftFormEl!==null){validationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject($(overdraftFormEl));$.each(_getSelectElements(),function(key){$(this).change(function(){_onChangeHandler(key,this.value);});});}}};})();LBG.autoSelectRadioButton=(function(){var RADIO_GROUP_SELECTOR="div.amountGroup",ELEMENT_SELECTORS="input:text";function _updateRadiobutton(){var $this=$(this),currentValue=$this.val();this.parentFormField=this.parentFormField||$this.closest("div.formField");if(currentValue!==this.previousValue){this.parentFormField.find("input:radio").get(0).checked=true;this.previousValue=currentValue;this.parentFormObject=this.parentFormObject||LBG.Forms.Validation.Tools.getValidationHandlerObject($this);this.formFieldName=this.formFieldName||LBG.Forms.Validation.Tools.convertClassDetailsToData(this.parentFormField[0],"validationName:")[0]||null;for(var i=0,len=this.parentFormObject.children.length,childField;i<len;i++){childField=this.parentFormObject.children[i];if(childField.name!==this.formFieldName&&childField.isShowingError===true){childField.hideError();}}}}return{init:function autoSelectRadiobuttonController(){$(RADIO_GROUP_SELECTOR).find(ELEMENT_SELECTORS).each(function(){var $this=$(this);this.previousValue=$this.val();$(this).blur(_updateRadiobutton);});}};})();LBG.beneficiariesChooser=(function(){var FORM="form.beneficiariesChooser",OVERLAY="#overlay",INPUT_TABLE="table.beneficiaries",INPUT_FIELDSET="fieldset.selectBeneficiaryAccount",MESSAGE_CONTAINER="p.selectionMsg",SELECTION_LIMIT=DI.lang.beneficiariesChooser.selectionCountValue,X_REMAINING_MSG=DI.lang.beneficiariesChooser.selectionRemainingMsg,MAX_REACHED_MSG=DI.lang.beneficiariesChooser.selectionMaxReachedMsg,PAGE_FORM="#page form",HIDDEN_COUNT_VAL="input.selectBeneficiaryCountValue:hidden";function updateSiblingCheckboxes(){var $inputsParent=($(OVERLAY).length>0)?$(this).parents(FORM).find(INPUT_FIELDSET):$(this).parents(FORM).find(INPUT_TABLE);var $siblingCheckboxes=$inputsParent.find("input:checkbox");var checkedElements=0;var i,len,disableCheckboxes=false;if($siblingCheckboxes.length>SELECTION_LIMIT){for(i=0,len=$siblingCheckboxes.length;i<len;i++){if($siblingCheckboxes[i].checked){checkedElements++;}}if(checkedElements===SELECTION_LIMIT){disableCheckboxes=true;}for(i=0;i<len;i++){if(!$siblingCheckboxes[i].checked){$siblingCheckboxes[i].disabled=disableCheckboxes;}}var html=((SELECTION_LIMIT-checkedElements)===0)?MAX_REACHED_MSG:X_REMAINING_MSG.replace("{0}",SELECTION_LIMIT-checkedElements);$(this).parents(FORM).find(MESSAGE_CONTAINER).html(html);}}return{init:function(){var $inputsParent=($(OVERLAY).length>0)?$(OVERLAY).find(FORM).find(INPUT_FIELDSET):$(FORM).find(INPUT_TABLE);if($(OVERLAY).length){var $inputHiddenCount=$(PAGE_FORM).find(HIDDEN_COUNT_VAL);if($inputHiddenCount.length&&$inputHiddenCount.val()!==""){SELECTION_LIMIT=parseInt($inputHiddenCount.val(),10);}}var checkedElements=$inputsParent.find("input:checkbox:checked").length;$inputsParent.parents(FORM).find(MESSAGE_CONTAINER).html(X_REMAINING_MSG.replace("{0}",SELECTION_LIMIT-checkedElements));$inputsParent.find("input:checkbox").bind("click",updateSiblingCheckboxes);}};})();LBG.previousAddressRepeater=(function(){var previousAddressSelector="fieldset.previousAddress",additionalPreviousAddressSelector="fieldset.additionalPreviousAddress",mainSelector="fieldset.repeatableAddress",yearsSelector="div.timeYearsMonths input.years",monthsSelector="div.timeYearsMonths input.months";function calculateTimeAtAddress(container){var years=parseInt($(yearsSelector,container).val(),10)||0,months=parseInt($(monthsSelector,container).val(),10)||0;if(isNaN(years)||years<0||isNaN(months)||months<0){return undefined;}else{return years*12+months;}}function hideAddress(selector){var inputCollection=$(selector).find("input:text"),hideThisAddress=true;for(var i=0;i<inputCollection.length;i++){if(inputCollection[i].value!==""){hideThisAddress=false;break;}}if(hideThisAddress===true){$(selector).hide();}}function timeFieldHasValue(addressSelector){var isValid=false,tTime;$(addressSelector).find("input:text").each(function(){if($(this).hasClass("years")||$(this).hasClass("months")){tTime=parseInt($(this).val(),10)||0;if(tTime>0){isValid=true;return false;}}});return isValid;}function setup(){hideAddress(previousAddressSelector);hideAddress(additionalPreviousAddressSelector);var addresses=[this];var handleChange=function handleChange(){};var insertNewAddress=function insertNewAddress(addressSelector){var block=$(addressSelector)[0];$(addressSelector).show();addresses.push(block);$(yearsSelector,block).change(handleChange);$(monthsSelector,block).change(handleChange);LBG.Forms.Validation.init();LBG.initAddressRepeaters.init();};handleChange=function handleChange(){var total=0;for(var i=0;i<addresses.length;i++){var time=calculateTimeAtAddress(addresses[i]);if(time===undefined||time===0){return;}total+=time;if(total>=36){while(addresses.length>i+1){$(addresses.pop()).hide();}return;}}if(addresses.length<=2){if(addresses.length===1){insertNewAddress(previousAddressSelector);if(timeFieldHasValue(previousAddressSelector)){insertNewAddress(additionalPreviousAddressSelector);
}}else{insertNewAddress(additionalPreviousAddressSelector);}}};$(yearsSelector,this).change(handleChange).change().blur();$(monthsSelector,this).change(handleChange).change().blur();}return{init:function(){$(mainSelector).each(setup);}};})();LBG.initAddressRepeaters=(function(){var mainSelector="div.addressField";function setup(){$(this).find("input:text").each(function(){if(($(this).hasClass(".first")||$(this).hasClass(".second"))){$(this).focus(function(){$(this).find("input:text").each(function(){if(!($(this).hasClass(".first")||$(this).hasClass(".second"))){this.ready=true;}});});}else{this.ready=true;}});}return{init:function(){$(mainSelector).each(setup);}};})();LBG.paymentCalculator={selectorForm:"form.internationalPaymentsCalculator",selectorCurrency:"select.internationalPaymentsCurrency",selectorCurrencyTypeForeign:".currencyType .currencyTypeForeign",selectorCurrencyAmount:".amountField",init:function(){var $form=$(LBG.paymentCalculator.selectorForm);$form.find(LBG.paymentCalculator.selectorCurrency).bind("change",function(){if(!this.disabled){LBG.currencyCode.init();var $warningMessage=$("<p class='warning'>"+DI.lang.allowDecimalsForCurrency.warningMessage+"</p>"),$amountWrapper=$(LBG.paymentCalculator.selectorCurrencyAmount).find(".formFieldInner");if($(":selected",this).metadata().allowDecimal===false){$warningMessage.prependTo($amountWrapper);}else{$amountWrapper.find("p.warning").remove();}var $selectedCurrencyLabel=$form.find(LBG.paymentCalculator.selectorCurrencyTypeForeign).find("label");if($selectedCurrencyLabel[0].defaultLabel===undefined){$selectedCurrencyLabel[0].defaultLabel=$selectedCurrencyLabel.html();}var currencyText=($(this).val()==="-")?$selectedCurrencyLabel[0].defaultLabel:$(this).find("option:selected").text();$selectedCurrencyLabel.html(currencyText);}}).change();}};LBG.internationalPayment={init:function(){var currencyWarning="span.warning",currencySelect="select.internationalPaymentCurrency",domesticInput="input.domesticAmountInput",foreignInput="input.foreignAmountInput",$allowDecimalMessage;$(currencySelect).bind("change",function(){var metadata=$(":selected",this).metadata();LBG.currencyCode.init();if(metadata.disabledSterlingEquivalent===true){$(foreignInput).attr("checked","checked");$(domesticInput).attr("disabled","disabled").next("label").addClass("disabled");}else{$(domesticInput).removeAttr("disabled").next("label").removeClass("disabled");}if(metadata.showCurrencyWarning===true){$(currencyWarning).add($(currencyWarning).next(".cxtHelp")).show();}else{$(currencyWarning).add($(currencyWarning).next(".cxtHelp")).hide();}if(metadata.allowDecimal!==undefined){if($allowDecimalMessage===undefined){$allowDecimalMessage=$('<span class="inlineHelp">'+DI.lang.allowDecimalsForCurrency.warningMessage+"</span>").hide();$(foreignInput).parents(".formFieldInner").find("span.label").append($allowDecimalMessage);}if(metadata.allowDecimal===false){$allowDecimalMessage.show();}else{$allowDecimalMessage.hide();}}else{if($allowDecimalMessage){$allowDecimalMessage.hide();}}}).change();LBG.internationalPayment.international_payments_email_preferences();},international_payments_email_preferences:function(){if(!$("input.ngb-ip-email-prefs").is(":checked")){$(".ngb-ip-email-details").hide();}$("input.ngb-ip-email-prefs").bind($.browser.msie?"propertychange":"change",function(){$(".ngb-ip-email-details").toggle();});}};LBG.currencyCode={init:function(){var currencyCode=$("select.currencyCodeSelect").val();if(currencyCode=="-"){if($(".domesticAmountInput").is(":checked")){$(".currencyCodeLabel").text("GBP");}else{$(".currencyCodeLabel").text("");}}else{if($(".domesticAmountInput").is(":checked")){$(".currencyCodeLabel").text("GBP");}else{$(".currencyCodeLabel").text(currencyCode);}}$(".currencyCodeSwitch input").click(function(){if($(".domesticAmountInput").is(":checked")){if(currencyCode=="-"){$(".currencyCodeLabel").text("");}else{$(".currencyCodeLabel").text("GBP");}}else{if(currencyCode=="-"){$(".currencyCodeLabel").text("");}else{$(".currencyCodeLabel").text(currencyCode);}}});$("select.currencyCodeSelect").change(function(){if($(this).val()=="-"){$(".currencyCodeLabel").text("");}});}};LBG.accountSwitcher=(function(){var ACCOUNT_SELECTOR=".accountSwitcher",ACCOUNT_FIELDS=".accountDetailsGroup";function updateAccountFields(input){var value=input.options[input.selectedIndex].value.toString(),ajaxUrl,validationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject($(input).parents(".formField"));switch(value){case"1":ajaxUrl=DI.lang.accountSwitcher.currentAccountStub;break;case"2":ajaxUrl=DI.lang.accountSwitcher.creditCardStub;break;case"3":ajaxUrl=DI.lang.accountSwitcher.loanAccountStub;break;case"4":ajaxUrl=DI.lang.accountSwitcher.mortgageAccountStub;break;case"5":ajaxUrl=DI.lang.accountSwitcher.creditCardCardOnlyStub;break;}function injectNewFormFields(data){validationHandler.removeChildren($(ACCOUNT_FIELDS));$(ACCOUNT_FIELDS).html(data);validationHandler.hideError();validationHandler.isValid=false;if($.browser.msie){LBG.common.explorerRedrawFix();}LBG.ajax.pageUpdated();validationHandler.findChildren($(ACCOUNT_FIELDS));}$.ajax({url:ajaxUrl,dataType:"html",success:function(data){injectNewFormFields(data);}});}function setup(){$(ACCOUNT_SELECTOR).change(function(){updateAccountFields(this);});}return{init:function(){$(ACCOUNT_SELECTOR).each(setup);}};})();LBG.balanceTransfer=(function(){var selectorFieldset="fieldset.balanceTransfer",selectorAddButton=".validateBalanceTransfer .actions input:image",selectorFieldRow=".formFieldRow",selectorAccDetails=".accountDetails",selectorAmountInput="input.amount";var classExpiry="expiryDate",classAccount="account";var max=5;function removeNoTransferOption($fieldset){$fieldset.find("select option.hideJS").remove();}function setupAccountDropDown($fieldRows){$fieldRows.each(function(){$(this).find(".formField:first select").change(function(){var $row=$(this).parents(selectorFieldRow);var $inputs=$row.next(selectorAccDetails).find("input:text(not:"+selectorAmountInput+")");var $amount=$row.find(selectorAmountInput);$inputs.val("");if(this.value==="-"){$amount.val("");}LBG.Forms.Validation.Tools.getFieldHandler($amount).hideError();LBG.autoTotal.init();}).blur(function(){LBG.autoTotal.init();});});}function setup(){$(selectorFieldset).each(function(){var $fieldset=$(this);var $fieldRows=$fieldset.find(selectorFieldRow);removeNoTransferOption($fieldset);if($fieldRows.length>=max){$(selectorAddButton,$fieldset).attr("disabled","disabled").css({"opacity":"0.5","cursor":"default"});}setupAccountDropDown($fieldRows);});}return{init:function(){setup();}};})();LBG.enrichedSelects=function(){$("select.enriched").change(function(){var meta=$("option:selected",this).metadata().enriched;if(!meta){return;}$.each(meta,function(target,text){$(target).each(function(){var $this=$(this);if($this.is("input, select")){$this.val(text.substring(0,18));}else{$this.text(text);}});});});if($.browser.mozilla===true){$("select.enriched").trigger("change");}};LBG.businessOverdraft=function(){var target=$(".businessNameToggle"),defaultName=$(target).text();$("select.businessGroup").change(function(){var $busName=$("option:selected",this).parent().attr("label");if(!$busName){$(target).text(defaultName);}else{$(target).text($busName);}});};LBG.statusToggle=(function(){var setFocusOnTab=false;function hideErrors($element,$this){var $formFields=null;var validationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject($this);
if($element.hasClass("formField")){$formFields=$element;}else{$formFields=$element.is("input, select")?$element.parents("div.formField"):$element.find("div.formField");}$formFields.each(function(){var data=LBG.Forms.Validation.Tools.convertClassDetailsToData(this,"validationName:");var field=validationHandler.getChild(data[0]);if(field.hideError){field.hideError();}});}function setDisabled($element,isDisabled,clearDisabled){if(!$element.is("input, select")){$element=$element.find("input, select");}$element.each(function(){var $this=$(this);$this[0].disabled=isDisabled;if(isDisabled){$this.addClass("isDisabled");if(clearDisabled||$this.parents().hasClass("otherTitle")){if(!$(".transferBalances .balanceTransferTo").length){$this.val("");}else{$this.filter("input").val("");}}}else{$this.removeClass("isDisabled").val($(this).defaultText);}if($.browser.safari){$this.css("-webkit-transform","scale(0.9)");setTimeout(function(){$this.css("-webkit-transform","none");},1);}});}function isId(str){return str.substring(1,0)==="#";}function escapeId(id){return id.replace(/:/g,"\\:");}function handleToggle(event){var $this=$(this),meta=($this.is("select"))?$this.find(":selected").metadata():$this.metadata(),$disable,$enable,$hide,$show,$reset,clearDisabled=false;if(meta.disable){$disable=isId(meta.disable)?$(escapeId(meta.disable)):$(meta.disable);}if(meta.enable){$enable=isId(meta.enable)?$(escapeId(meta.enable)):$(meta.enable);}if(meta.hide){$hide=isId(meta.hide)?$(escapeId(meta.hide)):$(meta.hide);}if(meta.show){$show=isId(meta.show)?$(escapeId(meta.show)):$(meta.show);}if(meta.clearDisabled&&typeof clearDisabled==="boolean"){clearDisabled=meta.clearDisabled;}if(meta.reset){$reset=isId(meta.reset)?$(escapeId(meta.reset)):$(meta.reset);}if(meta.toggleShowHide){var elem=isId(meta.toggleShowHide)?$(escapeId(meta.toggleShowHide)):$(meta.toggleShowHide);var show=$this.is(":checked");if(!elem.is(".statusToggleHide")){show=!show;}if(show){$show=elem;}else{$hide=elem;}}if($this.is(":checkbox, :radio")&&!this.checked){var $temp=$disable;$disable=$enable;$enable=$temp;}if($this.is(":checkbox, :radio, select")||($this.is(":text")&&$this.val()!=="")){if($disable){hideErrors($disable,$this);setDisabled($disable,true,clearDisabled);}if($enable){setDisabled($enable,false,clearDisabled);}}if($this.is(":text")&&$this.val()===""){if($disable){setDisabled($disable,false,clearDisabled);}if($enable){hideErrors($enable,$this);setDisabled($enable,true,clearDisabled);}}if($hide){hideErrors($hide,$this);$hide.hide();}if($show){var $showHiddenOnly=$show.not(":visible");if($showHiddenOnly.length){$showHiddenOnly.show();}if($reset){hideErrors($reset,$this);if(event){$reset.find("input:radio,input:checkbox").removeAttr("checked");$reset.find("input:text").val("");$reset.find("select").attr("selectedIndex",0);$reset.find(":input").each(function(){this.ready=false;});}}}if($show&&$show.length){if($show.hasClass("fasterPaymentFree")){$hide.find(":radio").removeAttr("checked");$show.find(":radio").eq(0).attr("checked","checked");}else{if($show.hasClass("fasterPaymentCharged")){$hide.find(":radio").removeAttr("checked");$show.find(":radio").eq(1).attr("checked","checked");}else{if($show.hasClass("paymentASAP")){$hide.find(":radio").removeAttr("checked");$show.find(":radio").eq(0).attr("checked","checked");}}}if($show.parent().find(".ops-calculator")){if($show.hasClass("disabledDiv")){$show.find("input").removeAttr("disabled");$show.removeClass("disabledDiv");if($show.find(":table").hasClass("tblOPSQuote")){$show.find(":table").removeClass("tblOPSQuote");$show.find(":table").find("tbody").addClass("tblOPSQuoteEnabled");}if($show.parent().find(".footnote").hasClass("hide-ops-footnote")){$show.parent().find(".footnote").removeClass("hide-ops-footnote");$show.parent().find(".footnote").addClass("show-ops-footnote");}}if($show.hasClass(".ops-calculator-monthly")){$("input:hidden[name$=opsPanelUsedHiddenInfo]").val(false);}else{if($show.hasClass(".ops-calculator-total")){$("input:hidden[name$=opsPanelUsedHiddenInfo]").val(true);}}}if($show.parent().hasClass(".secondaryauthcommercial")){if($show.parent().find(".option0.statusToggleHide").is(":visible")){if($show.parent().find(".option1.statusToggleHide .submitAction").hasClass("submitAction")){$show.parent().find(".option1.statusToggleHide .primaryAction input").removeClass("submitAction");}if($show.parent().find(".option2.statusToggleHide .submitAction").hasClass("submitAction")){$show.parent().find(".option2.statusToggleHide .primaryAction input").removeClass("submitAction");}if(!$show.parent().find(".option0.statusToggleHide .submitAction").hasClass("submitAction")){$show.parent().find(".option0.statusToggleHide .primaryAction input").addClass("submitAction");}}else{if($show.parent().find(".option1.statusToggleHide").is(":visible")){if($show.parent().find(".option0.statusToggleHide .submitAction").hasClass("submitAction")){$show.parent().find(".option0.statusToggleHide .primaryAction input").removeClass("submitAction");}if($show.parent().find(".option2.statusToggleHide .submitAction").hasClass("submitAction")){$show.parent().find(".option2.statusToggleHide .primaryAction input").removeClass("submitAction");}if(!$show.parent().find(".option1.statusToggleHide .submitAction").hasClass("submitAction")){$show.parent().find(".option1.statusToggleHide .primaryAction input").addClass("submitAction");}}else{if($show.parent().find(".option2.statusToggleHide").is(":visible")){if($show.parent().find(".option0.statusToggleHide .submitAction").hasClass("submitAction")){$show.parent().find(".option0.statusToggleHide .primaryAction input").removeClass("submitAction");}if($show.parent().find(".option1.statusToggleHide .submitAction").hasClass("submitAction")){$show.parent().find(".option1.statusToggleHide .primaryAction input").removeClass("submitAction");}if(!$show.parent().find(".option2.statusToggleHide .submitAction").hasClass("submitAction")){$show.parent().find(".option2.statusToggleHide .primaryAction input").addClass("submitAction");}}}}}if($show.parents("fieldset").hasClass("eiaAuth")){var $eiaAuth=$show.parents("fieldset"),$input0=$(".eiaAuth .option0.statusToggleHide .actions input"),$input1=$(".eiaAuth .option1.statusToggleHide .actions input");if($eiaAuth.find(".option0.statusToggleHide").is(":visible")){if($input1.hasClass("submitAction")){$input1.removeClass("submitAction");}if(!$input0.hasClass("submitAction")){$input0.addClass("submitAction");}}else{if($eiaAuth.find(".option1.statusToggleHide").is(":visible")){if($input0.hasClass("submitAction")){$input0.removeClass("submitAction");}if(!$input1.hasClass("submitAction")){$input1.addClass("submitAction");}}}}}if(($.browser.safari===true||$.browser.mozilla===true)&&setFocusOnTab===true){var $allFields=$(".formField");var $index=$allFields.index($this.parents(".formField"));var $nextFormField=$allFields.eq($index+1);var $focus=$nextFormField.find("input, select").eq(0);var $next=$allFields.eq($allFields.index($focus)+1);if($focus.length){if($focus[0].disabled){$next.find("input, select").eq(0).focus();}else{setTimeout(function(){$focus.focus();hideErrors($next,$this);},5);}}}}function setup(){var $this=$(this);if($this.is(":text")){$this.bind("change keydown keyup",handleToggle).change();}if($this.is("select")){$this.change(handleToggle).change();}else{if($this.is("a")){$this.click(function(e){e.preventDefault();handleToggle.call(this,e);return false;});}else{$this.click(handleToggle);}if(this.checked||$this.is(":checkbox")){handleToggle.call(this);
}}if($.browser.safari===true||$.browser.mozilla===true){$this.keydown(function(event){setFocusOnTab=event.shiftKey===false&&event.keyCode===9;});}}return{init:function($context){if(typeof $context==="undefined"||!$context.length){$context=$("body");}$(".statusToggle",$context).each(setup);}};})();LBG.selectAccount=(function(){var $overlay,$businesses,$form,$formField,$dropDown,$introCopy;var selectorScroller="fieldset.businessAccountList .formField",selectorJumpToList="ul.beneficiariesList",selectorIntroCopy=".beneficiariesListIntro";var dropDownID=DI.lang.selectAccount.dropDown.id,dropDownDefault=DI.lang.selectAccount.dropDown.defaultText,dropDownValidate=DI.lang.selectAccount.formField.validateClass,dropDownValidationName=DI.lang.selectAccount.formField.validationName;function showBusiness(){var selectedIndex=$dropDown.attr("selectedIndex")-1;$introCopy.find(selectorJumpToList).remove();if(selectedIndex>=0){$introCopy.find("p").hide();$businesses.hide().eq(selectedIndex).show().each(function(){$(this).find(selectorJumpToList).clone().appendTo($introCopy).show().find("a:eq(0)").focus();$form.find(selectorScroller).scrollTop(0);});}else{$overlay.find(selectorIntroCopy).find("p").show();$businesses.hide().find("input:checked").removeAttr("checked");}}function build(){$overlay=$("#overlay .businessBulkPayments");$businesses=$overlay.find(".selectBusinessAccount");$form=$overlay.find("form");$introCopy=$overlay.find(selectorIntroCopy);if($businesses.length>0){$formField=$('<div class="formField validate:('+dropDownValidate+") validationName:("+dropDownValidationName+') clearfix"><div class="formFieldInner"></div></div>');$dropDown=$('<select id="'+dropDownID+'" class="selectBusiness"><option value="-">'+dropDownDefault+"</option></select>");$businesses.each(function(i){var index=i+1;var businessName=$(this).find("h3").text();$dropDown.append('<option value="'+index+'">'+businessName+"</option>");});$dropDown.attr("selectedIndex",0).change(showBusiness).appendTo($formField.find(".formFieldInner"));if($businesses.length===1){$dropDown.addClass("isDisabled").attr({selectedIndex:1,disabled:"disabled"}).change().hide();var $businessName=$("<div><p>"+$businesses.eq(0).find("h3").text()+"</p></div>");$businessName.appendTo($formField.find(".formFieldInner"));}$businesses.find("h3").parent(".inner").remove();$formField.prependTo($form);var parentValidationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject($formField);parentValidationHandler.isValid=false;parentValidationHandler.add(new LBG.Forms.Validation.FormField($formField[0]));}}return{init:function(){build();}};})();LBG.scrollable=(function(){var SCROLL_CONTROL=".scroller";function setup(){$(SCROLL_CONTROL).find("a").live("click",function(){var data=$(this).parents(SCROLL_CONTROL).metadata(),$target=$($(this).attr("href").replace(/^.*(#.*)$/,"$1")),$pane=$(data.pane);$pane.scrollTo($target,400,function(){$target.next("ul").find("li:first-child input:radio").focus();});return false;});}return{init:function(){setup();}};})();LBG.setupPasscode=(function(){var selector="div.formField.passCode";var maxLength=4;function getCursorPosition(input){var pos=null;if(document.selection){var range=document.selection.createRange();var rangeLength=range.text.length;range.moveStart("character",-input.value.length);pos=range.text.length-rangeLength;}else{if(input.selectionStart){pos=input.selectionStart;}}return pos;}function setup(){$(selector).each(function(){$(this).find("input:text:first").keyup(function(event){var val=$(this).val();var pos=getCursorPosition(this);var elm=$(this).siblings("input:text");var key=event.keyCode;if(key<37||key>41){if(pos===maxLength&&val.length===maxLength&&this.prevLength>=(maxLength-1)){$(elm).unbind("focus").focus();}else{this.prevLength=val.length;}}});});}return{init:setup};})();LBG.setupTextAlertsDailyFrequency=function(){var defaultValue=DI.lang.textAlertsDailyFrequency.defaultValue,dailyValue=DI.lang.textAlertsDailyFrequency.dailyValue,notApplicableValue=DI.lang.textAlertsDailyFrequency.notApplicableValue,notApplicableSelector="option[value="+notApplicableValue+"]";$("table.textAlertsDailyFrequency select.slctFrequency").each(function(){var select=$(this).parents("tr").find("select.slctReceiveOn");this.notApplicableOption=$(select).find(notApplicableSelector).clone();$(this).bind("change",function(){var slctReceiveOn=$(this).parents("tr").find("select.slctReceiveOn");if(this.value===dailyValue){$(slctReceiveOn).append(this.notApplicableOption).attr("disabled","disabled");try{$(slctReceiveOn).val(notApplicableValue);}catch(e){}LBG.Forms.Validation.Tools.getFieldHandler($(slctReceiveOn).parents(".formField")).hideError();}else{if($(slctReceiveOn).val()===notApplicableValue){$(slctReceiveOn).val(defaultValue);}$(slctReceiveOn).removeAttr("disabled");$(slctReceiveOn).find(notApplicableSelector).remove();}});if($(this).parents("tr").find("input:checkbox").is(":checked")){$(this).change();}});};LBG.toggleFrequencyTerm={selectorDepositTerm:"select.toggleFrequencyTerm",selectorInterestPaidOptions:".interestPaidOptions",selectorFrequencyTerm:"select.slctFrequencyTerm",toggle:function($this){var meta=$this.find(":selected").metadata();var $show=meta.target?$(meta.target):undefined;var validationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject($this);$(LBG.toggleFrequencyTerm.selectorInterestPaidOptions).each(function(){var field=validationHandler.getChild(LBG.Forms.Validation.Tools.convertClassDetailsToData(this,"validationName:")[0]);if(field.hideError){field.hideError();}});var $slctFrequencyTerm=$(LBG.toggleFrequencyTerm.selectorFrequencyTerm);if($show!==undefined){$slctFrequencyTerm.removeAttr("disabled").removeClass("isDisabled");if($.browser.mozilla===false){if($slctFrequencyTerm[0].optionElements===undefined){$slctFrequencyTerm[0].optionElements=$slctFrequencyTerm.html();}$slctFrequencyTerm.html($slctFrequencyTerm[0].optionElements);$show=$(meta.target);}$slctFrequencyTerm.find("option").hide().attr("disabled","disabled");$show.show().attr("disabled","");var selectedIndex=$slctFrequencyTerm.attr("selectedIndex");$slctFrequencyTerm.attr("selectedIndex",selectedIndex).removeAttr("disabled").removeClass("isDisabled").show();if($.browser.mozilla===false){$slctFrequencyTerm.find("option").each(function(){if($(this).css("display")==="none"){$(this).remove();}});}}else{$slctFrequencyTerm.attr("disabled","disabled").addClass("isDisabled");}},init:function(){$(LBG.toggleFrequencyTerm.selectorDepositTerm).change(function(){LBG.toggleFrequencyTerm.toggle($(this));}).change();}};LBG.fraudDetection={screenResolution:"input.screenRes",timeZone:"input.timeZone",init:function(){var screenWidth=window.screen.width;var screenHeight=window.screen.height;var screenResolution=screenWidth+"x"+screenHeight;$(LBG.fraudDetection.screenResolution).attr("value",screenResolution);var visitortime=new Date();var offsettime=-1*visitortime.getTimezoneOffset()/60;var offsethour=parseInt(Math.abs(visitortime.getTimezoneOffset()/60),10);var offsetmin=Math.abs(visitortime.getTimezoneOffset())%60;var formattedtime="";if(offsettime!==0){var offsettimeSymb=(offsettime>0)?"+":"-";var offsethourSymb=(offsethour<10)?"0":"";var offsetminSymb=(offsetmin<10)?"0":"";formattedtime="GMT "+offsettimeSymb+offsethourSymb+offsethour+offsetminSymb+offsetmin;}else{formattedtime="GMT 0000";}if(visitortime){$(LBG.fraudDetection.timeZone).attr("value",formattedtime);}else{$(LBG.fraudDetection.timeZone).attr("value","JavaScript Date() not enabled");
}}};LBG.previousYearMaxDate=(function(dateGroup){var thisYear=parseInt(new Date().getFullYear());var isPrevYear=$("."+dateGroup+" .year option[value="+(thisYear-1)+"]").length==1?true:false;if(isPrevYear){$("."+dateGroup+" .month").change(function(){selectedMonth=$(this).val();selectedYear=parseInt($("."+dateGroup+" .year").val());if(selectedYear==thisYear&&(selectedMonth=="12"||selectedMonth=="11")){$("."+dateGroup+" .year option[value="+(thisYear-1)+"]").attr("selected","selected");}else{if(selectedYear==thisYear-1&&(selectedMonth=="01"||selectedMonth=="02")){$("."+dateGroup+" .year option[value="+thisYear+"]").attr("selected","selected");}}});}});LBG.leapYearDayAdjust=(function(){var selector={dateGroup:".formField.dateRange .inputGroup, .formField .date.inputGroup",inputGroup:".inputGroup",day:"select.day",month:"select.month",year:"select.year"};var defaultValue={month:"-",year:"-"};var $focusedSelect=null;function isLeapYear(year){return((year%4===0)&&(year%100!==0||year%400===0));}function getDaysInMonth(month,year){if(month==="02"&&isLeapYear(year)===true){return 29;}else{var days=31;switch(month){case"01":case"03":case"05":case"07":case"08":case"10":case"12":days=31;break;case"04":case"06":case"09":case"11":days=30;break;case"02":days=28;break;default:break;}return days;}}function setDaysInMonth(inputGroup,trigger){var $slctDay=$(inputGroup).find(selector.day),month=$(inputGroup).find(selector.month).val(),year=$(inputGroup).find(selector.year).val();if(month===defaultValue.month&&year===defaultValue.year){return;}var displayDays=(month!==defaultValue.month&&year!==defaultValue.year)?getDaysInMonth(month,year)+1:inputGroup.optionsElements.length;var optionLength=$slctDay.find("option").length;var selectedIndex=$slctDay.attr("selectedIndex");var i;if($.browser.safari===false){if(optionLength>=displayDays){for(i=optionLength;i>=displayDays;i--){$slctDay.find("option").eq(i).remove();}}else{for(i=optionLength;i<displayDays;i++){$slctDay.append(inputGroup.optionsElements[i]);}}}else{var $newSlctDay=$($("<select></select>").attr({id:$slctDay.attr("id"),name:$slctDay.attr("name"),className:$slctDay.attr("class")}));for(i=0;i<displayDays;i++){$newSlctDay.append(inputGroup.optionsElements[i]);}$slctDay.html($newSlctDay[0].innerHTML);}$slctDay=$(inputGroup).find(selector.day);optionLength=$slctDay.find("option").length-1;if(selectedIndex>optionLength){$slctDay.attr("selectedIndex",optionLength);}else{$slctDay.attr("selectedIndex",selectedIndex);}if($.browser.msie===true&&$focusedSelect!==null){$focusedSelect.focus();}}function setup(){var $dateGroup=$(selector.dateGroup);$dateGroup.each(function(){if(this.optionsElements===undefined){this.optionsElements=$(this).find(selector.day+" option").clone();}$(this).find(selector.month+", "+selector.year).bind("change.leapYearDayAdjust",function(){if($.browser.msie===true){$focusedSelect=$(this);}setDaysInMonth($(this).parents(selector.inputGroup)[0],this);});$(this).find(selector.day).bind("focus.leapYearDayAdjust",function(){$focusedSelect=null;setDaysInMonth($(this).parents(selector.inputGroup)[0],this);});if($.browser.msie===true){$(this).find(selector.day).bind("change.leapYearDayAdjust",function(){$(this).focus();});}});}return{init:function(){setup();}};})();LBG.successFadeOutDelay=(function(){return{init:function(color,delay){color=(!color)?"#FFFFCC":color;delay=(!delay)?10000:delay;$(".successInfoMessage h2.success").each(function(){var successInfoMessage=$(this).parents(".successInfoMessage").css("background-color",color);setTimeout(function(){$(successInfoMessage).css("background-color","transparent");LBG.common.effects.highlightElement(successInfoMessage,color);},delay);});}};})();LBG.warningFadeOutDelay=(function(){return{init:function(color,delay){color=(!color)?"#FFFFCC":color;delay=(!delay)?10000:delay;$(".warningInfoMessage h2.warning").each(function(){var warningInfoMessage=$(this).parents(".warningInfoMessage").css("background-color",color);setTimeout(function(){$(warningInfoMessage).css("background-color","transparent");LBG.common.effects.highlightElement(warningInfoMessage,color);},delay);});}};})();LBG.setFocus={focusFieldSelector:".setFocus",init:function(){$(LBG.setFocus.focusFieldSelector).each(function(){$(LBG.setFocus.focusFieldSelector).focus();});}};LBG.rememberMe=(function(){var selector="form.rememberUserID";var parameters=DI.cookieRememberUserID;return{init:function(){$(selector).each(function(){var $checkbox=$(this).find("input:checkbox");if($checkbox.length>0){var cookie=$.cookie(parameters.name);var $username=$(this).find("input:text");if(cookie!==null){$checkbox.attr("checked","checked");$username.val(cookie);}$(this).bind("submit",function(){if($checkbox.is(":checked")){$.cookie(parameters.name,$username.val(),{expires:parameters.expires,path:parameters.path,domain:parameters.domain,secure:parameters.secure});}else{$.cookie(parameters.name,null);}});}});}};})();LBG.toggleBankRouting={selectorCountry:"select.toggleBankRouting",selectorRouting:".bankInfoSelector",selectorRoutingType:"select.bankRoutingType",toggle:function($this){var meta=$this.find(":selected").metadata();var $show=meta.target?$(meta.target):undefined;var validationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject($this);$(LBG.toggleBankRouting.selectorRouting).each(function(){var field=validationHandler.getChild(LBG.Forms.Validation.Tools.convertClassDetailsToData(this,"validationName:")[0]);if(field.hideError){field.hideError();}});$("input:text.bankRoutingType").remove();if($show!==undefined){$(LBG.toggleBankRouting.selectorRouting).show();var $slctRoutingType=$(LBG.toggleBankRouting.selectorRoutingType);if($.browser.mozilla===false){if($slctRoutingType[0].optionElements===undefined){$slctRoutingType[0].optionElements=$slctRoutingType.html();}$slctRoutingType.html($slctRoutingType[0].optionElements);$show=$(meta.target);}$slctRoutingType.find("option").hide();$show.show();if($show.length>1){$slctRoutingType.attr("selectedIndex",0).removeAttr("disabled").show();}else{var $option=$slctRoutingType.find("option[value="+$show.val()+"]");$slctRoutingType.attr({"selectedIndex":$slctRoutingType.find("option").index($option)}).hide();$("<input />").attr({"type":"text","readonly":"readonly","class":$($slctRoutingType).attr("class"),"name":$($slctRoutingType).attr("name")+"_readonly","id":$($slctRoutingType).attr("id")+"_readonly","value":$option.text()}).insertAfter($slctRoutingType);}if($.browser.mozilla===false){$slctRoutingType.find("option").each(function(){if($(this).css("display")==="none"){$(this).remove();}});}}else{$(LBG.toggleBankRouting.selectorRouting).hide();}},init:function(){$(LBG.toggleBankRouting.selectorCountry).change(function(){LBG.toggleBankRouting.toggle($(this));}).change();}};LBG.contentScrollerTabIndex=function(){$(".legals, .scrollable").attr("tabIndex",0);};LBG.iOS={scrollGestureMessage:function(element){if(LBG.browserIdent.browserIdent==="iPad"||LBG.browserIdent.browserIdent==="iPhone"){var message='<div class="infoMessage alert scrollGesture clearfix"><div class="infoMessageInner clearfix"><p>'+DI.lang.iOS.scrollGestureMessage+"</p></div></div>";if(element&&element.scrollHeight>$(element).innerHeight()){$(element).addClass("scrollGesture");$(message).insertBefore(element);}}}};LBG.timedLogout={duration:0,interval:null,selectorContainer:".logoutTimer",selectorMessage:".logoutTimer .timer",selectorButtons:".logoutButton",selectorLogoutLink:".movingOn a",selectorDuration:".logoutTimerDurationMS",enabledClassName:"jsTimedLogout",messageHtml:"",buttonUrl:"",buttonAlt:"",init:function(){if($(LBG.timedLogout.selectorContainer).length===1){LBG.timedLogout.duration=$(LBG.timedLogout.selectorDuration).val();
LBG.timedLogout.messageHtml=DI.lang.timedLogout.logoutMsg;LBG.timedLogout.buttonUrl=DI.lang.timedLogout.logoutButton;LBG.timedLogout.buttonAlt=DI.lang.timedLogout.logoutAlt;$(LBG.timedLogout.selectorContainer).addClass(LBG.timedLogout.enabledClassName);$(LBG.timedLogout.selectorButtons).attr({"src":LBG.timedLogout.buttonUrl,"alt":LBG.timedLogout.buttonAlt});var timerImg=new Image();$(LBG.timedLogout.selectorMessage).before($(timerImg).addClass("clock").attr("alt",DI.timedLogout.timerImgAlt).attr("src",DI.timedLogout.timerImg));LBG.timedLogout.refreshMessage();LBG.timedLogout.start();}},start:function(){LBG.timedLogout.timer=window.setInterval(LBG.timedLogout.countdown,1000);},stop:function(){window.clearInterval(LBG.timedLogout.timer);},refreshMessage:function(){var message=LBG.timedLogout.messageHtml+" <strong>"+LBG.timedLogout.formatMs(LBG.timedLogout.duration)+"</strong>";$(LBG.timedLogout.selectorMessage).html(message);},formatMs:function(ms){var formattedTime=parseInt(ms%60000/1000,10)+" seconds.";if(ms/60000>=1){formattedTime=parseInt(Math.floor(ms/60000),10)+" minutes and "+formattedTime;}return formattedTime;},logout:function(){window.location.href=$(LBG.timedLogout.selectorLogoutLink).attr("href");},countdown:function(){LBG.timedLogout.duration=LBG.timedLogout.duration-1000;if(LBG.timedLogout.duration>=0){LBG.timedLogout.refreshMessage();}else{LBG.timedLogout.stop();LBG.timedLogout.logout();}}};LBG.clickActionLinkOnce={init:function(){$('a[href*="&al="]:not(.removeSplit a, a.newwin, a.newhelpwin, a.newfaqwin, a.overlay, a.printwin, a.statementLink, a.pdfLink, a.tabBrowse, a.tabSearch, a.oabAddToCalLink), a[href*="link"]:not(.swipey-launch, [data-wt-ac])').bind("click",function(){$(this).unbind().bind("click",function(){return false;});});}};LBG.expandSelect={selector:".expandSelect select, select.expandSelect, .navBar select",current:null,cloneCSS:{position:"absolute",top:"-100px",left:"-10000px",width:"auto",maxWidth:"none",visibility:"hidden"},defaultCSS:{width:"auto",maxWidth:"none","z-index":2,position:"relative"},resetWidth:function(element){$(element).css("width",$(element).data("origWidth"));},doMouseover:function(event){var target=event.target;if(LBG.expandSelect.current!==null&&LBG.expandSelect.current!==event.target){LBG.expandSelect.resetWidth(LBG.expandSelect.current);}var cloneSelect=$(target).clone().css(LBG.expandSelect.cloneCSS).insertAfter(target);var cloneWidth=cloneSelect[0].offsetWidth;if(cloneWidth===0){cloneWidth=cloneSelect.width();}cloneSelect.remove();if(cloneWidth>=$(target).data("origWidth")){$(target).css(LBG.expandSelect.defaultCSS);}LBG.expandSelect.current=target;},doMouseout:function(event){LBG.expandSelect.resetWidth(event.target);},doFocus:function(event){$(event.target).unbind("mouseout").bind("blur",function(){LBG.expandSelect.resetWidth(this);$(this).bind("mouseout",LBG.expandSelect.doMouseout);});},init:function(){if($.browser.msie&&$.browser.version<9){$(LBG.expandSelect.selector).each(function(){$(this).data("origWidth",this.offsetWidth);}).bind("mouseover",LBG.expandSelect.doMouseover).bind("mouseout",LBG.expandSelect.doMouseout).bind("focus",LBG.expandSelect.doFocus);}}};LBG.equalisePanelHeights={isResizing:false,panels:[],resetPanels:function(){$(LBG.equalisePanelHeights.panels).css("height","auto");},equaliseHeights:function(){LBG.equalisePanelHeights.panels=[];function doEqualise(selWrapper,selPanel){var curHeight=0;var maxHeight=0;$(selWrapper).each(function(){$(this).find(selPanel).each(function(){curHeight=$(this).height();if(curHeight>maxHeight){maxHeight=curHeight;}LBG.equalisePanelHeights.panels.push(this);}).height(maxHeight);});}function doEqualiseParent(selWrapper,selPanel){var curHeight=0;var maxHeight=0;$(selWrapper).each(function(){$(this).find(selPanel).each(function(){curHeight=$(this).parent($(selWrapper)).height();if(curHeight>maxHeight){maxHeight=curHeight;}LBG.equalisePanelHeights.panels.push(this);}).height(maxHeight);});}doEqualise(".equalPanelHeights",".subPanel");doEqualise(".yourOffersMultiBox ul.offerList","> li");doEqualise(".yourOffersSingleBox ul.offerList","> li");doEqualise("div.optionPanel","div.subPanel");doEqualise("div.summaryPanels div.colLayout","div.subPanel");doEqualiseParent("div.summaryPanels","div.subPanel");if($.browser.msie){LBG.equalisePanelHeights.isResizing=false;}},init:function(doResetHeights){if(doResetHeights){LBG.equalisePanelHeights.resetPanels();}LBG.equalisePanelHeights.equaliseHeights();if(!$.browser.msie||$.browser.msie&&$.browser.version>=7){$(window).resize(function(){if($.browser.msie&&!LBG.equalisePanelHeights.isResizing||!$.browser.msie){if($.browser.msie){LBG.equalisePanelHeights.isResizing=true;}LBG.equalisePanelHeights.resetPanels();LBG.equalisePanelHeights.equaliseHeights();}});}}};LBG.investmentsExpandingTable={selectorTable:"table.expandingTable, table.table-expanding-row",selectorTrigger:"tr.trigger, more-info a",selectorDetail:"tr.detail",selectorReveal:"div.reveal",expand:function($trigger){var $detail=$trigger.next(this.selectorDetail),$reveal=$detail.find(this.selectorReveal);if($.browser.msie&&$.browser.version<7){$("tr.trigger, more-info").removeClass("expanded");$(this.selectorDetail).each(function(e){$(this)[0].style.display="none";});$detail[0].style.display="block";$reveal[0].style.display="block";$trigger.addClass("expanded");}else{if($trigger.data("isRevealSingle")){$trigger.parents(this.selectorTable).find("tbody tr.expanded").each(function(){LBG.investmentsExpandingTable.collapse($(this));});}$trigger.addClass("expanded");$detail.show().trigger("expand");$reveal.slideDown();}$trigger.addClass("expanded");$detail.show();$reveal.slideDown();$trigger.trigger("row_expanded");},collapse:function($trigger){var $detail=$trigger.next(this.selectorDetail),$reveal=$detail.find(this.selectorReveal);if($.browser.msie&&$.browser.version<7){$reveal[0].style.display="none";$detail[0].style.display="none";$trigger.removeClass("expanded");}else{$reveal.slideUp(function(){$detail.hide().trigger("collapse");$trigger.removeClass("expanded");});}$trigger.trigger("row_collapsed");},triggerText:function(trigger){$(trigger).find(".more-info a").toggleClass("hide");},init:function(){$(this.selectorTable).each(function(){var $table=$(this),$triggers=$table.find("tr.trigger",".more-info a");$triggers.data("isRevealSingle",$table.hasClass("revealSingle"));$triggers.click(function(e){if(e.target.tagName.toLowerCase()=="tr"||e.target.tagName.toLowerCase()=="th"||e.target.tagName.toLowerCase()=="td"||e.target.tagName.toLowerCase()=="input"||e.target.tagName.toLowerCase()=="a"){if(e.target.className=="more-info","more-info a"){if($(this).hasClass("expanded")){LBG.investmentsExpandingTable.collapse($(this));LBG.investmentsExpandingTable.triggerText(this);return false;}else{LBG.investmentsExpandingTable.expand($(this));LBG.investmentsExpandingTable.triggerText(this);return false;}}}else{if($(this).hasClass("expanded")){LBG.investmentsExpandingTable.collapse($(this));}else{LBG.investmentsExpandingTable.expand($(this));}}});$triggers.filter("tr").find(".first").attr("tabIndex","0").keyup(function(event){if(event.keyCode===13){$(this).parent("tr").click();}});});$(this.selectorDetail).each(function(e){if($(this).find(".error").length>0){LBG.investmentsExpandingTable.expand($(this).prev());}});if($.browser.msie&&$.browser.version<7){$("select").change(function(e){$(this).parents("table").find("div.reveal").each(function(){if(this.style.display){this.style.display="none";
this.style.display="block";e.target.blur();}});});}}};LBG.expandingTableByLink={expand:function($trigger){var $detail=$trigger.next(this.options.selectorDetail),$reveal=$detail.find(this.options.selectorReveal);if($trigger.data("isRevealSingle")){$trigger.parents(this.options.selectorTable).find("tbody tr.expanded").each(function(){LBG.expandingTableByLink.collapse($(this));});}$trigger.addClass("expanded");$detail.show();$reveal.slideDown();},collapse:function($trigger){var $detail=$trigger.next(this.options.selectorDetail),$reveal=$detail.find(this.options.selectorReveal);$reveal.slideUp(function(){$detail.hide();$trigger.removeClass("expanded");});},triggerText:function(trigger){$(trigger).find(this.options.selectorText).toggleClass("hide");},init:function(options){this.options=$.extend({},this.options,options);var triggerTr=this.options.triggerExpand,triggerBtn=this.options.selectorTrigger;$(this.options.selectorTable).each(function(){var $table=$(this),$triggers=$table.find(triggerBtn);$triggers.click(function(e){if($(this).closest(triggerTr).hasClass("expanded")){LBG.expandingTableByLink.collapse($(this).closest(triggerTr));LBG.expandingTableByLink.triggerText($(this).closest(triggerTr));return false;}else{LBG.expandingTableByLink.expand($(this).closest(triggerTr));LBG.expandingTableByLink.triggerText($(this).closest(triggerTr));return false;}});});},options:{selectorTable:"table.table-expanding-row-link",selectorTrigger:".more-info",selectorText:"a.more, a.less",triggerExpand:"tr.trigger",selectorDetail:"tr.detail",selectorReveal:"div.reveal"}};LBG.loanExpandingTable={init:function(){var $loansTable=$(".loanSelectionTable"),$revealRow=$loansTable.find("tr.detail"),$triggerRow=$loansTable.find("tr.trigger");var updateTriggerTitle=function($trigger){$trigger.each(function(){this.title=$(this).text()+": "+LBG.showHide.triggerTitle;});};$revealRow.hide();$triggerRow.addClass("collapsed").hover(function(){$(this).addClass("hover");},function(){$(this).removeClass("hover");});$triggerRow.find("a.loanSelectionOptions").click(function(e){e.preventDefault();});$triggerRow.click(function(){var $trigger=$(this),meta=$(this).find("a.trigger").metadata().label;var getRevealGroup=function($row){var $group=$([]);$row.nextAll().each(function(){if(!$(this).hasClass("detail")){return false;}$group=$group.add($(this));});return $group;};var expand=function($row){$row.removeClass("collapsed").addClass("expanded");if(typeof meta.open==="string"){$row.find("p").text(meta.open);}getRevealGroup($row).show();updateTriggerTitle($row.find("a.trigger"));};var collapse=function($row){$row.removeClass("expanded").addClass("collapsed");if(typeof meta.closed==="string"){$row.find("p").text(meta.closed);}getRevealGroup($row).hide();updateTriggerTitle($row.find("a.trigger"));};$triggerRow.not($trigger).each(function(){collapse($(this));});if($trigger.hasClass("collapsed")){expand($trigger);}else{collapse($trigger);}});updateTriggerTitle($triggerRow.find("a.trigger"));}};LBG.accountStatementTableExpandPolicy={init:function(){var $loansTable=$(".accountStatementTableExpandPolicy"),$revealRow=$loansTable.find("tr.detail"),$triggerRow=$loansTable.find("tr.trigger");$revealRow.hide();$triggerRow.addClass("collapsed");$triggerRow.find("a.loanSelectionOptions").click(function(e){e.preventDefault();});$triggerRow.click(function(){var $trigger=$(this);var getRevealGroup=function($row){var $group=$([]);$row.nextAll().each(function(){if(!$(this).hasClass("detail")){return false;}$group=$group.add($(this));});return $group;};var expand=function($row){$row.removeClass("collapsed").addClass("expanded");getRevealGroup($row).show();};var collapse=function($row){$row.removeClass("expanded").addClass("collapsed");getRevealGroup($row).hide();};$triggerRow.not($trigger).each(function(){collapse($(this));});if($trigger.hasClass("collapsed")){expand($trigger);}else{collapse($trigger);}$triggerRow.removeClass("expanded_alt");if($(this).hasClass("alt")){if($(this).hasClass("expanded")){$(this).addClass("expanded_alt");}}});}};LBG.olympicCountdown={animationInterval:5000,animationDuration:300,countdown:null,panels:null,css3DEnabled:function(){if(this._css3D===undefined){var perspective=this.countdown.css("Perspective")||this.countdown.css("WebkitPerspective");this._css3D=!(perspective===undefined||perspective===null||perspective===""||perspective==="none");}return this._css3D;},squeeze:function(){var self=this;$(this.panels[0]).animate({marginLeft:"50%",width:0},{duration:self.animationDuration,complete:function(){self.panels.reverse();self.expand();}});},expand:function(){var self=this;$(this.panels[0]).animate({marginLeft:0,width:"100%"},{duration:this.animationDuration});},init:function(countdown){var self=this;this.countdown=$(countdown);this.panels=this.countdown.find("div").get();try{document.execCommand("BackgroundImageCache",false,true);}catch(e){}window.setInterval(function(){if(self.css3DEnabled()){self.countdown.toggleClass("flip");}else{self.squeeze();}},self.animationInterval);}};LBG.iOS={scrollGestureMessage:function(element){if(LBG.browserIdent.browserIdent==="iPad"||LBG.browserIdent.browserIdent==="iPhone"){var message='<div class="infoMessage alert scrollGesture clearfix"><div class="infoMessageInner clearfix"><p>'+DI.lang.iOS.scrollGestureMessage+"</p></div></div>";if(element&&element.scrollHeight>$(element).innerHeight()){$(element).addClass("scrollGesture");$(message).insertBefore(element);}}}};LBG.ticker={isResizing:false,messages:[],total:0,defaultState:"play",currentState:"play",currIndex:0,nextIndex:0,prevIndex:0,interval:null,intervalDelay:40,increment:2,timer:null,timerDelay:2000,indent:15,playBtn:null,prevBtn:null,nextBtn:null,pauseBtn:null,init:function(){LBG.ticker.messages=$(".content .ticker li");if(!LBG.ticker.messages.length){return;}LBG.ticker.total=LBG.ticker.messages.length;LBG.ticker.defaultState=($(".content .ticker").hasClass("play")?"play":"pause");LBG.ticker.currentState=LBG.ticker.defaultState;LBG.ticker.currIndex=0;LBG.ticker.nextIndex=LBG.ticker.currIndex+1;LBG.ticker.prevIndex=LBG.ticker.total-1;LBG.ticker.messages.each(function(){LBG.ticker.startPosition($(this));});LBG.ticker.attachFadeEnds();LBG.ticker.attachButtons();LBG.ticker.bindResize();if(LBG.ticker.total<=1){$(".content .ticker").addClass("single");}LBG.ticker.setDefaultState();$(".content .ticker ul").hover(function(){LBG.ticker.pause();},function(){if(LBG.ticker.currentState==="play"){LBG.ticker.start();}});},setDefaultState:function(){if(LBG.ticker.defaultState==="play"){LBG.ticker.start();}else{var curr=LBG.ticker.messages.eq(LBG.ticker.currIndex);var next=LBG.ticker.messages.eq(LBG.ticker.nextIndex);if(LBG.ticker.messages.length>1){next.css("left",LBG.ticker.indent).show();LBG.ticker.startPosition(curr);LBG.ticker.updateIndex(false);}else{LBG.ticker.messages.css("left",LBG.ticker.indent);$(".prev, .next").hide();}LBG.ticker.pause();}},bindResize:function(){if(!$.browser.msie||$.browser.msie&&$.browser.version>=7){$(window).resize(function(){if(!$.browser.msie||$.browser.msie&&!LBG.equalisePanelHeights.isResizing){if($.browser.msie){LBG.ticker.isResizing=true;}var scrollerWidth=$(".content .ticker .scrollContainer").width();LBG.ticker.messages.each(function(i){var curr=$(this);var left=parseInt(curr.css("left"),10);if(left>scrollerWidth||!curr.data("isScrolling")){LBG.ticker.startPosition(curr);}});}});}},startPosition:function(elm){elm.css("left",$(".content .ticker .scrollContainer").width()).show();
},updateIndex:function(isDecrement){LBG.ticker.currIndex=isDecrement?LBG.ticker.currIndex-1:LBG.ticker.currIndex+1;if(LBG.ticker.currIndex>=LBG.ticker.total){LBG.ticker.currIndex=0;}if(LBG.ticker.currIndex<0){LBG.ticker.currIndex=LBG.ticker.total-1;}LBG.ticker.nextIndex=LBG.ticker.currIndex+1;if(LBG.ticker.nextIndex===LBG.ticker.total){LBG.ticker.nextIndex=0;}LBG.ticker.prevIndex=LBG.ticker.currIndex-1;if(LBG.ticker.prevIndex<0){LBG.ticker.prevIndex=LBG.ticker.total-1;}},attachFadeEnds:function(){if(!$.browser.msie||$.browser.msie&&$.browser.version>=7){var fadeL=$("<div />").addClass("fadeEdge fadeLeft");var fadeR=$("<div />").addClass("fadeEdge fadeRight");fadeL.add(fadeR).appendTo($(".content .ticker .scrollContainer"));LBG.ticker.indent=fadeL.width()-10;}},attachButtons:function(){var buttonHolder=$('<span class="buttons" />');LBG.ticker.playBtn=$("<img/>").attr("src",DI.ticker.playButtonURL).addClass("play").appendTo(buttonHolder);LBG.ticker.pauseBtn=$("<img/>").attr("src",DI.ticker.pauseButtonURL).addClass("pause").appendTo(buttonHolder);if(LBG.ticker.total>1){LBG.ticker.prevBtn=$("<img/>").attr("src",DI.ticker.previousButtonURL).addClass("prev").appendTo(buttonHolder);LBG.ticker.nextBtn=$("<img/>").attr("src",DI.ticker.nextButtonURL).addClass("next").appendTo(buttonHolder);}buttonHolder.unbind().bind("click",function(e){var targetElement=$(e.originalTarget||e.srcElement);if(targetElement&&targetElement.hasClass("play")){LBG.ticker.start();LBG.ticker.updateCurrentState("play");}if(targetElement&&targetElement.hasClass("pause")){LBG.ticker.pause();LBG.ticker.updateCurrentState("pause");}if(targetElement&&targetElement.hasClass("next")){LBG.ticker.pause();LBG.ticker.skip();}if(targetElement&&targetElement.hasClass("prev")){LBG.ticker.pause();LBG.ticker.skip(true);}});$(".content .ticker").append(buttonHolder);},updateCurrentState:function(state){LBG.ticker.updateDefaultState(state);LBG.ticker.currentState=state;if(state==="play"){$(".content .ticker").removeClass("pause").addClass("play");}else{$(".content .ticker").removeClass("play").addClass("pause");}},updateDefaultState:function(state){var actionURL=(state==="play")?DI.ticker.setDefaultActionPlayURL:DI.ticker.setDefaultActionPauseURL;$.ajax({url:actionURL,type:"GET",dataType:"html"});},start:function(){if(LBG.ticker.timer){LBG.ticker.clearTimer();}LBG.ticker.interval=window.setInterval(LBG.ticker.scroll,LBG.ticker.intervalDelay);$(".content .ticker .play").css("display","none");$(".content .ticker .pause").css("display","inline");},pause:function(){window.clearInterval(LBG.ticker.interval);LBG.ticker.interval=null;$(".content .ticker .play").css("display","inline");$(".content .ticker .pause").css("display","none");},clearTimer:function(){window.clearTimeout(LBG.ticker.timer);LBG.ticker.timer=null;},skip:function(isPrevious){LBG.ticker.pause();if(LBG.ticker.timer){LBG.ticker.clearTimer();}if(LBG.ticker.messages.is(":animated")){return false;}var curr=LBG.ticker.messages.eq(LBG.ticker.currIndex);var next=isPrevious?LBG.ticker.messages.eq(LBG.ticker.prevIndex):LBG.ticker.messages.eq(LBG.ticker.nextIndex);curr.fadeOut("fast",function(){next.css("left",LBG.ticker.indent).fadeIn("fast",function(){if(LBG.ticker.currentState==="play"){LBG.ticker.timer=window.setTimeout(function(){LBG.ticker.start();LBG.ticker.clearTimer();},LBG.ticker.timerDelay);}LBG.ticker.startPosition(curr);LBG.ticker.updateIndex(isPrevious);});});},scroll:function(){var curr=LBG.ticker.messages.eq(LBG.ticker.currIndex).data("isScrolling",true);var left=parseInt(curr.css("left"),10);if(left+curr.width()<0){curr.data("isScrolling",false).css("left",$(".content .ticker .scrollContainer").width());LBG.ticker.updateIndex();}else{curr.css("left",left-LBG.ticker.increment);}}};LBG.investmentsFund={selectorOptions:".investmentsFundOptions",selectorTable:".investmentsFundTable",errorHTML:'<div class="investmentsFundTable inner clearfix"><p>'+DI.lang.investmentsFund.ajaxErrorText+"</p></div>",selectedValue:null,init:function(){$(LBG.investmentsFund.selectorOptions).find(":radio").click(function(){if(LBG.investmentsFund.selectedValue===this.value){return;}var meta=$(this).metadata();if(meta&&meta.ajaxURI){$.ajax({url:LBG.common.ajax.tagUrl(meta.ajaxURI),success:function(response){$(LBG.investmentsFund.selectorTable).remove();$(response).insertAfter(LBG.investmentsFund.selectorOptions);LBG.investmentsFund.selectedValue=this.value;LBG.ajax.pageUpdated();},error:function(){$(LBG.investmentsFund.selectorTable).remove();$(LBG.investmentsFund.errorHTML).insertAfter(LBG.investmentsFund.selectorOptions);LBG.investmentsFund.selectedValue=null;}});}});$(LBG.investmentsFund.selectorOptions).find(":radio:checked").change();}};LBG.ajaxFormContentLoader={selectorOptions:".ajaxFormContent",selectorContent:".ajaxResult",errorHTML:'<div class="ajaxResult inner clearfix"><p>'+DI.lang.ajaxFormContent.ajaxErrorText+"</p></div>",init:function(){$(LBG.ajaxFormContentLoader.selectorOptions).find("input").click(function(){var $fieldset=$(this).parents("fieldset");var formValidationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject($fieldset);if(LBG.ajaxFormContentLoader.selectedValue===this.value){return;}var meta=$(this).metadata();var imgSrcStore;var $spinner=$fieldset.find(".spinner");$spinner.attr("style","display: block");if(meta&&meta.ajaxURI){$.ajax({url:LBG.common.ajax.tagUrl(meta.ajaxURI),success:function(response){formValidationHandler.removeChildren($fieldset);$fieldset.find(LBG.ajaxFormContentLoader.selectorContent).remove();$(response).insertAfter($fieldset.find(LBG.ajaxFormContentLoader.selectorOptions));var submitButton=$fieldset.find("submitAction").context;submitButton.disabled=true;imgSrcStore=submitButton.src;var disabledImageSrc=submitButton.className.split("disabledSrc:")[1];if(disabledImageSrc.length>0){submitButton.src=disabledImageSrc;}LBG.ajaxFormContentLoader.selectedValue=this.value;formValidationHandler.findChildren($fieldset);LBG.ajax.pageUpdated();},error:function(){var submitButton=$fieldset.find("submitAction").context;submitButton.disabled=false;submitButton.src=imgSrcStore;$(LBG.ajaxFormContentLoader.selectorContent).remove();$(LBG.ajaxFormContentLoader.errorHTML).insertAfter(LBG.ajaxFormContentLoader.selectorOptions);LBG.ajaxFormContentLoader.selectedValue=null;}});}$spinner.attr("style","display: none");});}};LBG.dbtSetupModules={init:function(){$(".dbtSetupConfirmation input").css("display","none");$(".setupRadioCheckedNoJS").attr("checked",false);$(".dbtSetupConfirmation").attr("style","display:none");$(".dbtSetup").each(function(){var $setupModuleRadios=$(this).find("input.setupRadio");var $setupModuleConfirmBox=$(this).find(".dbtSetupConfirmation");$setupModuleRadios.each(function(){if($(this).is(":checked")){if($(this).val()===DI.lang.validation.yesValue){$setupModuleConfirmBox.show("slow",function(){});$setupModuleConfirmBox.find("input").css("display","block");}}});});LBG.dbtSetupModules.check_valid_modules();$(".dbtSetup .yesplease").click(function(e){e.preventDefault();var $toggleWrapper=$(this).parents(".dbtSetup");var $toggleContent=$toggleWrapper.find(".dbtSetupConfirmation");$(this).attr("src","../assets/theme/lang/images/buttons/yes_please_disabled.png");$toggleContent.show("slow",function(){});$toggleContent.find("input").css("display","block");});$(".dbtSetup a.cancel").click(function(e){e.preventDefault();var $toggleWrapper=$(this).parents(".dbtSetup");var $toggleContent=$toggleWrapper.find(".dbtSetupConfirmation");
var $yespleaseButton=$toggleWrapper.find(".yesplease");$yespleaseButton.attr("src","../assets/theme/lang/images/buttons/yes_please.png");$toggleContent.hide("slow",function(){});$toggleContent.find("input").css("display","none");});$(".dbtSetup input.setupRadio").click(function(){var selected_radio=$(this).val();var $toggleWrapper=$(this).parents(".dbtSetup");var $toggleContent=$toggleWrapper.find(".dbtSetupConfirmation");if(selected_radio===DI.lang.validation.yesValue){$toggleContent.show("slow",function(){});$toggleContent.find("input").css("display","block");}if(selected_radio==="no"){$toggleContent.hide("slow",function(){});$toggleContent.find("input").css("display","none");}LBG.dbtSetupModules.check_valid_modules();});if(!$(".dbtSetup").hasClass("dbtSetupComm")){$(".dbtSetup input.confirmButton").click(function(e){var $wrapper=$(this).parents(".dbtSetup");var $disableRadios=$wrapper.find("input.setupRadio");$("form").submit(function(e){$disableRadios.attr("disabled","disabled");});});}$(".dbtSetupComm .primaryAction input").click(function(){var selected_radio=$(".dbtSetupComm input.setupRadio:checked").val();if(selected_radio==="no"){$(".dbtSetupComm input.mobileNumberMatch").val("");}});},check_valid_modules:function(){$("ul.dbtSetup .submitAction").attr("src",DI.themePath+"en-gb/images/buttons/continue.png");$("ul.dbtSetup .submitAction").removeAttr("disabled");if($(".dbtSetup .controls .radioGroup").length>0){var valid=true;$(".dbtSetup .controls .radioGroup").each(function(){var no_checks=true;var $theseRadios=$(this).find("input.setupRadio");$theseRadios.each(function(){if($(this).is(":checked")){no_checks=false;if($(this).val()!=="no"){valid=false;}}});if(no_checks===true){valid=false;}});if(valid===false){$("ul.dbtSetup .submitAction").attr("src",DI.themePath+"en-gb/images/buttons/continue_disabled.png");$("ul.dbtSetup .submitAction").attr("disabled","disabled");}else{$("ul.dbtSetup .submitAction").attr("src",DI.themePath+"en-gb/images/buttons/continue.png");$("ul.dbtSetup .submitAction").removeAttr("disabled");}}}};LBG.jumpList={init:function(){var $list=$("ul.jumpList"),$table=$("table.jumpListData"),$links=$list.find("a"),$headings=$table.find("thead th"),curIndex=null;if(!$links.length){return;}$headings.each(function(){if($(this).metadata().sorter!==false){$(this).click(function(){curIndex=$headings.index(this);});}});$links.click(function(event){var id=$(this)[0].hash,meta=$table.metadata(),$sort=null;if($table.hasClass("sortable")){if(typeof meta.targetColumn==="number"&&$headings.eq(meta.targetColumn).metadata().sorter!==false){$sort=$headings.eq(meta.targetColumn);}else{$sort=$headings.eq(0);}if($headings.index($sort)!==curIndex){if($sort[0].count%2!==0){$sort[0].count++;}$sort.click();}}if(id&&id!==""){setTimeout(function(){$($.browser.safari?"body":"html").animate({scrollTop:$(id).offset().top},"slow");},100);}event.preventDefault();});}};LBG.tabs={selectorTabs:"ul.js-tabs",selectorCurr:"current",setCurrent:function(elm){var $curr=$(elm).parents("li"),$tabs=$curr.parents(this.selectorTabs).find("li").not($curr);if($curr.hasClass()){return;}$tabs.removeClass(this.selectorCurr).find("a").each(function(){$(this.hash).hide();});$curr.addClass(this.selectorCurr).find("a").each(function(){$(this.hash).show();});},init:function(){$(this.selectorTabs).each(function(){var $links=$(this).find("a"),meta=$(this).metadata(),index=0,i=0,isMPA=false;if(meta&&meta.showTab&&meta.showTab>0&&meta.showTab<=$links.length){index=meta.showTab-1;}$links.click(function(event){LBG.tabs.setCurrent(this);event.preventDefault();});LBG.tabs.setCurrent($links[index]);$links.each(function(){var bg=$(this).metadata(),img=$("<img />"),imgWidth,tabWidth,tabPadding;if(bg.bgURI&&bg.bgURI.length>0){isMPA=true;img.hide();img.bind("load",function(){imgWidth=$(this).width();tabWidth=120-imgWidth;tabPadding=12+imgWidth;$(this).closest("a").css({"background-image":'url("'+bg.bgURI+'")',"background-position":"7px 9px","width":tabWidth+"px","max-width":tabWidth+"px","padding-left":tabPadding+"px"});});$(this).append(img);img.attr("src",bg.bgURI);}});if(isMPA){$("#overlay").css("width","auto");}});}};LBG.calculateFundAllocations=function(){if($("table.fundAllocationDetails").length){$(".amount_percent_total").autoTotal(".amount_percent");}};LBG.lineWrap={init:function(){var $heading=$(".tile h2 span, .tile h3 span, .banner h2 span, .banner h3 span, .bigBanner h2 span, .bigBanner h3 span, .bigPrompt h2 span, .bigPrompt h3 span, .IBMediumPanel h3 span");$heading.each(function(){var $headingParent=$(this).parent(),headingText=$(this).text(),headingWidth=$headingParent.width();$headingParent.append("<span style=>T</span>");var $spanInit=$headingParent.find("span"),singleTextWidth=$headingParent.find("span").eq($spanInit.length-1).width();$headingParent.find("span").eq($spanInit.length-1).remove();headingWidth=headingWidth-parseInt($(this).css("padding-left"),10)-parseInt($(this).css("padding-right"),10);var noChars=Math.floor(headingWidth/singleTextWidth);$headingParent.html("");var lines=[""];var max_chars_per_line=noChars;var segments=headingText.split(" ");var j=0,i=0;for(i=0;i<segments.length;i++){if(lines[j].length+segments[i].length>max_chars_per_line){j++;}if(typeof lines[j]==="undefined"){lines[j]="";}lines[j]+=segments[i]+" ";}for(i=0;i<lines.length;i++){$headingParent.append("<span>"+lines[i]+"</span>");}});}};LBG.flashEmbed={embedflash:function($this,configOptions){swfobject.embedSWF(configOptions.swfFile,$this.attr("id"),configOptions.width,configOptions.height,configOptions.version,false,configOptions.customParams,configOptions.player,configOptions.attributes);},init:function(){var $flashAttr=$(".flashMovie"),meta=[],flashNum=0;var defaultObj={version:"10",attributes:{styleclass:"flashMovie"},player:{play:"true",loop:"true",wmode:"window",allowFullScreen:"false",allowscriptaccess:"sameDomain"}};$flashAttr.each(function(){var $this=$(this);meta=$this.metadata();var $objLink=$this.find(".flashLinkWrapper").remove();$this.closest(".flashContainer").append($objLink);if(!($this.attr("id"))){flashNum++;var classToID="flashMovie"+flashNum;$this.attr("id",classToID);}for(var parent in defaultObj){if(parent in meta){if(typeof defaultObj[parent]==="object"){for(var subKey in defaultObj[parent]){if(!(subKey in meta[parent])||meta[parent][subKey]===""){meta[parent][subKey]=defaultObj[parent][subKey];}}}}else{meta[parent]=defaultObj[parent];}}LBG.flashEmbed.embedflash($this,meta);});}};LBG.flashLink={init:function(){var $flashAttr=$(".flashMovie");$flashAttr.each(function(){var $this=$(this);var $thisLink=$this.next(".flashLinkWrapper");var altText=$thisLink.find("a").text();$thisLink.find("a").empty().attr("title",altText);var flashGif=new Image();$(flashGif).attr("src",DI.flashObj.flashObjImg).attr("alt","");$thisLink.find("a").append($(flashGif));var objWidth=$this.width();var objHeight=$this.height();$this.closest(".flashContainer").css({"width":objWidth,"height":objHeight});$thisLink.css({"width":objWidth,"height":objHeight});$thisLink.mouseover(function(){$thisLink.css("cursor","pointer");});});}};LBG.doNotUpdateEmail={init:function(){$(function(){if(($(".txtEmail1")&&$(".txtEmail2"))&&$(".showHide")){$(".donotupdate").click(function(){$("input.txtEmail").each(function(){$(this).val("");});$(".pane .formField").each(function(){var validationHandler=LBG.Forms.Validation.Tools.getFieldHandler($(this));validationHandler.hideError();});LBG.showHide.toggleDisplay($(".emailPreference .trigger"));
return false;});}});}};LBG.clearValuesOnHide={init:function(){if($(".triggerChild").length&&$(".showHide").length&&$(".typesAndAmounts").length&&$(".amountGroup").length){var wrapperValues=$(".pane .amountGroup .formField");var formValidationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject(wrapperValues);var triggered=0;$(".searchTransactions .showHide .triggerChild").click(function(){if(triggered>0){formValidationHandler.removeChildren(wrapperValues);formValidationHandler.isValid=false;LBG.Forms.Validation.Tools.setMultipleFieldValidation(wrapperValues);formValidationHandler.hideError();$(".pane .amountGroup input:text").val("");$(".pane .amountGroup .formField input:radio").eq(0).attr("checked",true);}triggered++;});}}};LBG.fixedHeadingHeight={init:function(){$(function(){var sizes=[];if($(".content table.fiveCol thead th strong.autoHeighStrong")){$(".content table.fiveCol thead th strong.autoHeighStrong").each(function(){sizes.push($(this).height());}).css("height",(Math.max.apply(null,sizes)+4)+"px");}sizes=[];if($(".content table.fiveCol thead th p.autoHeightDescription")){$(".content table.fiveCol thead th p.autoHeightDescription").each(function(){sizes.push($(this).height());}).css("height",Math.max.apply(null,sizes)+"px");}sizes=[];if($(".content table.fiveCol thead th a.autoHeightLink")){$(".content table.fiveCol thead th a.autoHeightLink").each(function(){sizes.push($(this).height());}).css("height",Math.max.apply(null,sizes)+"px");$(".content table.fiveCol thead th a.autoHeightLink").each(function(){if($(this).height<Math.max.apply(null,sizes)){$(this).css("line-height",(Math.max.apply(null,sizes)/2+4)+"px");}});}});}};LBG.formAutoSubmit={init:function(){if($("form.samlAutoSubmit").length){$("form.samlAutoSubmit").submit();}}};LBG.managePaperStatements=function(){$("table.preferences.paperstatements").each(function(){var strInputName=DI.lang.managePaperStatements.selectAll.inputName,strLabelText=DI.lang.managePaperStatements.selectAll.labelText;var $table=$(this),$tbody=$table.find("tbody"),$checkboxes=$tbody.find("input:checkbox").not(":disabled"),$rows=$tbody.find("tr"),$cells=null;var $toggleCell=null,$toggleRow=$("<tr />").addClass("selectAll"),$toggleLabel=$("<label />").attr("for",strInputName).html(strLabelText),$toggleInput=$("<input />").attr({type:"checkbox",id:strInputName,name:strInputName});var isSetup=false;if($checkboxes.length<=1){return;}function enableSelectAll(isEnabled){if(isEnabled){$toggleRow.find("label").removeClass("isDisabled");$toggleRow.find("input:checkbox").attr({"disabled":"","checked":""});}else{$toggleRow.find("label").addClass("isDisabled");$toggleRow.find("input:checkbox").attr({"disabled":"disabled","checked":"checked"});}}for(var i=0;i<$rows.length;i++){if(!isSetup&&$rows.eq(i).find("input:checkbox").length){$cells=$rows.eq(i).find("td");for(var j=0;j<$cells.length;j++){$toggleCell=$("<td />");if(j===0){$toggleCell.addClass("first");}if($cells.eq(j).find(":checkbox").length){$toggleLabel.append($toggleInput).appendTo($toggleCell.addClass("selectAll"));}$toggleCell.appendTo($toggleRow);}isSetup=true;break;}}if(!$toggleRow.find("td").length){return;}$tbody.prepend($toggleRow);$tbody.find("tr:odd").removeClass("alt");$tbody.find("tr:even").addClass("alt");if($checkboxes.filter(":checked").length===$checkboxes.length){enableSelectAll(false);}$toggleRow.find("input:checkbox").click(function(){if(this.checked){enableSelectAll(false);$checkboxes.attr("checked","checked");}});$checkboxes.click(function(){if(this.checked&&$checkboxes.filter(":checked").length===$checkboxes.length){enableSelectAll(false);}else{enableSelectAll(true);}});});};LBG.alternateImageSrc=function(){var isID=function(str){return str.substring(1,0)==="#";};var escapeID=function(id){return id.replace(/:/g,"\\:");};var clickHandler=function(event){var meta=$(this).metadata();var $target=$(this);if(meta.target){if(meta.parent){$target=$target.parents(meta.parent).find(meta.target);}else{$target=isID(meta.target)?$(escapeID(meta.target)):$(meta.target);}}$target.each(function(){$(this).attr("src",$(this).metadata().alternateSrc);});};$(".alternateImageSrc").each(function(){var meta=$(this).metadata();if(meta&&(meta.alternateSrc||meta.target)){$(this).one("click",clickHandler);}});};LBG.ajaxLoader=(function(){var wrapperSelector="div.ajaxLoaderPlaceholder";var contentSelector="div.ajaxContent";var contentWrapper='<div class="ajaxContent" />';var errorClassName="ajaxLoaderError";var successClassName="ajaxLoaderSuccess";var errorMessage='<div class="inner"><p>'+DI.lang.ajaxLoader.errorMessage+"</p></div>";return{init:function(){$(wrapperSelector).each(function(i){var $wrapper=$(this);var meta=$(this).metadata();if(meta&&meta.ajaxURI){$.ajax({url:meta.ajaxURI,cache:false,type:"GET",error:function(){$wrapper.addClass(errorClassName).html(errorMessage);},success:function(data){$wrapper.css("height",$wrapper.height()).animate({opacity:0},function(){$wrapper.wrapInner(contentWrapper);var animHeight=$(contentSelector,$wrapper).html(data).height();$wrapper.animate({opacity:1,height:animHeight},function(){$wrapper.addClass(successClassName);});});}});}});}};})();LBG.stpLoanCalculatorSlider={init:function(){var trigger=$(".stpLoanCalculator input"),sliderWrapper='<div class="sliderWrapper"><div class="sliderInnerWrapper"><div class="slider"/></div></div>',btnAmountMore='<span class="sliderIncrease"><a href="#" title="'+DI.stpLoanCalculatorButton.amount.increase+'">'+DI.stpLoanCalculatorButton.amount.increase+"</a></span>",btnAmountLess='<span class="sliderDecrease"><a href="#" title="'+DI.stpLoanCalculatorButton.amount.decrease+'">'+DI.stpLoanCalculatorButton.amount.decrease+"</a></span>",btnMonthMore='<span class="sliderIncrease"><a href="#" title="'+DI.stpLoanCalculatorButton.months.increase+'">'+DI.stpLoanCalculatorButton.months.increase+"</a></span>",btnMonthLess='<span class="sliderDecrease"><a href="#" title="'+DI.stpLoanCalculatorButton.months.decrease+'">'+DI.stpLoanCalculatorButton.months.decrease+"</a></span>";if(!trigger.length){return;}var formValidationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject(trigger);trigger.each(function(i){var input=$(this),params=input.metadata(),sliderMin=parseInt(input.closest(".formFieldInner").find(".minVal").text().replace(/,/,""),10),sliderMax=parseInt(input.closest(".formFieldInner").find(".maxVal").text().replace(/,/,""),10),interval=(params.sliderInterval)?parseInt(params.sliderInterval,10):1,startOverlay=parseInt(input.closest(".formFieldInner").find(".startBestRate").text().replace(/,/,""),10),endOverlay=parseInt(input.closest(".formFieldInner").find(".endBestRate").text().replace(/,/,""),10),positionOverlay,widthOverlay,slider,oValue,labelUnit;var formFieldName=LBG.Forms.Validation.Tools.convertClassDetailsToData($(this).closest(".formField")[0],"validationName:")[0];var formFieldValidationHandler=formValidationHandler.getChild(formFieldName);input.closest(".inputWrapper").after(sliderWrapper);slider=input.closest(".inputWrapper").next(".sliderWrapper").find(".slider");slider.slider({min:sliderMin,max:sliderMax,value:input.val().replace(/,/,"")||sliderMin,step:interval,slide:function(event,ui){input.val(ui.value);input.val(input.val().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"));},start:function(event,ui){input.val(ui.value);input.val(input.val().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"));if(formFieldValidationHandler.isShowingError){formFieldValidationHandler.hideError();formFieldValidationHandler.isShowingError=false;
}}});input.focus(function(){if(!(formFieldValidationHandler.isShowingError)){oValue=$(this).val().replace(/,/,"");}});input.blur(function(){var typedVal=$(this).val().replace(/,/,"");if(formFieldValidationHandler.isShowingError&&!isNaN(Math.abs(typedVal))){if(typedVal>sliderMax){slider.slider("value",sliderMax);}else{if(typedVal<sliderMin){slider.slider("value",sliderMin);}else{slider.slider("value",oValue);}}}});input.bind("keypress",function(e){var typedVal=$(this).val().replace(/,/,"");if(e.keyCode===13&&!isNaN(Math.abs(typedVal))){if(typedVal>sliderMax){slider.slider("value",sliderMax);}else{if(typedVal<sliderMin){slider.slider("value",sliderMin);}else{slider.slider("value",oValue);}}}});input.change(function(){var typedVal=$(this).val().replace(/,/,""),roundedVal,i;if(typedVal.indexOf(".")!==-1){typedVal=typedVal.substr(0,typedVal.indexOf("."));}if(!isNaN(Math.abs(typedVal))){if(typedVal%interval!==0){roundedVal=Math.round(typedVal/interval)*interval;slider.slider("value",roundedVal);}else{slider.slider("value",typedVal);}}$(this).val(typedVal.toString(10).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"));});if(i===0){slider.parent().before(btnAmountLess).after(btnAmountMore);}else{slider.parent().before(btnMonthLess).after(btnMonthMore);}$(input.closest(".formFieldInner").find(".sliderDecrease,.sliderIncrease")).bind("click",function(e){var oldVal=parseInt(input.val().replace(/,/,""),10),newVal;if(isNaN(oldVal)){oldVal=sliderMin;}e.preventDefault();if($(this).hasClass("sliderDecrease")){newVal=((oldVal-interval)<sliderMin)?sliderMin:(oldVal-interval);}else{newVal=((oldVal+interval)>sliderMax)?sliderMax:(oldVal+interval);}slider.slider("option","value",newVal);if(newVal>=sliderMin&&newVal<=sliderMax&&formFieldValidationHandler.isShowingError){formFieldValidationHandler.hideError();formFieldValidationHandler.isShowingError=false;}newVal=newVal.toString(10).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,");input.val(newVal);});if(startOverlay<endOverlay&&startOverlay>=sliderMin&&endOverlay<=sliderMax){positionOverlay=((startOverlay-sliderMin)/(sliderMax-sliderMin))*100;widthOverlay=(((endOverlay-startOverlay)/(sliderMax-sliderMin))*100);input.closest(".formFieldInner").find(".slider").append('<div class="overlayLoanCalculator" style="left:'+positionOverlay+"%; width:"+widthOverlay+'%;"/>');}if(input.prev("span").hasClass("currency")){labelUnit=input.prev("span").text();input.closest(".formFieldInner").find(".minVal, .maxVal").prepend(labelUnit);}if(input.next("span").hasClass("durationUnit")){labelUnit=" "+input.next("span").text();input.closest(".formFieldInner").find(".minVal, .maxVal").append(labelUnit);}});}};LBG.filterBy={instances:[],selectorInit:"select.filterBy",classTrigger:"filterByTrigger",classMenu:"filterByMenu",classSelected:"selected",classActive:"active",classHover:"hover",classFocus:"focus",classLast:"last",prefixMenuId:"filterById",dataKeyId:"dataFilterById",dataKeyIndex:"dataFilterByIndex",dataKeyValue:"dataFilterByValue",fadeSpeed:100,getInstanceObject:function(menuId){var self;for(var i=0;i<LBG.filterBy.instances.length;i++){if(LBG.filterBy.instances[i].menuId===menuId){self=LBG.filterBy.instances[i];break;}}return self;},getMenuId:function($target){var menuId;if($target[0].tagName.toLowerCase()==="span"&&$target.parent("."+LBG.filterBy.classTrigger).length){$target=$target.parents("."+LBG.filterBy.classTrigger);}if($target.hasClass(LBG.filterBy.classTrigger)){menuId=$target.data(LBG.filterBy.dataKeyId);}else{menuId=$target.parents("ul."+LBG.filterBy.classMenu).attr("id");}return menuId;},init:function(){$(LBG.filterBy.selectorInit).each(function(){var uniqueId=LBG.filterBy.instances.length;var select=this;if(select.options.length){LBG.filterBy.instances.push(new LBG.filterBy.dropDown(select,uniqueId));}});}};LBG.filterBy.dropDown=function(select,uniqueId){this.form=$(select).parents("form");this.$select=$(select).hide();this.$options=$(select).find("option");this.uniqueId=uniqueId;this.menuId=LBG.filterBy.prefixMenuId+uniqueId;this.focusIndex=0;this.$trigger=[];this.$menu=[];this.$menuItems=[];this.setup();};LBG.filterBy.dropDown.prototype={setFocus:function(e){var menuId=LBG.filterBy.getMenuId($(e.target));var isUp=e.keyCode===38;var isDown=e.keyCode===40;var len=0;var self;if(menuId&&(isUp||isDown)){e.preventDefault();e.stopPropagation();self=LBG.filterBy.getInstanceObject(menuId);if(self){len=self.$menuItems.length-1;if(isUp){self.focusIndex=self.focusIndex===0?len:self.focusIndex-1;}if(isDown){self.focusIndex=self.focusIndex===len?0:self.focusIndex+1;}self.$menuItems.eq(self.focusIndex).find("a:first").focus();}}},showMenu:function(){var position={};var height=0;for(var i=0;i<LBG.filterBy.instances.length;i++){if(LBG.filterBy.instances[i].$menu!==this.$menu){LBG.filterBy.instances[i].hideMenu();}}position=this.$trigger.position();height=this.$trigger.outerHeight();this.$menu.css({"top":position.top+height+"px","left":position.left+"px","width":(this.$menu.width()<195)?this.$menu.width():195+"px"}).fadeIn(LBG.filterBy.fadeSpeed);this.$trigger.addClass(LBG.filterBy.classActive);this.focusIndex=this.$menuItems.filter("."+LBG.filterBy.classSelected).find("a:eq(0)").data(LBG.filterBy.dataKeyIndex);$(document).bind("keydown",this.setFocus);},hideMenu:function(){this.$menu.fadeOut(LBG.filterBy.fadeSpeed);this.$trigger.removeClass(LBG.filterBy.classActive);$(document).unbind("keydown",this.setFocus);},toggleMenu:function(e){e.preventDefault();e.stopPropagation();if(this.$menu.is(":hidden")){this.showMenu();}else{this.hideMenu();}return false;},trackFocus:function(e){this.focusIndex=$(e.target).data(LBG.filterBy.dataKeyIndex);},setSelected:function(e){var self=this;var $target=$(e.target);var value=$target.data(LBG.filterBy.dataKeyValue);this.$menuItems.filter("."+LBG.filterBy.classSelected).removeClass(LBG.filterBy.classSelected);$target.parent("li").addClass(LBG.filterBy.classSelected);self.hideMenu();this.$options.each(function(i){if(this.value===value){self.$select.attr("selectedIndex",i);}});self.form.submit();},setup:function(){var self=this;self.$trigger=$("<a />");self.$menu=$("<ul />");self.$trigger.html(self.$select.find("option:eq(0)").html()).attr("tabIndex",0).data(LBG.filterBy.dataKeyId,self.menuId).keydown(function(e){if(e.keyCode===32||e.keyCode===13){$(this).click();return false;}}).addClass(LBG.filterBy.classTrigger).insertBefore(self.$select);self.$trigger.wrapInner($("<span />"));self.$trigger.add(self.$trigger.find("span")).click(function(e){self.toggleMenu(e);});self.$menu.attr("id",self.menuId).addClass(LBG.filterBy.classMenu).insertAfter(self.$trigger);self.$options.each(function(i){if(i>0){var $item=$("<li />");var $link=$("<a />");if(this.selected){$item.addClass(LBG.filterBy.classSelected);}$link.html(this.text).attr("tabIndex",0).data(LBG.filterBy.dataKeyIndex,i).data(LBG.filterBy.dataKeyValue,this.value).click(function(e){self.setSelected(e);}).focus(function(e){self.trackFocus(e);}).keydown(function(e){if(e.keyCode===32||e.keyCode===13){$(this).click();return false;}}).mouseover(function(e){self.trackFocus(e);}).appendTo($item);$item.appendTo(self.$menu);}});self.$menuItems=self.$menu.find("li");if($.browser.msie&&$.browser.version<7){self.$menuItems.find("a").focus(function(){$(this).parent("li").addClass(LBG.filterBy.classFocus);}).blur(function(){$(this).parent("li").removeClass(LBG.filterBy.classFocus);});self.$menuItems.hover(function(){$(this).addClass(LBG.filterBy.classHover);},function(){$(this).removeClass(LBG.filterBy.classHover);
});}if($.browser.msie&&$.browser.version<9){self.$menuItems.filter(":last").addClass(LBG.filterBy.classLast);}$(document).click(function(e){var $target=$(e.target);var isVisible=self.$menu.is(":visible");var isTrigger=$target.hasClass(LBG.filterBy.classTrigger);var isMenu=$target.parents("ul."+LBG.filterBy.classMenu).length;if(isVisible&&!isTrigger&&!isMenu){self.hideMenu();}});}};LBG.radioButtonPanel={init:function(){var $panelSelect=$(".content .optionPanel input:radio.statusToggle");$panelSelect.click(function(){$panelSelect.each(function(){$(this).closest(".subPanel").removeClass("panelSelected");});$(this).closest(".subPanel").addClass("panelSelected");var $panelGroup=$(".content .optionPanel .subPanel");$panelGroup.each(function(){if(!$(this).hasClass(".panelSelected")){$(this).find("input:text").val("");}});});}};LBG.optionPanelDisable={init:function(){var $getDisabled=$(".content .optionPanel .isDisabled");$getDisabled.attr("disabled","disabled");}};LBG.yourInbox={toggleRow:function($rowTrigger){var $rowDetail=$rowTrigger.next("tr.detail");var $checkbox=$rowTrigger.find(":checkbox:eq(0)");if($rowTrigger.hasClass("expanded")){$rowTrigger.removeClass("expanded");$rowDetail.hide();}else{$("tr").removeClass("expanded");$("tr.detail").hide();$rowTrigger.addClass("expanded");$rowDetail.show();}},toggleMainActions:function(isEnable){var $messageTable=$("table.inboxMessageTable");var yourInboxDI=DI.paperlessCorrespondence.yourInbox;var $archive=$("th.selectAll",$messageTable).find("li.archive input");var $delete=$("th.selectAll",$messageTable).find("li.delete input");var isRead=$("td.first input:enabled",$messageTable).length;if(isEnable&&isRead){$archive.removeAttr("disabled").removeClass("isDisabled").attr("src",yourInboxDI.archiveImage.enabled);$delete.removeAttr("disabled").removeClass("isDisabled").attr("src",yourInboxDI.deleteImage.enabled);}else{$archive.addClass("isDisabled").attr({"disabled":true,"src":yourInboxDI.archiveImage.disabled});$delete.addClass("isDisabled").attr({"disabled":true,"src":yourInboxDI.deleteImage.disabled});}},init:function(){var $inboxTable=$("table.inboxMessageTable");LBG.yourInbox.toggleMainActions();$(".messageAction .isDisabled").attr("tabindex","-1");$(".inboxData .infoMessage p.buttonLink a").click(function(){$(this).parents(".infoMessage").slideUp({opacity:"hide"},"slow");});$(".secondary .inboxPanel").click(function(e){var location=$("a:eq(0)",this).attr("href");if(typeof location==="string"&&location!==""){document.location.href=location;}e.preventDefault();});$(".inboxMessageTable .selectAll input").click(function(e){if(this.checked){$(".inboxMessageTable tr.messageRead").addClass("highlight");}else{$(".inboxMessageTable tr.messageRead").removeClass("highlight");}});$(".inboxMessageTable input.msgcheckbox").click(function(e){if(this.checked){$(this).parents("tr").addClass("highlight");}else{$(this).parents("tr").removeClass("highlight");}});$(".inboxMessageTable input.msgcheckbox").click(function(e){e.stopImmediatePropagation();});if(!$inboxTable.length){return;}$inboxTable.find("tr").each(function(){if($(this).hasClass("trigger")){$(this).click(function(event){var tagName=event.target.tagName.toLowerCase();if(tagName!=="input"){event.preventDefault();event.stopPropagation();LBG.yourInbox.toggleRow($(this));}});}if($(this).hasClass("detail")){$(this).hide();}});$inboxTable.find("tr.detail .messageAction").find("li.archive a, li.delete a").click(function(event){var checkbox=$(this).parents("tr.detail").prev().find("td.select input:checkbox")[0];if(checkbox.disabled){event.preventDefault();return false;}return true;});$inboxTable.find("thead th.selectAll").find("li.archive input, li.delete input").click(function(event){var checkbox=$(this).parents("th").find("input:checkbox")[0];if(!checkbox.checked){event.preventDefault();return false;}return true;});$inboxTable.find("thead th.selectAll input:checkbox").click(function(){$(this).parents("table").find("tbody td.select input:checkbox:not(:disabled)").attr("checked",this.checked);LBG.yourInbox.toggleMainActions(this.checked);});$inboxTable.find("tbody td.select input:checkbox").click(function(){var $selectAll=$inboxTable.find("thead th.selectAll");var $rowCheckboxes=$inboxTable.find("tbody td input:checked").length,$rowCheckboxesAll=$inboxTable.find("tbody td.select input:checkbox:not(:disabled)").length;if($rowCheckboxes>=1){LBG.yourInbox.toggleMainActions(true);}else{$inboxTable.find("thead th.selectAll input:checkbox").attr("checked",false);LBG.yourInbox.toggleMainActions(false);}if($rowCheckboxes<$rowCheckboxesAll){$inboxTable.find("thead th input:checkbox:not(:disabled)").attr("checked",false);}else{$inboxTable.find("thead th input:checkbox:not(:disabled)").attr("checked",true);}});$inboxTable.find(".statementLink").one("click",function(){var $rowTrigger=$(this).parents("tr.detail").prev("tr");var $rowDetail=$(this).parents("tr.detail");var $checkbox=$rowTrigger.find(":checkbox:eq(0)");$rowTrigger.removeClass("messageUnread").addClass("messageRead");$rowDetail.removeClass("messageUnread").addClass("messageRead");$checkbox.removeAttr("disabled");$rowDetail.find(".isDisabled").removeClass("isDisabled");});var stopHref=false;var outsideHref=false;$(".inboxMessageTable .messageinfo .overlay").closest(".trigger").click(function(){if($(this).hasClass("expanded")){stopHref=true;$(this).find(".messageinfo a.overlay").keydown();}});$(".inboxMessageTable .messageinfo a").keydown(function(e){if(!stopHref){e.preventDefault();e.stopImmediatePropagation();}else{outsideHref=true;LBG.overlay.open($(this).attr("href"),this,true);stopHref=false;}});$(".inboxMessageTable .messageinfo a").click(function(e){if(!$(this).closest(".trigger").hasClass("expanded")){$(this).closest(".trigger").trigger("click");}else{if(stopHref){if(!outsideHref){e.preventDefault();e.stopImmediatePropagation();}}else{stopHref=true;$(this).closest(".trigger").trigger("click");e.preventDefault();e.stopImmediatePropagation();}}stopHref=false;outsideHref=false;});}};LBG.checkboxSelectAll=(function(){var initSelector=".checkboxSelectAll";var isId=function(str){return str.substring(1,0)==="#";};var escapeId=function(id){return id.replace(/:/g,"\\:");};var getCheckboxes=function(metadata){var $checkboxes=$([]);if(metadata.columns&&metadata.columns.length){for(var i=0;i<metadata.columns.length;i++){$checkboxes=$checkboxes.add(metadata.$target.find("tbody th:nth-child("+metadata.columns[i]+"), tbody td:nth-child("+metadata.columns[i]+")").find("input:checkbox:not(:disabled)"));}}else{$checkboxes=$checkboxes.add(metadata.$target.find("tbody input:checkbox:not(:disabled)"));}return $checkboxes;};var checkStatus=function(event,$trigger){$trigger=$trigger||$(event.target);var metadata=$trigger.data("metadata"),$checkboxes=getCheckboxes(metadata),isChecked,allChecked;$checkboxes.each(function(){allChecked=true;if($(this).is(":checked")===false){allChecked=false;return allChecked;}return allChecked;});if(allChecked&&$trigger[0]===metadata.$trigger[0]){isChecked=allChecked;metadata.$trigger.attr("checked",isChecked).attr("disabled",isChecked);}else{if($trigger[0]===metadata.$trigger[0]){isChecked=metadata.$trigger.is(":checked");$checkboxes.each(function(){if(!isChecked&&this.checked){$(this).attr("checked","checked");}else{$(this).attr("checked",isChecked);}});metadata.$trigger.attr("disabled",isChecked);}else{isChecked=$checkboxes.filter(":checked").length===$checkboxes.length;metadata.$trigger.attr({"disabled":isChecked,"checked":isChecked});
}}};var setup=function($formField){var metadata=$formField.metadata();var $checkboxes;if(typeof metadata.target==="undefined"){return;}metadata.$trigger=$formField.find("input:checkbox:eq(0)");metadata.$target=$(escapeId(metadata.target));if(!metadata.$target.length){return;}$checkboxes=getCheckboxes(metadata);$checkboxes.data("metadata",metadata).click(checkStatus);metadata.$trigger.data("metadata",metadata).click(checkStatus).each(function(){checkStatus(null,$(this));});};return{init:function(){$(initSelector).each(function(){setup($(this));});}};})();LBG.preventPaste={init:function(){$("input.noPaste").bind("paste",function(e){e.preventDefault();});}};LBG.branchFinder={onlyLloyds:false,allResultsContainer:null,allResults:null,numberItemsDisplay:5,init:function(){LBG.branchFinder.allResultsContainer=$("div.selectBranchAccountSetup div.branchResults");LBG.branchFinder.allResults=LBG.branchFinder.allResultsContainer.find("div.inputGroup");LBG.branchFinder.altRows();$("#slctBranches").change(function(e){if($("#slctBranches option:selected").attr("value")==="onlyLloyds"){LBG.branchFinder.onlyLloyds=true;LBG.branchFinder.goToPage(1);}else{LBG.branchFinder.onlyLloyds=false;LBG.branchFinder.goToPage(1);}});$("div.selectBranchAccountSetup div.paginationSudoButtons li.next input.pseudoLink").click(function(){});},goToPage:function(pageNumber){var localCurrentView=LBG.branchFinder.allResults;var minIndex=(pageNumber-1)*LBG.branchFinder.numberItemsDisplay;var maxIndex=(pageNumber*LBG.branchFinder.numberItemsDisplay)-1;localCurrentView.show();if(LBG.branchFinder.onlyLloyds){localCurrentView=localCurrentView.filter("div.branchDivested").hide();}localCurrentView.filter(":visible").filter(function(index){return index<minIndex||index>maxIndex;}).hide();LBG.branchFinder.altRows();},altRows:function(){var visibleResults=LBG.branchFinder.allResults.filter(":visible");$(visibleResults).each(function(){if($(this).find(".alt")){$(this).find(".alt").removeClass("alt");}});$(visibleResults).filter(":odd").find(".branchDetails").addClass("alt");}};LBG.showMeOrientation={journeyCookieName:"IBCookie04",loadedStubs:[],welcomeBubbleAnchorExceptionConstant:"welcomeShowMeAnchor",doneBubbleAnchorExceptionConstant:"doneShowMeAnchor",showMeSupportAnchorConstant:"showMeSupport",isWelcomeMessage:false,frameIsInjected:false,origialBubbleTopMargin:undefined,bubbleNavigationControls:[".goNext",".goPrev",".close"],currentBubbleControl:0,bubbleControlFocus:".goNext",showMeWebTrends:false,forceJourneyEnd:".bubbleJourneyEnd",thisSlideNumber:0,bubblesToShow:[],bubblesToLookFor:[],match_anchors_to_functions:function(anchor){if(anchor===LBG.showMeOrientation.welcomeBubbleAnchorExceptionConstant){LBG.showMeOrientation.isWelcomeMessage=true;LBG.showMeOrientation.welcomeSlide();}else{if(anchor===LBG.showMeOrientation.doneBubbleAnchorExceptionConstant){LBG.showMeOrientation.isWelcomeMessage=false;LBG.showMeOrientation.doneSlide();}else{if(anchor==="welcomeOnly"){LBG.showMeOrientation.welcomeOnlySlide();}else{if(anchor==="accountNameShowMeAnchor"){var $accountAnchorWrapper=$(".accountNameShowMeAnchor").parents(".accountDetails");var $AccountNameTextElement=$accountAnchorWrapper.find("h2 a");var account_name="Account name";if($AccountNameTextElement.text().length>1){account_name=$AccountNameTextElement.text();}$("#showMeOrientation .accountName h2").empty().append(account_name);LBG.showMeOrientation.showBubble("accountName",anchor,"up",10,20);}else{var metadata=$("."+anchor).metadata();var pointer="up";if(metadata.hasOwnProperty("pointer")){pointer=metadata.pointer;}var topPositionOffset=0;if(metadata.hasOwnProperty("topPositionOffset")){topPositionOffset=metadata.topPositionOffset;}var leftPositionOffset=0;if(metadata.hasOwnProperty("leftPositionOffset")){leftPositionOffset=metadata.leftPositionOffset;}if(metadata.hasOwnProperty("bubble")){LBG.showMeOrientation.showBubble(metadata.bubble,anchor,pointer,topPositionOffset,leftPositionOffset);}}}}}},createBubbleIndicators:function(){LBG.showMeOrientation.bubblesToShow.length=0;if(($.inArray(LBG.showMeOrientation.welcomeBubbleAnchorExceptionConstant,LBG.showMeOrientation.bubblesToLookFor))>-1){LBG.showMeOrientation.bubblesToShow.push(LBG.showMeOrientation.welcomeBubbleAnchorExceptionConstant);}for(var i=0;i<LBG.showMeOrientation.bubblesToLookFor.length;i++){if(($("."+LBG.showMeOrientation.bubblesToLookFor[i]).length>0)&&(LBG.showMeOrientation.bubblesToLookFor[i]!==LBG.showMeOrientation.welcomeBubbleAnchorExceptionConstant)&&(LBG.showMeOrientation.bubblesToLookFor[i]!==LBG.showMeOrientation.doneBubbleAnchorExceptionConstant)){LBG.showMeOrientation.bubblesToShow.push(LBG.showMeOrientation.bubblesToLookFor[i]);}}if(($.inArray(LBG.showMeOrientation.doneBubbleAnchorExceptionConstant,LBG.showMeOrientation.bubblesToLookFor))>-1){LBG.showMeOrientation.bubblesToShow.push(LBG.showMeOrientation.doneBubbleAnchorExceptionConstant);}if(LBG.showMeOrientation.bubblesToShow.length>1){$("ul.steps").empty();for(var j=1;j<=LBG.showMeOrientation.bubblesToShow.length;j++){if(j===1){$("ul.steps").append('<li class="first current"><span>'+j+"</span></li>");}else{if(j===LBG.showMeOrientation.bubblesToShow.length){$("ul.steps").append('<li class="last"><span>'+j+"</span></li>");}else{$("ul.steps").append("<li><span>"+j+"</span></li>");}}}$("#showMeOrientation .bubbleControls").css("display","inline");}else{$("#showMeOrientation .bubbleControls").css("display","none");}},welcomeSlide:function(){LBG.showMeOrientation.bubbleControlFocus=".goNext";LBG.showMeOrientation.thisSlideNumber=0;this.scrollPage(0);$("#showMeOrientation a.goPrev").removeClass("restart");$("#showMeOrientation").removeClass("tip").addClass("showMeWelcome");$("#showMeOrientation .bubbleControls").css("display","inline");$("#showMeMask").addClass("show");$("#showMeOrientation a.goNext img").attr({"src":DI.showme.welcomeNextArrow,"alt":DI.showme.welcomeNextAlt}).css("display","inline");$("#showMeOrientation a.goPrev img").attr({"src":DI.showme.welcomePrevArrow,"alt":DI.showme.welcomePrevAlt}).css("display","inline");$("#showMeOrientation a.goNext").css("display","inline");$("#showMeOrientation a.goPrev").css("display","inline");$("ul.steps li").removeClass("current");$("ul.steps li.first").addClass("current");$("#showMeOrientation .midspace img").removeClass("show");$("#showMeOrientation .midspace img.welcome").addClass("show");$("#showMeOrientation .midspace .textContent > div").css("display","none");$("#showMeOrientation .midspace .textContent .welcome").css("display","block");$("#showMeOrientation img.pointUp").css("display","none");$("#showMeOrientation img.pointUpRight").css("display","none");$("#showMeOrientation img.pointRight").css("display","none");$("#showMeOrientation img.pointLeft").css("display","none");$("#showMeOrientation img.pointDownLeft").css("display","none");$("#showMeOrientation img.pointDownRight").css("display","none");$("#showMeOrientation").animate({top:135,left:"50%",width:"810px"},500,function(){});$(LBG.showMeOrientation.bubbleControlFocus).prev().focus();LBG.showMeOrientation.web_trends("welcome_journey_start");},fade_text:function(in_or_out){var fade=0;if(in_or_out==="in"){fade=1;}$("#showMeOrientation .textContent").animate({opacity:fade},350,function(){});},showBubble:function(bubbleClassName,anchor,pointer,positionTopOffset,positionLeftOffset,metadata){if($("."+anchor).length>0){$("#showMeOrientation img").css("margin-left","");$("#showMeOrientation img.pointRight").removeClass("doneStretch");
$("#showMeOrientation").removeClass("showMeWelcome");var arrowTopOffset,arrowLeftOffset;switch(pointer){case"up":LBG.showMeOrientation.hide_all_bubble_arrows();$("#showMeOrientation img.pointUp").css("display","block");arrowTopOffset=70;arrowLeftOffset=360;break;case"upRight":LBG.showMeOrientation.hide_all_bubble_arrows();$("#showMeOrientation img.pointUpRight").css("display","block");arrowTopOffset=70;arrowLeftOffset=0;break;case"left":LBG.showMeOrientation.hide_all_bubble_arrows();$("#showMeOrientation img.pointLeft").css("display","block");arrowTopOffset=-12;arrowLeftOffset=500;break;case"right":LBG.showMeOrientation.hide_all_bubble_arrows();$("#showMeOrientation img.pointRight").css("display","block");arrowTopOffset=-20;arrowLeftOffset=-10;if($.browser.msie&&parseInt($.browser.version)<8){arrowTopOffset=-10;}break;case"downLeft":LBG.showMeOrientation.hide_all_bubble_arrows();$("#showMeOrientation img.pointDownLeft").css("display","block");arrowTopOffset=35;arrowLeftOffset=360;break;default:LBG.showMeOrientation.hide_all_bubble_arrows();$("#showMeOrientation img.pointUp").css("display","block");arrowTopOffset=70;arrowLeftOffset=360;break;}if((positionTopOffset>0)||(positionTopOffset<0)){arrowTopOffset=arrowTopOffset+positionTopOffset;}if((positionLeftOffset>0)||(positionLeftOffset<0)){arrowLeftOffset=arrowLeftOffset+positionLeftOffset;}if(anchor===LBG.showMeOrientation.showMeSupportAnchorConstant){LBG.showMeOrientation.thisSlideNumber=0;}$("#showMeOrientation .midspace img").removeClass("show");$("#showMeOrientation .textContent").animate({opacity:0},350,function(){$("#showMeOrientation").addClass("tip");$("#showMeMask").removeClass("show");$("#showMeOrientation .midspace .textContent > div").css("display","none");$("#showMeOrientation .midspace ."+bubbleClassName).css("display","block");$("#showMeOrientation a.goNext img").attr({"src":DI.showme.standardNextTip,"alt":DI.showme.standardNextTipAlt});$("#showMeOrientation a.goPrev img").attr({"src":DI.showme.standardPrevTip,"alt":DI.showme.standardPrevTipAlt});if(LBG.showMeOrientation.thisSlideNumber===0){$("#showMeOrientation a.goPrev img").css("display","none");$("#showMeOrientation a.goPrev").css("display","none");$("#showMeOrientation a.goNext img").css("display","inline");$("#showMeOrientation a.goNext").css("display","inline");$(LBG.showMeOrientation.bubbleControlFocus).focus();}else{if((LBG.showMeOrientation.thisSlideNumber+1)===LBG.showMeOrientation.bubblesToShow.length){$("#showMeOrientation a.goPrev img").css("display","inline");$("#showMeOrientation a.goPrev").css("display","inline");$("#showMeOrientation a.goNext img").css("display","none");$("#showMeOrientation a.goNext").css("display","none");LBG.showMeOrientation.bubbleControlFocus=".goPrev";$(LBG.showMeOrientation.bubbleControlFocus).focus();}else{if(LBG.showMeOrientation.isWelcomeMessage===true&&((LBG.showMeOrientation.thisSlideNumber+2)===LBG.showMeOrientation.bubblesToShow.length)){$("#showMeOrientation a.goNext img").attr({"src":DI.showme.standardNextArrow,"alt":DI.showme.standardNextArrowAlt});}else{if(LBG.showMeOrientation.isWelcomeMessage===true&&((LBG.showMeOrientation.thisSlideNumber)===1)){$("#showMeOrientation a.goPrev img").attr({"src":DI.showme.standardPrevArrow,"alt":DI.showme.standardPrevArrowAlt});}else{$("#showMeOrientation a.goPrev").css("display","inline");$("#showMeOrientation a.goNext").css("display","inline");$("#showMeOrientation a.goPrev img").css("display","inline");$("#showMeOrientation a.goNext img").css("display","inline");}}}}if(bubbleClassName==="showMeSupport"){$(".showmMeSupport > li:first").focus();}else{if($("#showMeOrientation a.goNext img:visible").length>0||$("#showMeOrientation a.goPrev img:visible").length>0){$(LBG.showMeOrientation.bubbleControlFocus).focus();}else{$("#showMeOrientation .close").focus();}}});var p=$("."+anchor);var position=p.offset();var thisBubbleHeight=$("#showMeOrientation > .showWrap:visible:last").height();var thisBubbleContentHight=$("#showMeOrientation .textContent:visible:last").height();var isBottomArrow=(pointer==="downLeft"||pointer==="downRight");var newContentHeight=$("."+bubbleClassName+":last").height();var offsetTop=position.top;var offsetCorrection=newContentHeight-thisBubbleContentHight;if(isBottomArrow){if(LBG.showMeOrientation.origialBubbleTopMargin===undefined){LBG.showMeOrientation.origialBubbleTopMargin=(Number($("#showMeOrientation .pointDownLeft:first").css("marginTop").replace("px","")));}if(newContentHeight!==thisBubbleContentHight){offsetCorrection=newContentHeight-thisBubbleContentHight;}offsetTop=position.top-thisBubbleHeight-offsetCorrection;}else{offsetTop=position.top+arrowTopOffset;offsetCorrection=0;}var width=bubbleClassName==="showMeSupport"?"396px":"480px";$("#showMeOrientation").animate({top:offsetTop,left:position.left+arrowLeftOffset,width:width},500,function(){if($(".showMeSupport:visible").length>0){$(".showMeSupport li a:first").focus();}});if(pointer!=="downLeft"){LBG.showMeOrientation.scrollPage(position.top-100);}LBG.showMeOrientation.fade_text("in");}$("#showMeOrientation .midspace .textContent div").filter(":visible").focus();var bubbleMetaData=$("."+anchor).metadata();LBG.showMeOrientation.web_trends(bubbleClassName,bubbleMetaData);},doneSlide:function(){LBG.showMeOrientation.thisSlideNumber=LBG.showMeOrientation.bubblesToShow.length+1;this.scrollPage(0);$("#showMeOrientation a.goPrev").addClass("restart");$("#showMeMask").removeClass("show");$("#showMeOrientation a.goNext img").attr({"src":DI.showme.doneNextArrow,"alt":DI.showme.doneNextArrowAlt});$("#showMeOrientation a.goPrev img").attr({"src":DI.showme.donePrevArrow,"alt":DI.showme.donePrevArrowAlt});$("#showMeOrientation a.goNext").css("display","inline");$("#showMeOrientation a.goPrev").css("display","inline");$("ul.steps li").removeClass("current");$("ul.steps li.last").addClass("current");$("#showMeOrientation .midspace img").removeClass("show");$("#showMeOrientation .midspace img.done").addClass("show");$("#showMeOrientation .midspace .textContent > div").css("display","none");$("#showMeOrientation .midspace .textContent .done").css("display","block");LBG.showMeOrientation.hide_all_bubble_arrows();var is_button_visible=$(".showMeSupportLinkShowMeAnchor").parents("div").hasClass("selected");var p=$(".showMeSupportLinkShowMeAnchor");if(is_button_visible===false){p=$(".showMeSupportLinkShowMeAnchor").parents(".part").find("h2");}var ie7Offset=($.browser.msie===true&&Number($.browser.version)===7)?7:20;if($(".showMeSupportLinkShowMeAnchor").length>0){$("#showMeOrientation img.pointRight").css("display","block").addClass("doneStretch");$("#showMeOrientation .bubbleControls").addClass("lastBubble");var position=p.offset();$("#showMeOrientation").animate({top:position.top-ie7Offset,left:position.left-300,width:680},500,function(){});}else{$("#showMeOrientation").animate({top:135,left:"50%",width:"700px"},500,function(){});}LBG.showMeOrientation.web_trends("welcome_journey_done");},welcomeOnlySlide:function(){LBG.showMeOrientation.thisSlideNumber=LBG.showMeOrientation.bubblesToShow.length+1;this.scrollPage(0);$("#showMeOrientation a.goPrev").addClass("restart");$("#showMeOrientation").addClass("tip showMeWelcome");$("#showMeMask").removeClass("show");$("#showMeOrientation a.goNext img").attr("src",DI.showme.doneNextArrow);$("#showMeOrientation a.goPrev img").css("display","none");$("#showMeOrientation .midspace img").removeClass("show");$("#showMeOrientation .midspace img.welcome").addClass("show");
$("#showMeOrientation .midspace .textContent > div").css("display","none");$("#showMeOrientation .midspace .textContent .welcomeOnly").css("display","block").css("width","375px");LBG.showMeOrientation.hide_all_bubble_arrows();if($(".showMeSupportLinkShowMeAnchor").length>0){$("#showMeOrientation img.pointRight").css("display","block").css("margin-left","759px");var p=$(".showMeSupportLinkShowMeAnchor");var position=p.offset();$("#showMeOrientation").animate({top:position.top-15,left:position.left-420,width:810},500,function(){});}else{$("#showMeOrientation").animate({top:135,left:"68%",width:"810px"},500,function(){});}},checkForNudge:function(){var container_metadata=$(".showMeContainer").metadata();if(container_metadata.hasOwnProperty("nudge")){var nudgeJourneyKey=container_metadata.nudge;return nudgeJourneyKey;}else{return false;}},scrollPage:function(y){$("html, body").animate({scrollTop:y},500);},setCookie:function(cookieName,cookieValue){if($(LBG.showMeOrientation.forceJourneyEnd).length<1){document.cookie=cookieName+"="+cookieValue+";path=/";}},getCookie:function(get_cookie_name){var noCookie=true;var i,cookieName,cookieVal,ARRcookies=document.cookie.split(";");for(i=0;i<ARRcookies.length;i++){cookieName=ARRcookies[i].substr(0,ARRcookies[i].indexOf("="));cookieVal=ARRcookies[i].substr(ARRcookies[i].indexOf("=")+1);cookieName=cookieName.replace(/^\s+|\s+$/g,"");if(cookieName===get_cookie_name){if((cookieVal.length>0)&&(cookieVal!=="false")){noCookie=false;return cookieVal;}}}if(noCookie===true){return false;}},removeCookie:function(cookieName){document.cookie=cookieName+"= "+";expires=Thu, 01 Jan 1970 00:00:01 GMT"+";path=/";},collapseToShowMe:function(){LBG.showMeOrientation.thisSlideNumber=0;LBG.showMeOrientation.hide_all_bubble_arrows();var is_button_visible=$(".showMeSupportLinkShowMeAnchor").parents(".part").hasClass("selected");var closeTo=$(".showMeSupportLinkShowMeAnchor");if(is_button_visible===false){closeTo=$(".showMeSupportLinkShowMeAnchor").parents(".part").find("h2");}var curHeight=$("#showMeOrientation").height();var position=closeTo.offset(),topPos=position.top-15,leftPos=position.left+85,width=0,currentLeft=$("#showMeOrientation").offset().left,params={top:topPos,left:leftPos,width:0,margin:0};if($(".showMeSupportLinkShowMeAnchor").length>0){$("#showMeOrientation").css({left:currentLeft}).animate(params,850,function(){$(this).css({top:135,left:"50%",width:"810px",marginTop:-60,marginLeft:-405,display:"none"});$("#showMeMask").removeClass("show");});}else{$("#showMeOrientation").css("display","none");$("#showMeMask").removeClass("show");}},showMeSupportClicks:function($clicked_element){var link_metadata=$clicked_element.metadata();var existing_content=$(".showMeContainer #showMeOrientation .textContent").html();LBG.showMeOrientation.setCookie(LBG.showMeOrientation.journeyCookieName,link_metadata.journeyKey);var i=$(".showMeContainer").metadata();if(i.journeyKeys.lastIndexOf(link_metadata.journeyKey)!==-1){if($.inArray(link_metadata.journeyKey,LBG.showMeOrientation.loadedStubs)===-1){$(".showMeContainer #showMeOrientation .textContent").empty();$(".showMeContainer #showMeOrientation .textContent").load(DI.showme.stubFileLocation+"showme_"+link_metadata.journeyKey+DI.showme.stubFileExtension,function(responseText,textStatus,req){if(textStatus==="error"){$(".showMeContainer #showMeOrientation .textContent").prepend(existing_content);$(".showMeContainer #showMeOrientation .textContent > div").css("display","none");LBG.showMeOrientation.showBubble("unavailabubble","showMeSupportLinkShowMeAnchor","right");}if(textStatus==="success"){LBG.showMeOrientation.setCookie(LBG.showMeOrientation.journeyCookieName,link_metadata.journeyKey);$(".showMeContainer #showMeOrientation .textContent").prepend(existing_content);$(".showMeContainer #showMeOrientation .textContent > div").css("display","none");LBG.showMeOrientation.loadedStubs.push(link_metadata.journeyKey);LBG.showMeOrientation.invokeJourneyFromKey(link_metadata.journeyKey);}});}else{LBG.showMeOrientation.invokeJourneyFromKey(link_metadata.journeyKey);}}else{if($(".backToAccountsAnchor").length>0){$("#showMeOrientation .bubbleControls").css("display","none");LBG.showMeOrientation.showBubble("backToAccountOverview","backToAccountsAnchor","up");}else{$("#showMeOrientation .bubbleControls").css("display","none");LBG.showMeOrientation.showBubble("unavailabubble","showMeSupportLinkShowMeAnchor","right");}}},invokeJourneyFromKey:function(journey_key){if(journey_key.length>0){var container_metadata=$(".showMeContainer").metadata();var journey_arrays=container_metadata.journeyKeys.split(";");var journey_anchors=[];var found=false;var i;for(i=0;i<journey_arrays.length;i++){var kee=journey_arrays[i].split(":");if(kee[0]===journey_key){journey_anchors=kee[1].split(",");found=true;}}if(found===true){LBG.showMeOrientation.setCookie(LBG.showMeOrientation.journeyCookieName,journey_key);LBG.showMeOrientation.bubblesToLookFor=journey_anchors;LBG.showMeOrientation.createBubbleIndicators();if(LBG.showMeOrientation.bubblesToShow.length>0){LBG.showMeOrientation.match_anchors_to_functions(LBG.showMeOrientation.bubblesToShow[0]);}else{if($(".backToAccountsAnchor").length>0){$("#showMeOrientation .bubbleControls").css("display","none");LBG.showMeOrientation.showBubble("backToAccountOverview","backToAccountsAnchor","up");}else{$("#showMeOrientation .bubbleControls").css("display","none");LBG.showMeOrientation.showBubble("unavailabubble","showMeSupportLinkShowMeAnchor","right");}}}else{if($(".backToAccountsAnchor").length>0){$("#showMeOrientation .bubbleControls").css("display","none");LBG.showMeOrientation.showBubble("backToAccountOverview","backToAccountsAnchor","up");}else{$("#showMeOrientation .bubbleControls").css("display","none");LBG.showMeOrientation.showBubble("unavailabubble","showMeSupportLinkShowMeAnchor","right");}}}else{$("#showMeOrientation .bubbleControls").css("display","none");LBG.showMeOrientation.showBubble("unavailabubble","showMeSupportLinkShowMeAnchor","right");}},isCurrentJourneyInTheShowMeMetadata:function(){var current_journey=LBG.showMeOrientation.getCookie(LBG.showMeOrientation.journeyCookieName);if(current_journey!==false){var container_metadata=$(".showMeContainer").metadata();var journey_arrays=container_metadata.journeyKeys.split(";");var i;var found=false;for(i=0;i<journey_arrays.length;i++){var kee=journey_arrays[i].split(":");if(kee[0]===current_journey){found=true;}}return found;}else{return false;}},hide_all_bubble_arrows:function(){$("#showMeOrientation img.pointUp").css("display","none");$("#showMeOrientation img.pointUpRight").css("display","none");$("#showMeOrientation img.pointRight").css("display","none");$("#showMeOrientation img.pointLeft").css("display","none");$("#showMeOrientation img.pointDownLeft").css("display","none");$("#showMeOrientation img.pointDownRight").css("display","none");},web_trends:function(bubble_identifier,bubbleMetaData){var time=new Date().toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1");var date=new Date();var datestring=("0"+(date.getMonth()+1).toString()).substr(-2)+"/"+("0"+date.getDate().toString()).substr(-2)+"/"+(date.getFullYear().toString()).substr(2);if(typeof WebTrends!=="undefined"){if(LBG.showMeOrientation.showMeWebTrends===false){}if(typeof bubbleMetaData!="undefined"){var dcsuri=location.pathname.slice(-1)==="/"?location.pathname+bubble_identifier:location.pathname+"/"+bubble_identifier;LBG.track("WT.ti",bubble_identifier,"DCS.dcsuri",dcsuri,"WT.dl","77","dcsext.pagename",bubbleMetaData.pagename,"DCSext.overlayid",bubbleMetaData.module,"DCSext.content",bubbleMetaData.content,"WT.tx_it",time,"WT.tx_id",datestring);
}else{LBG.track("WT.ti",bubble_identifier,"WT.dl","77","WT.tx_it",time,"WT.tx_id",datestring);}}},init:function(){if($(".showMeContainer").length>0){LBG.showMeOrientation.thisSlideNumber=0;$(".showMeMenu ul").prepend(DI.showme.showMeMenuButton);var item=1;$("li.showMeItem").each(function(index){if(item!==1){$(this).remove();}item=2;});var current_journey=LBG.showMeOrientation.getCookie(LBG.showMeOrientation.journeyCookieName);var nudge=LBG.showMeOrientation.checkForNudge();var existing_content="";if(current_journey!==false){if(LBG.showMeOrientation.frameIsInjected===false){$(".showMeContainer").load(DI.showme.stubFileLocation+DI.showme.coreStubFile+DI.showme.stubFileExtension,function(){LBG.showMeOrientation.frameIsInjected=true;if($.inArray(current_journey,LBG.showMeOrientation.loadedStubs)===-1){existing_content=$(".showMeContainer #showMeOrientation .textContent").html();$(".showMeContainer #showMeOrientation .textContent").load(DI.showme.stubFileLocation+"showme_"+current_journey+DI.showme.stubFileExtension,function(){$(".showMeContainer #showMeOrientation .textContent").prepend(existing_content);$(".showMeContainer #showMeOrientation .textContent > div").css("display","none");LBG.showMeOrientation.loadedStubs.push(current_journey);LBG.showMeOrientation.invokeJourneyFromKey(current_journey);});}else{LBG.showMeOrientation.invokeJourneyFromKey(current_journey);}});}else{if($.inArray(current_journey,LBG.showMeOrientation.loadedStubs)===-1){existing_content=$(".showMeContainer #showMeOrientation .textContent").html();$(".showMeContainer #showMeOrientation .textContent").load(DI.showme.stubFileLocation+"showme_"+current_journey+DI.showme.stubFileExtension,function(){$(".showMeContainer #showMeOrientation .textContent").prepend(existing_content);$(".showMeContainer #showMeOrientation .textContent > div").css("display","none");LBG.showMeOrientation.loadedStubs.push(current_journey);LBG.showMeOrientation.invokeJourneyFromKey(current_journey);});}else{LBG.showMeOrientation.invokeJourneyFromKey(current_journey);}}}else{if(nudge!==false){if(LBG.showMeOrientation.frameIsInjected===false){$(".showMeContainer").load(DI.showme.stubFileLocation+DI.showme.coreStubFile+DI.showme.stubFileExtension,function(){LBG.showMeOrientation.frameIsInjected=true;existing_content=$(".showMeContainer #showMeOrientation .textContent").html();if($.inArray(nudge,LBG.showMeOrientation.loadedStubs)===-1){$(".showMeContainer #showMeOrientation .textContent").load(DI.showme.stubFileLocation+"showme_"+nudge+DI.showme.stubFileExtension,function(){$(".showMeContainer #showMeOrientation .textContent").prepend(existing_content);$(".showMeContainer #showMeOrientation .textContent > div").css("display","none");LBG.showMeOrientation.loadedStubs.push(nudge);LBG.showMeOrientation.invokeJourneyFromKey(nudge);});}else{LBG.showMeOrientation.invokeJourneyFromKey(nudge);}});}else{existing_content=$(".showMeContainer #showMeOrientation .textContent").html();if($.inArray(nudge,LBG.showMeOrientation.loadedStubs)===-1){$(".showMeContainer #showMeOrientation .textContent").load(DI.showme.stubFileLocation+"showme_"+nudge+DI.showme.stubFileExtension,function(){$(".showMeContainer #showMeOrientation .textContent").prepend(existing_content);$(".showMeContainer #showMeOrientation .textContent > div").css("display","none");LBG.showMeOrientation.loadedStubs.push(nudge);LBG.showMeOrientation.invokeJourneyFromKey(nudge);});}else{LBG.showMeOrientation.invokeJourneyFromKey(nudge);}}}else{$("#showMeOrientation").css("display","none");$("#showMeMask").removeClass("show");}}$("a.close").live("click",function(e){e.preventDefault();LBG.showMeOrientation.thisSlideNumber=0;LBG.showMeOrientation.isWelcomeMessage=false;LBG.showMeOrientation.removeCookie(LBG.showMeOrientation.journeyCookieName);LBG.showMeOrientation.collapseToShowMe();LBG.showMeOrientation.web_trends("close");});$("a.goNext").live("click",function(e){e.preventDefault();LBG.showMeOrientation.thisSlideNumber++;var thisAnchor=LBG.showMeOrientation.bubblesToShow[LBG.showMeOrientation.thisSlideNumber];var $currentStepNum=$("ul.steps li.current");var $nextStepNum=$("ul.steps li.current").next();$currentStepNum.removeClass("current");$nextStepNum.addClass("current");if(LBG.showMeOrientation.thisSlideNumber===(LBG.showMeOrientation.bubblesToShow.length+2)){LBG.showMeOrientation.thisSlideNumber=0;$(".restart").removeClass("restart");LBG.showMeOrientation.removeCookie(LBG.showMeOrientation.journeyCookieName);LBG.showMeOrientation.collapseToShowMe();}else{LBG.showMeOrientation.match_anchors_to_functions(thisAnchor);}});$("a.goPrev").live("click",function(e){e.preventDefault();LBG.showMeOrientation.thisSlideNumber--;var thisAnchor=LBG.showMeOrientation.bubblesToShow[LBG.showMeOrientation.thisSlideNumber];var $totalSteps=$("ul.steps li").length;var $currentStepNum=$("ul.steps li.current");var $prevStepNum=$("ul.steps li.current").prev();$currentStepNum.removeClass("current");$prevStepNum.addClass("current");if(LBG.showMeOrientation.thisSlideNumber===-1){$("#showMeMask").removeClass("show");LBG.showMeOrientation.thisSlideNumber=0;LBG.showMeOrientation.removeCookie(LBG.showMeOrientation.journeyCookieName);LBG.showMeOrientation.collapseToShowMe();}else{if($(this).hasClass("restart")){LBG.showMeOrientation.welcomeSlide();}else{LBG.showMeOrientation.match_anchors_to_functions(thisAnchor);}}});$("#showMeOrientation .showMeSupport a").live("click",function(e){e.preventDefault();var $cligged=$(this);if(LBG.showMeOrientation.frameIsInjected===false){$(".showMeContainer").load(DI.showme.stubFileLocation+DI.showme.coreStubFile+DI.showme.stubFileExtension,function(){LBG.showMeOrientation.frameIsInjected=true;LBG.showMeOrientation.showMeSupportClicks($cligged);});}else{LBG.showMeOrientation.showMeSupportClicks($cligged);}});$("a.showMeSupportLinkShowMeAnchor").live("click",function(e){e.preventDefault();LBG.showMeOrientation.thisSlideNumber=0;LBG.showMeOrientation.isWelcomeMessage=false;var node=e?$(e.target):$(window.event.srcElement);var metadata=node.metadata();var nodename=node.nodeName;var pointer="right";if(metadata.hasOwnProperty("pointer")){pointer=metadata.pointer;}var topPositionOffset=0;if(metadata.hasOwnProperty("topPositionOffset")){topPositionOffset=metadata.topPositionOffset;}var leftPositionOffset=0;if(metadata.hasOwnProperty("leftPositionOffset")){leftPositionOffset=metadata.leftPositionOffset;}var existing_contents="";if(LBG.showMeOrientation.frameIsInjected===false){$(".showMeContainer").load(DI.showme.stubFileLocation+DI.showme.coreStubFile+DI.showme.stubFileExtension,function(){LBG.showMeOrientation.frameIsInjected=true;existing_contents=$(".showMeContainer #showMeOrientation .textContent").html();if($.inArray(DI.showme.menuStubFile,LBG.showMeOrientation.loadedStubs)===-1){$(".showMeContainer #showMeOrientation .textContent").load(DI.showme.menuStubFile,function(){$("#showMeOrientation .bubbleControls").css("display","none");$(".showMeContainer #showMeOrientation .textContent").prepend(existing_contents);$(".showMeContainer #showMeOrientation .textContent > div").css("display","none");LBG.showMeOrientation.loadedStubs.push(DI.showme.menuStubFile);LBG.showMeOrientation.showBubble("showMeSupport","showMeSupportLinkShowMeAnchor",pointer,topPositionOffset,leftPositionOffset);});}else{$("#showMeOrientation .bubbleControls").css("display","none");LBG.showMeOrientation.showBubble("showMeSupport","showMeSupportLinkShowMeAnchor",pointer,topPositionOffset,leftPositionOffset);}});}else{existing_contents=$(".showMeContainer #showMeOrientation .textContent").html();
if($.inArray(DI.showme.menuStubFile,LBG.showMeOrientation.loadedStubs)===-1){$(".showMeContainer #showMeOrientation .textContent").load(DI.showme.menuStubFile,function(){$("#showMeOrientation .bubbleControls").css("display","none");$(".showMeContainer #showMeOrientation .textContent").prepend(existing_contents);$(".showMeContainer #showMeOrientation .textContent > div").css("display","none");LBG.showMeOrientation.loadedStubs.push(DI.showme.menuStubFile);LBG.showMeOrientation.showBubble("showMeSupport","showMeSupportLinkShowMeAnchor",pointer,topPositionOffset,leftPositionOffset);});}else{$("#showMeOrientation .bubbleControls").css("display","none");LBG.showMeOrientation.showBubble("showMeSupport","showMeSupportLinkShowMeAnchor",pointer,topPositionOffset,leftPositionOffset);}}LBG.showMeOrientation.hide_all_bubble_arrows();$("#showMeOrientation img.pointRight").css("display","block");$(".showMeSupport ul li").focus();LBG.showMeOrientation.web_trends("show_me_menu");});document.onmousedown=function(evt){var $clicked_thing=evt?$(evt.target):$(window.event.srcElement);var cookie_running=LBG.showMeOrientation.getCookie(LBG.showMeOrientation.journeyCookieName);if($clicked_thing.hasClass("backToAccountsAnchor")){var sameJourney=LBG.showMeOrientation.isCurrentJourneyInTheShowMeMetadata();if(sameJourney===true){var current_journey=LBG.showMeOrientation.getCookie(LBG.showMeOrientation.journeyCookieName);var metadata=$(".showMeContainer").metadata();var journey_arrays=metadata.journeyKeys.split(";");var i;var classes;var classCount=0;var killCookie=true;for(i=0;i<journey_arrays.length;i++){var kee=journey_arrays[i].split(":");if(kee[0]===current_journey){classes=kee[1].split(",");for(var j=0;j<classes.length;j++){var currentClass="."+classes[j];classCount+=$(currentClass).length;}}}if(classCount===0){killCookie=false;}if(killCookie){LBG.showMeOrientation.collapseToShowMe();LBG.showMeOrientation.removeCookie(LBG.showMeOrientation.journeyCookieName);}else{killCookie=true;LBG.showMeOrientation.collapseToShowMe();}}}else{if(($clicked_thing.hasClass(cookie_running))||($clicked_thing.parents("a").hasClass(cookie_running))){}else{if($clicked_thing.parents(".showMeContainer").length>0){}else{if(($clicked_thing.hasClass("showMeSupportLinkShowMeAnchor"))||($clicked_thing.parents("a").hasClass("showMeSupportLinkShowMeAnchor"))){}else{if(($clicked_thing.parents().hasClass("retainCookieSetup"))){if($("#showMeOrientation").is(":visible")){LBG.showMeOrientation.collapseToShowMe();}}else{var tagType=$clicked_thing.attr("tagName");var parentType=$clicked_thing.parent().attr("tagName");var exceptions=["A"];if(($.inArray(tagType,exceptions)!==-1)||($.inArray(parentType,exceptions)!==-1)){LBG.showMeOrientation.removeCookie(LBG.showMeOrientation.journeyCookieName);LBG.showMeOrientation.thisSlideNumber=0;if($("#showMeOrientation").is(":visible")){LBG.showMeOrientation.collapseToShowMe();}}}}}}}};if($(LBG.showMeOrientation.forceJourneyEnd).length>0){LBG.showMeOrientation.removeCookie(LBG.showMeOrientation.journeyCookieName);}}else{LBG.showMeOrientation.removeCookie(LBG.showMeOrientation.journeyCookieName);}}};LBG.iadaUtilities={parameters:{ajaxUserNameCheckSelector:"input[class*=ajaxUserNameCheck]:first",focusOnSuccess:"#passwordField"},addAnimation:function(){var $loaderAnimation=$("<div/>").append("<span class='loading' />&nbsp;"+DI.lang.ajaxLoader.waitMessage);$("input[class*=ajaxUserNameCheck]:first").after($loaderAnimation);},removeAnimation:function(){$("span.loading").parent("div").remove();},ajaxUserNameCheck:function(){var $ajaxUserNameCheck=$(LBG.iadaUtilities.parameters.ajaxUserNameCheckSelector);if($ajaxUserNameCheck.parents(".error").length){return false;}var classSelector=$ajaxUserNameCheck.attr("class").split(" ");jsonURLSelector="url";var v=classSelector;for(var i=0;i<v.length;i++){var test=v[i].search(/ajaxUserNameCheck/);if(test){classSelector.splice(i,1);classSelector=classSelector[0].replace("ajaxUserNameCheck","url");}}LBG.iadaUtilities.removeSuggestions();var jsonURL=DI.iada.userName[classSelector]+"?userName="+$ajaxUserNameCheck.val()+"&_"+new Date().getTime();LBG.iadaUtilities.addAnimation();$.getJSON(jsonURL,function(data){LBG.iadaUtilities.removeAnimation();if(data.userName.length>0){var $suggestionsText=$("<p class='userNameSuggestions note informational'/>"),$suggestions=$("<ul class='userNameSuggestionsList note informational' />");if($ajaxUserNameCheck.next().hasClass("note")){$ajaxUserNameCheck.next().css("display","none");}$(data.userName).each(function(index){var $li=$('<li><a href="#"></a></li>');$("a",$li).text(data.userName[index]);$suggestions.append($li);});$suggestionsText.append(data.displayText);$("input[class*=ajaxUserNameCheck]:first").after($suggestionsText);$(".userNameSuggestions:first").after($suggestions);var h=$(".userNameSuggestionsList").height();$(".userNameSuggestionsList").css("height",h);}else{return true;}});},removeSuggestions:function(){$(".userNameSuggestions, .userNameSuggestionsList").remove();$(".iada p:hidden").css("display","block");},deleteFormContent:function(){LBG.iadaUtilities.removeSuggestions();$(this).val("");},listeners:function(){$("input[class*=ajaxUserNameCheck]").blur(this.ajaxUserNameCheck);$("input[class*=ajaxUserNameCheck]").focus(function(){LBG.iadaUtilities.removeSuggestions();$(this).val("");});$(".userNameSuggestionsList a").live("click",function(e){e.preventDefault();$(this).find(":hidden").css("display","block");var $this=$(e.target);$("input[class*=ajaxUserNameCheck]:first").val($this.text());LBG.iadaUtilities.removeSuggestions();$(this).val("");if(LBG.iadaUtilities.parameters.focusOnSuccess){$(LBG.iadaUtilities.parameters.focusOnSuccess).focus();}return false;});$('.iada input[name="applyForISA"]').click(function(){if($(this).val()==="yes"){$(".conditionalFields").show("slow");}else{$(".conditionalFields").hide("slow");}});},init:function(){this.listeners();}};LBG.selectReference=(function(initSelector,textSelector,dropDownSelector){var setup=function($formField){$(dropDownSelector,$formField).change(function(){var $input=$(this).parents(initSelector).parent().find(textSelector),$option=$("option:selected",this),metadata=$option.metadata(),$refhelp=$(this).parents(initSelector).nextAll(".showHide").eq(0);if(typeof metadata==="undefined"||!$input.length){return;}if($option.attr("disabled")){metadata.reference="";}$input.val(metadata.reference);if(metadata.reference){$refhelp.show();}else{$refhelp.hide();$input.removeAttr("disabled","disabled").removeClass("isDisabled");}if(metadata.hide){$(metadata.hide).hide();}});};return{init:function(){$(initSelector).each(function(){setup($(this));$(dropDownSelector,this).trigger("change");});}};});LBG.beneficaryReference=(function(){return LBG.selectReference(".formField.beneficaryReference",".formField.beneficaryReferenceLinkedTextField input:text","select.existingPayee");})();LBG.isaTopUpReference=(function(){return LBG.selectReference(".formField.isaTopUpReference","div.dcfModule","select.isaTopUpAccount");})();LBG.multichannel={selectChipAndPinValue:function(){var selectedVal=$('fieldset.multichannel input[type="radio"]:checked').val();if($('fieldset.multichannel input[name$="confirmCheckboxTelephony"]').size()!=0){$('fieldset.multichannel input[name$="confirmCheckboxTelephony"]').attr("checked",false);}if(selectedVal==="available"){$("fieldset.multichannel .chipAndPinAvailableInfo").show();$("fieldset.multichannel .chipAndPinUnavailableInfo").hide();$("fieldset.multichannel .chipAndPinSelected").val("available");
}else{$("fieldset.multichannel .chipAndPinUnavailableInfo").show();$("fieldset.multichannel .chipAndPinAvailableInfo").hide();$('fieldset.multichannel .chipAndPinUnavailableInfo input[type="checkbox"]').attr("checked",false);$("fieldset.multichannel .chipAndPinSelected").val("unavailable");}},selectReasonForWaiver:function(){if($(".content dl.summary .descriptionGroup").find(":checkbox").attr("checked")===true){$(".content dl.summary .descriptionGroup select").attr("disabled",false);}else{$(".content dl.summary .descriptionGroup select").attr("disabled",true);$(".content fieldset.select_account select").attr("disabled",false);}var totalCostVal=$(".content dl.summary .descriptionGroup em").text();$(".content dl.summary .descriptionGroup").find(":checkbox").click(function(){if($(this).attr("checked")===true){$(".content dl.summary .descriptionGroup select").attr("disabled",false);}else{$(".content dl.summary .descriptionGroup select").attr("disabled",true);$(".content dl.summary .descriptionGroup select").val("-");$(".content dl.summary .descriptionGroup em").text(totalCostVal);$(".content fieldset.select_account select").attr("disabled",false);}});},updateTotalCosts:function(){var totalCostVal=$(".content dl.summary .descriptionGroup em").text();$(".content dl.summary .descriptionGroup select").change(function(){if($(this).val()!="-"){$(".content dl.summary .descriptionGroup em").text("0");$(".content fieldset.select_account select").attr("disabled","true");}else{$(".content dl.summary .descriptionGroup em").text(totalCostVal);$(".content fieldset.select_account select").attr("disabled",false);}});},showReasonText:function(){$(".content .manageAuthPassword,.content .manageAuthDomain").hide();$(".content p.manageAuthReasonLabel,.content .manageAuthReasonText").hide();if($(".content .manageAuthReasonText").siblings(".error").length>0){$(".content .manageAuthReasonText").siblings(".error").remove();}if($(".content .manageAuthReasonText").parent().parent().hasClass(".error")===true){$(".content .manageAuthReasonText").parent().parent().removeClass("error");}var selectedRadioval=$(".content .formField.stackedField .radioGroup.managerAuthGroup").find(":radio:checked").val();if(selectedRadioval==="1"){$(".content p.manageAuthReasonLabel, .content .manageAuthReasonText").hide();}else{$(".content p.manageAuthReasonLabel, .content .manageAuthReasonText").show();}$(".content .formField.stackedField .radioGroup.managerAuthGroup").find(":radio").click(function(){if($(this).val()==="2"){$(".content p.manageAuthReasonLabel, .content .manageAuthReasonText").show();$(".content .manageAuthPassword").show();$(".content .manageAuthDomain").show();$(".content .manageAuthPasswordRequired").hide();$(".content .manageAuthDomainRequired").hide();}else{if($(".content .manageAuthReasonText").siblings(".error").length>0){$(".content .manageAuthReasonText").siblings(".error").remove();}if($(".content .manageAuthReasonText").parent().parent().hasClass(".error")===true){$(".content .manageAuthReasonText").parent().parent().removeClass("error");}$(".content p.manageAuthReasonLabel, .content .manageAuthReasonText").hide();$(".content .manageAuthPassword").hide();$(".content .manageAuthDomain").hide();$(".content .manageAuthPasswordRequired").show();$(".content .manageAuthDomainRequired").show();}});},init:function(){LBG.multichannel.selectChipAndPinValue();LBG.multichannel.selectReasonForWaiver();LBG.multichannel.updateTotalCosts();LBG.multichannel.showReasonText();$('fieldset.multichannel input[type="radio"]').click(function(){LBG.multichannel.selectChipAndPinValue();});$("fieldset.multichannel #initiateChipAndPin").click(function(event){event.preventDefault();event.stopPropagation();try{var AGCI=new ActiveXObject("AGCI.functionCall");}catch(e){}var temp=[],alias="PEDIDV",data="<root><data>PEDIDV</data></root>";if(AGCI){var responseObject=AGCI.doFunction(alias,data,temp);if(responseObject){$("fieldset.multichannel #chipAndPinRespPBS").val(responseObject);}}});}};LBG.fatcaNationality=(function(){var initSelector="fieldset.fatcaNationality .nationalityContext",legacyInitSelector="fieldset.fatcaNationality",addSelector="div.addNationality",nationalitySelector="div.formField.nationality";var checkLimit=function($wrapper){var $formFields=$wrapper.find(nationalitySelector),$addWrapper=$wrapper.find(addSelector);if($formFields.filter(":visible").length!==$formFields.length){$addWrapper.show();}else{$addWrapper.hide();}};var updateLabel=function($formField){$formField.find("label").each(function(){var meta=$(this).metadata();if(typeof meta.altLabel==="string"){$(this).html(meta.altLabel);}});};var setup=function($wrapper){var $formFields=$wrapper.find(nationalitySelector),$addWrapper=$wrapper.find(addSelector),$selects=$formFields.find("select"),$sudoButtons=$formFields.find("ul.sudoButtons");$formFields.each(function(i){var $select=$(this).find("select");var threshold=1;if($wrapper.hasClass("taxResidencies")){threshold--;}$select.data("options",$select.find("option"));updateLabel($(this));if($select.val()==="-"&&i>threshold){$(this).hide();}});$selects.each(function(){var formField=$(this).parents(".formField");$(this).change(function(){var vals=$selects.map(function(){return $.trim($(this).val());});if("-"!==$.trim($(this).val())){formField.removeClass("error").find("span.error").remove();}$selects.each(function(){$("span",this).each(function(){if(-1===$.inArray($.trim($(this).attr("data-val")),vals)){var option=$("<option/>").val($(this).attr("data-val")).text($(this).text());$(this).before(option).remove();}});var pIndex=this.selectedIndex;$("option",this).filter(function(){if(pIndex==this.index){return false;}var myval=$.trim(this.value);return -1!==$.inArray(myval,vals)&&"-"!==myval;}).each(function(){var clone=$("<span/>").attr("data-val",$(this).val()).text($(this).text());$(this).before(clone).remove();});});});});setTimeout(function(){$selects.change();},0);$sudoButtons.find("input").click(function(e){var ctx=$(this).parents(legacyInitSelector);var idx=$("input.pseudoLink",ctx).index(this);var me=ctx.find(nationalitySelector).eq(idx+(ctx.is(".taxResidencies")?0:1));if(me.nextAll(nationalitySelector+":visible").length<1){$("option:selected",this).removeAttr("selected");ctx.find(nationalitySelector).eq(1).hide();}me.nextAll(nationalitySelector+":visible").each(function(){var next=$(this).next(nationalitySelector+":visible");if(next.length>0&&next.is(":visible")){var opt=document.createElement("option");opt.value=$("select",next).val();opt.text=$("select",next).find("option:selected").text();var optindex=$("select",next).find("option:selected")[0].index;$("select",this)[0].add(opt);$("select",this).val(opt.value);$("select",this).html($("select option",this).sort(function(a,b){return a.text==b.text?0:a.text<b.text?-1:1;}));}else{$("option:selected",this).removeAttr("selected");$(this).hide();}});$(nationalitySelector+" select:not(:visible)",ctx).val("-").change();checkLimit($wrapper);e.preventDefault();});checkLimit($wrapper);$addWrapper.find("a").click(function(e){e.preventDefault();var $visible=$formFields.filter(":visible");var index=$formFields.index($visible[$visible.length-1]);var validationHandler;var fieldInvalid=false;var blnRequiredValidationAddedDynamically=false;$visible.each(function(i){var $current=$($visible[i]);if($current.find("select option:selected").val()==="-"){validationHandler=LBG.Forms.Validation.Tools.getFieldHandler($current);if(!validationHandler.validationRoutines.required){blnRequiredValidationAddedDynamically=true;
validationHandler.validationRoutines.push("required");validationHandler.validationRoutines.required={msg:"validateSelect"};}validationHandler.validate();if(blnRequiredValidationAddedDynamically){delete validationHandler.validationRoutines.required;validationHandler.validationRoutines.splice($.inArray("required",validationHandler.validationRoutines),1);}fieldInvalid=true;}});if(fieldInvalid){return false;}$formFields.eq(index+1).find('option[value="-"]').attr("selected","selected");$formFields.eq(index+1).show();checkLimit($wrapper);});};return{init:function(){$initElements=$(initSelector);if(!$initElements.length){$initElements=$(legacyInitSelector);}$initElements.each(function(){setup($(this));});}};})();LBG.appointmentBookings={init:function(){if($(".appointment-booker").length>0){LBG.appointmentBookings.page_load_setup();$(".appointment-booker tbody th a").click(function(e){e.preventDefault();if($(this).hasClass("closed")){$(this).removeClass("closed");$(this).parents("tr").find("td span").slideDown("slow");}else{$(this).addClass("closed");$(this).parents("tr").find("td span").slideUp("slow");}});$(".appointment-booker tbody td a").click(function(e){e.preventDefault();$(".appointment-booker tbody td a").removeClass("selected");$(this).addClass("selected");$(this).parents(".appointment-booker tr td").find("input[type=radio]").attr("checked","checked");target_val=$(this).attr("href").substr(1);$(".appointment_booger_radio_conglomerate").val(target_val);});}},page_load_setup:function(){if($(".appointment-booker tbody tr th a").length>0){$(".appointment-booker tbody tr td").wrapInner("<span />");$(".appointment-booker tbody tr td span").hide();$(".appointment-booker tbody tr").eq(0).find("td span").show();$(".appointment-booker tbody tr th a").addClass("closed");$(".appointment-booker tbody tr").eq(0).find("th a").removeClass("closed");}$(".appointment-booker tbody tr td label").each(function(){var labeltxt=$(this).html();var is_radio_selected=$(this).parents("td").find("input[type=radio]").is(":checked");if(is_radio_selected){$('<a href="#" class="selected">'+labeltxt+"</a>").insertBefore(this);}else{$('<a href="#">'+labeltxt+"</a>").insertBefore(this);}});$(".appointment-booker tbody tr td input:radio").hide();$(".appointment-booker tbody tr td label").hide();}},LBG.oabShowHidePropertyBox={init:function(){if($(".oabPropertyField").length>0){LBG.oabShowHidePropertyBox.show_hide_property_box();$(".oabMoneyField select").change(function(){LBG.oabShowHidePropertyBox.show_hide_property_box();});}},show_hide_property_box:function(){if($(".oabMoneyField select option:selected").hasClass("showPropertyBox")){$(".oabPropertyField").show();}else{$(".oabPropertyField").hide();}}},LBG.oabShowHideEmailPhoneReminderBoxes={init:function(){LBG.oabShowHideEmailPhoneReminderBoxes.showhide_email();$(".oab .formField.oabEmailReminder input").blur(function(){LBG.oabShowHideEmailPhoneReminderBoxes.showhide_email();});LBG.oabShowHideEmailPhoneReminderBoxes.showhide_sms();$(".oab .formField.oabSMSReminder input").blur(function(){LBG.oabShowHideEmailPhoneReminderBoxes.showhide_sms();});},showhide_email:function(){var emailReminderField=$(".oab .formField.oabEmailReminder input").val();if(($.trim(emailReminderField).length>0)&&(!$(".oab .formField.oabEmailReminder").hasClass("error"))){$(".oab .linkedTooabEmailReminder").show();}else{$(".oab .linkedTooabEmailReminder input:checkbox").attr("checked",false);$(".oab .linkedTooabEmailReminder").hide();}},showhide_sms:function(){var phoneReminderField=$(".oab .formField.oabSMSReminder input").val();if(($.trim(phoneReminderField).length>0)&&(!$(".oab .formField.oabSMSReminder").hasClass("error"))&&(LBG.oabShowHideEmailPhoneReminderBoxes.is_mobile_number(phoneReminderField)===true)){$(".oab .linkedTooabSMSReminder").show();}else{$(".oab .linkedTooabSMSReminder input:checkbox").attr("checked",false);$(".oab .linkedTooabSMSReminder").hide();}},is_mobile_number:function(phone_number){var mob=false;if(phone_number.substring(0,2)=="07"){mob=true;}if(phone_number.substring(0,3)=="447"){mob=true;}return mob;}},LBG.oabSearchSelectBranchBoxes={init:function(){var searchBranchBox=$(".selectBranch .colPart:eq(0) .subPanel");var selectedBranchBox=$(".findBranch .colPart:eq(1) .subPanel");if(searchBranchBox.height()>selectedBranchBox.height()){selectedBranchBox.height(searchBranchBox.height());}else{searchBranchBox.height(selectedBranchBox.height());}}},LBG.vefTable={z_index_fixed:false,init:function(){if($(".ajax_loaded_vef_debit_transactions_table").length>0){var isCreditCard=false;var tansactionURL=DI.vef.transactions;$(".vef-get-content a").click(function(){isCreditCard=$(this).parent().hasClass("creditcard");console.log("isCredit? = "+isCreditCard);if(isCreditCard){tansactionURL=DI.vef.creditCardTransactions;}console.log("tansactionURL = "+tansactionURL);$(".ajax_loaded_vef_debit_transactions_table").load(tansactionURL+"?_"+new Date().getTime(),function(){if(typeof dcsMultiTrack!="undefined"){if(!isCreditCard){dcsMultiTrack("WT.ac","modules/m342/properties.pm342lnk503c,modules/m342/properties.pm342lnk503a,Pending debit card transactions and uncleared cheques");}else{dcsMultiTrack("WT.ac","modules/m342/properties.pm342lnk503c,modules/m342/properties.pm342lnk503a,Pending credit card transactions");}}$(".vefTable").each(function(index){var $thisVefTable=$(this);var vefmeta=$thisVefTable.metadata();var onLoadThisManyRows=vefmeta.num_rows_to_load||10;var vefTableRowCount=$("tbody tr",$thisVefTable).length;if(vefTableRowCount>onLoadThisManyRows){$("tbody",$thisVefTable).addClass("startHidden").css("display","none");$("thead",$thisVefTable).after('<tbody class="first"></tbody>');$("tbody tr",$thisVefTable).each(function(index){if(index<onLoadThisManyRows){$("tbody.first",$thisVefTable).append($(this).clone());$(this).remove();}});var numCols=$("thead tr th",$thisVefTable).length;$("tbody.startHidden",$thisVefTable).before('<tbody><tr><td colspan="'+numCols+'" class="first centerAlignContent"><a href="#" class="showMoreRows">See all</a></td></tr></tbody>');$("tbody.startHidden",$thisVefTable).after('<tbody style="display:none"><tr><td colspan="'+numCols+'" class="first centerAlignContent"><a href="#" class="hideMoreRows">Hide</a></td></tr></tbody>');}});$("a.showMoreRows").click(function(e){e.preventDefault();$(this).parents(".vefTable").find("tbody.startHidden").toggle();$(this).parents("tbody").fadeOut("slow");$(this).parents(".vefTable").find("a.hideMoreRows").parents("tbody").fadeIn("slow");});$("a.hideMoreRows").click(function(e){e.preventDefault();$(this).parents(".vefTable").find("tbody.startHidden").toggle();$(this).parents("tbody").fadeOut("slow");$(this).parents(".vefTable").find("a.showMoreRows").parents("tbody").fadeIn("slow");});LBG.vefTable.bobbers_zindex_fix();});});}},bobbers_zindex_fix:function(){if(!LBG.vefTable.z_index_fixed&&($.browser.msie&&$.browser.version<8)){if($(".ajax_loaded_vef_debit_transactions_table").length>0){$("div.secondary .subPanel .pane").css({"z-index":1,"position":"static"});}}}},LBG.travelFlags={init:function(){$(".addNewTravelFlagPanel").hide();$("form.changeTravelFlag").hide();$(".addNewTravelFlagButton").click(function(e){e.preventDefault();$(".addNewTravelFlagButton").slideUp("slow");$(".addNewTravelFlagPanel").slideDown("slow");});$(".addNewTravelFlagPanel .cancelTravel").click(function(e){e.preventDefault();$(".addNewTravelFlagPanel").slideUp("slow");$(".addNewTravelFlagButton").slideDown("slow");});$(".changeTravelFlagButton").click(function(e){e.preventDefault();
$(this).parents(".travelFlagPanel").find("form.changeTravelFlag").slideDown();});$("form.changeTravelFlag .cancelTravel").click(function(e){e.preventDefault();$(this).parents("form.changeTravelFlag").slideUp();});$(".countrySearchTxt").keydown(function(e){if(e.keyCode===40){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();var resGrp=$(".countryLookupResults .resultsGroup");if(resGrp&&resGrp.length>0){resGrp[0].children[0].children[0].focus();}}});}},LBG.jsPrintButton={init:function(){$(".jsPrintButton").css("display","block");$(".jsPrintButton").parents("ul.printactions").css("position","static").css("position","absolute");}},LBG.loanServicing={init:function(){$(".loanServicing .loadHidden").hide();if($(".loanServicing .showHiddenIfChecked").is(":checked")){$(".loanServicing .loadHidden").show();}}},LBG.LinkDropDownToToolTip_Hrefs={init:function(){if($("select.LinkToolTips").length>0){$("select.LinkToolTips").change(function(){LBG.LinkDropDownToToolTip_Hrefs.populateTooltip();}).change();}},populateTooltip:function(){var dd_meta=$("select.LinkToolTips").metadata();var linked_tip_class=dd_meta.tooltipclass;var option_meta=$("select.LinkToolTips").find(":selected").metadata();var option_tipref=option_meta.tooltip_ref;$("."+linked_tip_class).attr("href","#"+option_tipref);}},LBG.avaRadioButtons={init:function(){$(".avaSuitabilityCheck .avaSuitabilitySectionOne input:radio").each(function(){var label=$("label[for="+'"'+this.id+'"'+"]").text();var checked=$(this).attr("checked");var radioStatus=checked?"radio-checked":"radio";var radioButton=$('<a title=" '+$.trim(label)+' " class="avaRadioBtn '+this.name+'" href="#"><span class="'+radioStatus+'"></span></a>');radioButton.insertAfter(this);});$(".avaSuitabilityCheck .avaSuitabilitySectionOne .avaRadioBtn").click(function(e){var $check=$(this).prev("input:radio");var unique="."+this.className.split(" ")[1]+" span";unique=unique.replace(/:/g,"\\:");$(unique).attr("class","radio");$(this).find("span").attr("class","radio-checked");$check.attr("checked",true);if($(this).parents("tr").hasClass("error")){$check.trigger("click");}return false;});$(".avaSuitabilityCheck .avaSuitabilitySectionOne .disabled .avaRadioBtn").click(function(){$(this).find("span").attr("class","radio");return false;});}};LBG.ajaxPoweredBankFinder=(function(){var initSelector="div.bankFinder",isFilterResults=DI.lang.bankFinder.isFilterResults,bankNameSpecialChars=LBG.Forms.Validation.Expressions.bankNameSpecialChars,bankFinderURL=DI.lang.bankFinder.bankFinderURL,dataURL=DI.lang.bankFinder.bankData,addressDataURL=DI.lang.bankFinder.bankAddressData,loadingData=false,ajaxResultsSelector="div.ajaxPoweredBankFinderResults",$elementsForAjaxResponseInjection,resultsTemplateURL=DI.lang.bankFinder.bankResults,resultsTemplate,bankNoResultsText=DI.lang.bankFinder.bankNoResultsText,radioGroupSelector="div.radioGroup",$radioGroupTemplate,resultsArr=[],inputTextBoxSelector="input.bankSearchTxt",bankInputDefaultText=DI.lang.bankFinder.bankNameInputText,isPagedResults=DI.lang.bankFinder.isPagedResults,numSearchItemsToDisplay=DI.lang.bankFinder.numSearchItemsToDisplay,numBrowseItemsToDisplay=DI.lang.bankFinder.numBrowseItemsToDisplay,numItemsToDisplay,pagingSelector="fieldset ul.paginationSudoButtons",previousImgEnabled=DI.lang.bankFinder.previousImgEnabled,previousImgDisabled=DI.lang.bankFinder.previousImgDisabled,nextImgEnabled=DI.lang.bankFinder.nextImgEnabled,nextImgDisabled=DI.lang.bankFinder.nextImgDisabled,$previousLink,$nextLink,$tabSearch,$tabBrowse,resetBrowseSubTabs=true,currentPage=1,numPages=0,tabCache;var setup=function($wrapper){$elementsForAjaxResponseInjection=$wrapper.find(ajaxResultsSelector);if($elementsForAjaxResponseInjection.length===0){return false;}$("li.primaryAction a.submitAction",initSelector).addClass("disabled");if($wrapper.find("div.searchBank").length>0){var $bankInputBox=$wrapper.find(inputTextBoxSelector);$bankInputBox.attr("defaultVal",bankInputDefaultText);$bankInputBox.val(bankInputDefaultText);$bankInputBox.addClass("bgColor");$bankInputBox.focus(function(){bankInputFocusHandler($bankInputBox);});$bankInputBox.blur(function(){bankInputBlurHandler($bankInputBox);});$bankInputBox.bind("keyup",function(){if($bankInputBox.val().length>=3&&$bankInputBox.val().substring(0,3)!=="   "){$("div.formSubmitError",initSelector).remove();$($bankInputBox).closest("div.error").removeClass("error").find("span.error").remove();getJsonResults($bankInputBox.val(),null,null,null,null);}else{$(ajaxResultsSelector,initSelector).closest(".formField").removeClass("error").find("span.error").remove();$(ajaxResultsSelector,initSelector).empty();$(pagingSelector,initSelector).hide();$("li.primaryAction a.submitAction",initSelector).addClass("disabled");}});}$.get(resultsTemplateURL,function(data){resultsTemplate=data;$radioGroupTemplate=$(resultsTemplate).find(radioGroupSelector);if($wrapper.find("div.browseBank.active").length>0){setBankBrowseLinks($wrapper);}},"html");$previousLink=$wrapper.find(pagingSelector).find("li.previous a.pseudoLink");$nextLink=$wrapper.find(pagingSelector).find("li.next a.pseudoLink");$tabSearch=$("ul.tabs li a.tabSearch",initSelector);$tabBrowse=$("ul.tabs li a.tabBrowse",initSelector);tabCache=$("ul.subTabs").clone();$tabBrowse.live("click",function(e){e.preventDefault();$("ul.subTabs").before(tabCache.clone()).remove();$(".searchBank").removeClass("active").addClass("hide");$(".browseBank").removeClass("hide").addClass("active");setBankBrowseLinks($wrapper);});$tabSearch.live("click",function(e){e.preventDefault();$(".browseBank").removeClass("active").addClass("hide");$(".searchBank").removeClass("hide").addClass("active");clearForm();});if(isPagedResults){setPagingLinks();if(resultsArr.length===0){$wrapper.find(pagingSelector).hide();}}else{$wrapper.find(pagingSelector).hide();}$(".radioGroup input").live("click",function(){var radioSelected=$(".radioGroup input:checked").length;$("li.primaryAction a.submitAction",initSelector).addClass("disabled");if(radioSelected>0){$("div.formSubmitError",initSelector).remove();$("span.error",initSelector).remove();$("div.formField.error",initSelector).removeClass("error");$("li.primaryAction a.submitAction",initSelector).removeClass("disabled");}});$(initSelector+" form").submit(function(e){var radioSelected,radioSelectedValue;e.preventDefault();radioSelected=$(".radioGroup input:checked").length;if(radioSelected>0){radioSelectedValue=$(".radioGroup input:checked").val();processSmartSearchResult(radioSelectedValue);}else{return false;}});$(initSelector+" .submitAction").live("click",function(e){var radioSelected,radioSelectedValue;if(3===e.which){return;}e.preventDefault();radioSelected=$(".radioGroup input:checked").length;if(radioSelected>0){radioSelectedValue=$(".radioGroup input:checked").val();processSmartSearchResult(radioSelectedValue);}else{return false;}});$(initSelector+" a.searchAgainLink").live("click",function(e){e.preventDefault();$.ajax({type:"GET",url:bankFinderURL,cache:false,data:{searchAgain:"true"}});$(".bankFinderConfirmation",initSelector).addClass("hide");$(".searchBank",initSelector).removeClass("hide").addClass("active");clearForm();});$previousLink.live("click",function(e){if($previousLink.is(".disabled")||3===e.which){return;}$("li.primaryAction a.submitAction",initSelector).addClass("disabled");e.preventDefault();currentPage-=1;displayResults();setPagingLinks();});$nextLink.live("click",function(e){if($nextLink.is(".disabled")||3===e.which){return;
}$("li.primaryAction a.submitAction",initSelector).addClass("disabled");e.preventDefault();currentPage+=1;displayResults();setPagingLinks();});},processSmartSearchResult=function(smartSearchResult){var addressDataURLBase=addressDataURL;addressDataURL+="?selectedOption="+encodeURIComponent(smartSearchResult);$(".searchBank",initSelector).addClass("hide");$(".browseBank",initSelector).addClass("hide");$(initSelector+" .isaProviderConfirmation").empty();$.ajax({type:"GET",url:addressDataURL,cache:false,dataType:"json",success:function(data){var t=buildTemplate(data);$(initSelector+" .isaProviderConfirmation").append(t);},error:function(data){$(initSelector+" .isaProviderConfirmation").append("<h3>An error occurred. Please try again</h3>");}});addressDataURL=addressDataURLBase;$(".bankFinderConfirmation",initSelector).removeClass("hide");},clearForm=function(){$(ajaxResultsSelector,initSelector).empty();$("form input",initSelector).each(function(){var inputType=$(this).attr("type");if(inputType==="text"){$(this).val("");}else{if(inputType==="radio"){$(this).attr("checked",false);}}});$("div.formSubmitError",initSelector).remove();$("span.error",initSelector).remove();$("div.formField.error",initSelector).removeClass("error");$(inputTextBoxSelector,initSelector).val(bankInputDefaultText).addClass("bgColor");$(pagingSelector,initSelector).hide();$("li.primaryAction a.submitAction",initSelector).addClass("disabled");},buildTemplate=function(data){var template="";if(data.bankSunData.length>0){for(var key in data){var obj=data[key];for(var prop in obj){template+="<h3>Your existing Cash ISA provider</h3>";template+="<p>"+obj[prop].Provider+"</p>";template+="<h3>Your existing Cash ISA provider's address</h3>";template+="<p>"+obj[prop].Address1+"<br>";template+=obj[prop].hasOwnProperty("Address2")?obj[prop].Address2+"<br>":"";template+=obj[prop].hasOwnProperty("Address3")?obj[prop].Address3+"<br>":"";template+=obj[prop].hasOwnProperty("Address4")?obj[prop].Address4+"<br>":"";template+=obj[prop].PostCode1;template+="</p>";}}}else{template+="<h3>No results found</h3>";}return template;},setPagingLinks=function(){if(currentPage>1){$previousLink.children("img").attr("src",previousImgEnabled);$previousLink.unbind("click");$previousLink.removeClass("disabled");}else{$previousLink.children("img").attr("src",previousImgDisabled);$previousLink.click(function(){return false;});$previousLink.addClass("disabled");}if(currentPage<numPages){$nextLink.children("img").attr("src",nextImgEnabled);$nextLink.unbind("click");$nextLink.removeClass("disabled");}else{$nextLink.children("img").attr("src",nextImgDisabled);$nextLink.click(function(){return false;});$nextLink.addClass("disabled");}};bankInputFocusHandler=function($input){if($input.val()==$input.attr("defaultVal")){$input.val("");$input.removeClass("bgColor");$input.addClass("fgColor");}},bankInputBlurHandler=function($input){if($input.val()==$input.attr("defaultVal")){$input.val($input.attr("defaultVal"));$input.removeClass("fgColor");$input.addClass("bgColor");}},setBankBrowseLinks=function($wrapper){var $browseBankTabs=$wrapper.find("ul.subTabs span.tabInner");if($browseBankTabs.length>0){var $currentTab,$currentList,$list;var $parent,meta,letters;var metaBackup;var startLetter=null,endLetter=null,isBrowseNum=false,isBrowseSpecialChar=false;$currentTab=$browseBankTabs.find("em");if($currentTab.length!==0){$parent=$currentTab.parents("span.tabInner");meta=$currentTab.metadata();if(typeof meta.browseBankAlpha==="string"){letters=meta.browseBankAlpha.split("-");if(letters.length>0){startLetter=letters[0];endLetter=letters[letters.length-1];}}if(typeof meta.browseBankNum==="boolean"){isBrowseNum=meta.browseBankNum;}if(typeof meta.browseBankSpecialChars==="boolean"){isBrowseSpecialChar=meta.browseBankSpecialChars;}if(typeof meta.browseBankAlpha==="undefined"){letters=$currentTab.html();letters=letters.split("-");startLetter=letters[0];endLetter=letters[letters.length-1];}getJsonResults(null,startLetter,endLetter,isBrowseNum,isBrowseSpecialChar);isBrowseNum=false;isBrowseSpecialChar=false;}if(resetBrowseSubTabs){resetBrowseSubTabs=false;$browseBankTabs.find("a").live("click",function(e){e.preventDefault();$browseBankTabs=$wrapper.find("ul.subTabs span.tabInner");$("li.primaryAction a.submitAction",initSelector).addClass("disabled");$currentTab=$browseBankTabs.find("em");$currentList=$currentTab.parents("li");$list=$(this).parents("li");$parent=$(this).parents("span.tabInner");meta=$(this).metadata();if(typeof meta.browseBankAlpha==="string"){letters=meta.browseBankAlpha.split("-");if(letters.length>0){startLetter=letters[0];endLetter=letters[letters.length-1];$currentList.removeClass("current");$currentList.removeAttr("class");metaBackup=$currentTab.html();metaBackup="{browseBankAlpha:'"+metaBackup+"'}";if($currentTab.hasClass("numbersAndSpecial")){metaBackup="{browseBankAlpha:'"+$currentTab.html()+"', browseBankNum:true, browseBankSpecialChars:true} numbersAndSpecial";}$currentTab.replaceWith('<a href="#" class="'+metaBackup+'">'+$currentTab.html()+"</a>");$list.addClass("current");metaBackup=$(this).metadata();metaBackup=metaBackup.browseBankAlpha;if($(this).hasClass("numbersAndSpecial")){$(this).replaceWith("<em class=\"{browseBankAlpha:'"+metaBackup+"', browseBankNum:true, browseBankSpecialChars:true} numbersAndSpecial\">"+metaBackup+"</em>");}else{$(this).replaceWith("<em>"+metaBackup+"</em>");}}}if(typeof meta.browseBankNum==="boolean"){isBrowseNum=meta.browseBankNum;}if(typeof meta.browseBankSpecialChars==="boolean"){isBrowseSpecialChar=meta.browseBankSpecialChars;}getJsonResults(null,startLetter,endLetter,isBrowseNum,isBrowseSpecialChar);isBrowseNum=false;isBrowseSpecialChar=false;});}}},displayResults=function(){var resultsHTML="",resultsLength=resultsArr.length;$elementsForAjaxResponseInjection.empty();if(resultsLength>0){var radioList="";resultsHTML=resultsTemplate;if(isPagedResults){var i,j,k;numPages=(isNaN(numItemsToDisplay)?1:Math.ceil(resultsLength/numItemsToDisplay));if(numPages>1){$(initSelector).find(pagingSelector).show();}else{$(initSelector).find(pagingSelector).hide();}i=(currentPage*numItemsToDisplay)-numItemsToDisplay;j=(((currentPage*numItemsToDisplay)-1)>resultsLength-1?resultsLength-1:(currentPage*numItemsToDisplay)-1);for(k=i;k<=j;k++){radioList+=$radioGroupTemplate.clone().html().replace(/{id}/g,resultsArr[k].id).replace(/\s*{Provider}\s*/g,resultsArr[k].provider);}}else{$.each(resultsArr,function(index,value){radioList+=$radioGroupTemplate.clone().html().replace(/{id}/g,value.id).replace(/\s*{Provider}\s*/g,value.provider);});}var target=$elementsForAjaxResponseInjection.filter(function(){return $(this).parents(".active").length!=0;});target.append(resultsHTML);var $radioGroupResults=$elementsForAjaxResponseInjection.find(radioGroupSelector);$radioGroupResults.empty();$radioGroupResults.append(radioList);}else{$elementsForAjaxResponseInjection.append("<p>"+bankNoResultsText+"</p>");$(ajaxResultsSelector,initSelector).closest(".formField").removeClass("error").find("span.error").remove();$(initSelector).find(pagingSelector).hide();}},getJsonResults=function(searchStr,startLetter,endLetter,isBrowseNum,isBrowseSpecialChar){$("li.primaryAction a.submitAction",initSelector).addClass("disabled");$.ajax({type:"GET",url:dataURL,data:{searchStr:searchStr,startLetter:startLetter,endLetter:endLetter,isBrowseNum:isBrowseNum,isBrowseSpecialChar:isBrowseSpecialChar},cache:false,dataType:"json",success:function(response){if(typeof response.bankSunData!=="undefined"){var resultsData=response.bankSunData;
resultsArr=[];currentPage=1;numPages=0;numItemsToDisplay=(searchStr!==null?numSearchItemsToDisplay:numBrowseItemsToDisplay);if(isFilterResults){if(searchStr!==null){searchStr=searchStr.toLowerCase();for(var key in resultsData){if($.trim(resultsData[key].Provider).substring(0,searchStr.length).toLowerCase()===searchStr){resultsArr.push({id:resultsData[key].ID,provider:resultsData[key].Provider});}}}else{if(startLetter!==null||isBrowseNum!==null||isBrowseSpecialChar!==null){startLetter=(startLetter!==null?startLetter.toLowerCase():"");endLetter=(endLetter!==null?"-"+endLetter.toLowerCase():"");isBrowseNum=(isBrowseNum!==null?isBrowseNum:false);isBrowseSpecialChar=(isBrowseSpecialChar!==null?isBrowseSpecialChar:false);var regExp="^["+startLetter+endLetter+(isBrowseNum?"\\d":"")+(isBrowseSpecialChar?bankNameSpecialChars:"")+"]+$";for(var key in resultsData){if($.trim(resultsData[key].Provider).substring(0,1).toLowerCase().match(regExp)){resultsArr.push({id:resultsData[key].ID,provider:resultsData[key].Provider});}}}}}else{for(var key in resultsData){resultsArr.push({id:resultsData[key].ID,provider:resultsData[key].Provider});}}displayResults();setPagingLinks();}},error:function(){loadingData=false;}});};return{init:function(){setup($(initSelector));}};})();var countryData;LBG.countryLookup=(function(countryData){var initSelector=".countryLookup",countryData=countryData,loadingData=false,resultsSelector=".countryLookupResults",resultsTemplateURL=DI.lang.countryLookup.countryResults,resultsTemplate,countryNoResultsText=DI.lang.countryLookup.countryNoResultsText,resultsGroupSelector=".resultsGroup",$resultGroupTemplate,resultsArr=[],searchType="advanced",inputTextBoxSelector=".countrySearchTxt",countryInputDefaultText=DI.lang.countryLookup.countryInputText,numSearchItemsToDisplay=DI.lang.countryLookup.numSearchItemsToDisplay,numItemsToDisplay;var setup=function($wrapper){$wrapper.find(".searchCountry").each(function(){var $thisSearch=$(this),$inputTextBoxSelector=$thisSearch.find(inputTextBoxSelector),$elementsForResultsInjection=$thisSearch.find(resultsSelector),$countryInputBox=$thisSearch.find(inputTextBoxSelector),thisSearchId=$thisSearch.attr("id").replace(/([;&,\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,"\\$1");if($elementsForResultsInjection.length===0){return false;}if($inputTextBoxSelector[0].value.length<1){$countryInputBox.attr("defaultVal",countryInputDefaultText).val(countryInputDefaultText);}$countryInputBox.focus(function(){countryInputFocusHandler($countryInputBox);});$countryInputBox.blur(function(){countryInputBlurHandler($countryInputBox);});$countryInputBox.bind("keyup",function(){if($.browser.msie&&$.browser.version<7&&$countryInputBox.val().length>2&&resultsArr.length<1){showIE6Selet($countryInputBox,"visible",true);$(resultsSelector,initSelector).empty();}if($countryInputBox.val().length>=3&&$countryInputBox.val().substring(0,3)!=="   "){$(".formSubmitError",initSelector).remove();$($countryInputBox).closest("div.error").removeClass("error").find("span.error").remove();getResults($countryInputBox.val(),$elementsForResultsInjection);if($.browser.msie&&$.browser.version<7){showIE6Selet($countryInputBox,"hidden",true);}}else{if($.browser.msie&&$.browser.version<7){showIE6Selet($countryInputBox,"visible",true);$(resultsSelector,initSelector).empty();return;}$(resultsSelector,initSelector).closest(".formField").removeClass("error").find("span.error").remove();$(resultsSelector,initSelector).empty();$("li.primaryAction a.submitAction",initSelector).addClass("disabled");}});$countryInputBox.bind("keydown",function(e){var keyCode=e.keyCode||e.which;if($countryInputBox.val().length>=3&&$countryInputBox.val().substring(0,3)!=="   "){if(keyCode===40){if($("#"+thisSearchId+" .result").length>0){$("#"+thisSearchId+" .result:first").find("a").focus();}}}});$.get(resultsTemplateURL,function(data){resultsTemplate=data;$resultsGroupTemplate=$(resultsTemplate).find(resultsGroupSelector);},"html");$("#"+thisSearchId+" .result a").live("click",function(e){e.preventDefault();updateCountryInputVal($(this),$countryInputBox);});$("#"+thisSearchId+" .result a").live("keydown",function(e){e.preventDefault();var keyCode=e.keyCode||e.which;if(!e.shiftKey&&keyCode===9||keyCode===40){$(this).parent().next(".result").find("a").focus();}if(e.shiftKey&&keyCode===9||keyCode===38){if($(this).parent().prev(".result").length>0){$(this).parent().prev(".result").find("a").focus();}else{$countryInputBox.focus();}}if(keyCode===13){updateCountryInputVal($(this),$countryInputBox);}});});},updateCountryInputVal=function($this,$input){$input.val($this.attr("data-country"));$(".resultsGroup").hide();if($.browser.msie&&$.browser.version<7){showIE6Selet($input,"visible",false);}$(".setDate").find("select").focus();},showIE6Selet=function($theElem,state,setFocus){$theElem.parents(".summary").find("select").each(function(idx){if($(this)[0].style.visibility!=state){$(this)[0].style.visibility=state;$(this).parents(".detail").each(function(){if($(this)[0].style.display=="block"){$(this)[0].style.display="none";$(this)[0].style.display="block";}});if(setFocus&&$theElem[0]&&$theElem[0].type=="text"){$theElem[0].style.display="none";$theElem[0].style.display="block";$theElem.focus();}}});},countryInputFocusHandler=function($input){if($input.val()==$input.attr("defaultVal")){$input.val("");}},countryInputBlurHandler=function($input){if($input.val()==$input.attr("defaultVal")){$input.val($input.attr("defaultVal"));}},displayResults=function($elementsForResultsInjection,$searchStr){var resultsHTML="",resultsLength=resultsArr.length;$elementsForResultsInjection.empty();if(resultsLength>0){var resultsList="";resultsHTML=resultsTemplate;$.each(resultsArr,function(index,value){if($searchStr){$searchStr2=$searchStr.substr(0,1).toUpperCase()+$searchStr.substr(1);$searchStr3=$searchStr.toUpperCase();var searchExpr=new RegExp($searchStr,"g");var searchExpr2=new RegExp($searchStr2,"g");var searchExpr3=new RegExp($searchStr3,"g");var higlightCtr=value.country.replace(searchExpr,"<strong>"+$searchStr+"</strong>");higlightCtr=higlightCtr.replace(searchExpr2,"<strong>"+$searchStr2+"</strong>");higlightCtr=higlightCtr.replace(searchExpr3,"<strong>"+$searchStr3+"</strong>");resultsList+=$resultsGroupTemplate.clone().html().replace(/\s*{country}\s*\</g,higlightCtr+"<");resultsList=resultsList.replace(/\s*{country}\s*/g,value.country);}else{resultsList+=$resultsGroupTemplate.clone().html().replace(/\s*{country}\s*/g,value.country);}});var target=$elementsForResultsInjection.filter(function(){return $(this).parents(".active").length!=0;});target.append(resultsHTML);var $resultsGroupResults=$elementsForResultsInjection.find(resultsGroupSelector);$resultsGroupResults.empty();$resultsGroupResults.append(resultsList);}else{$elementsForResultsInjection.append("<p>"+countryNoResultsText+"</p>");$(resultsSelector,initSelector).closest(".formField").removeClass("error").find("span.error").remove();}},getResults=function(searchStr,$elementsForResultsInjection){if(typeof countryData!=="undefined"){var resultsData=countryData;resultsArr=[];resultsArrAdv=[];numItemsToDisplay=numSearchItemsToDisplay;if(searchStr!==null){searchStr=searchStr.toLowerCase();for(var key in resultsData){var searchPos=$.trim(resultsData[key].country).toLowerCase().indexOf(searchStr);if(searchType=="startsWith"||searchType=="advanced"){if(searchPos==0){resultsArr.push({country:resultsData[key].country});}}else{if(searchType=="all"){if(searchPos>-1){resultsArr.push({country:resultsData[key].country});
}}}if(searchType=="advanced"){if(searchPos>0){resultsArrAdv.push({country:resultsData[key].country});}}}resultsArr=resultsArr.concat(resultsArrAdv);}displayResults($elementsForResultsInjection,searchStr);}};return{init:function(){setup($(initSelector));}};})(countryData);LBG.showNextOnChange={init:function(){var selector=".showNextOnChange",formFieldSelector=".formField",hideClass="hideJS";$(selector).find("input, select").each(function(){var elem=$(this);elem.data("oldVal",elem.val());elem.bind("propertychange keyup input paste",function(event){if(elem.data("oldVal")!=elem.val()){elem.data("oldVal",elem.val());elem.parents(selector).next(formFieldSelector).show().removeClass(hideClass).find("input, select").val("");}});});}};LBG.closeWindowLink={init:function(){$("a.closeWindow").unbind("click").bind("click",function(e){e.preventDefault();window.open("","_self","");window.close();});}};LBG.fixedTermDepositReinvestDropDown={initSelector:".maturityOptionsDropdowns",successorProduct:".successorProduct",interestFrequency:".interestFrequency",init:function(){if($(LBG.fixedTermDepositReinvestDropDown.initSelector).length>0){$(LBG.fixedTermDepositReinvestDropDown.successorProduct).change(function(){LBG.fixedTermDepositReinvestDropDown.populateNextDropDown($(this));});$(LBG.fixedTermDepositReinvestDropDown.successorProduct).keyup(function(){LBG.fixedTermDepositReinvestDropDown.populateNextDropDown($(this));});}},populateNextDropDown:function($successorProduct){var dropDownReceiverData=DI.lang.fixedTermDeposit.dropDownReceiverData;var $interestFrequencyElement=$successorProduct.parents(LBG.fixedTermDepositReinvestDropDown.initSelector).find(LBG.fixedTermDepositReinvestDropDown.interestFrequency);if($successorProduct.val()!=="-"){$.get(dropDownReceiverData,{"successorProduct":$successorProduct.val()},function(data){$interestFrequencyElement.empty().append($("option",$(data)));$("option:first-child",$interestFrequencyElement).attr("selected","selected");});}else{$interestFrequencyElement.html('<option selected="selected" value="-">&lt;Please select&gt;</option>');}}};LBG.ieZindexFix={apply:function(override,cxt){if(override||(!LBG.ieZindexFix.zIndexFixed&&($.browser.msie&&$.browser.version<8))){var elems,count,offset;if(!cxt){elems=$(".content div:not(.no-z-fix)");count=elems.length;offset=0;}else{others=$(".content div");others.css("z-index","");elems=cxt.parents("div:not(.no-z-fix)");count=elems.length;offset=others.length;}for(var i=0;i<count;i++){$(elems[i]).css({"z-index":(count-i)+offset});}LBG.ieZindexFix.zIndexFixed=true;return true;}else{return false;}},zIndexFixed:false};LBG.dateShortcut={init:function(){$("a.dateRangeShortcut").each(function(){if(!$(this).metadata().period){$(this).remove();}else{$(this).data("period",$(this).metadata().period);}}).click(function(){var cxt=$(this).closest("form");var period=$(this).data("period");var from=new Date((new Date()).getTime()-parseInt(period)*86400000);var to=new Date();$(".datesAndNames select.slctDay:eq(0)",cxt).val(LBG.dateShortcut.dayFormat(from.getUTCDate()));$(".datesAndNames select.slctMonth:eq(0) > option",cxt).attr("selected","").eq(from.getUTCMonth()+1).attr("selected","selected");$(".datesAndNames select.slctYear:eq(0)",cxt).val(from.getUTCFullYear());$(".datesAndNames select.slctDay:eq(1)",cxt).val(LBG.dateShortcut.dayFormat(to.getUTCDate()));$(".datesAndNames select.slctMonth:eq(1) > option",cxt).attr("selected","").eq(to.getUTCMonth()+1).attr("selected","selected");$(".datesAndNames select.slctYear:eq(1)",cxt).val(to.getUTCFullYear());return false;});},dayFormat:function(val){if(val<10){return"0"+val;}return val;}};LBG.eloanUtils={init:function(){$(".cancelInput").click(function(e){e.preventDefault();var target=e?$(e.target):$(window.event.srcElement),context=$(target).parents(".showHide");$(".triggerChild",context).trigger("click");$(":input",context).val("");});}};LBG.altOverlay=(function(){var reposition=function(){var verticalSpace=Math.min($(".altOverlayContainer").height(),$(window).height());var coverage=Math.min(0.95,$(".altOverlay").height()/verticalSpace);$(".altOverlay").css("margin-top",coverage*verticalSpace/-2);};var bind=function(){$(".altOverlay a.dismiss, .altOverlayMask").click(function(e){e.preventDefault();$(".hasAltOverlay").removeClass("hasAltOverlay");$(".altOverlayContainer").hide();return false;});};return{init:function(){if($(".altOverlay").length>0){$("html").addClass("hasAltOverlay").find("body").append($(".altOverlayContainer"));reposition();$(window).resize(reposition);bind();}}};})();LBG.marmaladePhaseTwo=(function(){var expand=(function(){var initSelector="td.first a.avaRadioBtn";var parent;var setup=function($wrapper){$wrapper.click(function(event){$parent=$(this).parents("table");$thisRow=$(this).parents("tr");currentRowIndex=$("tr",$parent).index($thisRow);$("tr",$parent).each(function(index){var $this=$(this);var $trigger=$(this).find(".triggerChild:first");var testDiv=$(".showHide",$(this));if(index===currentRowIndex){if(testDiv.hasClass("closed")){$trigger.trigger("click");}}else{if(!testDiv.hasClass("closed")){$trigger.trigger("click");}}});});};return{init:function(){$(initSelector).each(function(){setup($(this));});}};})();var validateCountable=(function(){var initSelector=".avaSales .avaSuitabilityCheck table",radioGroupSelector=".formField .radioGroup .inputGroup",countableSelector=".countable .formField .radioGroup .inputGroup",checkedSelector=".radio-checked";var getThreshold=function($wrapper){var meta=$wrapper.metadata();return meta.threshold;};var setup=function($wrapper){var $countables=$(countableSelector),$inputGroups=$(radioGroupSelector),$form=$wrapper.parents("form");var countableThreshold=getThreshold($wrapper);var total=$(".radioGroup").find(":input[value='yes']").length;var successfulSubmit=false;var performCountableCheck=function(){var answered=$(".radioGroup").find(":input:radio[checked='true']").length;if(answered<total){return false;}var count=$(".countable .radioGroup").find(":input:radio[checked='true']").filter("[value='yes']").length;return count<=countableThreshold;};var updateWarning=function(){var showWarning=performCountableCheck();var disclosure=$(".disclosure");var benefitCount=$wrapper.parents("form").find("tr").length;var questionsAnswered=$wrapper.parents("form").find(":radio:checked").length;if(showWarning){disclosure.slideDown();$wrapper.parents("form").find(".submitAction").attr("disabled",true);}else{disclosure.slideUp();if(benefitCount===questionsAnswered){$wrapper.parents("form").find(".submitAction").attr("disabled",false);}}};$(".radioGroup .avaRadioBtn",$wrapper).click(function(e){updateWarning();});$(":radio").click(function(e){updateWarning();});$(document).ready(function(){updateWarning();});};return{init:function(){$(initSelector).each(function(){setup($(this));});}};})();var ageDisclosure=(function(){var initSelector=".avaSales .disclosurePanel",nearingIneligibleWarningSelector=".nearingIneligibleWarning",ineligibleWarningSelector=".ineligibleWarning";var setup=function($wrapper){var meta=$wrapper.metadata();var ineligibleAge=meta.ineligibleAge;var nearingIneligibleAge=meta.nearingIneligibleAge;var $datePicker=$wrapper.parent().find(".formField .date");var createDate=function($dateWrapper){var daySelector="select.slctDay";var monthSelector="select.slctMonth";var yearSelector="select.slctYear";var day=$dateWrapper.find(daySelector).val(),month=$dateWrapper.find(monthSelector).val(),year=$dateWrapper.find(yearSelector).val();
return new Date(year,month-1,day);};var greaterOrEqualToAge=function(dateOfBirth,age){var ageDateOfBirth=new Date();ageDateOfBirth=new Date(ageDateOfBirth.getFullYear()-age,ageDateOfBirth.getMonth(),ageDateOfBirth.getDate());return ageDateOfBirth>=dateOfBirth;};$(":input",$datePicker).change(function(e){var ageNotEntered=false;$datePicker.find(":input").each(function(){var ageNotEntered=ageNotEntered||$(this).val()==="-";});if(ageNotEntered){return false;}var dob=createDate($datePicker);var ineligible=greaterOrEqualToAge(dob,ineligibleAge);var nearingIneligible=false;if(!ineligible){var nearingIneligible=greaterOrEqualToAge(dob,nearingIneligibleAge);}if(ineligible){$(ineligibleWarningSelector,$wrapper).slideDown();}else{$(ineligibleWarningSelector,$wrapper).slideUp();}if(nearingIneligible){$(nearingIneligibleWarningSelector,$wrapper).slideDown();}else{$(nearingIneligibleWarningSelector,$wrapper).slideUp();}return false;}).change();};return{init:function(){$(initSelector).each(function(){setup($(this));});}};})();return{init:function(){expand.init();ageDisclosure.init();}};})();LBG.marmaladePhaseTwo=(function(){var expand=(function(){var initSelector="td.first a.avaRadioBtn";var parent;var setup=function($wrapper){$wrapper.click(function(event){$parent=$(this).parents("table");$thisRow=$(this).parents("tr");currentRowIndex=$("tr",$parent).index($thisRow);$("tr",$parent).each(function(index){var $this=$(this);var $trigger=$(this).find(".triggerChild:first");var testDiv=$(".showHide",$(this));if(index===currentRowIndex){if(testDiv.hasClass("closed")){$trigger.trigger("click");}}else{if(!testDiv.hasClass("closed")){$trigger.trigger("click");}}});});};return{init:function(){$(initSelector).each(function(){setup($(this));});}};})();var validateCountable=(function(){var initSelector=".avaSales .avaSuitabilityCheck table",radioGroupSelector=".formField .radioGroup .inputGroup",countableSelector=".countable .formField .radioGroup .inputGroup",checkedSelector=".radio-checked";var getThreshold=function($wrapper){var meta=$wrapper.metadata();return meta.threshold;};var setup=function($wrapper){var $countables=$(countableSelector),$inputGroups=$(radioGroupSelector),$form=$wrapper.parents("form");var countableThreshold=getThreshold($wrapper);var total=$(".radioGroup").find(":input[value='yes']").length;var successfulSubmit=false;var performCountableCheck=function(){var answered=$(".radioGroup").find(":input:radio[checked='true']").length;if(answered<total){return false;}var count=$(".countable .radioGroup").find(":input:radio[checked='true']").filter("[value='yes']").length;return count<=countableThreshold;};var updateWarning=function(){var showWarning=performCountableCheck();var disclosure=$(".disclosure");var benefitCount=$wrapper.parents("form").find("tr").length;var questionsAnswered=$wrapper.parents("form").find(":radio:checked").length;if(showWarning){disclosure.slideDown();$wrapper.parents("form").find(".submitAction").attr("disabled",true);}else{disclosure.slideUp();if(benefitCount===questionsAnswered){$wrapper.parents("form").find(".submitAction").attr("disabled",false);}}};$(".radioGroup .avaRadioBtn",$wrapper).click(function(e){updateWarning();});$(":radio").click(function(e){updateWarning();});$(document).ready(function(){updateWarning();});};return{init:function(){$(initSelector).each(function(){setup($(this));});}};})();var ageDisclosure=(function(){var initSelector=".avaSales .disclosurePanel",nearingIneligibleWarningSelector=".nearingIneligibleWarning",ineligibleWarningSelector=".ineligibleWarning";var setup=function($wrapper){var meta=$wrapper.metadata();var ineligibleAge=meta.ineligibleAge;var nearingIneligibleAge=meta.nearingIneligibleAge;var $datePicker=$wrapper.parent().find(".formField .date");var createDate=function($dateWrapper){var daySelector="select.slctDay";var monthSelector="select.slctMonth";var yearSelector="select.slctYear";var day=$dateWrapper.find(daySelector).val(),month=$dateWrapper.find(monthSelector).val(),year=$dateWrapper.find(yearSelector).val();return new Date(year,month-1,day);};var greaterOrEqualToAge=function(dateOfBirth,age){var ageDateOfBirth=new Date();ageDateOfBirth=new Date(ageDateOfBirth.getFullYear()-age,ageDateOfBirth.getMonth(),ageDateOfBirth.getDate());return ageDateOfBirth>=dateOfBirth;};$(":input",$datePicker).change(function(e){var ageNotEntered=false;$datePicker.find(":input").each(function(){var ageNotEntered=ageNotEntered||$(this).val()==="-";});if(ageNotEntered){return false;}var dob=createDate($datePicker);var ineligible=greaterOrEqualToAge(dob,ineligibleAge);var nearingIneligible=false;if(!ineligible){var nearingIneligible=greaterOrEqualToAge(dob,nearingIneligibleAge);}if(ineligible){$(ineligibleWarningSelector,$wrapper).slideDown();}else{$(ineligibleWarningSelector,$wrapper).slideUp();}if(nearingIneligible){$(nearingIneligibleWarningSelector,$wrapper).slideDown();}else{$(nearingIneligibleWarningSelector,$wrapper).slideUp();}return false;}).change();};return{init:function(){$(initSelector).each(function(){setup($(this));});}};})();var fixTextWrap=(function(){var initSelector=".avaSummaryTable .notEligible";var setup=function($wrapper){var elWidth=$wrapper.outerWidth(true)+10;$wrapper.parent("a").css("padding-right",elWidth);};return{init:function(){$(initSelector).each(function(){setup($(this));});}};})();return{init:function(){expand.init();ageDisclosure.init();fixTextWrap.init();}};})();LBG.textNoSpace={init:function(){$(".js-noSpace input:text").blur(function(){var txt=this.value;txt=txt.replace(/[()+\-\s]/ig,"");$(this).val(txt);});}};LBG.lostAndStolen={init:function(){var submit=$("div.lostAndStolen .submitAction");var formReplacement=$("div.lostAndStolen form");var formReqReplacement=$("div.reqReplacement form");var field=$("div.lostAndStolen input.field");var row=$("table.lostAndStolenCardCancellation tbody tr");var rowReqReplacement=$("table.lostAndStolenCardReplace tbody tr");var creditCardRepRow=$("table.lostAndStolenCardReplace tbody tr.creditCard");var cancel=$("table.lostAndStolenCardCancellation td div.replaceCard input, table.lostAndStolenCardCancellation td div.newPin input");var radio=$("div.lostAndStolen .radioGroup input");var radioContainer=$("div.lostAndStolen div.radio");var checkbox=$("div.lostAndStolen table.lostAndStolenCardCancellation td div.cancelCard input");var checkboxReqReplacement=$("div.reqReplacement table.lostAndStolenCardReplace td input");var errorMessage=$(".formSubmitError");var confirmationRadio=$("div.lostAndStolen.confirmationSummary .radioGroup");var confirmAddressLS=$(".confirmAddressLostandStolen");$(confirmAddressLS).hide();var replaceErrShown=false;var wrapperValues=$(".lostAndStolen .formField");var formValidationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject(wrapperValues);LBG.Forms.Validation.ValidationHandlers.push(formValidationHandler);var reqWrapperValues=$(".reqReplacement .formField");var reqformValidationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject(reqWrapperValues);LBG.Forms.Validation.ValidationHandlers.push(reqformValidationHandler);if(formValidationHandler!=false&&formValidationHandler.validationRoutines!=undefined&&!formValidationHandler.validationRoutines.customMessage){blnRequiredValidationAddedDynamically=true;formValidationHandler.validationRoutines.push("customMessage");formValidationHandler.validationRoutines.customMessage={msg:"validateRadio"};}$(radioContainer).find("input:radio").click(function(){if(formValidationHandler){formValidationHandler.hideError();
}});$(rowReqReplacement).each(function(){var tmpChekbx=$(this).find("input:checkbox");tmpChekbx.unbind("click");tmpChekbx.click(function(){if(reqformValidationHandler){reqformValidationHandler.hideError();}if($(this.checked)&&($(".submitAction").attr("disabled")!==undefined)){if(formValidationHandler){formValidationHandler.hideError();}$(".submitAction").removeAttr("disabled");}});});$(creditCardRepRow).each(function(){var replaceCard=$(this).find(".replaceCard input");var newPin=$(this).find(".newPin input");replaceCard.click(function(event){if(replaceCard[0].checked){newPin.addClass("isDisabled").attr("disabled","disabled");}else{newPin.removeClass("isDisabled").removeAttr("disabled");}});newPin.click(function(){if(newPin[0].checked){replaceCard.addClass("isDisabled").attr("disabled","disabled");}else{replaceCard.removeClass("isDisabled").removeAttr("disabled");}});});$(formReqReplacement).submit(function(e){if(checkboxReqReplacement.filter(":checked").length==0){errorMessage.show();rowReqReplacement.addClass("error");return false;}});$(row).each(function(){var boxchecked=$(this).find(".cancelCard input");$(this).find("input:checkbox").click(function(){if(radio.filter(":checked").length!==0){if(formValidationHandler){formValidationHandler.hideError();}}});if($.browser.msie){$(this).find(".newPin input").removeClass("isDisabled").removeAttr("disabled");}if($(boxchecked).is(":checked")){$(this).find(".replaceCard input").removeClass("isDisabled").removeAttr("disabled");if(!$(this).find(".replaceCard input").is(":checked")){$(this).find(".newPin input").addClass("isDisabled").attr("disabled","disabled");}}else{$(this).find(".replaceCard input").addClass("isDisabled").attr("disabled","disabled");$(this).find(".newPin input").addClass("isDisabled").attr("disabled","disabled");}$(this).find(".cancelCard input").click(function(){if(this.checked){$(this).parents("tr").find(".replaceCard input, .newPin input").removeClass("isDisabled").removeAttr("disabled");$(this).parents("tr").find(".replaceCard input").attr("checked","checked");}else{$(this).parents("tr").find(".replaceCard input, .newPin input").addClass("isDisabled").removeAttr("checked").attr("disabled","disabled");}});$(this).find(".replaceCard input").click(function(){if(this.checked){$(this).parents("tr").find(".newPin input").removeClass("isDisabled").removeAttr("disabled");}else{if(!replaceErrShown){if(formValidationHandler.validationRoutines!=undefined){formValidationHandler.validationRoutines.customMessage={msg:"msg2476"};}if(formValidationHandler){formValidationHandler.showError();}replaceErrShown=true;}$(this).parents("tr").find(".newPin input").addClass("isDisabled").removeAttr("checked").attr("disabled","disabled");}});});$(submit).click(function(){if(($(field).length==0)){if((checkbox.filter(":checked").length==0)||(radio.filter(":checked").length==0)){if(radio.filter(":checked").length==0){if(formValidationHandler.validationRoutines!=undefined){formValidationHandler.validationRoutines.customMessage={msg:"validateRadio"};}}else{if(checkbox.filter(":checked").length==0){if(formValidationHandler.validationRoutines!=undefined){formValidationHandler.validationRoutines.customMessage={msg:"msg2474"};}}}if(formValidationHandler){formValidationHandler.showError();}return false;}}});$(formReplacement).submit(function(e){if(!formValidationHandler){return true;}if(($(field).length==0)){if((checkbox.filter(":checked").length==0)||(radio.filter(":checked").length==0)){errorMessage.show();if(checkbox.filter(":checked").length==0){$(row).addClass("error");}if(radio.filter(":checked").length==0){$(radioContainer).addClass("error");}return false;}}});$(field).bind("paste",function(e){setTimeout(function(){if($(field).val()!==""){$(submit).removeAttr("disabled").attr("src",DI.lang.lostAndStolen.submitImgEnabled);}else{$(submit).attr("disabled","disabled").attr("src",DI.lang.lostAndStolen.submitImgDisabled);}},100);});$(field).keyup(function(){if($(field).val()!==""){$(submit).removeAttr("disabled").attr("src",DI.lang.lostAndStolen.submitImgEnabled);}else{$(submit).attr("disabled","disabled").attr("src",DI.lang.lostAndStolen.submitImgDisabled);}});$(confirmationRadio).find("input").click(function(){if($(this).val()==1){$(".lostAndStolenSummary .choiceValue").each(function(){$(this).parent().attr("orig-value",$(this).text());$(this).text("N/A");$(confirmAddressLS).show("slow",function(){});});}else{if($(this).val()==0){$(".lostAndStolenSummary .choiceValue").each(function(){$(this).text($(this).parent().attr("orig-value"));$(confirmAddressLS).hide("slow",function(){});});}}});}};LBG.cssFixUtilities={init:function(){var isIE9=($.browser.msie&&parseInt($.browser.version)===9)?true:false;var hasPaymentTable=$("table.payments").length>0?true:false;if(isIE9&&hasPaymentTable){var cells=$("th,td");var div=$("<div/>");cells.each(function(){$(this).wrapInner(div);});}else{return false;}}};LBG.browserSniffer={init:function(){var browser=$.browser;var version=parseInt($.browser.version);for(var key in browser){if(browser[key]===Boolean(true)){$("body").addClass(key+"_"+version).attr({"data-browser":key,"data-version":version});}key++;}}};var AspectCollection=(function(){function AspectCollection(){this.aspects=[];}AspectCollection.prototype.init=function(){for(var i=0;i<this.aspects.length;i++){this.aspects[i].init();}};AspectCollection.prototype.addAspectAsLiteral=function(aspect){this.aspects.push(aspect);return this;};AspectCollection.prototype.addAspectAsFunction=function(aspect){this.aspects.push({init:aspect});return this;};AspectCollection.prototype.add=function(aspect){if("function"===typeof aspect){this.addAspectAsFunction(aspect);}else{if(aspect.init&&"function"===typeof aspect.init){this.addAspectAsLiteral(aspect);}}return this;};return AspectCollection;})();LBG.wtError={init:function(){$(".formField.wtError input:text").blur(function(){if($(".formField.wtError").hasClass(".error")){LBG.track({"WT.ti":this.id,"DCSext.CurrentPostcode":this.value,"DCSext.CurrentPostcodeValid":"false"});}else{LBG.track({"WT.ti":this.id,"DCSext.CurrentPostcode":this.value,"DCSext.CurrentPostcodeValid":"true"});}});}};LBG.selectAccountNew=function(){var el;function init(){el=$(".selectAccountNewList");if(!el.length){return;}el.find("li").each(function(){var button=$("<a href='#' class='button selectAccountButton'>Select</a>");$(this).append(button);button.bind("click",function(e){radioButton_click(e,this);});});el.find("input[type='radio']").click(function(){refreshClasses();});refreshClasses();}function refreshClasses(){if(el.find("input:checked").length){el.addClass("account-selected").find("li").removeClass("selected").find("a.selectAccountButton").text("Select");el.find("input:checked").parents("li").addClass("selected").find("a.selectAccountButton").text("Selected");}else{el.removeClass("account-selected");}}function radioButton_click(e,el){e.preventDefault();var radio=$(el).parents("li").find("input[type='radio']");radio.attr("checked","checked");refreshClasses();}return{init:init};}();LBG.ajaxSelect=(function(){var init=function(){$("select.ajaxSelect").each(function(){var md=$(this).metadata();$(this).change(function(){var url=$(":selected",this).metadata().url;if(!url){$(md.target).html("");}else{$(md.target).load(url,function(){$(this).removeClass("loading");LBG.Forms.Validation.init();LBG.common.getNewWindowLinks();}).addClass("loading");}}).change();});};return{init:init};})();LBG.loans=window.LBG.loans||(function(config){var loans=new AspectCollection();
loans.addAspectAsFunction(function(){var OverpaymentCalculator=(function($,config){var selectors={amount:"input[type=text]",form:"form",result:".overpayment-calc-result",submit:".submitAction",linkedField:".colPart:eq(0) .amountField input",containers:{form:".overpayment-calc-form",result:".overpayment-calc-result-container",page:".colLayout"}};var classes={progress:"overpayment-calc-progress"};function OPCalc(element){context=$(element);var self=this;this.form=$(selectors.form,context);this.form.submit(function(e){e.preventDefault();self.handler(e);return false;}).bind("error",function(){self.result.hide();$(selectors.submit,self.form).removeAttr("disabled");});$(selectors.submit,self.form).keydown(function(e){if(13==e.which){$(this).click();}});this.amount=$(selectors.amount,context);this.amount.keydown(function(e){if(13==e.which){e.preventDefault();$(selectors.submit,self.form).click();}});this.result=$(selectors.containers.result,context);this.context=context;}OPCalc.prototype.getAmount=function(){return this.amount.val();};OPCalc.prototype.handler=function(e){e.preventDefault();LBG.track({"WT.tx_s":this.amount.val(),"WT.ac":"pages/p60_00_loan_statements/properties.p6000btn518a,pages/p60_00_loan_statements/properties.p6000btn518b,Calculate"});var val=this.amount.val();if(""==val||isNaN(parseFloat(val))){return false;}var data={};data[this.amount.attr("name")]=val;$(selectors.result,this.result).text(config.text.loading).addClass(classes.progress);this.result.show();var self=this;$.ajax({url:config.ajax.url,data:data,success:function(result){self.form[0].reset();self.amount.val(val);$(selectors.result,self.result).html(result).removeClass(classes.progress);$(selectors.submit,self.form).removeAttr("disabled");$(self.context).parents(selectors.containers.page).find(selectors.linkedField).val(val).parents(".error").removeClass("error").find("span.error").remove();},error:function(){self.form[0].reset();self.amount.val(val);$(selectors.result,self.result).html(config.html.error).removeClass(classes.progress);$(selectors.submit,self.form).removeAttr("disabled");}});return false;};return OPCalc;})($,config.overpaymentCalculator||{});$(".overpayment-calc").each(function(){new OverpaymentCalculator(this);});});return loans;})(DI.lang.loans||{});LBG.selectAccountNew=function(){var el;function init(){el=$(".selectAccountNewList");if(!el.length){return;}el.find("input[type='radio']").click(function(){refreshClasses();});refreshClasses();}function refreshClasses(){if(el.find("input:checked").length){el.addClass("account-selected").find("li").removeClass("selected");el.find("input:checked").parents("li").addClass("selected");}else{el.removeClass("account-selected");}}function radioButton_click(e,el){e.preventDefault();var radio=$(el).parents("li").find("input[type='radio']");radio.attr("checked","checked");refreshClasses();}return{init:init};}();LBG.emailModule=(function(){var init=function(){$("div.optionalEmail").each(function(){var $this=$(this);var checkbox=$this.find('input[type="checkbox"]').eq(0);var hidden=$this.find('input[type="hidden"]').eq(0);var emailfields=$this.find('input[type="text"]');var emailcapture=$this.find("div.emailShowHide");var pane=$this.find(".pane");if(checkbox.length>0){checkbox.attr("checked","");emailcapture.hide();checkbox.click(function(){if(emailcapture.hasClass("email-visible")){emailcapture.removeClass("email-visible");emailcapture.hide();pane.hide();if(hidden.length>0){emailfields.val(hidden.val());}}else{emailcapture.addClass("email-visible");emailcapture.show();}});}else{emailcapture.show();$this.find(".inner").eq(0).addClass("dash");}});};return{init:init};})();LBG.inTNGA={init:function(){if($("#txtRequestType").attr("value","TNGA").length){$("body").addClass("inTNGA");}}};LBG.enableCheckbox={init:function(){$(".newwinEnablePrint").click(function(event){if($(".opcRadioGroup input:radio[class='label']").length){if(!$(".opcRadioGroup input:radio[class='label']").is(":checked")){$(".opcRadioGroup .inputGroup input:last").trigger("click");$(".opcRadioGroup .inputGroup input:last").removeAttr("checked");$(".opcRadioGroup .radioGroup").attr("style","width: 100%");event.stopPropagation();event.preventDefault();event.stopImmediatePropagation();}else{$(".inputEnabledAfterPrint").removeAttr("disabled");var radioID=$(".opcRadioGroup input:radio:checked").attr("id");var printFormLink=$(".newwinEnablePrint").attr("href");var valRadio=radioID.slice(radioID.length-1);printFormLink=printFormLink+"&opc="+valRadio;$(".newwinEnablePrint").attr("href",printFormLink);}}else{$(".inputEnabledAfterPrint").removeAttr("disabled");}});var emailFields=[];var emailBoxes=[];$(".captureusernameandpassword .emailAddressComparison input:text").each(function(i){emailFields[i]=$(this);});if(emailFields[0]!=undefined&&emailFields[1]!=undefined){emailFields[0].change(function(){if(emailFields[0].val()!=""){LBG.enableCheckbox.makeRequired(true,emailFields);}else{if(emailFields[0].val()==""&&emailFields[1].val()==""){LBG.enableCheckbox.makeRequired(false,emailFields);}}});emailFields[1].change(function(){if(emailFields[1].val()!=""){LBG.enableCheckbox.makeRequired(true,emailFields);}else{if(emailFields[1].val()==""&&emailFields[0].val()==""){LBG.enableCheckbox.makeRequired(false,emailFields);}}});}},makeRequired:function(isReq,emailFields){console.log("Making required "+isReq);var xxx=LBG.Forms.Validation.Tools.getFieldHandler(emailFields[0]);var yyy=LBG.Forms.Validation.Tools.getFieldHandler(emailFields[1]);if(isReq){if(-1===$.inArray("required",xxx.validationRoutines)){xxx.validationRoutines.push("required");yyy.validationRoutines.push("required");}}else{var index=$.inArray("required",xxx.validationRoutines);xxx.validationRoutines.splice(index,1);var index2=$.inArray("required",yyy.validationRoutines);yyy.validationRoutines.splice(index2,1);xxx.hideError();yyy.hideError();}}};(function(){var Autobinder=(function(){function autobinder(){this.bindings={};this.autobind={};this.handlers={};this.instances=[];}autobinder.prototype.register=function(selector,cls,autobind,args){var path=selector;var target=this.bindings;for(var i=0;i<path.length;i++){if(undefined==target[path[i]]){target[path[i]]={};}target=target[path[i]];}target._=cls;target.__autobind=autobind;target.__args=args;this.trigger("register",target,{selector:selector,"class":cls,autobind:autobind,args:args});return this;};autobinder.prototype.registerInstance=function(instance){return this.instances.push(instance)-1;};autobinder.prototype.bind=function(){var self=this;var lastkey=null;var walk=function(subclasses,element){var classAtThisDepth=subclasses._;for(var key in subclasses){if(subclasses.hasOwnProperty(key)&&"_"!=key&&element.is(key)){lastkey=key;return walk(subclasses[key],element);}}var elem_attr=self.getElemAttr(subclasses._.getSelector());if(subclasses.__autobind&&undefined===element.attr("data-instance"+elem_attr)){function F(elem,args){var new_inst=classAtThisDepth.apply(this,[].concat(elem,args));elem.attr("data-instance"+elem_attr,self.registerInstance(this));return new_inst;}F.prototype=classAtThisDepth.prototype;new F(element,subclasses.__args);}};var baseclasses=this.bindings;for(var selector in baseclasses){if(baseclasses.hasOwnProperty(selector)){var elem_attr=self.getElemAttr(selector);$(selector).not("[data-instance"+elem_attr+"]").each(function(){walk(baseclasses[selector],$(this));});}}return this;};autobinder.prototype.removeBindings=function(parent){var baseclasses=this.bindings;var self=this;
for(var selector in baseclasses){if(baseclasses.hasOwnProperty(selector)){if($(parent).is(selector)){var elem_attr=self.getElemAttr(selector);$(parent).unbind().removeAttr("data-instance"+elem_attr);}$(parent).find(selector).each(function(){var elem_attr=self.getElemAttr(selector);$(this).unbind().removeAttr("data-instance"+elem_attr);});}}return this;};autobinder.prototype.reBind=function(parent){this.removeBindings(parent);setTimeout($.proxy(function(){this.bind();},this),1);return this;};autobinder.prototype.getElemAttr=function(selector){return selector.replace(/[\.;\/'\[\]= ]/g,"-");};autobinder.prototype.getInstanceForElement=function(element){if($(element).is("[data-instance]")){return this.instances[parseInt($(element).data("instance"))];}var lastkey=null;var walk=function(subclasses,element){var classAtThisDepth=subclasses._;for(var key in subclasses){if(subclasses.hasOwnProperty(key)&&"_"!=key&&element.is(key)){lastkey=key;return walk(subclasses[key],element);}}function F(elem,args){return classAtThisDepth.apply(this,[].concat(elem,args));}F.prototype=classAtThisDepth.prototype;return new F(element,subclasses.__args);};var baseclasses=this.bindings;for(var selector in baseclasses){if(baseclasses.hasOwnProperty(selector)){if($(element).is(selector)){if(undefined!=$(element).attr("data-instance"+this.getElemAttr(selector))){return this.instances[parseInt($(element).attr("data-instance"+this.getElemAttr(selector)))];}return walk(baseclasses[selector],$(element));}}}return null;};autobinder.prototype.on=function(event,handler){if(!this.handlers[event]){this.handlers[event]=[];}this.handlers[event].push(handler);return this;};autobinder.prototype.trigger=function(event,ctx,obj){if(!this.handlers[event]){return this;}for(var i=0;i<this.handlers[event];i++){this.handlers[event][i].call(ctx,obj);}return this;};return new autobinder();})();var initing;function Class(options,prop){var F=function(){};initing=true;var prototype=this instanceof Function?(new this()):{};initing=false;var _super=this.prototype||{};if(undefined==prop){prop=options;options=undefined;}for(var name in prop){prototype[name]=(typeof prop[name]=="function"&&typeof _super[name]=="function")?(function(name,func){return function(){var tmp=this._super;this._super=_super[name];var ret=func.apply(this,arguments);this._super=tmp;return ret;};})(name,prop[name]):prop[name];}var Class=function(){if(!initing&&this.init){this.init.apply(this,arguments);}};Class.prototype=prototype;Class.prototype.constructor=Class;Class.extend=arguments.callee;Class.getSelector=function(){return Class.selector.join("");};if(options&&(options.selector||"string"==typeof options)){var selector=options.selector||options;var autobind=options.autobind!==false;Class.selector=this.selector?this.selector.concat(selector):[selector];Autobinder.register(Class.selector,Class,autobind,arguments.length>2?[].slice.call(arguments,2):[]);}Class.prototype.delegate=function(func){var self=this;return function(){return func.call(self,arguments);};};return Class;}this.Autobinder=Autobinder;this.Class=Class;})();var Config=new Class({init:function(obj){this.obj=obj;},tryGet:function(key){return this.get(key,null);},get:function(key,fallback){if(undefined!=this.obj&&undefined!=this.obj[key]){if(this.obj[key].toString()==({}).toString()){return new Config(this.obj[key]);}return this.obj[key];}if(-1!==key.indexOf("-")){key=key.replace(/\-([a-z])/g,function(a,match){return match.toUpperCase();});return this.get(key,fallback);}if(undefined===fallback){throw"Key '"+key+"' is not defined.";}return fallback;},val:function(){return this.obj;},tryGetNested:function(key){if(this.obj!=null){return this.obj.get(key,null);}else{return this.get(key,null);}}});var Repeatable=new Class({selector:".repeatable",autobind:false},{init:function(element){this.element=$(element);this.removeButton=$(".removeRepeatable",this.element);this.bind();this.handlers={remove:[]};},bind:function(){var self=this;this.removeButton.click(function(e){self.remove();e.preventDefault();});},canRemove:function(){return true;},onRemove:function(handler){this.handlers.remove.push(handler);return this;},toggleRemoveButton:function(show){if(show){this.removeButton.show();}else{this.removeButton.hide();}},remove:function(element){$(this.element).hide();this.element.find("input:text").val("");this.element.find("select").val("-").change();for(var i in this.handlers.remove){if(this.handlers.remove.hasOwnProperty(i)){this.handlers.remove[i].apply(this);}}},isVisible:function(){return $(this.element).is(":visible");},show:function(){$(this.element).show();return this;},hasShown:function(){return this;}},false);var LoanRepeatable=Repeatable.extend({selector:".loanPurpose",autobind:false},{init:function(element){Repeatable.prototype.init.call(this,element);$("select",element).change(function(){element.find("input:text").val("");LBG.Forms.Validation.Tools.getFieldHandler(element.find("input:text")[0]).isShowingError=false;});this.controller=null;},bind:function(){var self=this;this.removeButton.click(function(e){e.preventDefault();e.stopImmediatePropagation();self.shiftData();});},setController:function(controller){this.controller=controller;return this;},getController:function(){return this.controller;},canRemove:function(){var empty=true;$(":input",this.element).each(function(){empty=empty&&($(this).val()==($(this).is("select")?"-":""));});return empty;},hasShown:function(){return this;},shiftData:function(){var next=this.getController().nextChild(this);if(null==next||!next.isVisible()){this.remove();return;}var self=this;var selVal;var data=[];var errMsgs=[];var hasActualCost=[];$("input",next.element).each(function(i){data[i]=$(this).val();errMsgs[i]="";hasActualCost[i]=$(this).is(":visible");var inValHandler=LBG.Forms.Validation.Tools.getFieldHandler($(this));if(inValHandler.isShowingError){errMsgs[i]=inValHandler.errorMessage.innerHTML;}});$("select",next.element).each(function(i){var selVal=$(this).val();$(this).val("-").change();$("select:eq("+i+")",self.element).val(selVal);});$("input",this.element).each(function(i){$(this).val(data[i]);if(i==1){if(hasActualCost[i]){$(this).parent().parent().parent().show();}else{$(this).parent().parent().parent().hide();}}var inValHandler=LBG.Forms.Validation.Tools.getFieldHandler($(this));if(errMsgs[i]!=""){inValHandler.showError();$(this).parent().find("span.error").each(function(x){this.innerHTML=errMsgs[i];});}else{inValHandler.hideError();}});next.shiftData();}});var RepeatableWrapper=new Class(".repeatableWrapper",{init:function(element){var loanRepeatableMaxReachedMessage=DI.lang.repeatableLoanElements.maxReached;$(".repeatableMaxReached .infoMessage p").text(loanRepeatableMaxReachedMessage);var self=this;this.reserve=[];this.element=element;this.limit=$(Repeatable.getSelector()).length;this.elements=[];this.addButton=$(".addRepeatable",element).show().click(function(e){e.preventDefault();var previousFieldsInvalid=false;var $previousVisibleRepeatables=$(this).prevAll(".repeatable").filter(":visible");$previousVisibleRepeatables.each(function(){var self=$(this);var $visibleFormFields=self.find(".formField").filter(":visible");$visibleFormFields.each(function(i){var $current=$($visibleFormFields[i]);if("-"===$current.find("select option:selected").val()||""===$current.find("input:text").filter(":enabled").val()){var validationHandler=LBG.Forms.Validation.Tools.getFieldHandler($current);var errorMessage="required";if("-"===$current.find("select option:selected").val()){errorMessage="requiredSelect";
}if(validationHandler.validationRoutines.required){validationHandler.showError(errorMessage);previousFieldsInvalid=true;}}});});if(!previousFieldsInvalid){if(self.countRepeatable()<self.limit){self.nextChild().show().hasShown();}self.updateButtons();}});$(Repeatable.getSelector(),element).each(function(index){var elem=Autobinder.getInstanceForElement(this);elem.onRemove(function(){self.updateButtons();});elem.setController(self);if(index!=0&&elem.canRemove()){elem.remove();}self.elements.push(elem);});self.updateButtons();},nextChild:function(child){if(child){for(var i=0,l=this.elements.length;i<l;i++){if(this.elements[i]==child){if(i+1<l){return this.elements[i+1];}return null;}}}for(var i=0,l=this.elements.length;i<l;i++){if(!this.elements[i].isVisible()){return this.elements[i];}}return null;},updateButtons:function(){this.notifyChildren("toggleRemoveButton",[this.countRepeatable()>1]);this.toggleAddButton();},addChild:function(element){var elem=Autobinder.getInstanceForElement(element);var self=this;elem.onRemove(function(){self.updateButtons();});this.elements.push(elem);return this;},toggleAddButton:function(){if(this.countRepeatable()<this.limit){this.addButton.show();$(".repeatableMaxReached").hide();}else{this.addButton.hide();$(".repeatableMaxReached").show();}},countRepeatable:function(){var count=0;for(var i=0,l=this.elements.length;i<l;i++){if(this.elements[i].isVisible()){count++;}}return count;},notifyChildren:function(event,params){for(var i in this.elements){if(this.elements.hasOwnProperty(i)){this.elements[i][event].apply(this.elements[i],params);}}}});var UniqueSelection=new Class(".uniqueSelection",{init:function(element){var $repeatableWrapper=$(".repeatableWrapper");$(element).change(function(e){var scope=$("select",$repeatableWrapper);if($(this).parents(":eq(1)").next().hasClass("error")){$(this).parents(":eq(1)").next().removeClass("error").find("span.error").remove();}scope.each(function(){var vals=scope.map(function(){return $.trim($(this).val());});$("span",this).each(function(){if(-1===$.inArray($.trim($(this).attr("data-val")),vals)){var option=$("<option/>").val($(this).attr("data-val")).addClass($(this).attr("class-val")).text($(this).text());$(this).before(option).remove();}});var pIndex=this.selectedIndex;$("option",this).filter(function(){if(pIndex==this.index){return false;}var myval=$.trim(this.value);return -1!==$.inArray(myval,vals)&&"-"!==myval;}).each(function(){var clone=$("<span/>").attr("data-val",$(this).val()).attr("class-val",$(this).attr("class")).text($(this).text());$(this).before(clone).remove();});});});}});var OPSCalculatorController=new Class(".ops-calculator",{init:function(elem){this.element=elem;var self=this;$(":radio",elem).click(function(){if($(this).is(":checked")){var modelObj=new Config($(this).metadata()).get("model");self.swapModels(modelObj);}});},swapModels:function(model){$(".ops-calculator-total, .ops-calculator-monthly",this.element).each(function(){var cls=$(this).attr("class");cls=cls.replace(/ops[\-a-z]+\-calculator\-model/g,"");$(this).attr("class",cls).addClass(model);});return this;}});var OPSCalculator=new Class({init:function(elem){this.config=new Config($(elem).metadata());this.element=elem;this.isValid=false;var data=$("table",elem);this.fields={cover:$(".cover",data),term:$(".term",data),premium:$(".premium",data),total:$(".cost",data)};var curVal=this;$(".ops-calculator .input-text").bind("blur",function(){var isValid=LBG.Forms.Validation.Routines.simpleRegexTest(LBG.Forms.Validation.Expressions.currencyCharacters,$(this).val().replace(/,/g,""));if(!isValid){curVal.clearSummaryPanel();}LBG.OPSSummaryData.continueJourney();});$(".ops-calculator .slider .plus",".ops-calculator .slider .minus").bind("click",function(){$(".ops-calculator .input-text").bind();});if($(".ops-engagement-hub .ui-slider").length){$(".ops-engagement-hub .ui-slider").bind("slidechange",this.delegate(this.updateEngagementHub));}else{$(".ui-slider",elem).bind("slidechange",this.delegate(this.update));}$(".ops-calculator input[type='radio'],.sidePaneHeadingRight a").bind("click",function(e){var totalCover=$("table.monthly .cover").html().replace("","");var totalTerm=$("table.monthly .term").html().replace("years","").trim();var monthlyPremium=$("table.total .premium").html().replace("","");var monthlyTerm=$("table.total .term").html().replace("years","").trim();$(".ui-slider").each(function(){if($(this).closest(".formField").hasClass("error")){}else{if(!$(e.target).hasClass("statusToggle")){if($("input:hidden[name$=opsPanelUsedHiddenInfo]").val()=="true"){$("[name$=ops-total-cover]").val(totalCover);$("[name$=ops-total-length]").val(totalTerm);}else{$("[name$=ops-monthly-premium]").val(monthlyPremium);$("[name$=ops-monthly-length]").val(monthlyTerm);}}var minVal=parseFloat($(this).closest(".formFieldInner").find(".minVal, .min .limit").text().replace(/,/g,""),10);var maxVal=parseFloat($(this).closest(".formFieldInner").find(".maxVal, .max .limit").text().replace(/,/g,""),10);$(this).slider("option","min",minVal);$(this).slider("option","max",maxVal);if(maxVal<parseFloat($(this).closest(".formFieldInner").find("input").val().replace(/,/g,""),10)){$(this).slider("value",maxVal);$(this).closest(".formFieldInner").find(".input-text").val(maxVal).trigger("blur");}else{if(maxVal>=parseFloat($(this).closest(".formFieldInner").find("input").val().replace(/,/g,""),10)){$(this).slider("value",parseFloat($(this).closest(".formFieldInner").find("input").val().replace(/,/g,""),10));}}}$(this).trigger("slidechange");});});this.model=null;var slider=$(".opsCoverAmount .slider");slider.bind("slide",function(event,ui){if(ui!==undefined&&Math.round(ui.value/5000)!==0&&ui.value>slider.slider("option","min")){var val=ui.value%5000?Math.round(ui.value/5000)*5000:ui.value;ui.value=val;}});var sliderMonthly=$(".opsMonthlyCover .slider");sliderMonthly.bind("slide",function(event,ui){if(ui!==undefined&&ui.value/1!==0&&ui.value<sliderMonthly.slider("option","max")){var val=ui.value%1?Math.round(ui.value/1)*1:ui.value;if((sliderMonthly.slider("option","max")-val)<1){val=sliderMonthly.slider("option","max");ui.value=val;}else{ui.value=val;}}});if($("form.ops-engagement-hub").length){this.engagementHubInit();}},engagementHubInit:function(){var minCoverAmount=this.getModels().decreasing.getMinimumCoverAmount();var minCoverAmountHub=minCoverAmount.toString(10).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,");var coverInput=$(".opsCoverAmount");coverInput.find(".slider").slider("option","min",minCoverAmount);coverInput.find("input").val(minCoverAmountHub);coverInput.find(".ops-cover-min-amount").html(minCoverAmountHub);},getModel:function(){if(!/ops-[\-a-z]+calculator-model/.test(this.element.attr("class"))){throw"Model not selected";}var modelName=this.element.attr("class").match(/ops-[\-a-z]+calculator-model/)[0];if(!this.model||!this.model.obj||this.model.name!=modelName){this.model={name:modelName,obj:Autobinder.getInstanceForElement($("[type='application/json; model="+modelName+"']:eq(0)"))};}return this.model.obj;},getModels:function(){var models={level:Autobinder.getInstanceForElement($("[type='application/json; model=ops-level-term-calculator-model']:eq(0)")),decreasing:Autobinder.getInstanceForElement($("[type='application/json; model=ops-decreasing-term-calculator-model']:eq(0)"))};return models;},getPremium:function(e){throw"getPremium is not implemented";},getSaleCost:function(){return((this.getPremium()*12)*this.getTerm()*this.getModel().getSaleCostPercent()/100+this.getModel().getSaleCost()).toFixed(2);
},getCover:function(){throw"getCover is not implemented";},getTerm:function(){return parseInt(this.term.val());},update:function(e){var formStatus=$("input:hidden[name$=frmOPSStatus]").val();var errorMessage=$("div.formSubmitError");var minCoverAmount=this.getModel().getMinimumCoverAmount();$("span.ops-cover-min-amount.limit").html(minCoverAmount.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"));var monthlyMaxCoverAmount=this.getModel().getMonthlyMaxCoverAmount();var premium=this.getPremium();var coverInput=$("[name$=ops-total-cover]"),termInput=$("[name$=ops-total-length]"),coverLimitContainer=coverInput.closest(".formFieldInner").find(".limit-container"),termLimitContainer=termInput.closest(".formFieldInner").find(".limit-container");var modelName=this.element.attr("class").match(/ops-[\-a-z]+calculator-model/)[0];if($("input:hidden[name$=levelSelected]").val()=="false"&&(modelName=="ops-level-term-calculator-model")){levelCoverAmount=this.getCover();coverInput.val(levelCoverAmount);coverInput.val(coverInput.val().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"));}else{if($("input:hidden[name$=levelSelected]").val()=="true"&&(modelName=="ops-level-term-calculator-model")){levelCoverAmount=this.getCover();coverInput.val(levelCoverAmount);coverInput.val(coverInput.val().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"));}}if($("input:hidden[name$=decreasingSelected]").val()=="false"&&(modelName=="ops-decreasing-term-calculator-model")){decCoverAmount=this.getCover();coverInput.val(decCoverAmount);coverInput.val(coverInput.val().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"));}else{if($("input:hidden[name$=decreasingSelected]").val()=="true"&&(modelName=="ops-decreasing-term-calculator-model")){decCoverAmount=this.getCover();coverInput.val(decCoverAmount);coverInput.val(coverInput.val().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"));}}if(modelName=="ops-level-term-calculator-model"){coverAmount=levelCoverAmount;}else{if(modelName=="ops-decreasing-term-calculator-model"){coverAmount=decCoverAmount;}}if($("input:hidden[name$=opsPanelUsedHiddenInfo]").val()=="true"){if(parseInt(coverInput.val().replace(/,/g,""))>=coverAmount&&parseFloat(premium)>=5&&parseInt(coverInput.val().replace(/,/g,""))<=parseInt(coverLimitContainer.find(".max .limit").html().replace(/,/g,""))&&parseInt(termInput.val().replace(/,/g,""))>=parseInt(termLimitContainer.find(".min .limit").html().replace(/,/g,""))&&parseInt(termInput.val().replace(/,/g,""))<=parseInt(termLimitContainer.find(".max .limit").html().replace(/,/g,""))){$(".sidePaneHeadingRight").removeClass("disabledDiv");var term=this.getTerm();var getCover=this.getCover();var saleCost=this.getSaleCost();this.fields.cover.html("&pound;"+LBG.converter.formatCurrency(getCover));this.fields.term.html(term+" years");this.fields.premium.html("&pound;"+premium);this.fields.total.html("&pound;"+(premium*term*12).toFixed(2));$("span.ops-sale-cost").html(saleCost);$(".showSubmitErrorPrepend").removeClass("ops-monthly-error");if(formStatus=="false"&&parseFloat(premium)<5){errorMessage.show();}else{errorMessage.hide();}}else{if(parseFloat(premium)<5&&parseFloat(premium)>0){errorMessage.show();$(".showSubmitErrorPrepend").addClass("formSubmitError ops-monthly-error");$(".showSubmitErrorPrepend").html(DI.lang.errorMessages.defaultFormFieldErrorMessages.msg3015);}this.clearSummaryPanel();}}else{$("span.ops-monthly-max-amount.limit").html(monthlyMaxCoverAmount);var getCover=this.getCover();var monCoverInput=$("[name$=ops-monthly-premium]"),monTermInput=$("[name$=ops-monthly-length]"),coverLimitContainer=monCoverInput.closest(".formFieldInner").find(".limit-container"),termLimitContainer=monTermInput.closest(".formFieldInner").find(".limit-container");if(parseFloat(monCoverInput.val().replace(/,/g,""))>=parseFloat(coverLimitContainer.find(".min .limit").html().replace(/,/g,""))&&parseFloat(monCoverInput.val().replace(/,/g,""))<=monthlyMaxCoverAmount&&parseInt(getCover)<=500000&&parseInt(monTermInput.val().replace(/,/g,""))>=parseInt(termLimitContainer.find(".min .limit").html().replace(/,/g,""))&&parseInt(monTermInput.val().replace(/,/g,""))<=parseInt(termLimitContainer.find(".max .limit").html().replace(/,/g,""))){$(".sidePaneHeadingRight").removeClass("disabledDiv");var term=this.getTerm();var saleCost=this.getSaleCost();this.fields.cover.html("&pound;"+LBG.converter.formatCurrency(getCover));this.fields.term.html(term+" years");this.fields.premium.html("&pound;"+premium);this.fields.total.html("&pound;"+(premium*term*12).toFixed(2));$("span.ops-sale-cost").html(saleCost);$(".showSubmitErrorPrepend").removeClass("ops-total-error");if(formStatus=="false"&&parseInt(coverAmount)<500000){errorMessage.show();}else{errorMessage.hide();}}else{if(parseInt(coverAmount)>500000){errorMessage.show();$(".showSubmitErrorPrepend").addClass("formSubmitError ops-total-error");$(".showSubmitErrorPrepend").html(DI.lang.errorMessages.defaultFormFieldErrorMessages.msg3014);}this.clearSummaryPanel();}}},clearSummaryPanel:function(){$(".sidePaneHeadingRight").each(function(){$(this).addClass("disabledDiv");});this.fields.cover.html("");this.fields.term.html("");this.fields.premium.html("");this.fields.total.html("");},updateEngagementHub:function(){var coverAmount=this.getCoverEngagement();var $summary=$(".ops-engagement-hub .summary");var errorMessage=$("div.formSubmitError");var coverInput=$("[name$=ops-total-cover]"),lengthInput=$("[name$=ops-total-length]"),coverLimitContainer=coverInput.closest(".formFieldInner").find(".limit-container"),lengthLimitContainer=lengthInput.closest(".formFieldInner").find(".limit-container");if($("input:hidden[name$=decreasingSelected]").val()=="false"){$("input:hidden[name$=decreasingSelected]").val("true");coverInput.val(coverAmount.replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"));$(".ui-slider").slider("value",coverAmount);}if(parseInt(coverInput.val().replace(/,/g,""))>=parseInt(coverAmount)&&parseInt(coverInput.val().replace(/,/g,""))<=parseInt(coverLimitContainer.find(".max .limit").html().replace(/,/g,""))&&parseInt(lengthInput.val().replace(/,/g,""))>=parseInt(lengthLimitContainer.find(".min .limit").html().replace(/,/g,""))&&parseInt(lengthInput.val().replace(/,/g,""))<=parseInt(lengthLimitContainer.find(".max .limit").html().replace(/,/g,""))){$summary.css("display","block");errorMessage.hide();var premiumCounts=this.getPremiumEngagement();$(".ops-engagement-hub .levelPremium").html(premiumCounts.level);$(".ops-engagement-hub .decreasingPremium").html(premiumCounts.decreasing);}else{$summary.css("display","none");errorMessage.show();$(".showSubmitErrorPrepend").addClass("formSubmitError");$(".showSubmitErrorPrepend").html(DI.lang.errorMessages.defaultFormFieldErrorMessages.msg3015);}},getBaseRate:function(){return this.getModel().getBaseRate(term);}});var OPSMonthlyCalculator=OPSCalculator.extend(".ops-calculator-monthly",{init:function(elem){this._super(elem);this.premium=$("[name$=ops-monthly-premium]",elem);this.term=$("[name$=ops-monthly-length]",elem);},getPremium:function(){return parseFloat(this.premium.val().replace(/,/g,"")||0).toFixed(2);},getCover:function(){var premium=this.getPremium();var modelName=this.element.attr("class").match(/ops-[\-a-z]+calculator-model/)[0];if($("input:hidden[name$=levelSelected]").val()=="false"&&(modelName=="ops-level-term-calculator-model")){$("input:hidden[name$=levelSelected]").val("true");premium=5;}if($("input:hidden[name$=decreasingSelected]").val()=="false"&&(modelName=="ops-decreasing-term-calculator-model")){$("input:hidden[name$=decreasingSelected]").val("true");
premium=5;}return(1000*((premium-this.getModel().getPolicyFee())/(1+this.getModel().getTotalRating()/100)*12)/(this.getModel().getBaseRate(this.getTerm())*this.getModel().getDiscountFactor())).toFixed();}});var OPSTotalCalculator=OPSCalculator.extend(".ops-calculator-total",{init:function(elem){this._super(elem);this.cover=$("[name$=ops-total-cover]",elem);this.term=$("[name$=ops-total-length]",elem);},getPremium:function(e){return((1+this.getModel().getTotalRating()/100)*(this.cover.val().replace(/,/g,"")/1000*this.getModel().getBaseRate(this.getTerm())*this.getModel().getDiscountFactor()/12)+this.getModel().getPolicyFee()).toFixed(2);},getCover:function(){return parseInt(this.cover.val().replace(/,/g,"")||0).toFixed();},getPremiumEngagement:function(e){var premiumJson={level:((1+this.getModels().level.getTotalRating()/100)*($("[name$=ops-total-cover]").val().replace(/,/g,"")/1000*this.getModels().level.getBaseRate(this.getTerm())*this.getModels().level.getDiscountFactor()/12)+this.getModels().level.getPolicyFee()).toFixed(2),decreasing:((1+this.getModels().decreasing.getTotalRating()/100)*($("[name$=ops-total-cover]").val().replace(/,/g,"")/1000*this.getModels().decreasing.getBaseRate(this.getTerm())*this.getModels().decreasing.getDiscountFactor()/12)+this.getModels().decreasing.getPolicyFee()).toFixed(2)};return premiumJson;},getCoverEngagement:function(){var premium=5;return(1000*((premium-this.getModels().decreasing.getPolicyFee())/(1+this.getModels().decreasing.getTotalRating()/100)*12)/(this.getModels().decreasing.getBaseRate(this.getTerm())*this.getModels().decreasing.getDiscountFactor())).toFixed();}});var Model=new Class({init:function(elem,config){var data;if(window["JSON"]){data=JSON.parse(elem.html());}else{var text=elem.html();data=!(/[^,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]/.test(text.replace(/"(\\.|[^"\\])*"/g,"")))&&eval("("+text+")");}this.data=new Config(data);this.config=config;}});var OPSCalculatorModel=Model.extend({init:function(elem){this._super(elem,new Config(DI.onlineProtectionSales));},getMaximumAge:function(){return this.config.get("maximum-age");},getMinimumAge:function(){return this.config.get("minimum-age");},getAge:function(){return Math.max(this.config.get("minimum-age"),parseInt(this.data.get("customer-age")));},getSaleCost:function(){return this.data.get("cost-of-sale");},getSaleCostPercent:function(){return this.data.get("cost-sale-perc");},getMinimumCoverAmount:function(){return this.data.get("min-cover-amt");},getMonthlyMaxCoverAmount:function(){return this.data.get("monthly-max-cover-amt");},getPolicyFee:function(){return this.data.get("policy-fee");},getSumAssured:function(){return this.data.get("sum-assured");},getTotalRating:function(){return this.data.get("total-rating");},getDiscountFactor:function(){return this.data.get("discount-factor");},getBoundaryRates:function(targetTerm){var targetTerm=parseInt(targetTerm),isBoundaryTerm=targetTerm%5==0,data=this.data.get("base-rate-list"),targetAge=this.data.get("customer-age");var compare=function(fromBelow){if(fromBelow){return(function(value,target,current){return value<=target&&(null==current||value>=current);});}else{return(function(value,target,current){return value>=target&&(null==current||value<=current);});}};var rates={upper:{upper:null,lower:null},lower:{upper:null,lower:null}};var lower=compare(true);var upper=compare();var check=0;var C=function(obj){return new Config(obj);};for(var i=0;i<data.length;i++){var tmp=new Config(data[i]);var term=tmp.get("policy-term");var age=tmp.get("age");if(lower(term,targetTerm,C(rates.lower.upper).tryGetNested("policy-term"))||lower(term,targetTerm,C(rates.lower.lower).tryGetNested("policy-term"))){if(lower(age,targetAge,C(rates.lower.lower).tryGet("age"))){rates.lower.lower=tmp;check|=1;}else{if(upper(age,targetAge,C(rates.lower.upper).tryGet("age"))){rates.lower.upper=tmp;check|=2;}}}if(!isBoundaryTerm&&C(rates.lower.lower).tryGetNested("policy-term")==(term-5)&&C(rates.lower.lower).tryGetNested("age")==age){rates.upper.lower=tmp;check|=4;}if(!isBoundaryTerm&&C(rates.lower.upper).tryGetNested("policy-term")==(term-5)&&C(rates.lower.upper).tryGetNested("age")==age){rates.upper.upper=tmp;check|=8;}}if(isBoundaryTerm){rates.upper.lower=rates.lower.lower;rates.upper.upper=rates.lower.upper;check=15;}if(15!=check){throw"Could not find matching boundary for term '"+term+"'";}for(var fkey in rates){if(rates.hasOwnProperty(fkey)){for(var skey in rates[fkey]){if(rates[fkey].hasOwnProperty(skey)){rates[fkey][skey]=rates[fkey][skey].get("rates");}}}}return rates;},getRateInterpolator:function(position,gap){return function(rates){return rates.lower+(rates.upper-rates.lower)*(position%gap)/gap;};},getBaseRate:function(term){var rates=this.getBoundaryRates(term);var intByAge=this.getRateInterpolator(this.getAge(),5);var intByTerm=this.getRateInterpolator(term,5);return Math.round(intByTerm({lower:intByAge(rates.lower),upper:intByAge(rates.upper)})*10000)/10000;}});LBG.OPSSummaryData={init:function(){if($(".ops-calculator input[type='radio']").is(":checked")){var totalFlag=$("input:hidden[name$=opsPanelUsedHiddenInfo]").val();if(totalFlag=="true"){$(".ops-calculator-total").removeClass("statusToggleHide");$(".ops-calculator-monthly").addClass("statusToggleHide");}else{$(".ops-calculator-monthly").removeClass("statusToggleHide");$(".ops-calculator-total").addClass("statusToggleHide");}$("input[type='radio']:checked")[0].click();$(".ui-slider").each(function(){$(this).trigger("slidechange");});}$(".ops-engagement-hub .opsCoverAmount").find(".slider").trigger("slidechange");},continueJourney:function(){if($("input:hidden[name$=frmOPSStatus]").val()=="false"){$("input:hidden[name$=frmOPSStatus]").val("true");}}};var OPSLevelCalculatorModel=OPSCalculatorModel.extend("[type='application/json; model=ops-level-term-calculator-model']",{});var OPSDecreasingCalculatorModel=OPSCalculatorModel.extend("[type='application/json; model=ops-decreasing-term-calculator-model']",{});LBG.sliderInputProgress={init:function(){var trigger=$(".slider-input.progressbar input:text, .slider-input input:text"),sliderWrapper='<div class="sliderWrapper"><div><div class="sliderInnerWrapper"><div class="slider"><div class="progressArea progressColored" /></div></div></div><div class="ccMinLimit"></div><div class="clearer"></div></div>',btnAmountMore='<span class="plus"><a href="#" title="'+DI.stpLoanCalculatorButton.amount.increase+'">'+DI.stpLoanCalculatorButton.amount.increase+"</a></span>",btnAmountLess='<span class="minus"><a href="#" title="'+DI.stpLoanCalculatorButton.amount.decrease+'">'+DI.stpLoanCalculatorButton.amount.decrease+"</a></span>",btnMonthMore='<span class="plus"><a href="#" title="'+DI.stpLoanCalculatorButton.months.increase+'">'+DI.stpLoanCalculatorButton.months.increase+"</a></span>",btnMonthLess='<span class="minus"><a href="#" title="'+DI.stpLoanCalculatorButton.months.decrease+'">'+DI.stpLoanCalculatorButton.months.decrease+"</a></span>";if(!trigger.length){return;}function commaConvert(currAmount){return currAmount.replace(/\B(?=(\d{3})+(?!\d))/g,",");}if(LBG.sliderInputProgress.determineAdjusterPresence()){var availableCredit=function(){return parseInt($(".secondCard").find("[name$=available-credit-limit]").text().replace(/,/g,""));};var compareUIValues=function(ui,input){if(ui.value>=parseFloat(input.val().replace(/,/,""))){return true;}return false;};$(".progressBarContainer").each(function(){var minimum=parseFloat($(".currentValue span",this).text().replace(/[^\d\.]/g,""));
var maximum=parseFloat($(".ccLimit span",this).text().replace(/[^\d\.]/g,""));var ratio=minimum/maximum;$(".preamble",this).width(ratio*100+"%");$(".innerChart",this).width((1-ratio)*100+"%");});}var formValidationHandler=LBG.Forms.Validation.Tools.getValidationHandlerObject(trigger);trigger.each(function(i){var input=$(this),params=input.metadata(),sliderMin=parseInt(input.closest(".formFieldInner").find(".minVal, .min .limit").text().replace(/,/,""),10),sliderMax=parseFloat(input.closest(".formFieldInner").find(".maxVal, .max .limit").text().replace(/,/,""),10),interval=(params.sliderInterval)?parseFloat(params.sliderInterval,10):1,startOverlay=parseInt(input.closest(".formFieldInner").find(".startBestRate").text().replace(/,/,""),10),endOverlay=parseInt(input.closest(".formFieldInner").find(".endBestRate").text().replace(/,/,""),10),positionOverlay,widthOverlay,slider,oValue,labelUnit;var formFieldName=LBG.Forms.Validation.Tools.convertClassDetailsToData($(this).closest(".formField")[0],"validationName:")[0];var formFieldValidationHandler=formValidationHandler.getChild(formFieldName);if(params.allowDecimals&&interval!="undefined"){interval=parseFloat(interval.toFixed(2));}input.closest("input").after(sliderWrapper);slider=input.closest("input").next(".sliderWrapper").find(".slider");slider.slider({min:sliderMin,max:sliderMax,step:interval,animate:!$(".secondCard").length,slide:function(event,ui){function updateValues(value){if(params.allowDecimals&&value!="undefined"){value=value.toFixed(2);if((slider.slider("option","max")-value)<1){slider.slider("option","step",0.01);value=parseFloat(slider.slider("option","max"));}else{slider.slider("option","step",interval);}}input.val(value);input.val(input.val().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")).change();if(LBG.sliderInputProgress.determineAdjusterPresence()){LBG.sliderInputProgress.adjustProgressBar(slider);}}if(LBG.sliderInputProgress.determineAdjusterPresence()){var getAvailableCredit=function(override){var progressBar=$(".progressBarContainer");var availableCredit=parseInt(progressBar.find(".maxValue span").text().replace(/,/,""))-parseInt(progressBar.find(".minValue span").text().replace(/,/,""));var total=0;$(".slider-input.progressbar").each(function(i){var min=parseInt($(this).find(".min .limit").text().replace(/,/,""));var newLimit=$(event.target).parents(".slider-input.progressbar:eq(0)")[0]==this&&!override?ui.value:$(this).find("input").val().replace(/,/,"");total+=(newLimit-min);});return availableCredit-total;};var available=getAvailableCredit();if(available<0){slider.slider("value",ui.value+available);updateValues(ui.value+available);return false;}}LBG.OPSSummaryData.continueJourney();updateValues(ui.value);},stop:function(event){if(LBG.sliderInputProgress.determineAdjusterPresence()){LBG.sliderInputProgress.adjustProgressBar(slider);}},start:function(event,ui){if(params.allowDecimals&&(parseFloat(ui.value)!="undefined")){ui.value=parseFloat(ui.value).toFixed(2);}input.val(ui.value);input.val(input.val().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"));if(formFieldValidationHandler.isShowingError){formFieldValidationHandler.hideError();formFieldValidationHandler.isShowingError=false;}}});if($(this).parents(".secondCard").length>0){var ratio=sliderMin/sliderMax;ratio=(ratio>0.8)?0.8:ratio;$(".ccMinLimit",$(this).parents(".slider-input.progressbar")).width(ratio*100+"%");$(".sliderInnerWrapper",$(this).parents(".slider-input.progressbar")).css("left",ratio*100+"%");}input.focus(function(){if(!(formFieldValidationHandler.isShowingError)){oValue=$(this).val().replace(/,/,"");}});var getAvailableCredit=function(context){var progressBar=$(".progressBarContainer");var availableCredit=parseInt(progressBar.find(".maxValue span").text().replace(/,/,""))-parseInt(progressBar.find(".minValue span").text().replace(/,/,""));var total=0;$(".slider-input.progressbar").filter(function(){return this!=context;}).each(function(i){var min=getMinimumLimit(this);var newLimit=getCurrentLimit(this);total+=(newLimit-min);});return availableCredit-total;};var sanitiseStringNumber=function(number){if(params.allowDecimals){return parseFloat(number.replace(/,/,"")).toFixed(2);}else{return parseFloat(number.replace(/[^\d\.]/g,""));}};var getMinimumLimit=function(context){return sanitiseStringNumber($(context).find(".min .limit").text());};var getMaximumLimit=function(context){return sanitiseStringNumber($(context).find(".max .limit").text());};var getCurrentLimit=function(context){return sanitiseStringNumber($(context).find("input").val());};input.blur(function(){var typedVal=$(this).val().replace(/,/,"");if(formFieldValidationHandler.isShowingError&&!isNaN(Math.abs(typedVal))){if(typedVal>sliderMax){slider.slider("value",sliderMax);}else{if(typedVal<sliderMin){slider.slider("value",sliderMin);}else{slider.slider("value",oValue);}}}input.change();});input.bind("keypress",function(e){var typedVal=sanitiseStringNumber($(this).val().replace(/,/,""));if(e.keyCode===13&&!isNaN(Math.abs(typedVal))){if(typedVal>sliderMax){slider.slider("value",sliderMax);}else{if(typedVal<sliderMin){slider.slider("value",sliderMin);}else{slider.slider("value",oValue);}}}});input.change(function(){var typedVal=$(this).val().replace(/,/,""),roundedVal,i;if(!params.allowDecimals){if(typedVal.indexOf(".")!==-1){typedVal=typedVal.substr(0,typedVal.indexOf("."));}}if(!isNaN(Math.abs(typedVal))){if(typedVal%interval!==0){roundedVal=Math.round(typedVal/interval)*interval;slider.slider("value",roundedVal);}else{slider.slider("value",typedVal);}}$(this).val(typedVal.toString(10).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"));});input.change();if(i===0){slider.parent().before(btnAmountLess).after(btnAmountMore);}else{slider.parent().before(btnMonthLess).after(btnMonthMore);}$(input.closest(".formFieldInner").find(".minus,.plus")).bind("click",function(e){if(LBG.sliderInputProgress.determineAdjusterPresence()){if($(this).hasClass("plus")){if(availableCredit()<=0){return false;}}}if(params.updatableSlider){var context=input.parents(".slider-input")[0];sliderMin=getMinimumLimit(context);sliderMax=getMaximumLimit(context);}var oldVal=parseFloat(input.val().replace(/,/,""),10),newVal;if(isNaN(oldVal)){oldVal=sliderMin;}e.preventDefault();LBG.OPSSummaryData.continueJourney();if($(this).hasClass("minus")){newVal=((oldVal-interval)<sliderMin)?sliderMin:(oldVal-interval);newVal=(parseFloat(newVal)>=parseFloat(sliderMax))?sliderMax:Math.round(newVal);}else{newVal=((oldVal+interval)>sliderMax)?sliderMax:(oldVal+interval);newVal=(parseFloat(newVal)<=parseFloat(sliderMin))?sliderMin:newVal;}if(newVal>sliderMin&&newVal<sliderMax){newVal=newVal%interval?Math.round(newVal/interval)*interval:newVal;}if(params.allowDecimals){if(newVal!="undefined"){newVal=parseFloat(newVal).toFixed(2);}}slider.slider("option","value",newVal).trigger("slide");if(newVal>=sliderMin&&newVal<=sliderMax&&formFieldValidationHandler.isShowingError){formFieldValidationHandler.hideError();formFieldValidationHandler.isShowingError=false;}newVal=newVal.toString(10).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,");input.val(newVal).change();});$(input.closest(".slider-input.progressbar").find(".minus")).bind("click",function(e){if(!LBG.Forms.Validation.Routines.validateSliderProgress($(this).closest(".formField"))){var newVal=sliderMin.toString(10).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,");input.val(newVal).blur();}});if(startOverlay<endOverlay&&startOverlay>=sliderMin&&endOverlay<=sliderMax){positionOverlay=((startOverlay-sliderMin)/(sliderMax-sliderMin))*100;
widthOverlay=(((endOverlay-startOverlay)/(sliderMax-sliderMin))*100);input.closest(".formFieldInner").find(".slider").append('<div class="overlayLoanCalculator" style="left:'+positionOverlay+"%; width:"+widthOverlay+'%;"/>');}if(input.prev("span").hasClass("currency")){labelUnit=input.prev("span").text();input.closest(".formFieldInner").find(".minVal, .maxVal").prepend(labelUnit);}if(input.next("span").hasClass("durationUnit")){labelUnit=" "+input.next("span").text();input.closest(".formFieldInner").find(".minVal, .maxVal").append(labelUnit);}});$(".ui-slider a").bind("touchmove",function(e){var evt=e.originalEvent;evt.preventDefault();if(evt.touches.length>1||(evt.type=="touchend"&&evt.touches.length>0)){return;}var newEvt=document.createEvent("MouseEvents");var touch=evt.changedTouches[0];newEvt.initMouseEvent("mousemove",true,true,window,0,touch.screenX,touch.screenY,touch.clientX,touch.clientY,evt.ctrlKey,evt.altKey,evt.shiftKey,evt.metaKey,0,null);this.dispatchEvent(newEvt);}).bind("touchstart",function(e){var evt=e.originalEvent;evt.preventDefault();if(evt.touches.length>1||(evt.type=="touchend"&&evt.touches.length>0)){return;}var newEvt=document.createEvent("MouseEvents");var touch=evt.changedTouches[0];newEvt.initMouseEvent("mousedown",true,true,window,0,touch.screenX,touch.screenY,touch.clientX,touch.clientY,evt.ctrlKey,evt.altKey,evt.shiftKey,evt.metaKey,0,null);this.dispatchEvent(newEvt);}).bind("touchend",function(e){var evt=e.originalEvent;evt.preventDefault();if(evt.touches.length>1||(evt.type=="touchend"&&evt.touches.length>0)){return;}var newEvt=document.createEvent("MouseEvents");var touch=evt.changedTouches[0];newEvt.initMouseEvent("mouseup",true,true,window,0,touch.screenX,touch.screenY,touch.clientX,touch.clientY,evt.ctrlKey,evt.altKey,evt.shiftKey,evt.metaKey,0,null);this.dispatchEvent(newEvt);});},determineAdjusterPresence:function(){return $(".adjuster").length;},adjustProgressBar:function(slider){if(LBG.sliderInputProgress.determineAdjusterPresence()){var sanitiseStringNumber=function(number){return parseFloat(number.replace(/[^\d\.]/g,""));};function commaConvert(currAmount){return currAmount.replace(/\B(?=(\d{3})+(?!\d))/g,",");}var progressBar=$(".progressBarContainer");var availableCredit=sanitiseStringNumber(progressBar.find(".maxValue span").text())-sanitiseStringNumber(progressBar.find(".minValue span").text());var runningTotal=0;$(".slider-input.progressbar").each(function(i){var min=sanitiseStringNumber($(this).find(".min .limit").text());var max=sanitiseStringNumber($(this).find(".max .limit").text());var newLimit=sanitiseStringNumber($(this).find("input").val());runningTotal+=(newLimit-min);var currAvCred=$(this).find("p.currentAvailableCredit span.currentAvailableCreditAmount");if(!currAvCred.data("initial-value")){currAvCred.data("initial-value",sanitiseStringNumber(currAvCred.text()));}var currentAvailableCredit=currAvCred.data("initial-value")+(newLimit-min);if(!isNaN(currentAvailableCredit)){$(this).find("p.currentAvailableCredit span.currentAvailableCreditAmount").text(commaConvert(parseFloat(currentAvailableCredit).toFixed(2)));}var position=$(".ui-slider-handle",$(this)).css("left");if(position){$(".progressArea",$(this)).css("width",parseInt(position.slice(0,-1))+2+"%");}});var pc=(availableCredit-runningTotal)/availableCredit*100;progressBar.find(".value").css("width",pc+"%");var ccAvailableLimit=progressBar.find(".ccAvailable span.currentAvailableCreditAmount");if(!ccAvailableLimit.data("initial-value")){ccAvailableLimit.data("initial-value",sanitiseStringNumber(ccAvailableLimit.text()).toFixed(2));}var ccAvailableLimitVal=parseFloat(ccAvailableLimit.data("initial-value")-runningTotal).toFixed(2);var creditLeft=availableCredit-runningTotal;if(!isNaN(ccAvailableLimitVal)){progressBar.find(".ccAvailable span.currentAvailableCreditAmount").text(commaConvert(ccAvailableLimitVal));}if(!isNaN(creditLeft)){$(".sliderAvailableCredit span:first").text(commaConvert(creditLeft.toString()));}var currentCCLimit=progressBar.find(".ccLimit span");if(!currentCCLimit.data("initial-value")){currentCCLimit.data("initial-value",sanitiseStringNumber(commaConvert(currentCCLimit.text())));}var newCCLimit=currentCCLimit.data("initial-value")-runningTotal;if(!isNaN(newCCLimit)){progressBar.find(".ccLimit span").text(commaConvert(parseFloat(newCCLimit).toString()));}}}};LBG.carFinanceTable={json:false,init:function(){if($("table.car-finance").length>0){$(".car-finance-deposit .formField, .car-finance-price .formField").removeClass("amountField");$(".car-finance .slider-input input[type=text]").change(function(){LBG.carFinanceTable.updateTable();});if($("#updateTable").length){var hdnTrigger=document.getElementById("updateTable").value;if(hdnTrigger==="true"){LBG.carFinanceTable.updateTable();}}}$(".car-finance .submit-on, .car-finance .more-info").click(function(){var carPrice=parseInt($(".car-finance-price input.input-text").val().replace(/,/,""));LBG.track({"WT.tx_s":carPrice});});},updateTable:function(){if($(".formField").hasClass("error")){LBG.carFinanceTable.productStatus("hp",false);LBG.carFinanceTable.productStatus("fp",false);LBG.carFinanceTable.messageController([]);return;}var json=LBG.carFinanceTable.json;if(json.hp){var customerLimitsHp={minMonthlyPayment:json.min_monthly_payment||0,maxMonthlyPayment:json.max_monthly_payment,hpMinDepositPriceRatio:json.hp.min_deposit_price_ratio||0,hpMinLoanAmount:json.hp.min_amount,hpMaxLoanAmount:json.hp.max_amount,hpMinTerm:json.hp.min_term,hpMaxTerm:json.hp.max_term,hpMaxTermAge:json.hp.max_term_age};}if(json.fp){var customerLimitsFp={minMonthlyPayment:json.min_monthly_payment||0,maxMonthlyPayment:json.max_monthly_payment,fpMinDepositPriceRatio:json.fp.min_deposit_price_ratio||0,fpMinLoanAmount:json.fp.min_amount,fpMaxLoanAmount:json.fp.max_amount,fpMinTerm:json.fp.min_term,fpMaxTerm:json.fp.max_term,fpMaxTermAge:json.fp.max_term_age};}var carPrice=parseInt($(".car-finance-price input.input-text").val().replace(/,/,""));var deposit=parseInt($(".car-finance-deposit input.input-text").val().replace(/,/,""));var term=parseInt($(".car-finance-term input.input-text").val());$("table.car-finance .hp-term").empty().text(term);$("table.car-finance .fp-term").empty().text(term-1);if(isNaN(carPrice)||isNaN(deposit)||isNaN(term)){LBG.carFinanceTable.productStatus("hp",false);LBG.carFinanceTable.productStatus("fp",false);LBG.carFinanceTable.messageController([]);return;}var loanAmount=$(".car-finance-price input.input-text").val().replace(/,/,"")-deposit;$("table.car-finance .hp-loan-amount").empty().text(LBG.converter.formatCurrency(loanAmount.toString()));$("table.car-finance .fp-loan-amount").empty().text(LBG.converter.formatCurrency(loanAmount.toString()));if(json.hp){var hpApr=LBG.carFinanceTable.getApr(json.hp.apr,term,deposit,loanAmount);$("table.car-finance .hp-apr").empty().text((hpApr*100).toFixed(1));var monthlyInterestRateHp=LBG.carFinanceTable.getMonthlyInterestRate(hpApr);var monthlyPaymentHp=LBG.carFinanceTable.getMonthlyPaymentHp(loanAmount,term,monthlyInterestRateHp,0);$("table.car-finance .hp-monthly").empty().text(LBG.converter.formatCurrency(monthlyPaymentHp.toFixed(2)));var totalPayableHp=LBG.carFinanceTable.getTotalPayable("hp",term,monthlyPaymentHp,0,json.hp.fee);$("table.car-finance .hp-total-payable").empty().text(LBG.converter.formatCurrency(totalPayableHp.toFixed(2)));}if(json.fp){var fpApr=LBG.carFinanceTable.getApr(json.fp.apr,term,deposit,loanAmount);$("table.car-finance .fp-apr").empty().text((fpApr*100).toFixed(1));
var monthlyInterestRateFp=LBG.carFinanceTable.getMonthlyInterestRate(fpApr);var residualValueFp=LBG.carFinanceTable.getResidualValueFp(json.fp.depreciation,carPrice,term);var monthlyPaymentFp=LBG.carFinanceTable.getMonthlyPaymentFp(loanAmount,term,monthlyInterestRateFp,residualValueFp,json.fp.fee);$("table.car-finance .fp-monthly").empty().text(LBG.converter.formatCurrency(monthlyPaymentFp.toFixed(2)));var finalPaymentFp=LBG.carFinanceTable.getFinalPaymentFp(residualValueFp,json.fp.fee);$("table.car-finance .fp-final-payment").empty().text(LBG.converter.formatCurrency(finalPaymentFp.toFixed(2)));var totalPayableFp=LBG.carFinanceTable.getTotalPayable("fp",term,monthlyPaymentFp,residualValueFp,json.fp.fee);$("table.car-finance .fp-total-payable").empty().text(LBG.converter.formatCurrency(totalPayableFp.toFixed(2)));}var hpAffordable=(json.hp&&monthlyPaymentHp<=customerLimitsHp.maxMonthlyPayment);var hpPositive=(json.hp&&monthlyPaymentHp>customerLimitsHp.minMonthlyPayment);var hpAmountAboveMin=(json.hp&&loanAmount>=customerLimitsHp.hpMinLoanAmount);var hpAmountBelowMax=(json.hp&&loanAmount<=customerLimitsHp.hpMaxLoanAmount);var hpTermAboveMin=(json.hp&&term>=customerLimitsHp.hpMinTerm);var hpTermBelowMax=(json.hp&&term<=customerLimitsHp.hpMaxTerm);var hpAgeBelowMax=(json.hp&&term<=customerLimitsHp.hpMaxTermAge);var hpDpRatioAboveMin=(json.hp&&(deposit/carPrice)>=customerLimitsHp.hpMinDepositPriceRatio);var fpAffordable=(json.fp&&monthlyPaymentFp<=customerLimitsFp.maxMonthlyPayment);var fpPositive=(json.fp&&monthlyPaymentFp>customerLimitsFp.minMonthlyPayment);var fpAmountAboveMin=(json.fp&&loanAmount>=customerLimitsFp.fpMinLoanAmount);var fpAmountBelowMax=(json.fp&&loanAmount<=customerLimitsFp.fpMaxLoanAmount);var fpTermAboveMin=(json.fp&&term>=customerLimitsFp.fpMinTerm);var fpTermBelowMax=(json.fp&&term<=customerLimitsFp.fpMaxTerm);var fpAgeBelowMax=(json.fp&&term<=customerLimitsFp.fpMaxTermAge);var fpDpRatioAboveMin=(json.fp&&(deposit/carPrice)>=customerLimitsFp.fpMinDepositPriceRatio);var fpCurrentMileageExceeded=(json.fp&&json.fp.max_current_mileage_exceeded);var fpFutureMileageExceeded=(json.fp&&json.fp.max_future_mileage_exceeded);var hpValid=json.hp&&hpAffordable&&hpPositive&&hpAmountAboveMin&&hpAmountBelowMax&&hpTermAboveMin&&hpTermBelowMax&&hpAgeBelowMax&&hpDpRatioAboveMin;var fpValid=json.fp&&fpAffordable&&fpPositive&&fpAmountAboveMin&&fpAmountBelowMax&&fpTermAboveMin&&fpTermBelowMax&&fpAgeBelowMax&&fpDpRatioAboveMin&&!fpCurrentMileageExceeded&&!fpFutureMileageExceeded;LBG.carFinanceTable.productStatus("hp",hpValid);LBG.carFinanceTable.productStatus("fp",fpValid);var msg=[];if(json.hp&&!hpValid){if(!hpAffordable){msg[msg.length]="hp-msgMonthlyMax";}if(!hpPositive){msg[msg.length]="hp-msgMonthlyMin";}if(!hpDpRatioAboveMin){msg[msg.length]="hp-msgDepositRatioMin";}if(!hpAmountAboveMin){msg[msg.length]="hp-msgLoanMin";}if(!hpAmountBelowMax){msg[msg.length]="hp-msgLoanMax";}if(!hpTermAboveMin){msg[msg.length]="hp-msgTermMin";}if(hpTermBelowMax&&!hpAgeBelowMax){msg[msg.length]="hp-msgTermAge";}if(!hpTermBelowMax&&hpAgeBelowMax){msg[msg.length]="hp-msgTermMax";}if(!hpTermBelowMax&&!hpAgeBelowMax){msg[msg.length]="hp-msgTermAge";}}if(json.fp&&!fpValid){if(fpCurrentMileageExceeded){msg[msg.length]="fp-msgCurrentMileageMax";}else{if(fpFutureMileageExceeded){msg[msg.length]="fp-msgAnnualMileageMax";}else{if(!fpAffordable){msg[msg.length]="fp-msgMonthlyMax";}if(!fpPositive){msg[msg.length]="fp-msgMonthlyMin";}if(!fpDpRatioAboveMin){msg[msg.length]="fp-msgDepositRatioMin";}if(!fpAmountAboveMin){msg[msg.length]="fp-msgLoanMin";}if(!fpAmountBelowMax){msg[msg.length]="fp-msgLoanMax";}if(!fpTermAboveMin){msg[msg.length]="fp-msgTermMin";}if(!fpTermBelowMax){msg[msg.length]="fp-msgTermMax";}else{if(fpTermBelowMax&&!fpAgeBelowMax){msg[msg.length]="fp-msgTermAge";}if(!fpTermBelowMax&&!fpAgeBelowMax){msg[msg.length]="fp-msgTermAge";}}}}}LBG.carFinanceTable.messageController(msg);},getApr:function(terms,desiredTerm,deposit,loanAmount){var apr,terms,deposits,loanAmounts,i,j,k;deposits=terms[terms.length-1];for(i=terms.length-2;i>=0;i-=2){if(desiredTerm>terms[i]){break;}deposits=terms[i+1];}loanAmounts=deposits[1];for(k=0;k<deposits.length;k=k+2){if(deposit<deposits[k]){break;}loanAmounts=deposits[k+1];}apr=loanAmounts[1];for(k=0;k<loanAmounts.length;k=k+2){if(loanAmount<loanAmounts[k]){break;}apr=loanAmounts[k+1];}return apr;},getMonthlyInterestRate:function(apr){return(Math.pow((1+apr),(1/12)))-1;},getMonthlyPaymentHp:function(loanAmount,term,monthlyInterestRate,residualValue){return -(residualValue-loanAmount*Math.pow(1+monthlyInterestRate,term))*monthlyInterestRate/(Math.pow((1+monthlyInterestRate),term)-1);},getMonthlyPaymentFp:function(loanAmount,term,monthlyInterestRate,residualValue,fee){var paymentNumber=term-1;return(loanAmount-(residualValue+fee)/Math.pow((1+monthlyInterestRate),term))/((Math.pow((1+monthlyInterestRate),paymentNumber)-1)/(Math.pow((1+monthlyInterestRate),paymentNumber)*monthlyInterestRate));},getFinalPaymentFp:function(residualValueFp,fee){return residualValueFp+fee;},getTotalPayable:function(type,term,monthlyPayment,residualValueFp,fee){if(type==="hp"){return term*parseFloat(monthlyPayment.toFixed(2));}else{if(type==="fp"){return(term-1)*parseFloat(monthlyPayment.toFixed(2))+residualValueFp+fee;}}},getResidualValueFp:function(depreciationTable,carPrice,term){var depreciationFp=depreciationTable.values[1];for(i=0;i<depreciationTable.values.length;i+=2){if(term<depreciationTable.values[i]){break;}depreciationFp=depreciationTable.values[i+1];}if(depreciationTable.type==="Absolute"){return depreciationFp;}var monthlyDepreciationFp=Math.pow((1-depreciationFp),(1/12))-1;return carPrice*Math.pow((1+monthlyDepreciationFp),term);},productStatus:function(type,state){if($("table.car-finance").length>0){var objTable=$("table.car-finance");var table=$("table.car-finance");var tableRow=objTable.find("tr."+type);var inputImg=objTable.find("tr."+type+" input:image");if(state===true){tableRow.removeClass("disabled");tableRow.find(".submit-off").addClass("hide");tableRow.find(".submit-on").removeClass("hide");}else{tableRow.addClass("disabled");tableRow.find(".submit-on").addClass("hide");tableRow.find(".submit-off").removeClass("hide");$("table.car-finance ."+type+"-monthly").empty().text("0.00");$("table.car-finance ."+type+"-loan-amount").empty().text("0");$("table.car-finance ."+type+"-apr").empty().text("0.0");if(type==="hp"){$("table.car-finance ."+"hp-final-payment").empty().text("N/A");}else{if(type==="fp"){$("table.car-finance ."+"fp-final-payment").empty().text("0.00");}}$("table.car-finance ."+type+"-total-payable").empty().text("0.00");}}},messageController:function(msg){var msgs=$(".car-finance-message p");$(msgs).addClass("hide");if(msg.length>0){for(var m=0;m<msg.length;m++){$("."+msg[m]).removeClass("hide");}$(".car-finance-message").removeClass("hide");}else{$(".car-finance-message").addClass("hide");}}};LBG.statements=window.LBG.statements||(function(){var config=DI.lang.statement||{};var statements=new AspectCollection();statements.addAspectAsFunction(function(){var TransactionDetails=(function($,config){var templates={debit:'<tr class="detail"><td><div class="reveal">  <div style="text-align:center">&nbsp;</div>  </div></td></tr>',credit:'<tr class="detail"><td><div class="reveal">  <div style="text-align:center">&nbsp;</div>  </div></td></tr>',vef:'<tr class="detail"><td><div class="reveal">  <div style="text-align:center">&nbsp;</div>  </div></td></tr>',current:'<tr class="detail"><td><div class="reveal">  <div style="text-align:center">&nbsp;</div>  </div></td></tr>'};
function TransactionDetail(element){var self=this;var metadata=$(element).metadata();this.type=metadata.type;this.rowid=metadata.rowid;this.transAmount=metadata.amount;this.transRef=metadata.transactionRef;this.merchantName=metadata.merchantName;if(this.type=="credit"){this.url=DI.vtdCredit.ajax.url+"?rowid="+this.rowid+"&merchantname="+this.merchantName;}else{this.url=DI.vtd.ajax.url+"?rowid="+this.rowid+"&merchantname="+this.merchantName;}console.log("this.url = "+this.url);var tmp=$(templates[this.type]).clone();$(element).bind("row_expanded",function(e){self.handler(e);if(typeof dcsMultiTrack!="undefined"){dcsMultiTrack("WT.ac","xxx TBC","WT.si_n","ViewTransactionDetails","WT.si_x",1,"WT.tx_e","s","WT.pn_sku",self.type,"WT.tx_s",self.transAmount,"WT.tx_i",self.transRef,"DCSext.mername",self.merchantName);}});$(element).bind("row_collapsed",function(e){LBG.track({});});if($(element).is(".alt")){tmp.addClass("alt");}$("td",tmp).attr("colSpan",$("td, th",element).length);$(element).after(tmp);if("vef"===this.type){var html=$("td:first-child",element).remove().html();$(element).prepend($('<th class="first"></td>').html(html));tmp.addClass("creditCard");if(!$(element).closest(".pane").is(".accountData")){$(element).closest(".pane").addClass("accountData");}}this.details=tmp;}TransactionDetail.prototype.handler=function(e){var self=this;var details=$(this.details);if(!details.hasClass("loaded")){details.addClass("loading");$.ajax({url:this.url,success:function(result){$("td > div",details).html(result);details.removeClass("loading").addClass("loaded");$("a.transQuery",details).click(function(){var metadata=$(this).metadata();if(typeof dcsMultiTrack!="undefined"){dcsMultiTrack("WT.ac",metadata.analyticsRef);}});if(typeof dcsMultiTrack!="undefined"){if(self.type=="credit"){dcsMultiTrack("WT.ac","pages/p42_00_account_statement/properties.p4200lnk521a,pages/p42_00_account_statement/properties.p2700lnk521c,I have a query about this transaction");}else{dcsMultiTrack("WT.ac","pages/p27_00_account_statement/properties.p2700lnk501a,pages/p27_00_account_statement/properties.p2700lnk501c,I have a query about this transaction");}}},error:function(){$("td > div",details).html(config[self.type].html.error).addClass("error");details.removeClass("loading");}});}};return TransactionDetail;})($,config.viewTransactionDetails||{});$(".vtd").each(function(idx){new TransactionDetails(this);});});return statements;})();LBG.emailModule=(function(){var init=function(){$("div.optionalEmail").each(function(){var $this=$(this);var checkbox=$this.find('input[type="checkbox"]').eq(0);var hidden=$this.find('input[type="hidden"]').eq(0);var emailfields=$this.find('input[type="text"]');var emailcapture=$this.find("div.emailShowHide");var pane=$this.find(".pane");if(checkbox.length>0){checkbox.attr("checked","");emailcapture.hide();checkbox.click(function(){if(emailcapture.hasClass("email-visible")){emailcapture.removeClass("email-visible");emailcapture.hide();pane.hide();if(hidden.length>0){emailfields.val(hidden.val());}}else{emailcapture.addClass("email-visible");emailcapture.show();}});}else{emailcapture.show();$this.find(".inner").eq(0).addClass("dash");}});};return{init:init};})();LBG.IEemptyCells=(function(){var init=function(){if(jQuery.browser.msie&&jQuery.browser.version<8){$("td:empty").html("&nbsp;");}};return{init:init};})();LBG.residentialStatusLRA=(function(){var init=function(){$(".residentialStatus select").change(function(){var residentialInputs=$(".residentialStatus").find('input[type="text"]:visible');var regexDecimal=/^[0-9]+\.?[0-9]*$/;if(residentialInputs.length>1){residentialInputs.each(function(){$(this).blur(function(){if(((regexDecimal.test($(".homeOwner input").val())==true)&&(regexDecimal.test($(".privateTenant input").val())==false))||((regexDecimal.test($(".homeOwner input").val())==false)&&(regexDecimal.test($(".privateTenant input").val())==true))){residentialInputs.each(function(){if((regexDecimal.test($(this).val())==false)&&($(this).val()=="")){$(this).parent().parent().removeClass("error");$(this).parent().children("span.error").remove();}});}});});}});};return{init:init};})();LBG.addRemoveRowsLRA={init:function(){$(".tblStyle .inner").hide();$(".tblStyle .inner:first-child").show();$(".tblStyle .inner").each(function(){$(this).find("select").each(function(){if(($(this).val()!="")&&($(this).val()!="-")){$(this).closest("div.inner").show();if($(".currentCosts input[type=radio]").val()=="yes"){var visibleRows=$(this).closest(".currentCosts").find(".inner:visible");if(visibleRows.length>1){visibleRows.each(function(){if($(this).find(".removeDebt").length==0){$(this).append('<a class="removeDebt" href="#">Remove</a>');}else{$(this).find(".removeDebt").show();}});}if(($(this).closest(".currentCosts").find("p.addMoreDebt").length==0)&&(visibleRows.length<20)){visibleRows.parent().append('<p class="addMoreDebt"><a href="#">Add another?</a></p>');}$(".addMoreDebt a").live("click",function(){var tblAction=$(this).closest(".tblStyle");tblAction.children(":hidden:eq(0)").show();if((tblAction.find(".inner:visible").length>=2)){tblAction.find(".inner:visible").each(function(){if($(this).find(".removeDebt").length==0){$(this).append('<a class="removeDebt" href="#">Remove</a>');}else{tblAction.find(".inner").find(".removeDebt").show();}});}if(tblAction.find(".inner:visible").length==20){$(this).hide();}return false;});$(".removeDebt").live("click",function(){var tblReset=$(this).closest("div.inner");var tblContainer=$(this).closest("div.tblStyle");tblReset.find("select").val([0]);tblReset.find("input[type=text]").val("");tblReset.find(".formField").removeClass("error");tblReset.find("span.error").html("");tblReset.find(".removeDebt").remove();tblReset.hide().insertBefore($(".addMoreDebt"));if((tblContainer.find(".inner:visible").length<20)&&(tblContainer.find(".addMoreDebt").length==1)){tblContainer.find(".addMoreDebt a").show();}if(tblContainer.find(".inner:visible").length==1){tblContainer.find(".inner:visible .removeDebt").remove();}return false;});}}}),$(this).find("input").each(function(){if($(this).val()!=""){$(this).closest("div.inner").show();}});});$(".currentCosts input[type=radio]").click(function(){if($(this).val()=="yes"){var visibleRows=$(this).closest(".currentCosts").find(".inner:visible");if(visibleRows.length>1){visibleRows.each(function(){if($(this).find(".removeDebt").length==0){$(this).append('<a class="removeDebt" href="#">Remove</a>');}else{$(this).find(".removeDebt").show();}});}if(($(this).closest(".currentCosts").find("p.addMoreDebt").length==0)&&(visibleRows.length<20)){visibleRows.parent().append('<p class="addMoreDebt"><a href="#">Add another?</a></p>');}$(".addMoreDebt a").live("click",function(){var tblAction=$(this).closest(".tblStyle");tblAction.children(":hidden:eq(0)").show();if((tblAction.find(".inner:visible").length>=2)){tblAction.find(".inner:visible").each(function(){if($(this).find(".removeDebt").length==0){$(this).append('<a class="removeDebt" href="#">Remove</a>');}else{tblAction.find(".inner").find(".removeDebt").show();}});}if(tblAction.find(".inner:visible").length==20){$(this).hide();}return false;});$(".removeDebt").live("click",function(){var tblReset=$(this).closest("div.inner");var tblContainer=$(this).closest("div.tblStyle");tblReset.find("select").val([0]);tblReset.find("input[type=text]").val("");tblReset.find(".formField").removeClass("error");tblReset.find("span.error").html("");tblReset.find(".removeDebt").remove();tblReset.hide().insertBefore($(".addMoreDebt"));
if((tblContainer.find(".inner:visible").length<20)&&(tblContainer.find(".addMoreDebt").length==1)){tblContainer.find(".addMoreDebt a").show();}if(tblContainer.find(".inner:visible").length==1){tblContainer.find(".inner:visible .removeDebt").remove();}return false;});}});}};LBG.residentialStatusLRA={init:function(){$(".residentialStatus select").change(function(){$(".homeOwner , .privateTenant").removeClass("error");$(".homeOwner span.error , .privateTenant span.error").remove();if($(".residentialStatus input[type=text]:visible").length==1){$(".residentialStatus input[type=text]:hidden").val("");LBG.Forms.Validation.Manip.add($(".formField.homeOwner , .formField.privateTenant"),"required");}else{if($(".residentialStatus input[type=text]:visible").length>1){LBG.Forms.Validation.Manip.remove($(".formField.homeOwner:eq(0) , .formField.privateTenant:eq(0)"),"required");}}});}};LBG.procedureIndicator={init:function(){$(".procImgOverrideAction").click(function(){var activeCheckbox=$(this).prev();if(activeCheckbox.is(":checked")===false){$(this).attr("src",DI.procedureIndicatorImages.overrideInActive);activeCheckbox.attr("checked","checked").change();$(this).closest(".formField").removeClass("error");if(availableCredit()<0){return false;}}});}};var AuthPolling=new Class(".authPanel",{init:function(element,window,config){var metadata=new Config($(element).metadata()).get("authPanel",null);this.config=config.get(null!=metadata&&metadata.get("variant")?metadata.get("variant"):"authPolling");$("form, div.inner.dash").hide();this.delegate=function(func){var self=this;return function(){return func.apply(self,arguments);};};this.interval=window.setInterval(this.delegate(this.tick),this.config.get("frequency"));this.timeout=window.setTimeout(this.delegate(this.timeout),this.config.get("timeoutInterval"));this.isSubmitting=false;},tick:function(){$.getJSON(LBG.common.ajax.tagUrl(this.config.get("url")),this.delegate(this.process));},timeout:function(){window.clearInterval(this.interval);this.process(this.config.get("timeoutData").val());},process:function(json){var i=0;for(var k in json){if(json.hasOwnProperty(k)){$('<input type="hidden">').attr({name:k,value:json[k]}).appendTo("form");++i;}}if(i&&!this.isSubmitting){this.submit();}},submit:function(){this.isSubmitting=true;window.clearInterval(this.interval);$("form input[type=image], form input[type=submit]").click(function(e){LBG.Forms.Validation._submitManagement(e);}).click();}},window,new Config(DI));LBG.MiData=(function(){var init=function(){if($("body").hasClass("pageLoadWithAjax")){setInterval(function(){poll();},3000);}function poll(){var json_url=DI.lang.miData.ajax.url;var success_url=DI.lang.miData.navigation.success;var error_url=DI.lang.miData.navigation.error;$.ajax({url:json_url,type:"GET",dataType:"json",success:function(data){$.each(data,function(key,val){if(key=="status"){switch(val){case"NotStarted":$("body.pageLoadWithAjax .statusInProcess").remove();$("body.pageLoadWithAjax .statusNotStarted").css({"display":"block"});break;case"InProgress":$("body.pageLoadWithAjax .statusNotStarted").css({"display":"none"});$("body.pageLoadWithAjax .statusInProcess").css({"display":"block"});break;case"Error":$("body.pageLoadWithAjax .statusInProcess").remove();$("div.miDataVariantContent").load("selectaccount.jsp div.statusNotStarted");window.location.href=error_url;break;case"Success":$("body.pageLoadWithAjax .statusInProcess").remove();$("div.miDataVariantContent").load("selectaccount.jsp div.statusNotStarted");window.location.href=success_url;break;}}});},error:function(data){$("body.pageLoadWithAjax .statusInProcess").remove();$("body.pageLoadWithAjax .miDataErrorContainer").css({"display":"block"});LBG.track({"DCSext.Errorcode":"MI Data Ajax Error"});$("body.pageLoadWithAjax .statusNotStarted").css({"display":"block"});},cache:false});}};return{init:init};})();LBG.appBanner=function(){var bannerEl;function getOS(){var mobileOS;if(navigator.userAgent.match(/Android/i)!==null){mobileOS="android";}return mobileOS;}function closeBanner(){bannerEl.style.display="none";$(".hasJS").removeClass("app-banner-open");$("#wrapper").css("margin-top","0");}function openBanner(){bannerEl.style.display="block";$(".hasJS").addClass("app-banner-open");if((".app-banner:visible")){var wid=window.screen.width;if(wid>360){wid=wid/window.devicePixelRatio;}var ratio=$(window).width()/wid;if(ratio>3){ratio=2;}$(".app-banner").css("top",parseFloat($(".app-banner").css("top"))*ratio);$(".app-banner").css("height",parseFloat($(".app-banner").css("height"))*ratio);$(".app-banner .sb-container").css("-webkit-transform","scale("+ratio+")");$(".app-banner .sb-container").css("-msie-transform","scale("+ratio+")");$(".app-banner .sb-container").css("-moz-transform","scale("+ratio+")");$(".app-banner .sb-container").css("width",$(window).width()/ratio);var appheight=$(".app-banner").outerHeight();$("#wrapper").css("margin-top",appheight+"px");}}function init(){var closeEl;bannerEl=$(".app-banner");bannerContainter=$(".app-banner .sb-container");if(!bannerEl.length){return;}bannerEl=bannerEl[0];bannerContainter=bannerContainter[0];closeEl=document.createElement("a");closeEl.className="sb-close";closeEl.title="Hide App Link";closeEl.href="#";closeEl.innerHTML="<span>x</span>";bannerContainter.appendChild(closeEl);openBanner();$(closeEl).click(function(e){e.preventDefault();closeBanner();},false);}return{init:init};}();LBG.CommercialRBBSCardDetails=(function(){var init=function(){if($(".cardTotal").length>0){$("dl.highlighted_cash_balance").show();}else{$("dl.highlighted_cash_balance").hide();}$(".rbbsCardSelection").change(function(){var cardLastFourDigits=$(this).val();var cardId=DI.lang.rbbsCardDetails.url+"?cardID="+cardLastFourDigits;$("div.rbbs_card_spinner").show();$(".rbbs_ajax_error").hide();$.ajax({url:cardId,success:function(data){$("div.rbbs_card_spinner").hide();$(".rbbs_ajax_error").hide();$("table.rbbs_commercial_table tbody").children().remove();$("table.rbbs_commercial_table tbody").html($(data).find(".filter_"+cardLastFourDigits).html());if($(data).filter("div.filterWrapper_"+cardLastFourDigits).find("div.cardTotal").length>0){$("dl.highlighted_cash_balance").show();$("div.dropdown_pattern dl.highlighted_cash_balance dd").html($(data).filter("div.filterWrapper_"+cardLastFourDigits).find("div.cardTotal").html());}else{$("dl.highlighted_cash_balance").hide();}},cache:false,error:function(jqXHR,textStatus,errorThrown){$("table.rbbs_commercial_table").hide();$("div.rbbs_card_spinner").hide();$(".rbbs_ajax_error").show();}});});$(".rbbs_cards .rbbs_more_trans").click(function(){var cardId=DI.lang.rbbsCardDetails.moreTransUrl;$("div.rbbs_card_spinner").show();$(".rbbs_ajax_error").hide();$.ajax({url:cardId,success:function(data){$("div.rbbs_card_spinner").hide();$(".rbbs_ajax_error").hide();$("table.rbbs_commercial_table tbody").append(data);$(".rbbs_cards .rbbs_more_trans").hide();},error:function(jqXHR,textStatus,errorThrown){$("div.rbbs_card_spinner").hide();$(".rbbs_ajax_error").show();}});});};return{init:init};})();LBG.RetailBaselinePJB=(function(){var sortCodeContainer=$(".content .infoAlertBox").prev().find("input:text, input[type=number]");var sameValue=false;var arr=[];var sortedSortCode;var prevSortCode;$(sortCodeContainer).blur(function(){$(sortCodeContainer).each(function(i){arr[i]=$(this).val();if((arr[0]&&arr[1]&&arr[2]!=="")&&((arr[0]).length==2&&(arr[1]).length==2&&(arr[2]).length==2)){if(arr[0].match(/^\d+$/)&&arr[1].match(/^\d+$/)&&arr[2].match(/^\d+$/)){sortedSortCode=arr[0]+arr[1]+arr[2];
if(sameValue==false||sortedSortCode!==prevSortCode){prevSortCode=arr[0]+arr[1]+arr[2];var sortCodeId=DI.lang.baselinePJB.url+"?sortCode="+sortedSortCode;$("div.pjb_spinner").show();$(".pjb_ajax_error").hide();$(".pjb_mismatch_error").hide();$.ajax({url:sortCodeId,success:function(data,success){var bankNameDisplayBox=$(".content .infoAlertBox dl dd em");$("div.pjb_spinner").hide();if(data==""||data==undefined){$(".pjb_mismatch_error").show();$(".pjb_ajax_error").hide();$(".content .infoAlertBox").hide();}else{if(data=="null"){$(".pjb_ajax_error").show();$(".pjb_mismatch_error").hide();$(".content .infoAlertBox").hide();}else{$(".pjb_mismatch_error").hide();$(".pjb_ajax_error").hide();$(".content .infoAlertBox").show();bankNameDisplayBox.show();bankNameDisplayBox.empty();bankNameDisplayBox.html(data);sameValue=true;}}},cache:false,error:function(jqXHR,textStatus,error){$("div.pjb_spinner").hide();$(".pjb_ajax_error").show();$(".pjb_mismatch_error").hide();}});}}else{$(".content .infoAlertBox").hide();}}else{$(".content .infoAlertBox").hide();}});});});LBG.confimSavingsPayment={init:function(){$(".interestAccount input:radio").change(function(){if($(this).is(":checked")){$(".textGroup.accountDetails input[type=text]").each(function(){$(this).val("");});}});}};LBG.newWindow={init:function(){$('a[class^="newWindow"]').click(function(){var classDimensions=$(this).attr("class").split("_"),winWidth=classDimensions[1],winHeight=classDimensions[2];window.open($(this).attr("href"),"_blank","width="+winWidth+" , height="+winWidth+" , scrollbars=yes");return false;});}};LBG.penniesForPudsey=(function(){$("select.p4pSelectionList").change(function(){if($(this)[0].selectedIndex===0){$(".showOnSelectionChange").hide();}else{$(".showOnSelectionChange").show();}});if($("a.tAndCOverlayLauncher").attr("href")!=="#"){if(($.browser.msie&&$.browser.version>=8)||!($.browser.msie)){$("a.tAndCOverlayLauncher").attr("href","#");}}$("a.tAndCOverlayLauncher").click(function(){$(".togglep4pOverlay").show();});$(".togglep4pOverlay input.closeOverlay").click(function(){$(".togglep4pOverlay").hide();});});LBG.colleagueBar=function(){function toggleTableRowContent(){$(".table-expanding-row .toggle").click(function(e){e.preventDefault();var toggleElem=$(this).closest("tr").next("tr.expand-child");if(toggleElem.css("display")=="none"){toggleElem.show();$(this).removeClass("open");$(this).addClass("close");}else{toggleElem.hide();$(this).removeClass("close");$(this).addClass("open");}});}function tieChild(){$(".expand-child").each(function(i){i+=1;$(".tie-child-"+i).after($(".child-"+i));});}function createZebra(){$(".table-expanding-row tbody tr.odd, .table-expanding-row tbody tr.even").each(function(i){i+=1;$(this).removeClass("even");$(this).removeClass("odd");if(i%2==0){$(this).addClass("even");}else{$(this).addClass("odd");}});}function getFirstElementText(node){var getFirstElementText;if($(node).children().length>=1){getFirstElementText=$(node).children().eq(0).html();}else{getFirstElementText=$(node).html();}return getFirstElementText;}function colleagueBarOverlay(){$("a.colleagueOverlayClosed").click(function(){$("div.colleagueOverlayClosed").removeClass("show-element-colleaguebar");$("div.colleagueOverlayClosed").addClass("hide-element-colleaguebar");$("div.colleagueOverlayVisible").removeClass("hide-element-colleaguebar");$("div.colleagueOverlayVisible").addClass("show-element-colleaguebar");$("div.overlayLauncher, table.table-expanding-row thead").width($(".outer").width());if($.browser.msie&&$.browser.version==6){var screenHeight=$(window).height();var screenWidth=$(window).width();$("div#olMaskColleagueBar").height(screenHeight);$("div#olMaskColleagueBar").width(screenWidth);$(".navBar .formField select.slctViewAccount").css("display","none");}});$("a.colleagueOverlayOpen").click(function(){$("div.colleagueOverlayClosed").removeClass("hide-element-colleaguebar");$("div.colleagueOverlayClosed").addClass("show-element-colleaguebar");$("div.colleagueOverlayVisible").removeClass("show-element-colleaguebar");$("div.colleagueOverlayVisible").addClass("hide-element-colleaguebar");if($.browser.msie&&$.browser.version==6){$(".navBar .formField select.slctViewAccount").css("display","block");}});}function fixedPositionMinWidth(){$("div.overlayLauncher, table.table-expanding-row thead").width($(".outer").width());$(window).resize(function(){$("div.overlayLauncher, table.table-expanding-row thead").width($(".outer").width());});}function findTopOfPage(){if($("div.colleague_intro_message").length>0){$(window).scroll(function(){if($(window).scrollTop()<50){$("table.table-expanding-row thead").removeClass("activeScroll");$("table.table-expanding-row thead").addClass("inActiveScroll");}else{$("table.table-expanding-row thead").removeClass("inActiveScroll");$("table.table-expanding-row thead").addClass("activeScroll");}});}}function init(){$("table.table-expanding-row").tablesorter({cssChildRow:"expand-child",dateFormat:"uk",textExtraction:getFirstElementText,headers:{6:{sorter:false},7:{sorter:false}}});toggleTableRowContent();colleagueBarOverlay();fixedPositionMinWidth();findTopOfPage();$("table.table-expanding-row").bind("sortEnd",function(){tieChild();createZebra();});}return{init:init};}();LBG.focusOnPageLoad={init:function(){if($(".pageload-focus").length){$(".pageload-focus input[type=text]").focus();}if($(".hasJS .content .avaSuitabilityCheck .avaSuitabilitySectionOne a.avaRadioBtn").length>0){$(this).focus();}}};LBG.config={newWindowTabClassList:{newWinClass:"newwin",newFaqClass:"newfaqwin",newhelpClass:"newhelpwin",overlayClass:"overlay",printwinClass:"printwin",statementLinkClass:"statementLink",pdfLinkClass:"pdfLink",tabBrowseClass:"tabBrowse",tabSearchClass:"tabSearch",oabAddToCalLinkClass:"oabAddToCalLink"}};LBG.newWindowTabClassListChecker=(function(){return{checkMatchingClass:function(obj){var isLinkClassMatching=false;$.each(LBG.config.newWindowTabClassList,function(key,value){if($(obj).hasClass(value)){isLinkClassMatching=true;return false;}});return isLinkClassMatching;}};})();LBG.autoLogoutApp=(function(){var isGenerateCookieParam=true;var params=DI.cookieAutoLogout;return{init:function(){$(window).bind("beforeunload",function(event){var currentTimeInMilliSec=+new Date();if(DI.cookieAutoLogout){if(isGenerateCookieParam===true){$.cookie(params.name,currentTimeInMilliSec,{expires:params.expires,path:params.path,secure:true});}}});$("form").submit(function(e){isGenerateCookieParam=false;});$("a").click(function(e){isGenerateCookieParam=false;var hrefLinkMatch=$(this).attr("href").substring(0,1)=="#";var ajaxLinkMatch=$(this).attr("data-ajax-uri")!=null;var hasMatchingLinkClass=LBG.newWindowTabClassListChecker.checkMatchingClass(this);if(hrefLinkMatch||ajaxLinkMatch||hasMatchingLinkClass){isGenerateCookieParam=true;}});}};})();LBG.inputKeyboard={init:function(){var touchCapable=false;var lastElement;if(("ontouchstart" in window)||(navigator.maxTouchPoints>0)||(navigator.msMaxTouchPoints>0)){touchCapable=true;}var pat804=$(".pat-804-input-number input");if(pat804.length>0){lastElement=pat804[pat804.length-1];}var enableSortCodeFields=function(){var pat804=$(".pat-804-input-number input");for(var i=0;i<pat804.length;i++){pat804[i].ready=true;}};for(var i=0;i<pat804.length;i++){if(touchCapable){pat804[i].setAttribute("type","tel");}pat804[i].setAttribute("max","99");pat804[i].setAttribute("maxlength","2");$(pat804[i]).blur(function(e){if(this.id==lastElement.id){this.ready=true;LBG.Forms.Validation.Tools.getFieldHandler($(".pat-804-input-number")).validate();
}});$(pat804[i]).focus(function(e){var maxLength=2;if(lastElement.value.length==0){lastElement.ready=false;}if(this.value.length>0&&this.id!=lastElement.id){this.value=this.value.slice(0,maxLength);if($.browser.msie){$(this).select();}}});$(pat804[i]).keyup(function(e){var maxLength=2;var key=e.which||e.keyCode||e.charCode;if(key==37||key==39){return;}if($(this).val().length==maxLength){var inputs=$(this).closest(".pat-804-input-number").find(":input");if((key!=8&&key!=46&&key!=9&&key!=35&&key!=36)){inputs.eq(inputs.index(this)+1).focus();}}if((key==8||key==46)){enableSortCodeFields();}},false);$(pat804[i]).keydown(function(e){var key=e.which||e.keyCode||e.charCode;if((key==8||key==46)&&$(this).val()==""){var inputs=$(this).closest(".pat-804-input-number").find(":input");inputs.eq(inputs.index(this)-1).focus();e.preventDefault();}},false);}if(touchCapable){var pat800=$(".pat-800-input-email input");for(var i=0;i<pat800.length;i++){pat800[i].setAttribute("type","email");pat800[i].setAttribute("autocomplete","on");}var pat801=$(".pat-801-input-tel input");for(var i=0;i<pat801.length;i++){pat801[i].setAttribute("autocomplete","on");pat801[i].setAttribute("type","tel");}var pat802=$(".pat-802-input-telext input");for(var i=0;i<pat802.length;i++){pat802[i].setAttribute("autocomplete","on");pat802[i].setAttribute("type","tel");$(".pat-802-input-telext .fullNumber").css("width","70%");$(".pat-802-input-telext .fullNumber").css("float","left");$(".pat-802-input-telext label").addClass("postit");$(".pat-802-input-telext .fullNumber").css("margin-right","4%");$(".extension").css("width","20%");$(".extension").attr("placeholder","ext");if($(".pat-802-input-telext .ngb-grouped-input").length){$(".pat-802-input-telext .ngb-grouped-input").css("display","inline");}}$(".pat-802-input-telext input").blur(function(){$(".pat-802-input-telext .fullNumber").css("width","70%");$(".extension").css("width","20%");if($(".pat-802-input-telext .ngb-grouped-input").length){$(".pat-802-input-telext .ngb-grouped-input").css("display","inline");}});$(".pat-802-input-telext input").focus(function(){this.setAttribute("type","tel");this.setAttribute("placeholder","");$(".pat-802-input-telext .fullNumber").css("width","70%");$(".extension").css("width","20%");if($(".pat-802-input-telext .ngb-grouped-input").length){$(".pat-802-input-telext .ngb-grouped-input").css("display","inline");}});$(".pat-802-input-telext .extension").blur(function(){$(".pat-802-input-telext .fullNumber").css("width","70%");$(".extension").css("width","20%");if(this.value==""){this.setAttribute("placeholder","ext");}});var pat803=$(".pat-803-input-number input");for(var i=0;i<pat803.length;i++){pat803[i].setAttribute("type","number");pat803[i].setAttribute("step","any");}$(".pat-803-input-number input").blur(function(){var a=this;if(a.value!="0"){a.value=a.value.replace(/^0+/,"");}if(a.value.indexOf(".")<0&&a.value!=""){a.value=a.value+".00";}if(a.value<1&&a.value!=""){a.value="0"+a.value;}if(a.value.indexOf(".")<0&&a.value!=""){if(LBG.Forms.Validation.Routines.simpleRegexTest(LBG.Forms.Validation.Expressions.numeric,parseInt(a.value.replace(/,/g,""),10))){a.value+=".00";}}else{if(a.value!=""){var splitDecimal=a.value.split("."),decimalPlaces="";for(var i=1;i<splitDecimal.length;i++){if(splitDecimal[i]!==""){decimalPlaces=splitDecimal[i];}}if(decimalPlaces.length<2){a.value=a.value+"0";}if(decimalPlaces.length<1){a.value=a.value+"0";}}}LBG.Forms.Validation.init();});$(".pat-803-input-number input").keydown(function(e){var charCode=e.which||e.keyCode||e.charCode;if((charCode<47||charCode>57)&&charCode!=190&&charCode!=8&&charCode!=46&&charCode!=13&&charCode!=32&&charCode!=9){e.preventDefault();}var b=this;if((b.value.indexOf(".")>0&&charCode==190)){e.preventDefault();}});$(".pat-803-input-number input").keyup(function(e){var maxLength=this.getAttribute("maxlength");maxLength=(maxLength!=null)?maxLength:10;this.value=this.value.slice(0,maxLength);});var pat805=$(".pat-805-input-number input");for(var i=0;i<pat805.length;i++){pat805[i].setAttribute("type","tel");}var pat809=$(".pat-809-input-number input");for(var i=0;i<pat809.length;i++){if(!$(pat809[i]).hasClass("submitAction")){pat809[i].setAttribute("type","tel");}}}}};LBG.clickableAreaForCheckbox={isCheckboxClicked:false,init:function(){$("input:checkbox[class$=cbxSelectableSignature]").click(function(){LBG.clickableAreaForCheckbox.isCheckboxClicked=true;});$("label[class$=clsLblSignature]").click(function(){LBG.clickableAreaForCheckbox.isCheckboxClicked=true;});$("div[class$=cbxSelectableDiv] strong").click(function(){LBG.clickableAreaForCheckbox.isCheckboxClicked=true;});$("div[class$=cbxSelectableDiv] span").click(function(){LBG.clickableAreaForCheckbox.isCheckboxClicked=true;});$("div[class$=cbxSelectableDiv]").click(function(event){if(event.target.nodeName=="A"||(event.target.nodeName=="SPAN"&&event.target.className=="error")){return;}var selector="";selector=$(this).closest(".cbxSelectableDiv");var checkbox=selector.find("input:checkbox[class$=cbxSelectableSignature]");if(LBG.clickableAreaForCheckbox.isCheckboxClicked){LBG.clickableAreaForCheckbox.isCheckboxClicked=false;event.stopPropagation();}else{if(checkbox.length>0){var validationHandler=LBG.Forms.Validation.Tools.getFieldHandler(checkbox);if(checkbox.is(":checked")){checkbox.attr("checked",false);}else{checkbox.attr("checked",true);}validationHandler.validate();if(validationHandler.isValid){validationHandler.hideError();}else{validationHandler.showError();}event.stopPropagation();}}});}};LBG.progressiveRevealForm={years:0,months:0,timeAtCurAdr:0,selectedElement:"",selectedFieldID:[],HomeDiallingCode:0,HomeAreaCode:0,HomePhoneNumber:0,isValidHomeNumber:false,MobileDiallingCode:0,MobilePhoneNumber:0,isValidMobileNumber:false,WorkDiallingCode:0,WorkAreaCode:0,WorkPhoneNumber:0,WorkPhoneExtensionNumber:0,isValidWorkNumber:false,MemorableWord:"",ConfMemorableWord:"",fieldsTobeChecked:{"address":[{"YearsAtCurrentAddress":":txtYearsAtCurrentAddress","MonthsAtCurrentAddress":":txtMonthsAtCurrentAddress","YearsAtPreviousAddress":":txtYearsAtPreviousAddress","MonthsAtPreviousAddress":":txtMonthsAtPreviousAddress","AJAXMonthsAtPreviousAddress":":txtMonthsAtPreviousAddress0","AJAXYearsAtPreviousAddress":":txtYearsAtPreviousAddress0","UnauthYearsAtPreviousAddress":":txtYearsAtPreviousAddress0","UnauthMonthsAtPreviousAddress":":txtMonthsAtPreviousAddress0"}],"OtherName":"clsOtherName","EmailAddress":"clsEmailAddress","MemorableWord":"clsMemorableWord","ConfMemorableWord":"clsConfMemorableWord","phoneNumbers":[{"HomeDiallingCode":"intDialCode","HomeAreaCode":"areaCode","HomePhoneNumber":"subscriberNumber"},{"MobileDiallingCode":"intDialCode","MobilePhoneNumber":"mobileNumber"},{"WorkDiallingCode":"intDialCode","WorkAreaCode":"areaCode","WorkPhoneNumber":"subscriberNumber","WorkPhoneExtensionNumber":"extension"}]},checkMonthOfCurrentAddress:function(){if(isNaN(this.years)||this.years<0||isNaN(this.months)||this.months<0){return 0;}else{return this.years*12+this.months;}},validateContactInfo:function(controller,type){if(type=="homephonenumber"){this.HomeDiallingCode=(controller.className.toLowerCase().indexOf(this.fieldsTobeChecked.phoneNumbers[0].HomeDiallingCode.toLowerCase())>=0)?parseInt(controller.value,10):this.HomeDiallingCode;this.HomeAreaCode=(controller.className.toLowerCase().indexOf(this.fieldsTobeChecked.phoneNumbers[0].HomeAreaCode.toLowerCase())>=0)?parseInt(controller.value,10):this.HomeAreaCode;this.HomePhoneNumber=(controller.className.toLowerCase().indexOf(this.fieldsTobeChecked.phoneNumbers[0].HomePhoneNumber.toLowerCase())>=0)?parseInt(controller.value,10):this.HomePhoneNumber;
if(this.HomeDiallingCode>0&&this.HomeAreaCode>0&&this.HomePhoneNumber>0){this.isValidHomeNumber=true;}}if(type=="mobilephonenumber"){this.MobileDiallingCode=(controller.className.toLowerCase().indexOf(this.fieldsTobeChecked.phoneNumbers[1].MobileDiallingCode.toLowerCase())>=0)?parseInt(controller.value,10):this.MobileDiallingCode;this.MobilePhoneNumber=(controller.className.toLowerCase().indexOf(this.fieldsTobeChecked.phoneNumbers[1].MobilePhoneNumber.toLowerCase())>=0)?parseInt(controller.value,10):this.MobilePhoneNumber;if(this.MobileDiallingCode>0&&this.MobilePhoneNumber>0){this.isValidMobileNumber=true;}}if(type=="workphonenumber"){this.WorkDiallingCode=(controller.className.toLowerCase().indexOf(this.fieldsTobeChecked.phoneNumbers[2].WorkDiallingCode.toLowerCase())>=0)?parseInt(controller.value,10):this.WorkDiallingCode;this.WorkAreaCode=(controller.className.toLowerCase().indexOf(this.fieldsTobeChecked.phoneNumbers[2].WorkAreaCode.toLowerCase())>=0)?parseInt(controller.value,10):this.WorkAreaCode;this.WorkPhoneNumber=(controller.className.toLowerCase().indexOf(this.fieldsTobeChecked.phoneNumbers[2].WorkPhoneNumber.toLowerCase())>=0)?parseInt(controller.value,10):this.WorkPhoneNumber;this.WorkPhoneExtensionNumber=(controller.className.toLowerCase().indexOf(this.fieldsTobeChecked.phoneNumbers[2].WorkPhoneExtensionNumber.toLowerCase())>=0)?parseInt(controller.value,10):this.WorkPhoneExtensionNumber;if(this.WorkDiallingCode>0&&this.WorkAreaCode>0&&this.WorkPhoneNumber>0&&this.WorkPhoneExtensionNumber>0){this.isValidWorkNumber=true;}}},validateDurationOfAddress:function(controller,frmID){var status=false;if(controller.id==frmID+this.fieldsTobeChecked.address[0].YearsAtCurrentAddress){this.years=parseInt(controller.value,10);}if(controller.id==frmID+this.fieldsTobeChecked.address[0].MonthsAtCurrentAddress){this.months=parseInt(controller.value,10);}if(controller.id==frmID+this.fieldsTobeChecked.address[0].YearsAtCurrentAddress||controller.id==frmID+this.fieldsTobeChecked.address[0].MonthsAtCurrentAddress){this.timeAtCurAdr=LBG.progressiveRevealForm.checkMonthOfCurrentAddress();if(this.timeAtCurAdr>=36){status=true;}else{status=false;}}if(controller.id==frmID+this.fieldsTobeChecked.address[0].YearsAtPreviousAddress||controller.id==frmID+this.fieldsTobeChecked.address[0].UnauthYearsAtPreviousAddress||controller.id==frmID+this.fieldsTobeChecked.address[0].AJAXYearsAtPreviousAddress){if(controller.value>0){status=true;}else{status=false;}}if(controller.id==frmID+this.fieldsTobeChecked.address[0].MonthsAtPreviousAddress||controller.id==frmID+this.fieldsTobeChecked.address[0].UnauthMonthsAtPreviousAddress||controller.id==frmID+this.fieldsTobeChecked.address[0].AJAXMonthsAtPreviousAddress){if(controller.value>0){status=true;}else{status=false;}}return status;},checkValidation:function(sectionId,step,whichEvent){var formElmController=sectionId.find(".formField").find("input:not(.submitAction), textarea, select").filter(":visible");var formID=sectionId.closest("form").attr("id");var count=0;var adrFieldArray=[formID+this.fieldsTobeChecked.address[0].YearsAtCurrentAddress,formID+this.fieldsTobeChecked.address[0].MonthsAtCurrentAddress,formID+this.fieldsTobeChecked.address[0].YearsAtPreviousAddress,formID+this.fieldsTobeChecked.address[0].MonthsAtPreviousAddress,formID+this.fieldsTobeChecked.address[0].AJAXYearsAtPreviousAddress,formID+this.fieldsTobeChecked.address[0].AJAXMonthsAtPreviousAddress,formID+this.fieldsTobeChecked.address[0].UnauthYearsAtPreviousAddress,formID+this.fieldsTobeChecked.address[0].UnauthMonthsAtPreviousAddress];var validFieldArray=[];for(var i=0;i<formElmController.length;i++){var validationHandler=LBG.Forms.Validation.Tools.getFieldHandler(formElmController[i]);if(validationHandler){var fldValue=$.trim(formElmController[i].value);if(fldValue!=""&&fldValue!="-"){if($.inArray(formElmController[i].id,LBG.progressiveRevealForm.selectedFieldID)>-1){switch(whichEvent.toLowerCase()){case"keyup":if(!$.browser.safari){validationHandler.validate();}break;case"click":case"mousemove":break;default:validationHandler.validate();break;}}switch(step){case"step-address-details":if(($.inArray(formElmController[i].id,adrFieldArray))>-1){validFieldArray[formElmController[i].id]=LBG.progressiveRevealForm.validateDurationOfAddress(formElmController[i],formID);}else{validFieldArray[formElmController[i].id]=true;}break;case"step-contact-details":if($(formElmController[i]).closest(".formField")[0].className.toLowerCase().indexOf("homephonenumber")>=0){LBG.progressiveRevealForm.validateContactInfo(formElmController[i],"homephonenumber");}if($(formElmController[i]).closest(".formField")[0].className.toLowerCase().indexOf("mobilephonenumber")>=0){LBG.progressiveRevealForm.validateContactInfo(formElmController[i],"mobilephonenumber");}if($(formElmController[i]).closest(".formField")[0].className.toLowerCase().indexOf("workphonenumber")>=0){LBG.progressiveRevealForm.validateContactInfo(formElmController[i],"workphonenumber");}if(this.isValidHomeNumber||this.isValidMobileNumber||this.isValidWorkNumber){validFieldArray[formElmController[i].id]=true;}if(formElmController[i].className.toLowerCase().indexOf(this.fieldsTobeChecked.EmailAddress.toLowerCase())>=0){if(validationHandler.isValid==true){validFieldArray[formElmController[i].id]=true;}else{validFieldArray[formElmController[i].id]=false;}}break;case"lastStep":if(formElmController[i].className.toLowerCase().indexOf(this.fieldsTobeChecked.MemorableWord.toLowerCase())>=0){this.MemorableWord=fldValue;}if(formElmController[i].className.toLowerCase().indexOf(this.fieldsTobeChecked.ConfMemorableWord.toLowerCase())>=0){this.ConfMemorableWord=fldValue;}if((this.MemorableWord===this.ConfMemorableWord)&&this.ConfMemorableWord.length>2){validFieldArray[formElmController[i].id]=true;if($(".primaryAction .prgRvlSubmitAction").length>0){$(".primaryAction .prgRvlSubmitAction").attr("disabled","");}}else{validFieldArray[formElmController[i].id]=false;}break;default:if(validationHandler.isValid){validFieldArray[formElmController[i].id]=true;}else{validFieldArray[formElmController[i].id]=false;}break;}if(formElmController[i].id==formID+this.fieldsTobeChecked.address[0].YearsAtCurrentAddress||formElmController[i].id==formID+this.fieldsTobeChecked.address[0].MonthsAtCurrentAddress){if(this.timeAtCurAdr>=36){validFieldArray[formElmController[i].id]=true;}}}else{switch(step){case"step-unauth-user-details":if(formElmController[i].className.toLowerCase().indexOf(this.fieldsTobeChecked.OtherName.toLowerCase())>0){if(validationHandler.isShowingError==true){validFieldArray[formElmController[i].id]=false;}else{validFieldArray[formElmController[i].id]=true;}}break;case"step-contact-details":if(this.isValidHomeNumber||this.isValidMobileNumber||this.isValidWorkNumber){if(formElmController[i].className.toLowerCase().indexOf(this.fieldsTobeChecked.EmailAddress.toLowerCase())>=0){validFieldArray[formElmController[i].id]=false;}else{validFieldArray[formElmController[i].id]=true;}}break;default:if(($.inArray(formElmController[i].id,adrFieldArray))>-1){if(this.timeAtCurAdr>=36){validFieldArray[formElmController[i].id]=true;}}else{validFieldArray[formElmController[i].id]=false;}if(formElmController[i].className.indexOf("fldOptional")>0){validFieldArray[formElmController[i].id]=true;}else{validFieldArray[formElmController[i].id]=false;}break;}}}else{validFieldArray[formElmController[i].id]=true;}}if(validFieldArray[formID+this.fieldsTobeChecked.address[0].YearsAtPreviousAddress]===true||validFieldArray[formID+this.fieldsTobeChecked.address[0].UnauthYearsAtPreviousAddress]===true||validFieldArray[formID+this.fieldsTobeChecked.address[0].AJAXYearsAtPreviousAddress]===true){validFieldArray[formID+this.fieldsTobeChecked.address[0].YearsAtCurrentAddress]=true;
validFieldArray[formID+this.fieldsTobeChecked.address[0].MonthsAtCurrentAddress]=true;validFieldArray[formID+this.fieldsTobeChecked.address[0].MonthsAtPreviousAddress]=true;validFieldArray[formID+this.fieldsTobeChecked.address[0].AJAXMonthsAtPreviousAddress]=true;}if(validFieldArray[formID+this.fieldsTobeChecked.address[0].MonthsAtPreviousAddress]===true||validFieldArray[formID+this.fieldsTobeChecked.address[0].UnauthMonthsAtPreviousAddress]===true||validFieldArray[formID+this.fieldsTobeChecked.address[0].AJAXMonthsAtPreviousAddress]===true){validFieldArray[formID+this.fieldsTobeChecked.address[0].YearsAtPreviousAddress]=true;validFieldArray[formID+this.fieldsTobeChecked.address[0].AJAXYearsAtPreviousAddress]=true;validFieldArray[formID+this.fieldsTobeChecked.address[0].YearsAtCurrentAddress]=true;validFieldArray[formID+this.fieldsTobeChecked.address[0].MonthsAtCurrentAddress]=true;}for(var i=0;i<formElmController.length;i++){if(validFieldArray[formElmController[i].id]==true){count++;}}if(count>=formElmController.length){return true;}else{return false;}},GetUnique:function(iptArray){var optArray=[];for(var i=0;i<iptArray.length;i++){if(($.inArray(iptArray[i],optArray))==-1){optArray.push(iptArray[i]);}}return optArray;},initVallidation:function(step,stepId,whichEvent){if(stepId=="lastStep"){LBG.progressiveRevealForm.checkValidation(step,stepId,whichEvent);}else{if(LBG.progressiveRevealForm.checkValidation(step,stepId,whichEvent)){step.next().fadeIn(1000);}}},bindEvent:function(){$(".frmProgressiveReveal .section-row input:not(.submitAction,.pseudoLink), textarea, select").bind("click",function(e){LBG.progressiveRevealForm.initVallidation($(this).closest(".section-row"),$(this).closest(".section-row")[0].className.split(" ",1)[0],"click");}).live($.browser.msie?"focusout":"change",function(e){e.preventDefault();LBG.progressiveRevealForm.initVallidation($(this).closest(".section-row"),$(this).closest(".section-row")[0].className.split(" ",1)[0],"change");}).live($.browser.safari?"keyup":"",function(e){e.preventDefault();LBG.progressiveRevealForm.initVallidation($(this).closest(".section-row"),$(this).closest(".section-row")[0].className.split(" ",1)[0],"keyup");}).live($.browser.mozilla?"keyup":"mousemove",function(e){e.preventDefault();LBG.progressiveRevealForm.initVallidation($(this).closest(".section-row"),$(this).closest(".section-row")[0].className.split(" ",1)[0],"mousemove");});},init:function(e){if($(".primaryAction .prgRvlSubmitAction").length>0){$(".primaryAction .prgRvlSubmitAction").attr("disabled","disabled");}var objElm="";var vldHnlr="";$(".frmProgressiveReveal .section-row input:not(.submitAction,.pseudoLink), textarea, select").click(function(){LBG.progressiveRevealForm.selectedElement=$(this).attr("id");objElm=$(this);LBG.progressiveRevealForm.selectedFieldID.push($(this).attr("id"));LBG.progressiveRevealForm.selectedFieldID=LBG.progressiveRevealForm.GetUnique(LBG.progressiveRevealForm.selectedFieldID.sort());}).change(function(){LBG.progressiveRevealForm.selectedElement=$(this).attr("id");objElm=$(this);LBG.progressiveRevealForm.selectedFieldID.push($(this).attr("id"));LBG.progressiveRevealForm.selectedFieldID=LBG.progressiveRevealForm.GetUnique(LBG.progressiveRevealForm.selectedFieldID.sort());}).keyup(function(e){LBG.progressiveRevealForm.selectedElement=$(this).attr("id");objElm=$(this);LBG.progressiveRevealForm.selectedFieldID.push($(this).attr("id"));LBG.progressiveRevealForm.selectedFieldID=LBG.progressiveRevealForm.GetUnique(LBG.progressiveRevealForm.selectedFieldID.sort());});$(".section-row:not(.lastStep)").bind("keypress",function(event){if(event.which===13){vldHnlr=LBG.Forms.Validation.Tools.getFieldHandler(objElm);if(vldHnlr){vldHnlr.validate();if(vldHnlr.isValid){objElm.closest(".formField").next().find("input:not(.submitAction,.pseudoLink), textarea, select").focus();}}return false;}});if($(".frmProgressiveReveal .section-row input:not(.submitAction,.pseudoLink), textarea, select").closest(".section-row").length>0){LBG.progressiveRevealForm.bindEvent();}}};var positionOnPageLoad=new Class(".pageload-position",{init:function(element){this.element=element;$("html, body").animate({scrollTop:element.offset().top},700);}});LBG.carDetailsDropDowns={init:function(){$(".carLoan-car-details .container-car-reg-yesno input:radio.rdo-reg-no").click(function(){$(".carLoan-car-details .container-car-reg .car-reg input:text").val("");});$(".carLoan-car-details .container-car-reg-yesno input:radio").click(function(){$("form.form-car-details").submit();});$(".carLoan-car-details .container-car-condition input:radio").click(function(){LBG.clearForm(".container-dropdown","empty");LBG.clearForm(".option-panel .inputGroup","empty");$(".submit-car-details.on").addClass("hide");$(".continueToCalc").addClass("hide");$(".car-filter-list").addClass("hide");$(".cars-amend-filters").addClass("hide");$(".additional-details").addClass("hide");});$(".container-car-condition input:radio").click(function(){$(".formSubmitError").remove();});$(".container-car-condition .rdo-car-new").click(function(){$(".container-car-used").addClass("hide");if(!$(".car-make select").hasClass("select-dropdown")){LBG.carDetailsDropDowns.getData(null,"car-make");$(".carLoan-car-details .container-car-details").removeClass("hide");}$(".submit-car-details.on").addClass("hide");$(".submit-car-details.off").removeClass("hide");});$(".container-car-condition .rdo-car-used").click(function(){$(".carLoan-car-details .container-car-details").addClass("hide");LBG.clearForm(".container-dropdown","empty");$(".container-car-used").removeClass("hide").removeAttr("style");});$(".submit-car-details.off").click(function(e){e.preventDefault();});$(".submit-car-details.on a").click(function(e){e.preventDefault();var userSelection=$(".car-engine").find("select").val();if(!LBG.carDetailsDropDowns.state.inital){$(".disabled-calc").addClass("hide");$(".continueToCalc").removeClass("hide");}LBG.carDetailsDropDowns.doFilterList(userSelection);});$(".carLoan-car-details .additional-details .rdo-existing-finance input:radio.rdo-yes").click(function(){$(".additional-details .txt-monthly-repayment").addClass("validate:(required_validateCurrency)");LBG.Forms.Validation.init();});},bindEventsAfterAjax:function(context){$(".select-dropdown",context).change(function(){var ddCurrent=(context.attr("class").match(/car-[\w-]*\b/)[0]);var userSelection=$(this).val();LBG.carDetailsDropDowns.checkDropDownState();LBG.carDetailsDropDowns.getNextDropdown(ddCurrent,userSelection);});},getNextDropdown:function(ddCurrent,userSelection){var dropdowns=["car-make","car-model","car-transmission","car-fuel","car-body","car-engine"];var currentPos=jQuery.inArray(ddCurrent,dropdowns);if(dropdowns.length-1<=currentPos&&!$(".container-dropdown."+ddCurrent).find("select option:eq(0)").is(":selected")){$(".submit-car-details.off").addClass("hide");$(".submit-car-details.on").removeClass("hide");}else{if($(".container-dropdown."+ddCurrent).find("select option:eq(0)").is(":selected")){var nextDropdown=currentPos+1;$(".container-dropdown."+dropdowns[nextDropdown]+" select").attr("disabled","disabled");$(".submit-car-details.on").addClass("hide");$(".submit-car-details.off").removeClass("hide");}else{$(".submit-car-details.on").addClass("hide");$(".submit-car-details.off").removeClass("hide");LBG.carDetailsDropDowns.getData(dropdowns[currentPos],dropdowns[currentPos+1],userSelection);}for(var i=currentPos;i<dropdowns.length;i++){$(".container-dropdown."+dropdowns[i+1]+" select option:eq(0)").attr("selected","selected");
$(".container-dropdown."+dropdowns[i+1]+" select").attr("disabled","disabled");}}},getData:function(ddCurrent,ddNext,userSelection){var ajaxUrl=DI.lang.loans.car.detailsDropdown.ajax.url;var errorUrl=DI.lang.loans.car.detailsDropdown.ajax.errorUrl;$.ajax({url:ajaxUrl,data:{dropdown:ddCurrent,selection:userSelection},beforeSend:function(){var loading="<p class='inline-loading'>Loading</p>";$(".container-dropdown."+ddNext).empty().append(loading);},success:function(data){$(".container-dropdown."+ddNext+" .loading").hide();$(".container-dropdown."+ddNext).empty().append(data);$(".container-dropdown."+ddNext).find("option:first").attr("selected","selected");LBG.carDetailsDropDowns.bindEventsAfterAjax($(".container-dropdown."+ddNext));},error:function(){window.location.replace(errorUrl);}});$(document).ajaxStop(function(){$(".container-dropdown."+ddNext+" .loading").hide();});},doFilterList:function(userSelection){LBG.carDetailsDropDowns.state.inital=false;$(".pat522 .car-spec, .pat522.car-filter-list").removeClass("hide");$(".pat522 .cars-no-value, .pat522 .cars-too-many, .pat522 .selected-option-panel").addClass("hide");$(".pat522 .refine-list").css("display","block");$("html, body").animate({scrollTop:$(".pat522.car-filter-list").offset().top},1000);LBG.filterList.init({validate:function(data){if(data.tooManyCarsFound){$(".cars-too-many").removeClass("hide");$(".pat522 .car-spec, .cars-amend-filters").addClass("hide");LBG.filterList.failedValidation();return false;}if(data.noCarFound){$(".cars-no-value").removeClass("hide");$(".pat522 .car-spec, .cars-amend-filters").addClass("hide");LBG.filterList.failedValidation();return false;}$(".cars-amend-filters").addClass("hide");$(".pat522 .selected-car-panel").removeClass("hide");LBG.filterList.passedValidation();return true;},radioBtnClick:function(that){var $radio=$(that).find('input[type="radio"]');var selectedMake=$(".car-make").find("select").val();var selectedModel=$(".car-model").find("select").val();var selectedCar=$radio.next("span").text();var selectedCarValue=$radio.val();$(".pat522 div.radio-btn-wrap").removeClass("selected");$(that).addClass("selected");$radio.attr("checked",true);$radio.triggerHandler("click");LBG.filterList.storage.selectedRadioBtn=selectedCarValue;$(".pat522 .radio-button-selected").html(selectedMake+" "+selectedModel+" "+selectedCar);$(".additional-details, .continueToCalc").removeClass("hide");LBG.filterList.collapse();},changeRadioOption:function(){LBG.filterList.expand();},afterFilterCollapse:function(){$("#frmNewCarJourney\\:newCarstxtExpectedMileage").focus();},data:{dropdown:"car-engine",selection:userSelection}});},checkDropDownState:function(){if(!this.state.inital){$(".pat522 .car-spec, .car-filter-list, .cars-no-value, .cars-too-many, .selected-option-panel, .continueToCalc").addClass("hide");$(".pat522.car-filter-list, .cars-amend-filters, .disabled-calc").removeClass("hide");LBG.filterList.storage.selectedRadioBtn=null;LBG.filterList.failedValidation();if(LBG.quickPagination.settings.paginationOn){$(".quick-pagination").addClass("hide");}}},state:{inital:true}};LBG.filterList={getData:function(){$.ajax({contentType:"application/json",dataType:"json",cache:LBG.filterList.settings.cache,data:LBG.filterList.settings.data,url:DI.lang.loans.car.pat522FilterList.ajax.url,beforeSend:function(){$('<p class="filter inline-loading">Loading</p>').insertBefore(LBG.filterList.settings.ele);$("refine-list").css("display","none");},success:function(data){$(LBG.filterList.settings.ele).removeClass("hide");$(".filter.inline-loading").remove();LBG.filterList.storage.data=data;if(LBG.filterList.settings.validate(data)){LBG.filterList.populate(data.filterList);LBG.filterList.bind(data.filterList);}},error:function(){window.location.replace(DI.lang.loans.car.detailsDropdown.ajax.errorUrl);}});},populate:function(data){var $optionPanel=$(this.settings.ele).find(".option-panel .radioGroup");$optionPanel.empty();$optionPanel.append('<div class="panel-radio-btn clearfix"></div>');$(".select-model-list").empty();$(".select-model-list").append("<select></select>");for(var i=0;i<data.length;i++){$(".select-model-list select").append('<option value="'+data[i].selectList+'">'+data[i].selectList+"</option>");}for(var j=0;j<data[0].radioBtn.length;j++){$(this.settings.ele).find(".option-panel div.panel-radio-btn").append('<div class="radio-btn-wrap"><div class="inputGroup"><label><input id="'+this.replaceSpace(data[0].radioBtn[j].value)+'" type="radio" name="modeltype" value="'+data[0].radioBtn[j].value+'"><span>'+data[0].radioBtn[j].label+"</span></label></div></div>");}LBG.filterList.setTotalItems();LBG.filterList.doPagination();LBG.filterList.scrollBarCheck();this.alternate();},bind:function(data){var $div=$(this.settings.ele).find(".option-panel div.panel-radio-btn");$(".pat522").find(".select-model-list select").change(function(value){var $val=$(this).val();$div.empty();if($val===data[0].selectList){for(var j=0;j<data[0].radioBtn.length;j++){if(LBG.filterList.storage.selectedRadioBtn===data[0].radioBtn[j].value){$div.append('<div class="radio-btn-wrap selected"><div class="inputGroup"><label><input id="'+LBG.filterList.replaceSpace(data[0].radioBtn[j].value)+'" type="radio" name="modeltype" value="'+data[0].radioBtn[j].value+'" checked><span>'+data[0].radioBtn[j].label+"</span></label></div></div>");}else{$div.append('<div class="radio-btn-wrap"><div class="inputGroup"><label><input id="'+LBG.filterList.replaceSpace(data[0].radioBtn[j].value)+'" type="radio" name="modeltype" value="'+data[0].radioBtn[j].value+'"><span>'+data[0].radioBtn[j].label+"</span></label></div></div>");}}}else{for(var i=0;i<data.length;i++){if(data[i].selectList===$val){for(var j=0;j<data[i].radioBtn.length;j++){if(LBG.filterList.storage.selectedRadioBtn===data[i].radioBtn[j].value){$div.append('<div class="radio-btn-wrap selected"><div class="inputGroup"><label><input id="'+LBG.filterList.replaceSpace(data[i].radioBtn[j].value)+'" type="radio" name="modeltype" value="'+data[i].radioBtn[j].value+'" checked><span>'+data[i].radioBtn[j].label+"</span></label></div></div>");}else{$div.append('<div class="radio-btn-wrap"><div class="inputGroup"><label><input id="'+LBG.filterList.replaceSpace(data[i].radioBtn[j].value)+'" type="radio" name="modeltype" value="'+data[i].radioBtn[j].value+'"><span>'+data[i].radioBtn[j].label+"</span></label></div></div>");}}}}}LBG.filterList.doPagination();LBG.filterList.scrollBarCheck();LBG.filterList.alternate();});if(!this.storage.initialBind){$(this.settings.ele).find(".option-panel div.radio-btn-wrap").live("keydown",function(evt){var key=evt.which||evt.keyCode;if(key===13){return false;}setTimeout(function(){$(LBG.filterList.settings.ele).find('.radio-btn-wrap input[type="radio"]').attr("checked",false);$(LBG.filterList.settings.ele).find('.radio-btn-wrap.selected input[type="radio"]').attr("checked",true);},0);if(key===32){LBG.filterList.settings.radioBtnClick(this);}});$(this.settings.ele).find(".option-panel div.radio-btn-wrap").live("mousedown",function(evt){LBG.filterList.settings.radioBtnClick(this);});$(this.settings.ele).find(".change-radio-option").live("click",function(evt){evt.preventDefault();LBG.filterList.settings.changeRadioOption(this);});this.storage.initialBind=true;}},replaceSpace:function(value){return value.replace(/ /g,"");},doPagination:function(){LBG.quickPagination.init(this.settings.paginationSettings);},scrollBarCheck:function(){if(this.settings.scrollSettings.scrollOn){var countItems=$(this.settings.ele).find(".option-panel .radio-btn-wrap .inputGroup").length;
if(countItems>this.settings.scrollSettings.scrollOnCount){var calHeight=parseInt($(this.settings.ele).find(".option-panel .radio-btn-wrap .inputGroup").height()*this.settings.scrollSettings.scrollOnCount);$(this.settings.ele).find(".option-panel").css("height",calHeight+"px").css("overflow","auto");}else{$(this.settings.ele).find(".option-panel").css("height","").css("overflow","");}}},failedValidation:function(){$(this.settings.ele).find(".refine-list").css("display","none");$(this.settings.ele).find(".no-value").removeClass("hide");},passedValidation:function(){$(this.settings.ele).find(".no-value").addClass("hide");$(this.settings.ele).find(".refine-list").css("display","block");},alternate:function(){$(this.settings.ele).find(".option-panel div.radio-btn-wrap:even").addClass("alt");},collapse:function(){var ele=LBG.filterList.settings.ele;if(this.settings.paginationSettings.paginationOn){$(".quick-pagination").addClass("hide");}setTimeout(function(){$(ele).find(".selected-option-panel").removeClass("hide");$(ele).find(".refine-list").slideUp("slow",function(){LBG.filterList.settings.afterFilterCollapse();});},500);},expand:function(){if(this.settings.paginationSettings.paginationOn){$(".quick-pagination").removeClass("hide");}$(this.settings.ele).find(".refine-list").slideDown("slow",function(){$(".pat522 .radio-btn-wrap.selected input").blur().focus();});$(this.settings.ele).find(".selected-option-panel").addClass("hide");},setTotalItems:function(){var totalItems=$(this.settings.paginationSettings.itemEleWrap).length;var stringReplaceOn=this.settings.stringReplaceOn;var totalItemsEle=this.settings.totalItemsEle;var stringToReplace=this.settings.stringToReplace;if(stringReplaceOn){if(!this.storage.totalItemsUpdate){var str=$(totalItemsEle).html();var res=str.replace(stringToReplace,'<span class="total-items str-updated">'+totalItems+"</span>");$(totalItemsEle).html(res);this.storage.totalItemsUpdate=true;}else{$(".total-items.str-updated").html(totalItems);}}else{$(totalItemsEle).html(totalItems);}},storage:{selectedRadioBtn:null,totalItemsUpdated:false,initialBind:false},settings:{cache:true,data:null,ele:".pat522",totalItemsEle:".total-items",stringReplaceOn:true,stringToReplace:"{0}",validate:function(data){if(!data.filterList.length>0){LBG.filterList.failedValidation();return false;}LBG.filterList.passedValidation();return true;},radioBtnClick:function(that){$(LBG.filterList.settings.ele).find("div.radio-btn-wrap").removeClass("selected");$(that).addClass("selected");var $radio=$(that).find('input[type="radio"]');$radio.attr("checked",true);$radio.triggerHandler("click");LBG.filterList.storage.selectedRadioBtn=$radio.val();$(LBG.filterList.settings.ele).find(".radio-button-selected").html($radio.next("span").text());LBG.filterList.collapse();},changeRadioOption:function(){LBG.filterList.expand();},afterFilterCollapse:function(){},scrollSettings:{scrollOnCount:20,scrollOn:true},paginationSettings:{parentEle:".option-panel",itemEleWrap:"div.radio-btn-wrap",perPage:30,pagOnCount:30,paginationOn:false,totalItemsEle:".total-items"}},init:function(options){if(options){$.extend(this.settings,options);}isVisible=$(this.settings.ele).is(":visible");if(isVisible){$(this.settings.ele).addClass("hide");this.getData();}}},LBG.quickPagination={doPagination:function(){var perPage=this.settings.perPage;var pagOnCount=this.settings.pagOnCount;var parentEle=$(this.settings.parentEle);var itemEleWrap=parentEle.find(this.settings.itemEleWrap);var totalItems=itemEleWrap.length;var pagingNumbers=$(".quick-pagination .paging-numbers");pagingNumbers.empty();if(totalItems<pagOnCount){$(".quick-pagination").addClass("hide");return false;}var pagNumCount=Math.ceil(itemEleWrap.length/perPage);for(var i=0;i<pagNumCount;i++){itemEleWrap.slice(i*perPage,(i+1)*perPage).wrapAll('<div class="pagWrap" />');pagingNumbers.append('<a href="#" class="pageLinks"> '+(i+1)+" </a> ");}var pagWrap=parentEle.find(".pagWrap");pagWrap.each(function(){$(this).addClass("hide");});var pageLinks=".quick-pagination .paging-numbers a.pageLinks";$(pageLinks).click(function(e){$(pageLinks).removeClass("active");$(pageLinks+":nth-child("+parseInt($(this).text())+")").addClass("active");pagWrap.addClass("hide");pagWrap.eq(parseInt($(this).text())-1).removeClass("hide");if(parseInt($(this).text())===1){$(".quick-pagination .paging-items").html("<strong>1</strong> to <strong>"+perPage+"</strong> (of <strong>"+totalItems+"</strong>)");}else{var value=((parseInt($(this).text())-1)*perPage)+1;result=pagWrap.eq(parseInt($(this).text())-1).find(LBG.quickPagination.settings.itemEleWrap).length;resultCount=value+(result-1);$(".quick-pagination .paging-items").html("<strong>"+value+"</strong> to <strong>"+resultCount+"</strong> (of <strong>"+totalItems+"</strong>)");}e.preventDefault();});$(pageLinks+":first-child").addClass("active");$(pagWrap.eq(0)).removeClass("hide");$(".quick-pagination").removeClass("hide");$(".quick-pagination .paging-items").html("<strong>1</strong> to <strong>"+perPage+"</strong> (of <strong>"+totalItems+"</strong>)");},settings:{parentEle:".option-panel",itemEleWrap:"div.radio-btn-wrap",perPage:5,pagOnCount:21,paginationOn:true},init:function(options){if(options){$.extend(this.settings,options);}if(this.settings.paginationOn){this.doPagination();}}};$(document).ready(function(){LBG.common.identJS();LBG.accordion.addOpenClass();LBG.quickTransfer.init();$("input[type=radio]").fixRadioChange();$(".preventDefault").click(function(e){e.preventDefault();});LBG.miniStatement.init();LBG.scottishWidows.init();LBG.accordion.init();LBG.showHide.init();LBG.datePicker.init();LBG.help.init();LBG.ajaxPoweredAddressFinder.init();LBG.compareSelection.init();LBG.textAlerts.init();LBG.common.getNewWindowLinks();LBG.common.getNewWindowContinueActionLinks();LBG.common.getPrintLinks();LBG.common.getHighlightElements();LBG.common.replaceLongStrings();LBG.selectHybrid.init();LBG.employmentShowHide.init();LBG.manageTransfers.init();LBG.linkedRadioAndTextFields.init();LBG.linkedSelectAndTextFields.init();LBG.linkedCheckBoxAndTextFields.init();LBG.linkedTextFieldAndCheckBox.init();LBG.converter.init();LBG.enhanceOverdraftDetails.init();LBG.autoTotal.init();LBG.beneficiariesChooser.init();LBG.submitOnChange.init();LBG.tableSorter.init();LBG.previousAddressRepeater.init();LBG.initAddressRepeaters.init();LBG.paymentCalculator.init();LBG.accountSwitcher.init();LBG.balanceTransfer.init();LBG.enrichedSelects();LBG.businessOverdraft();LBG.statusToggle.init();LBG.scrollable.init();LBG.autoSelectRadioButton.init();LBG.setupPasscode.init();LBG.setupTextAlertsDailyFrequency();LBG.toggleFrequencyTerm.init();LBG.leapYearDayAdjust.init();LBG.successFadeOutDelay.init();LBG.warningFadeOutDelay.init();LBG.setFocus.init();LBG.rememberMe.init();LBG.internationalPayment.init();LBG.toggleBankRouting.init();LBG.contentScrollerTabIndex();LBG.expandSelect.init();LBG.timedLogout.init();LBG.investmentsExpandingTable.init();LBG.expandingTableByLink.init();LBG.loanExpandingTable.init();LBG.accountStatementTableExpandPolicy.init();LBG.ticker.init();LBG.investmentsFund.init();LBG.ajaxFormContentLoader.init();LBG.dbtSetupModules.init();LBG.jumpList.init();LBG.ajaxLink.init();LBG.tabs.init();LBG.calculateFundAllocations();LBG.flashEmbed.init();LBG.doNotUpdateEmail.init();LBG.managePaperStatements();LBG.fixedHeadingHeight.init();LBG.addressFinder.init();LBG.formAutoSubmit.init();LBG.alternateImageSrc();LBG.ajaxLoader.init();LBG.clearValuesOnHide.init();
LBG.stpLoanCalculatorSlider.init();LBG.filterBy.init();LBG.radioButtonPanel.init();LBG.yourInbox.init();LBG.optionPanelDisable.init();LBG.checkboxSelectAll.init();LBG.preventPaste.init();LBG.branchFinder.init();LBG.beneficaryReference.init();LBG.isaTopUpReference.init();LBG.isaOvelay1Ref.init();LBG.isaOvelay2Ref.init();LBG.showMeOrientation.init();LBG.fatcaNationality.init();LBG.multichannel.init();LBG.avaRadioButtons.init();LBG.iadaUtilities.init();LBG.ajaxPoweredBankFinder.init();LBG.vefTable.init();LBG.appointmentBookings.init();LBG.oabShowHidePropertyBox.init();LBG.oabShowHideEmailPhoneReminderBoxes.init();LBG.oabSearchSelectBranchBoxes.init();LBG.LinkDropDownToToolTip_Hrefs.init();LBG.jsPrintButton.init();LBG.loanServicing.init();LBG.showNextOnChange.init();LBG.travelFlags.init();LBG.fixedTermDepositReinvestDropDown.init();LBG.dateShortcut.init();LBG.eloanUtils.init();LBG.altOverlay.init();LBG.marmaladePhaseTwo.init();LBG.textNoSpace.init();LBG.iban.init();LBG.lostAndStolen.init();LBG.cssFixUtilities.init();LBG.browserSniffer.init();LBG.wtError.init();LBG.loans.init();LBG.inTNGA.init();LBG.selectAccountNew.init();LBG.ajaxSelect.init();LBG.emailModule.init();LBG.enableCheckbox.init();LBG.MiData.init();LBG.countryLookup.init();LBG.IEemptyCells.init();LBG.appBanner.init();LBG.procedureIndicator.init();LBG.addRemoveRowsLRA.init();LBG.numericInputSupport.init();LBG.residentialStatusLRA.init();LBG.sliderInputProgress.init();LBG.carFinanceTable.init();LBG.focusOnPageLoad.init();LBG.confimSavingsPayment.init();LBG.CommercialRBBSCardDetails.init();LBG.newWindow.init();LBG.statements.init();Autobinder.bind();LBG.inputKeyboard.init();LBG.clickableAreaForCheckbox.init();LBG.progressiveRevealForm.init();LBG.OPSSummaryData.init();LBG.RetailBaselinePJB();LBG.carDetailsDropDowns.init();LBG.filterList.init();LBG.colleagueBar.init();LBG.penniesForPudsey();LBG.autoLogoutApp.init();if($(".countdown").length>0){LBG.olympicCountdown.init($(".countdown"));}$("body").click(function(event){if(event.altKey){if("console" in window){console.log("August 27th 12:45am");}}});});$(window).load(function(){LBG.overlay.init();LBG.equalisePanelHeights.init();LBG.flashLink.init();});var LBG=window.LBG||{};LBG.tags={ajax:{ajaxActions:[],addAjaxAction:function(id,target,source,event,type,href,params,paramsfields,onstart,onerror,oncomplete,replace,fade,spinner,disabledSrc,onsuccess,onfadedone){LBG.tags.ajax.ajaxActions.push({"id":id,"target":target,"source":source,"event":event,"type":type,"href":href,"params":params,"paramsfields":paramsfields,"onstart":onstart,"onerror":onerror,"oncomplete":oncomplete,"replace":replace,"fade":fade,"spinner":spinner,"disabledSrc":disabledSrc,"onsuccess":onsuccess,"onfadedone":onfadedone});},getAjaxAction:function(id){var actions=LBG.tags.ajax.ajaxActions;if(actions.length>0){for(var i=0,l=actions.length;i<l;i++){var aa=actions[i];if(aa.id===id){return aa;}}}return null;},getAjaxActionData:function(aa){var data,module,$module,$moduleInputs,inputVals=[];data=aa.id!=null?{"$aid":aa.id}:{};module=aa.target;$module=$(LBG.common.escapeSpecialCharsInId(module));$moduleDataCells=$module.find('table td:not(".first")');$moduleDataCells.each(function(){var isChecked;if($(this).find("input").length===1){var $thisInput=$(this).find("input");var thisInputId=$thisInput[0].id.split(":");isChecked=$thisInput.is(":checked");thisInputId=thisInputId[thisInputId.length-1];}else{isChecked=false;}inputVals.push(isChecked);});if(aa.type===2&&aa.params&&aa.paramsfields){var p=aa.params.split(",");var fp=aa.paramsfields.split(",");if(p.length==fp.length){for(var i=0;i<p.length;i++){var el=$(LBG.common.escapeSpecialCharsInId(fp[i]));if(el.length==0){data[p[i]]=fp[i];}else{if(el.parents(".formField").hasClass("error")){return -1;}if(el.is(":checkbox")){if(el.length==1){data[p[i]]=el.is(":checked");}else{if(!data[p[i]]){data[p[i]]=[];}el.each(function(){var id=el.attr("id").split(":");var target=data[p[i]];for(var e in id){if(id.hasOwnProperty(e)){if(!target[id[e]]){target[id[e]]=[];}target=target[id[e]];}}target=el.is(":checked");});}}else{data[p[i]]=el.val();}}}}}if(inputVals.length>0){data.checkedInputs=inputVals.join();}return data;},evalFunc:function(f){if(f){if(typeof f=="string"){eval(f);}else{f();}}},injectContent:function(aa,id,el,response){if(aa.fade!=true){if(aa.replace!=false){el.replaceWith(response);}else{el.html(response);}}else{el.fadeOut("slow",function(){if(aa.replace!=false){$(this).replaceWith($(response).hide());}else{$(this).html(response);}var e=$(id);var p;if(e.length==0&&(p=id.lastIndexOf(":"))>0){id=id.substring(p+1);e=$(LBG.common.escapeSpecialCharsInId(id));if(e.length==0){alert("Can't find element with id: "+id);}}e.fadeIn("slow",function(){LBG.tags.ajax.evalFunc(aa.onfadedone);});});}},ajaxActionHandler:function(event){var idx=event.data.idx;var aa=LBG.tags.ajax.ajaxActions[idx];var uri=LBG.common.ajax.tagUrl(aa.href);var id=LBG.common.escapeSpecialCharsInId(aa.target);var el=$(id);if(el.length==0){alert("Cannot find the target: "+aa.target+", element for the ajax call: "+uri);return;}var dat=LBG.tags.ajax.getAjaxActionData(aa);if(dat===-1){return;}var origImg;if(aa.disabledSrc){var sEl=$(LBG.common.escapeSpecialCharsInId(aa.source));origImg=sEl.attr("src");sEl.disabled=true;sEl.attr("src",aa.disabledSrc);}if(aa.spinner){$(LBG.common.escapeSpecialCharsInId(aa.spinner)).attr("style","display: block");}$.ajax({url:uri,data:dat,type:aa.type===1?"POST":"GET",success:function(response){var vh=LBG.Forms.Validation.Tools.getValidationHandlerObject(el);if(vh){var pel=el.parent();vh.removeChildren(el);LBG.tags.ajax.injectContent(aa,id,el,response);vh.hideError();vh.isValid=false;el=$(id);vh.findChildren(el.length==0?pel:el);}else{LBG.tags.ajax.injectContent(aa,id,el,response);}LBG.ajax.pageUpdated();LBG.tags.ajax.evalFunc(aa.onsuccess);},beforeSend:function(){LBG.tags.ajax.evalFunc(aa.onstart);},error:function(){LBG.tags.ajax.evalFunc(aa.onerror);},complete:function(){if(aa.spinner){$(LBG.common.escapeSpecialCharsInId(aa.spinner)).attr("style","display: none");}if(aa.disabledSrc){var sEl=$(LBG.common.escapeSpecialCharsInId(aa.source));sEl.disabled=false;sEl.attr("src",origImg);}LBG.tags.ajax.evalFunc(aa.oncomplete);}});return false;},init:function(){$(".ajaxAction").each(function(i,trigger){var jqEl=$(trigger);var meta=jqEl.metadata();LBG.tags.ajax.addAjaxAction(null,meta.target,jqEl.attr("id"),meta.event,2,meta.href,meta.params,meta.paramsfields,meta.onstart,meta.onerror,meta.oncomplete,meta.replace,meta.fade,meta.spinner,meta.disabledSrc,meta.onsuccess,meta.onfadedone);});var actions=LBG.tags.ajax.ajaxActions;if(actions.length>0){for(var i=0,l=actions.length;i<l;i++){var aa=actions[i];$(LBG.common.escapeSpecialCharsInId(aa.source)).bind(aa.event,{"idx":i},LBG.tags.ajax.ajaxActionHandler);}}}}};$(document).ready(function(){LBG.tags.ajax.init();});