iBarclays=iBarclays||{};iBarclays.Login=function(a){this.COOKIE_NAME="assist2";this.root=a;this.form=this.root.find("form");this.inputs=this.form.find("input");this.textInputs=this.inputs.filter("[type=text]");this.form.find("div.optional input[type=text]").attr("linked",true);this.groups=this.form.find("div.option-group");this.linkedRadioButtons=this.inputs.filter(".linked-radio");this.linkedLabels=this.root.find("label.linked-label");this.selectedGroup=null;this.selectedRadioButton=null;this.savedDetailsPanel=this.form.find("#saved-details");this.noSavedDetailsPanel=this.form.find("#none-saved-details");this.storedAccountDetails=this.getStoredAccountDetails();this.table=this.root.find("#login-table");this.displayStoredAccountDetails();this.displayNoSavedDetails();this.setUp()};iBarclays.Login.prototype=new iBarclays.Controls.Events.Custom();iBarclays.Login.prototype.setUp=function(){if($(".date-picker").length){if(iBarclays.iOSDevice()){iBarclays.Config.SystemValues.datePicker.showOn="both"}$(".date-picker").datepicker(iBarclays.Config.SystemValues.datePicker);$(".ui-datepicker-trigger").each(function(){var c=$(this).closest(".text");c.append(this)})}$("div.accordion div.module-holder").each(this.setAccordionHolderClass);$("div.accordion").accordion({header:".module-header",autoHeight:false});this.form.find("input:submit").click(this.getHandler(this.loginForm_Submit));this.linkedRadioButtons.keydown(function(d){switch(d.which){case 32:case 37:case 38:case 39:case 40:var c=$(this).closest("form");c.attr("data-eventFromKey","true");break}return true});this.linkedRadioButtons.click(this.getHandler(this.radio_Click));var b=window.opener;var a=$(".section-error p");if(b&&a.length){if(a.html().indexOf("505")>0){b.location="LoginLink6fbf.html?error=505";window.close()}}};iBarclays.Login.prototype.getStoredAccountDetails=function(){return $.cookie(this.COOKIE_NAME)};iBarclays.Login.prototype.setStoredAccountDetails=function(a){$.cookie(this.COOKIE_NAME,a,{expires:999});return this};iBarclays.Login.prototype.deleteAccountDetails=function(c){var b=this.getStoredAccountDetails();if(b){var a=b.split(",");a.splice(c,1);b=a.join(",")}this.setStoredAccountDetails(b)};iBarclays.Login.prototype.saveAccountDetails=function(b){var a=this.getStoredAccountDetails();if(a&&a.length){itemExists=b.match(a);if(!itemExists){a+=","+b}}else{a=b}this.setStoredAccountDetails(a)};iBarclays.Login.prototype.getStoredDataItem=function(b,a){var d="(#|,|^)"+a+"=([^&,]+)(&amp;|,|$)",c=new RegExp(d);match=c.exec(b);if(match){return match[2]}return};iBarclays.Login.prototype.displayNoSavedDetails=function(){this.textInputs.val("");this.displayOptionalInputs()};iBarclays.Login.prototype.displayOptionalInputs=function(c){var f=false;if(!c){c=(this.linkedRadioButtons.filter(":checked").length)?this.linkedRadioButtons.filter(":checked"):this.linkedRadioButtons.eq(0);f=true}c=$(c);var b=c.attr("id");if(b){var a="#"+b.replace("-radio",""),d=c.closest("form");d.validate().resetForm();d.find("div.option-group").hide().filter(a).show();if(f){formContext=d}else{this.selectedGroup=this.groups.filter(a);formContext=this.selectedGroup;var e=c.val();if(this.savedAuthMethod!=e){d.find("span.optional-label").hide();d.find(a+"-label").show();d.find("div.save-preference").show()}else{d.find("div.save-preference").hide()}}if(d.attr("data-eventFromKey")){d.removeAttr("data-eventFromKey")}else{formContext.find("input[type=text]").eq(0).focus()}}};iBarclays.Login.prototype.displayStoredAccountDetails=function(){this.table.find("a.remove").click(this.getHandler(this.remove_Click))};iBarclays.Login.prototype.setAccordionHolderClass=function(a){var b="middle-module";if(a===0){b="first-module"}else{if(!$(this).next().length){b="last-module"}}$(this).addClass(b)};iBarclays.Login.prototype.differentDetails_Click=function(){this.displayNoSavedDetails()};iBarclays.Login.prototype.radio_Click=function(a){this.displayOptionalInputs($(a.target))};iBarclays.Login.prototype.loginForm_Submit=function(c){var b=$(c.target),a=b.closest("form");if(b.is("input#back")||a.valid()){iBarclays.Controls.Loading.blockContainer();this.preventLoginTimeout()}else{c.preventDefault()}};iBarclays.Login.prototype.remove_Click=function(d){var c=$(d.target),a=c.closest("tr"),b=a.closest("table");this.deleteAccountDetails(b.find("tr").index(a));a.remove();if(!b.find("tr").length){this.displayNoSavedDetails()}else{a.remove()}d.preventDefault()};$(function(){new iBarclays.Login($("div.login-ctr"))});iBarclays.Login.prototype.preventLoginTimeout=function(){if(loginTimeoutKeepAliveInstance.timedOut){$.ajax({type:"GET",url:iBarclays.Config.SystemValues.auth.path+"LoginTimeoutKeepAlive.action",async:false})}};